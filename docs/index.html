<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Implementation of Cluster Stability Selection (Faletto and
    Bien 2022).">
<title>Cluster Stability Selection • cssr</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Cluster Stability Selection">
<meta property="og:description" content="Implementation of Cluster Stability Selection (Faletto and
    Bien 2022).">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">cssr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gregfaletto/cssr-project/tree/main/cssr/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="cluster-stability-selection">Cluster Stability Selection<a class="anchor" aria-label="anchor" href="#cluster-stability-selection"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>The cssr package implements <a href="https://arxiv.org/abs/2201.00494" class="external-link">cluster stability selection (Faletto and Bien 2022)</a>, a feature selection method designed to allow stability selection to work effectively in the presence of highly correlated features.</p>
<div class="section level2">
<h2 id="installing-the-cssr-package">Installing the cssr Package<a class="anchor" aria-label="anchor" href="#installing-the-cssr-package"></a>
</h2>
<p>You can install the cssr package using the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"gregfaletto/cssr-project"</span>, subdir <span class="op">=</span> <span class="st">"cssr"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="an-introduction-to-the-package">An Introduction to the Package<a class="anchor" aria-label="anchor" href="#an-introduction-to-the-package"></a>
</h2>
<p>Given data <span class="math inline">(<em>X</em>,<em>y</em>)</span>, cluster stability selection selects the variables in <span class="math inline"><em>X</em></span> that are useful for predicting <span class="math inline"><em>y</em></span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cssr</span><span class="op">)</span></span>
<span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">983219</span><span class="op">)</span></span>
<span><span class="co"># Generate some data containing clusters of highly correlated features</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/genClusteredData.html">genClusteredData</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">80</span>, <span class="co"># Sample size</span></span>
<span>                         p <span class="op">=</span> <span class="fl">40</span>, <span class="co"># Number of features </span></span>
<span>                         cluster_size <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Number of features in a cluster correlated with a latent variable</span></span>
<span>                         k_unclustered <span class="op">=</span> <span class="fl">10</span>, <span class="co"># Number of unclustered features that influence y</span></span>
<span>                         snr <span class="op">=</span> <span class="fl">3</span> <span class="co"># Signal-to-noise ratio in the response y generated from the data.</span></span>
<span>                         <span class="op">)</span></span>
<span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">y</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cssSelect.html">cssSelect</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output</span><span class="op">$</span><span class="va">selected_feats</span></span></code></pre></div>
<p>I’ll first walk through a description of <a href="https://arxiv.org/abs/0809.2932" class="external-link">stability selection (Meinshausen and Bühlmann, 2010)</a>, the method that cluster stability selection builds on. Then I’ll illustrate a problem with stability selection when data with clusters of highly correlated features are observed. This problem motivates cluster stability selection. Finally, I’ll demonstrate how to use the cssr package to implement cluster stability selection. The cssr package is <strong>written with over 3400 tests</strong> ensuring that it functions exactly the way we intended when we wrote the paper.</p>
</div>
<div class="section level2">
<h2 id="stability-selection">Stability Selection<a class="anchor" aria-label="anchor" href="#stability-selection"></a>
</h2>
<p>Cluster stability selection is an extension of <a href="https://arxiv.org/abs/0809.2932" class="external-link">stability selection (Meinshausen and Bühlmann, 2010)</a>. Stability selection is a procedure deisgned to make any feature selection procedure more <em>stable</em>. Given a data set <span class="math inline">(<strong>X</strong>,<strong>y</strong>)</span> with <span class="math inline"><em>n</em></span> observations, stability selection works as follows:</p>
<ul>
<li>The data are divided into <span class="math inline"><em>B</em></span> subsamples of size <span class="math inline"><em>n</em>/2</span> (typically, <span class="math inline"><em>B</em></span> might be around 50 or 100).</li>
<li>The desired feature selection method is run on each subsample, yielding <span class="math inline"><em>B</em></span> selected sets of features.</li>
<li>For each feature, we count how many times it was selected and divide by <span class="math inline"><em>B</em></span> to get a <em>selection proportion</em>. We interpret the selection proportion for each feature as a measure of feature importance–the higher the selection proportion is for a feature, the more relevant we think it is for predicting <span class="math inline"><em>y</em></span>.</li>
<li>Finally, we use the selection proportions to get a selected set (for example, by taking the top <span class="math inline"><em>s</em></span> features for some predetermined <span class="math inline"><em>s</em></span>).</li>
</ul>
<p>The below diagram (from Faletto and Bien 2022) demonstrates the procedure. In the diagram, the lasso is the chosen feature selection procedure, and a selected set is chosen by choosing all features with selection proportions larger than a predetermined <span class="math inline"><em>τ</em></span>.</p>
<div class="figure">
<img src="reference/figures/stability-selection-diagram.png" title="Stability Selection" alt=""><p class="caption">Stability Selection Flowchart Figure</p>
</div>
<p>In the classic framework of <a href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff" class="external-link">bias/variance tradeoff</a>, we can think of stability selection as a way to reduce variance at the price of increasing bias. We get a more stable and robust (lower variance) feature selection procedure because we average over many subsamples. The price we pay is that each selected set is estimated using a sample of size <span class="math inline"><em>n</em>/2</span> rather than <span class="math inline"><em>n</em></span>.</p>
</div>
<div class="section level2">
<h2 id="why-cluster-stability-selection">Why Cluster Stability Selection?<a class="anchor" aria-label="anchor" href="#why-cluster-stability-selection"></a>
</h2>
<p><strong>Stability selection doesn’t do well when features are highly correlated.</strong> The problem is that if there are clusters of highly correlated features, any one member of the cluster might be a reasonably good choice for a predictive model. So the base feature selection might select one cluster member more or less at random. Then at the end, no one cluster member will have a high selection proportion, so no cluster member will be selected as an important feature, even if every selected set contained a cluster member. This problem has been called “vote-splitting.”</p>
<p>In <a href="https://arxiv.org/abs/2201.00494" class="external-link">our paper</a>, we walk through an example where there is a latent (unobserved) feature <span class="math inline"><em>Z</em></span> that is important for predicting <span class="math inline"><em>y</em></span>. <span class="math inline"><em>Z</em></span> is not observed, but 10 <em>proxies</em> for <span class="math inline"><em>Z</em></span> are observed–features that are highly correlated with <span class="math inline"><em>Z</em></span> (and therefore with each other, too). There are also 10 “weak signal” features that influence <span class="math inline"><em>y</em></span>, but less so than <span class="math inline"><em>Z</em></span>. We show in a simulation study that stability selection tends to end up with low selection proportions for the proxies for <span class="math inline"><em>Z</em></span>, even though any one of the <span class="math inline"><em>Z</em></span> proxies would be more useful for predicting <span class="math inline"><em>y</em></span> than all of the “weak signal” features.</p>
<p>The below figure shows the selection proportions yielded by stability selection for proxies for <span class="math inline"><em>Z</em></span>, “weak signal” features, and “noise” features that are unrelated to <span class="math inline"><em>y</em></span>.</p>
<div class="figure">
<img src="reference/figures/sel_props.png" title="Proxy Selection Proportions" alt=""><p class="caption">Selection Proportions</p>
</div>
</div>
<div class="section level2">
<h2 id="how-does-cluster-stability-selection-fix-this">How does cluster stability selection fix this?<a class="anchor" aria-label="anchor" href="#how-does-cluster-stability-selection-fix-this"></a>
</h2>
<p>Cluster stability selection modifies stability selection with a simple fix: instead of only keeping track of the individual feature selection proportions, we also keep track of the <em>cluster selection proportions</em>–the proportion of subsamples in which at least one cluster member was selected. Then we can rank clusters by their importance according to cluster selection proportion, and select entire clusters. This avoids the vote-splitting problem!</p>
</div>
<div class="section level2">
<h2 id="getting-started-with-selecting-features-by-cluster-stability-selection-using-the-cssselect-function">Getting started with selecting features by cluster stability selection using the cssSelect function<a class="anchor" aria-label="anchor" href="#getting-started-with-selecting-features-by-cluster-stability-selection-using-the-cssselect-function"></a>
</h2>
<p>The data we generated at the beginning of third document contain a cluster of 10 features (specifically, the first 10 columns of <span class="math inline"><em>X</em></span>) that are highly correlated both with each other and also with an unobserved variable <span class="math inline"><em>Z</em></span> that is associated with <span class="math inline"><em>y</em></span>. The cssSelect function in the cssr package yields a set of features selected by cluster stability selection. We can tell cssSelect about the cluster using the “clusters” argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clus_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cssSelect.html">cssSelect</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>This input tells cssSelect that features 1 through 10 are in a cluster, and it names the cluster “Z_cluster” (providing a name is optional and is only for your convenience). cssSelect returns both a set of selected clusters (below) and all of the features contained within those clusters (as in the above).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clus_output</span><span class="op">$</span><span class="va">selected_clusts</span></span>
<span></span>
<span><span class="va">clus_output</span><span class="op">$</span><span class="va">selected_feats</span></span></code></pre></div>
<p>By default, cssSelect decides how many clusters to select on its own. However, you can set this yourself using the max_num_clusts argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clus_output_three</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cssSelect.html">cssSelect</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  max_num_clusts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">clus_output_three</span><span class="op">$</span><span class="va">selected_clusts</span></span></code></pre></div>
<p>You can also select all of the clusters with selection proportion above a certain threshold, rather than selecting a pre-specified number of clusters.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clus_output_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cssSelect.html">cssSelect</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  cutoff<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">clus_output_3</span><span class="op">$</span><span class="va">selected_clusts</span></span></code></pre></div>
<p>cssSelect uses the lasso (as implemented by the R glmnet package) as the base feature selection procedure. The lasso requires a tuning parameter <span class="math inline"><em>λ</em></span>. cssSelect will choose <span class="math inline"><em>λ</em></span> automatically by default, but you can also provide your own <span class="math inline"><em>λ</em></span> value if you’d like. (Remember that <span class="math inline"><em>λ</em></span> should be chosen for subsamples of size <span class="math inline"><em>n</em>/2</span>.)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clus_output_lam</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cssSelect.html">cssSelect</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  lambda<span class="op">=</span><span class="fl">0.01</span>, cutoff<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-more-advanced-the-css-function">Getting more advanced: the css function<a class="anchor" aria-label="anchor" href="#getting-more-advanced-the-css-function"></a>
</h2>
<p>Cluster stability selection is computationally intensive because it involves running a feature selection algorithm <span class="math inline"><em>B</em></span> times. Because of that, if you are going to use one data set and play around with the results (for example, by trying different model sizes or cutoffs), it is more efficient to only do the feature selection step once and then use the results however you want. The function css isolates this computationally intensive set and provides a convenient output that can be easily used by other functions in the package.</p>
<p>The css function is both more flexible and more demanding than cssSelect. In particular, css requires you to specify a lambda. If you’re not sure how you want to choose a lambda, we provide a function getLassoLambda that will do it for you.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getLassoLambda.html">getLassoLambda</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co"># Notice that the below function call takes kind of a long time. (cssSelect has to call css internally every time it is used.)</span></span>
<span><span class="va">css_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/css.html">css</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">lambda</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">css_output</span><span class="op">)</span></span></code></pre></div>
<p>The css function outputs an object of class cssr, a list containing the following elements:</p>
<ul>
<li>feat_sel_mat: A <span class="math inline">2 ⋅ <em>B</em> × <em>p</em></span> matrix of feature selection indicators. (feat_sel_mat[i, j] equals 1 if feature j was selected on set i and 0 otherwise.) feat_sel_mat is used to calculate the feature selection proportions.</li>
<li>clus_sel_mat: Like feat_sel_mat, except its number of columns is equal to the number of clusters, and it contains indicators of whether each cluster was selected on each subsample. clus_sel_mat is used to calculate the cluster selection proportions.</li>
<li>X (the originally provided X is returned)</li>
<li>y (the originally provided y is returned)</li>
<li>clusters (a list of clusters is returned; any features that were not specified to be in a cluster in the function input will be put in their own “cluster” of size 1, and any unnamed clusters will automatically get their own names).</li>
<li>train_inds (don’t worry about this for now)</li>
</ul>
<p>css has more options than cssSelect. Here are some of the options:</p>
<ul>
<li>You can select your own number of subsamples to use <span class="math inline"><em>B</em></span>. Larger values of <span class="math inline"><em>B</em></span> may be a bit more robust, but will require more computation time. (Also, there will be diminishing returns past a certain point, since there are only <span class="math inline"><em>n</em></span> data points to work with no matter how large <span class="math inline"><em>B</em></span> gets.) The default <span class="math inline"><em>B</em></span> is 50, leading to 100 subsamples.</li>
<li>You can specify your own feature selection function, fitfun. This must be a function that accepts as arguments X, y, and lambda (the lambda argument can be ignored if you like) and it must return an integer vector (containing the indices of the features selected using the data). Other than those requirements, the function can be whatever you want! Here’s one example of a valid (but silly) fitfun that ignores lambda and chooses <span class="math inline"><em>p</em>/2</span> features at random:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">testFitfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>    <span class="co"># Choose p/2 features randomly</span></span>
<span>    <span class="va">selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span><span class="va">p</span>, size<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">p</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">selected</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="va">css_output_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/css.html">css</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">lambda</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  fitfun<span class="op">=</span><span class="va">testFitfun</span>, B<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">css_output_test</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
<p>Here’s another that requires lambda to be an integer and takes the top lambda features with the highest absolute correlations with y. (Lambda can be anything you want and mean whatever you want, it’s up to you!)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corFitfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>    <span class="va">cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">cors</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cors</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">lambda</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">selected</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span><span class="va">css_output_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/css.html">css</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, lambda<span class="op">=</span><span class="fl">8</span>, clusters<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_cluster"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  fitfun<span class="op">=</span><span class="va">testFitfun</span>, B<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">css_output_cor</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="getting-selected-feature-sets-using-getcssselections">Getting selected feature sets using getCssSelections<a class="anchor" aria-label="anchor" href="#getting-selected-feature-sets-using-getcssselections"></a>
</h1>
<p>The function getCssSelections gets sets of selected features from the output of css. (This function is much faster to call than cssSelect since it relies on the already-generated output from css.)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sels</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getCssSelections.html">getCssSelections</a></span><span class="op">(</span><span class="va">css_output</span>, max_num_clusts<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sels</span></span></code></pre></div>
<p>You can choose a selected set according to a few criteria that you can provide as function inputs:</p>
<ul>
<li>Set a cutoff to select only features whose selection proportions are at least as large as the cutoff.</li>
<li>Set min_num_clusts to ensure that at least min_num_clusts features are returned (regardless of cutoff)</li>
<li>Set max_num_clusts to ensure that at most max_num_clusts are returned (regardless of cutoff, and if fulfilling min_num_clusts and max_num_clusts at the same time is impossible, max_num_clusts gets priority).</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/getCssSelections.html">getCssSelections</a></span><span class="op">(</span><span class="va">css_output</span>, cutoff<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/getCssSelections.html">getCssSelections</a></span><span class="op">(</span><span class="va">css_output</span>, cutoff<span class="op">=</span><span class="fl">0.99</span>, min_num_clusts<span class="op">=</span><span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/getCssSelections.html">getCssSelections</a></span><span class="op">(</span><span class="va">css_output</span>, cutoff<span class="op">=</span><span class="fl">0.5</span>, min_num_clusts<span class="op">=</span><span class="fl">3</span>, max_num_clusts<span class="op">=</span><span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>vignette incomplete past this point…</p>
<p>Here’s a brief summary of how cluster stability selection works: besides the data <span class="math inline">(<em>X</em>,<em>y</em>)</span>, cluster stability selection also requires a “base” feature selection method, and can also accept a tuning parameter for that method. (The default feature selection method is the lasso, which as tuning parameter lambda.) Cluster stability selection takes a large number <span class="math inline"><em>B</em></span> of subsamples of size <span class="math inline"><em>n</em>/2</span> and runs the feature selection method on each subsample, yielding <span class="math inline"><em>B</em></span> selected sets.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"Z_clust"</span><span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">36</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Wrapper functions (easy!)</span></span>
<span><span class="va">n_test</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">80</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">testx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">n_test</span>, ncol<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/cssPredict.html">cssPredict</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span>, <span class="va">testx</span>, <span class="va">clusters</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a good lambda</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getLassoLambda.html">getLassoLambda</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># clusters &lt;- list(1:10, 46:40)</span></span>
<span><span class="co"># clusters &lt;- 1:10</span></span>
<span></span>
<span><span class="va">inds</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">40</span></span>
<span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/css.html">css</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">y</span>, lambda<span class="op">=</span><span class="va">lambda</span></span>
<span>               , clusters<span class="op">=</span><span class="va">clusters</span></span>
<span>               <span class="co"># , clusters=list()</span></span>
<span>               <span class="co"># , clusters=1:10</span></span>
<span>               <span class="co"># , sampling.type = "SS"</span></span>
<span>               <span class="co"># B = 100,</span></span>
<span>               <span class="co"># , prop_feats_remove = .5</span></span>
<span>               , train_inds <span class="op">=</span> <span class="va">inds</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/getCssPreds.html">getCssPreds</a></span><span class="op">(</span>testX <span class="op">=</span> <span class="va">testx</span>, weighting<span class="op">=</span><span class="st">"sparse"</span>,</span>
<span>                                      cutoff<span class="op">=</span><span class="fl">0.3</span></span>
<span>                                      , min_num_clusts<span class="op">=</span><span class="fl">1</span></span>
<span>                                      , max_num_clusts<span class="op">=</span><span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="va">predictions</span></span>
<span></span>
<span><span class="va">train_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span><span class="op">*</span><span class="va">p</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">n_test</span>, ncol<span class="op">=</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="va">train_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds2</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/getCssPreds.html">getCssPreds</a></span><span class="op">(</span>testX <span class="op">=</span> <span class="va">testx</span>, weighting<span class="op">=</span><span class="st">"sparse"</span>,</span>
<span>                                 cutoff<span class="op">=</span><span class="fl">0.3</span>, min_num_clusts<span class="op">=</span><span class="fl">1</span>, max_num_clusts<span class="op">=</span><span class="fl">3</span>,</span>
<span>                                 trainX<span class="op">=</span><span class="va">train_x</span></span>
<span>                                 , trainY<span class="op">=</span><span class="va">train_y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds2</span></span>
<span></span>
<span><span class="va">selections</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/getCssSelections.html">getCssSelections</a></span><span class="op">(</span>weighting<span class="op">=</span><span class="st">"sparse"</span>, cutoff<span class="op">=</span><span class="fl">0.3</span></span>
<span>                                          <span class="co"># , min_num_clusts=1</span></span>
<span>                                          <span class="co"># , max_num_clusts=3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">selections</span><span class="op">)</span></span>
<span></span>
<span><span class="va">selections</span><span class="op">$</span><span class="va">selected_clusts</span></span>
<span><span class="va">selections</span><span class="op">$</span><span class="va">selected_feats</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">results</span>, cutoff<span class="op">=</span><span class="fl">0.3</span>, max_num_clusts<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x_design</span> <span class="op">&lt;-</span> <span class="va">results</span> <span class="op">|&gt;</span> <span class="fu"><a href="reference/getCssDesign.html">getCssDesign</a></span><span class="op">(</span><span class="va">testx</span>, weighting<span class="op">=</span><span class="st">"weighted_avg"</span>, cutoff<span class="op">=</span><span class="fl">0.3</span>,</span>
<span>  min_num_clusts<span class="op">=</span><span class="fl">1</span>, max_num_clusts<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">x_design</span><span class="op">)</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/gregfaletto/cssr-project/tree/main/cssr/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing cssr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://gregoryfaletto.com/" class="external-link">Gregory Faletto</a> <br><small class="roles"> Author, maintainer </small>  </li>
<li>
<a href="http://faculty.marshall.usc.edu/jacob-bien/" class="external-link">Jacob Bien</a> <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://gregoryfaletto.com/" class="external-link">Gregory Faletto</a>, <a href="http://faculty.marshall.usc.edu/jacob-bien/" class="external-link">Jacob Bien</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
