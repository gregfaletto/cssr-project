<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Now to the package itself | Creating the cssr R package</title>
  <meta name="description" content="2 Now to the package itself | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Now to the package itself | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Now to the package itself | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-01-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="helper-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Package setup</a></li>
<li class="chapter" data-level="2" data-path="now-to-the-package-itself.html"><a href="now-to-the-package-itself.html"><i class="fa fa-check"></i><b>2</b> Now to the package itself</a>
<ul>
<li class="chapter" data-level="2.1" data-path="now-to-the-package-itself.html"><a href="now-to-the-package-itself.html#the-core-function-css"><i class="fa fa-check"></i><b>2.1</b> The core function: css</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="helper-functions.html"><a href="helper-functions.html"><i class="fa fa-check"></i><b>3</b> Helper Functions</a></li>
<li class="chapter" data-level="4" data-path="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html"><i class="fa fa-check"></i><b>4</b> Tests for main functions in css (now that helper functions have been defined)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html#selection-and-prediction-functions"><i class="fa fa-check"></i><b>4.1</b> Selection and Prediction Functions</a></li>
<li class="chapter" data-level="4.2" data-path="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html#other-useful-functions"><i class="fa fa-check"></i><b>4.2</b> Other useful functions</a></li>
<li class="chapter" data-level="4.3" data-path="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-css-now-that-helper-functions-have-been-defined.html#convenient-wrapper-functions"><i class="fa fa-check"></i><b>4.3</b> Convenient Wrapper Functions</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>5</b> Competitor Methods</a></li>
<li class="chapter" data-level="6" data-path="documenting-the-package-and-building.html"><a href="documenting-the-package-and-building.html"><i class="fa fa-check"></i><b>6</b> Documenting the package and building</a></li>
<li class="chapter" data-level="7" data-path="add-readme.html"><a href="add-readme.html"><i class="fa fa-check"></i><b>7</b> Add README</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="now-to-the-package-itself" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Now to the package itself<a href="now-to-the-package-itself.html#now-to-the-package-itself" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Cluster stability selection is a feature selection method designed to allow stability selection to work effectively in the presence of highly correlated features. We will define the functions in this package in steps.</p>
<ul>
<li>First we define the workhorse function of the package, css. This function takes as inputs a data set, a feature selection method, and clusters of features appearing in the data. It calculates random subsamples of the data and gets selected sets of features on each subsample. It returns a matrix of indicator variables for whether each feature was selected on each subsample (one row for each subsample, one column for each feature). It returns a similar matrix of indicator variables for whether any feature from each cluster was selected on each subsample. This is the most computationally intensive step of cluster stability selection, so it is isolated within its own function that is designed to be run only once on a data set.</li>
<li>Next we define functions that take these indicator matrices and return useful output–for example, selected sets of features, or predictions on test data. These outputs depend on the selected features, which themselves depend on user-selected parameters (for example, the cutoff for selection proportions for selected clusters).</li>
<li>Next, we define wrapper functions that compute all of the above in one step in a user-friendly way. (These functions are not recommended for large data sets or for “power users” who may want to call these functions multiple times on the same data set, because these wrapper functions make a new call to css every time they are called, which is slow and computationally wasteful if the inputs to css are not changed.)</li>
<li>Finally, we define some other useful functions, like functions that generate clustered data to use for simulations or testing, or select a tuning parameter for the lasso via cross-validation.</li>
</ul>
<div id="the-core-function-css" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> The core function: css<a href="now-to-the-package-itself.html#the-core-function-css" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>css accepts as an input a design matrix X, a response y, a selection method fitfun with specified tuning parameter lambda, and a specification of which features belong together in highly correlated clusters. In this section, we will build the function css step-by-step.</p>
<ul>
<li>First, css creates random subsamples of the data. This is implemented in the function createSubsamples.</li>
<li>Next, css executes the specified feature selection method on each subsample. This generates a binary matrix, feat_sel_mat, with one row for each subsample and one column for each feature in X. In each row, the entry corresponding to each feature equals 1 if the feature was selected on that subsample and 0 otherwise. feat_sel_mat is one of the outputs of css; it is used to calculate the selection proportions for individual features. This is implemented in the function getSelMatrix.</li>
<li>So far this is the same as the original stability selection procedure. Now we take into account the clusters. The function getClusterSelMatrix takes in the formatted clusters as well as feat_sel_mat and generates the binary matrix clus_sel_mat, which contains selection indicators for each cluster. clus_sel_mat has the same number of rows as feat_sel_mat and one column for each cluster rather than one for each feature. This is used to calculate the cluster selection proportions.</li>
</ul>
<p>The function css is specified below. (There are some extra details that I omitted in the above description for brevity; you can read the full details below.)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="now-to-the-package-itself.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Cluster Stability Selection</span></span>
<span id="cb2-2"><a href="now-to-the-package-itself.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb2-3"><a href="now-to-the-package-itself.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Executes cluster stability selection algorithm. Takes subsamples of data,</span></span>
<span id="cb2-4"><a href="now-to-the-package-itself.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; executes feature selection algorithm on each subsample, and returns matrices</span></span>
<span id="cb2-5"><a href="now-to-the-package-itself.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of feature selection indicators as well as cluster selection indicators.</span></span>
<span id="cb2-6"><a href="now-to-the-package-itself.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb2-7"><a href="now-to-the-package-itself.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb2-8"><a href="now-to-the-package-itself.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb2-9"><a href="now-to-the-package-itself.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; p &gt;= 2 features/predictors.</span></span>
<span id="cb2-10"><a href="now-to-the-package-itself.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; can be anything that takes the form of an</span></span>
<span id="cb2-11"><a href="now-to-the-package-itself.html#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n-dimensional vector, with the ith entry corresponding to the ith row of X.</span></span>
<span id="cb2-12"><a href="now-to-the-package-itself.html#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Typically (and for default fitfun = cssLasso), y should be an n-dimensional</span></span>
<span id="cb2-13"><a href="now-to-the-package-itself.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector.</span></span>
<span id="cb2-14"><a href="now-to-the-package-itself.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb2-15"><a href="now-to-the-package-itself.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method fitfun. In the default case when</span></span>
<span id="cb2-16"><a href="now-to-the-package-itself.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fitfun = cssLasso, lambda should be a numeric: the penalty to use for each</span></span>
<span id="cb2-17"><a href="now-to-the-package-itself.html#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lasso fit. (css does not require lambda to be any particular object because</span></span>
<span id="cb2-18"><a href="now-to-the-package-itself.html#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for a user-specified feature selection method fitfun, lambda can be an</span></span>
<span id="cb2-19"><a href="now-to-the-package-itself.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arbitrary object. See the description of fitfun below.)</span></span>
<span id="cb2-20"><a href="now-to-the-package-itself.html#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list of integer vectors; each vector should contain the </span></span>
<span id="cb2-21"><a href="now-to-the-package-itself.html#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of a cluster of features (a subset of 1:p). (If there is only one</span></span>
<span id="cb2-22"><a href="now-to-the-package-itself.html#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster, clusters can either be a list of length 1 or an integer vector.)</span></span>
<span id="cb2-23"><a href="now-to-the-package-itself.html#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; All of the provided clusters must be non-overlapping. Every feature not</span></span>
<span id="cb2-24"><a href="now-to-the-package-itself.html#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; appearing in any cluster will be assumed to be unclustered (that is, they</span></span>
<span id="cb2-25"><a href="now-to-the-package-itself.html#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be treated as if they are in a &quot;cluster&quot; containing only themselves). If</span></span>
<span id="cb2-26"><a href="now-to-the-package-itself.html#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters is a list of length 0 (or a list only containing clusters of length</span></span>
<span id="cb2-27"><a href="now-to-the-package-itself.html#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1), then <a href='now-to-the-package-itself.html#css'>css</a>() returns the same results as stability selection (so the</span></span>
<span id="cb2-28"><a href="now-to-the-package-itself.html#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned feat_sel_mat will be identical to clus_sel_mat). Names for the</span></span>
<span id="cb2-29"><a href="now-to-the-package-itself.html#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters will be needed later; any clusters that are not given names in the</span></span>
<span id="cb2-30"><a href="now-to-the-package-itself.html#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided list will be given names automatically by css. Default is list() (so</span></span>
<span id="cb2-31"><a href="now-to-the-package-itself.html#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; no clusters are specified).</span></span>
<span id="cb2-32"><a href="now-to-the-package-itself.html#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function; the feature selection function used on each</span></span>
<span id="cb2-33"><a href="now-to-the-package-itself.html#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample by cluster stability selection. This can be any feature selection</span></span>
<span id="cb2-34"><a href="now-to-the-package-itself.html#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method; the only requirement is that it accepts the arguments (and only the</span></span>
<span id="cb2-35"><a href="now-to-the-package-itself.html#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arguments) X, y, and lambda and returns an integer vector that is a subset of</span></span>
<span id="cb2-36"><a href="now-to-the-package-itself.html#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1:p. For example, fitfun could be best subset selection or forward stepwise</span></span>
<span id="cb2-37"><a href="now-to-the-package-itself.html#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection or LARS and lambda could be the desired model size; or fitfun could be the</span></span>
<span id="cb2-38"><a href="now-to-the-package-itself.html#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; elastic net and lambda could be a length-two vector specifying lambda and</span></span>
<span id="cb2-39"><a href="now-to-the-package-itself.html#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; alpha. Default is cssLasso, an implementation of lasso (relying on the R</span></span>
<span id="cb2-40"><a href="now-to-the-package-itself.html#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; package glmnet), where lambda must be a positive numeric specifying the L1</span></span>
<span id="cb2-41"><a href="now-to-the-package-itself.html#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; penalty for the lasso.</span></span>
<span id="cb2-42"><a href="now-to-the-package-itself.html#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. For &quot;MB&quot;,</span></span>
<span id="cb2-43"><a href="now-to-the-package-itself.html#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; all B subsamples are drawn randomly (as proposed by Meinshausen and Bühlmann</span></span>
<span id="cb2-44"><a href="now-to-the-package-itself.html#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2010). For &quot;SS&quot;, in addition to these B subsamples, the B complementary pair</span></span>
<span id="cb2-45"><a href="now-to-the-package-itself.html#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsamples will be drawn as well (see Faletto and Bien 2022 or Shah and</span></span>
<span id="cb2-46"><a href="now-to-the-package-itself.html#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Samworth 2013 for details). Default is &quot;SS&quot;, and &quot;MB&quot; is not supported yet.</span></span>
<span id="cb2-47"><a href="now-to-the-package-itself.html#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb2-48"><a href="now-to-the-package-itself.html#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the total number of subsamples will be `B`; for</span></span>
<span id="cb2-49"><a href="now-to-the-package-itself.html#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of subsamples will be `2*B`. Default is 100</span></span>
<span id="cb2-50"><a href="now-to-the-package-itself.html#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for sampling_type=&quot;MB&quot; and 50 for sampling_type=&quot;SS&quot;.</span></span>
<span id="cb2-51"><a href="now-to-the-package-itself.html#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; if prop_feats_remove is greater than 0,</span></span>
<span id="cb2-52"><a href="now-to-the-package-itself.html#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then on each subsample, each feature is randomly dropped from the design</span></span>
<span id="cb2-53"><a href="now-to-the-package-itself.html#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix that is provided to fitfun with probability prop_feats_remove</span></span>
<span id="cb2-54"><a href="now-to-the-package-itself.html#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (independently across features). That is, in a typical subsample,</span></span>
<span id="cb2-55"><a href="now-to-the-package-itself.html#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prop_feats_remove*p features will be dropped (though this number will vary).</span></span>
<span id="cb2-56"><a href="now-to-the-package-itself.html#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is similar in spirit (but distinct from) extended stability selection</span></span>
<span id="cb2-57"><a href="now-to-the-package-itself.html#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (Beinrucker et. al. 2016); see their paper for some of the benefits of</span></span>
<span id="cb2-58"><a href="now-to-the-package-itself.html#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropping features (besides increasing computational speed and decreasing</span></span>
<span id="cb2-59"><a href="now-to-the-package-itself.html#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; memory requirements). For sampling_type=&quot;SS&quot;, the features dropped in</span></span>
<span id="cb2-60"><a href="now-to-the-package-itself.html#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each complementary pair of subsamples are identical in order to ensure that</span></span>
<span id="cb2-61"><a href="now-to-the-package-itself.html#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the theoretical guarantees of Faletto and Bien (2022) are retained within</span></span>
<span id="cb2-62"><a href="now-to-the-package-itself.html#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each individual pair of subsamples. (Note that this feature is not</span></span>
<span id="cb2-63"><a href="now-to-the-package-itself.html#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; investigated either theoretically or in simulations by Faletto and Bien</span></span>
<span id="cb2-64"><a href="now-to-the-package-itself.html#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2022). Must be between 0 and 1. Default is 0.</span></span>
<span id="cb2-65"><a href="now-to-the-package-itself.html#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param train_inds Optional; an integer or numeric vector containing the</span></span>
<span id="cb2-66"><a href="now-to-the-package-itself.html#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of observations in X and y to set aside for model training by the</span></span>
<span id="cb2-67"><a href="now-to-the-package-itself.html#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function getCssPreds after feature selection. (This will only work if y is</span></span>
<span id="cb2-68"><a href="now-to-the-package-itself.html#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; real-valued, because getCssPreds using ordinary least squares regression to</span></span>
<span id="cb2-69"><a href="now-to-the-package-itself.html#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate predictions.) If train_inds is not provided, all of the observations</span></span>
<span id="cb2-70"><a href="now-to-the-package-itself.html#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the provided data set will be used for feature selection.</span></span>
<span id="cb2-71"><a href="now-to-the-package-itself.html#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb2-72"><a href="now-to-the-package-itself.html#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (num_cores will be supplied</span></span>
<span id="cb2-73"><a href="now-to-the-package-itself.html#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the mc.cores argument of parallel::mclapply).</span></span>
<span id="cb2-74"><a href="now-to-the-package-itself.html#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list containing the following items: \item{feat_sel_mat}{A B (or</span></span>
<span id="cb2-75"><a href="now-to-the-package-itself.html#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `2*B` for sampling.method &quot;SS&quot;) x p numeric (binary) matrix.</span></span>
<span id="cb2-76"><a href="now-to-the-package-itself.html#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `feat_sel_mat[i, j] = 1` if feature j was selected by the base feature</span></span>
<span id="cb2-77"><a href="now-to-the-package-itself.html#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection method on subsample i, and 0 otherwise.} \item{clus_sel_mat}{A B</span></span>
<span id="cb2-78"><a href="now-to-the-package-itself.html#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (or 2*B for SS sampling) x length(clusters) numeric (binary) matrix.</span></span>
<span id="cb2-79"><a href="now-to-the-package-itself.html#cb2-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `clus_sel_mat[i, j] = 1` if at least one feature from cluster j was selected</span></span>
<span id="cb2-80"><a href="now-to-the-package-itself.html#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the base feature selection method on subsample i, and 0 otherwise.}</span></span>
<span id="cb2-81"><a href="now-to-the-package-itself.html#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{X}{The X matrix provided to css, coerced from a data.frame to a matrix</span></span>
<span id="cb2-82"><a href="now-to-the-package-itself.html#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; if needed.} \item{y}{The y vector provided to css.} \item{clusters}{A named</span></span>
<span id="cb2-83"><a href="now-to-the-package-itself.html#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; list of integer vectors containing all of the clusters provided to css, as</span></span>
<span id="cb2-84"><a href="now-to-the-package-itself.html#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as size 1 clusters of any features not listed in any of the clusters</span></span>
<span id="cb2-85"><a href="now-to-the-package-itself.html#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to css. All clusters will have names; any clusters not provided with</span></span>
<span id="cb2-86"><a href="now-to-the-package-itself.html#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a name in the input to css will be given names automatically by css (of the</span></span>
<span id="cb2-87"><a href="now-to-the-package-itself.html#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; form c1, etc.).} \item{train_inds}{Identical to the train_inds provided to</span></span>
<span id="cb2-88"><a href="now-to-the-package-itself.html#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css.}</span></span>
<span id="cb2-89"><a href="now-to-the-package-itself.html#cb2-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb2-90"><a href="now-to-the-package-itself.html#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Faletto, G., &amp; Bien, J. (2022). Cluster Stability Selection.</span></span>
<span id="cb2-91"><a href="now-to-the-package-itself.html#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \emph{arXiv preprint arXiv:2201.00494}.</span></span>
<span id="cb2-92"><a href="now-to-the-package-itself.html#cb2-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://arxiv.org/abs/2201.00494}. \cr Shah, R. D., &amp; Samworth, R. J.</span></span>
<span id="cb2-93"><a href="now-to-the-package-itself.html#cb2-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2013). Variable selection with error control: Another look at stability</span></span>
<span id="cb2-94"><a href="now-to-the-package-itself.html#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection. \emph{Journal of the Royal Statistical Society. Series B:</span></span>
<span id="cb2-95"><a href="now-to-the-package-itself.html#cb2-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Methodology}, 75(1), 55–80.</span></span>
<span id="cb2-96"><a href="now-to-the-package-itself.html#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1109/RITA.2014.2302071}. \cr Meinshausen, N., &amp;</span></span>
<span id="cb2-97"><a href="now-to-the-package-itself.html#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bühlmann, P. (2010). Stability Selection. \emph{Journal of the Royal</span></span>
<span id="cb2-98"><a href="now-to-the-package-itself.html#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Society. Series B: Statistical Methodology}, 72(4), 417–473.</span></span>
<span id="cb2-99"><a href="now-to-the-package-itself.html#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1467-9868.2010.00740.x}.</span></span>
<span id="cb2-100"><a href="now-to-the-package-itself.html#cb2-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \cr Beinrucker, A., Dogan, Ü., &amp;</span></span>
<span id="cb2-101"><a href="now-to-the-package-itself.html#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Blanchard, G. (2016). Extensions of stability selection using subsamples of</span></span>
<span id="cb2-102"><a href="now-to-the-package-itself.html#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations and covariates. \emph{Statistics and Computing}, 26(5), 1059-</span></span>
<span id="cb2-103"><a href="now-to-the-package-itself.html#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1077. \url{https://doi.org/10.1007/s11222-015-9589-y}. \cr Jerome Friedman,</span></span>
<span id="cb2-104"><a href="now-to-the-package-itself.html#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Trevor Hastie, Robert Tibshirani (2010). Regularization Paths for Generalized</span></span>
<span id="cb2-105"><a href="now-to-the-package-itself.html#cb2-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Linear Models via Coordinate Descent. \emph{Journal of Statistical Software},</span></span>
<span id="cb2-106"><a href="now-to-the-package-itself.html#cb2-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 33(1), 1-22. URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb2-107"><a href="now-to-the-package-itself.html#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb2-108"><a href="now-to-the-package-itself.html#cb2-108" aria-hidden="true" tabindex="-1"></a><span id='css'>css</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda, <span class="at">clusters =</span> <span class="fu">list</span>(), <span class="at">fitfun =</span> cssLasso,</span>
<span id="cb2-109"><a href="now-to-the-package-itself.html#cb2-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="fu">ifelse</span>(sampling_type <span class="sc">==</span> <span class="st">&quot;MB&quot;</span>, 100L, 50L),</span>
<span id="cb2-110"><a href="now-to-the-package-itself.html#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_feats_remove =</span> <span class="dv">0</span>, <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L</span>
<span id="cb2-111"><a href="now-to-the-package-itself.html#cb2-111" aria-hidden="true" tabindex="-1"></a>    ){</span>
<span id="cb2-112"><a href="now-to-the-package-itself.html#cb2-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-113"><a href="now-to-the-package-itself.html#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb2-114"><a href="now-to-the-package-itself.html#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="now-to-the-package-itself.html#cb2-115" aria-hidden="true" tabindex="-1"></a>    check_list <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(X, y, lambda, clusters, fitfun, sampling_type,</span>
<span id="cb2-116"><a href="now-to-the-package-itself.html#cb2-116" aria-hidden="true" tabindex="-1"></a>        B, prop_feats_remove, train_inds, num_cores)</span>
<span id="cb2-117"><a href="now-to-the-package-itself.html#cb2-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-118"><a href="now-to-the-package-itself.html#cb2-118" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> check_list<span class="sc">$</span>feat_names</span>
<span id="cb2-119"><a href="now-to-the-package-itself.html#cb2-119" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> check_list<span class="sc">$</span>X</span>
<span id="cb2-120"><a href="now-to-the-package-itself.html#cb2-120" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> check_list<span class="sc">$</span>clusters</span>
<span id="cb2-121"><a href="now-to-the-package-itself.html#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="now-to-the-package-itself.html#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(check_list)</span>
<span id="cb2-123"><a href="now-to-the-package-itself.html#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="now-to-the-package-itself.html#cb2-124" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb2-125"><a href="now-to-the-package-itself.html#cb2-125" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb2-126"><a href="now-to-the-package-itself.html#cb2-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-127"><a href="now-to-the-package-itself.html#cb2-127" aria-hidden="true" tabindex="-1"></a>    train_inds <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(train_inds)</span>
<span id="cb2-128"><a href="now-to-the-package-itself.html#cb2-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-129"><a href="now-to-the-package-itself.html#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Create subsamples</span></span>
<span id="cb2-130"><a href="now-to-the-package-itself.html#cb2-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-131"><a href="now-to-the-package-itself.html#cb2-131" aria-hidden="true" tabindex="-1"></a>    sel_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, train_inds)</span>
<span id="cb2-132"><a href="now-to-the-package-itself.html#cb2-132" aria-hidden="true" tabindex="-1"></a>    n_sel <span class="ot">&lt;-</span> <span class="fu">length</span>(sel_inds)</span>
<span id="cb2-133"><a href="now-to-the-package-itself.html#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_sel <span class="sc">&lt;</span> <span class="dv">4</span>){</span>
<span id="cb2-134"><a href="now-to-the-package-itself.html#cb2-134" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Too many training indices provided (must be at least 4 observations left for feature selection, and ideally many more)&quot;</span>)</span>
<span id="cb2-135"><a href="now-to-the-package-itself.html#cb2-135" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-136"><a href="now-to-the-package-itself.html#cb2-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-137"><a href="now-to-the-package-itself.html#cb2-137" aria-hidden="true" tabindex="-1"></a>    subsamps_object <span class="ot">&lt;-</span> <a href='now-to-the-package-itself.html#createSubsamples'>createSubsamples</a>(n_sel, p, B, sampling_type,</span>
<span id="cb2-138"><a href="now-to-the-package-itself.html#cb2-138" aria-hidden="true" tabindex="-1"></a>        prop_feats_remove)</span>
<span id="cb2-139"><a href="now-to-the-package-itself.html#cb2-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-140"><a href="now-to-the-package-itself.html#cb2-140" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Get matrix of selected feature sets from subsamples</span></span>
<span id="cb2-141"><a href="now-to-the-package-itself.html#cb2-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-142"><a href="now-to-the-package-itself.html#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb2-143"><a href="now-to-the-package-itself.html#cb2-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-144"><a href="now-to-the-package-itself.html#cb2-144" aria-hidden="true" tabindex="-1"></a>    feat_sel_mat <span class="ot">&lt;-</span> <a href='now-to-the-package-itself.html#getSelMatrix'>getSelMatrix</a>(X[sel_inds, ], y[sel_inds], lambda, B,</span>
<span id="cb2-145"><a href="now-to-the-package-itself.html#cb2-145" aria-hidden="true" tabindex="-1"></a>        sampling_type, subsamps_object, num_cores, fitfun)</span>
<span id="cb2-146"><a href="now-to-the-package-itself.html#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="now-to-the-package-itself.html#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(feat_names))){</span>
<span id="cb2-148"><a href="now-to-the-package-itself.html#cb2-148" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(feat_sel_mat) <span class="ot">&lt;-</span> feat_names</span>
<span id="cb2-149"><a href="now-to-the-package-itself.html#cb2-149" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> feat_names</span>
<span id="cb2-150"><a href="now-to-the-package-itself.html#cb2-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-151"><a href="now-to-the-package-itself.html#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="now-to-the-package-itself.html#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Get selection proportions for clusters corresponding to each feature</span></span>
<span id="cb2-153"><a href="now-to-the-package-itself.html#cb2-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-154"><a href="now-to-the-package-itself.html#cb2-154" aria-hidden="true" tabindex="-1"></a>    clus_sel_mat <span class="ot">&lt;-</span> <a href='now-to-the-package-itself.html#getClusterSelMatrix'>getClusterSelMatrix</a>(clusters, feat_sel_mat)</span>
<span id="cb2-155"><a href="now-to-the-package-itself.html#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="now-to-the-package-itself.html#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check outputs</span></span>
<span id="cb2-157"><a href="now-to-the-package-itself.html#cb2-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(clus_sel_mat)))</span>
<span id="cb2-158"><a href="now-to-the-package-itself.html#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(clus_sel_mat) <span class="sc">==</span> <span class="fu">names</span>(clusters)))</span>
<span id="cb2-159"><a href="now-to-the-package-itself.html#cb2-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-160"><a href="now-to-the-package-itself.html#cb2-160" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">feat_sel_mat =</span> feat_sel_mat,</span>
<span id="cb2-161"><a href="now-to-the-package-itself.html#cb2-161" aria-hidden="true" tabindex="-1"></a>        <span class="at">clus_sel_mat =</span> clus_sel_mat,</span>
<span id="cb2-162"><a href="now-to-the-package-itself.html#cb2-162" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> X,</span>
<span id="cb2-163"><a href="now-to-the-package-itself.html#cb2-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> y,</span>
<span id="cb2-164"><a href="now-to-the-package-itself.html#cb2-164" aria-hidden="true" tabindex="-1"></a>        <span class="at">clusters =</span> clusters,</span>
<span id="cb2-165"><a href="now-to-the-package-itself.html#cb2-165" aria-hidden="true" tabindex="-1"></a>        <span class="at">train_inds =</span> train_inds</span>
<span id="cb2-166"><a href="now-to-the-package-itself.html#cb2-166" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-167"><a href="now-to-the-package-itself.html#cb2-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-168"><a href="now-to-the-package-itself.html#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">class</span>(ret) <span class="ot">&lt;-</span> <span class="st">&quot;cssr&quot;</span></span>
<span id="cb2-169"><a href="now-to-the-package-itself.html#cb2-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-170"><a href="now-to-the-package-itself.html#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb2-171"><a href="now-to-the-package-itself.html#cb2-171" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for css and the other functions in this section are located at the end of this document. Next, we’ll build the individual functions one at a time. (The one function above that I didn’t mention at all is checkCssInputs, which confirms that the inputs to css are as expected and does some basic formatting on the inputs. To streamline presentation, this and other helper functions are specified later.) First we specify createSubsamples.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="now-to-the-package-itself.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Creates lists of subsamples for stability selection.</span></span>
<span id="cb3-2"><a href="now-to-the-package-itself.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb3-3"><a href="now-to-the-package-itself.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; sample size of the data set.</span></span>
<span id="cb3-4"><a href="now-to-the-package-itself.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; number of features.</span></span>
<span id="cb3-5"><a href="now-to-the-package-itself.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb3-6"><a href="now-to-the-package-itself.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the number of lasso fits will be `B`; for</span></span>
<span id="cb3-7"><a href="now-to-the-package-itself.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of lasso fits will be `2*B`.</span></span>
<span id="cb3-8"><a href="now-to-the-package-itself.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector (either &quot;SS&quot; or &quot;MB&quot;); the sampling</span></span>
<span id="cb3-9"><a href="now-to-the-package-itself.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; type used for stability selection.</span></span>
<span id="cb3-10"><a href="now-to-the-package-itself.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_feats_remove Integer; number of features select automatically on</span></span>
<span id="cb3-11"><a href="now-to-the-package-itself.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; every iteration. Determined earlier from input prop_feats_remove to css.</span></span>
<span id="cb3-12"><a href="now-to-the-package-itself.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of length `B` (or `2*B` for sampling_type = &quot;SS&quot;). If</span></span>
<span id="cb3-13"><a href="now-to-the-package-itself.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prop_feats_remove = 0, each list element is an integer vector of length</span></span>
<span id="cb3-14"><a href="now-to-the-package-itself.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; floor(`n/2`) containing the indices of a subsample of 1:`n`. (For</span></span>
<span id="cb3-15"><a href="now-to-the-package-itself.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type==&quot;SS&quot;, the last `B` subsamples will be complementary pairs of</span></span>
<span id="cb3-16"><a href="now-to-the-package-itself.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the first `B` subsamples; see Faletto and Bien 2022 or Shah and Samworth 2013</span></span>
<span id="cb3-17"><a href="now-to-the-package-itself.html#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for details.) If prop_feats_remove &gt; 0, each element is a named list with</span></span>
<span id="cb3-18"><a href="now-to-the-package-itself.html#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; members &quot;subsample&quot; (same as above) and &quot;feats_to_keep&quot;, a logical vector</span></span>
<span id="cb3-19"><a href="now-to-the-package-itself.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of length p; feats_to_keep[j] = TRUE if feature j is chosen for this</span></span>
<span id="cb3-20"><a href="now-to-the-package-itself.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample, and false otherwise.</span></span>
<span id="cb3-21"><a href="now-to-the-package-itself.html#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb3-22"><a href="now-to-the-package-itself.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Faletto, G., &amp; Bien, J. (2022). Cluster Stability Selection.</span></span>
<span id="cb3-23"><a href="now-to-the-package-itself.html#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \emph{arXiv preprint arXiv:2201.00494}.</span></span>
<span id="cb3-24"><a href="now-to-the-package-itself.html#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://arxiv.org/abs/2201.00494}. \cr Shah, R. D., &amp; Samworth, R. J.</span></span>
<span id="cb3-25"><a href="now-to-the-package-itself.html#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2013). Variable selection with error control: Another look at stability</span></span>
<span id="cb3-26"><a href="now-to-the-package-itself.html#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection. \emph{Journal of the Royal Statistical Society. Series B:</span></span>
<span id="cb3-27"><a href="now-to-the-package-itself.html#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Methodology}, 75(1), 55–80.</span></span>
<span id="cb3-28"><a href="now-to-the-package-itself.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1109/RITA.2014.2302071}.</span></span>
<span id="cb3-29"><a href="now-to-the-package-itself.html#cb3-29" aria-hidden="true" tabindex="-1"></a><span id='createSubsamples'>createSubsamples</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, B, sampling_type, <span class="at">prop_feats_remove=</span><span class="dv">0</span>){</span>
<span id="cb3-30"><a href="now-to-the-package-itself.html#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="now-to-the-package-itself.html#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb3-32"><a href="now-to-the-package-itself.html#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="now-to-the-package-itself.html#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb3-34"><a href="now-to-the-package-itself.html#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n) <span class="sc">|</span> <span class="fu">is.integer</span>(n))</span>
<span id="cb3-35"><a href="now-to-the-package-itself.html#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">round</span>(n))</span>
<span id="cb3-36"><a href="now-to-the-package-itself.html#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb3-37"><a href="now-to-the-package-itself.html#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="now-to-the-package-itself.html#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(p) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb3-39"><a href="now-to-the-package-itself.html#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(p) <span class="sc">|</span> <span class="fu">is.integer</span>(p))</span>
<span id="cb3-40"><a href="now-to-the-package-itself.html#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">==</span> <span class="fu">round</span>(p))</span>
<span id="cb3-41"><a href="now-to-the-package-itself.html#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb3-42"><a href="now-to-the-package-itself.html#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="now-to-the-package-itself.html#cb3-43" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb3-44"><a href="now-to-the-package-itself.html#cb3-44" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(prop_feats_remove, p)</span>
<span id="cb3-45"><a href="now-to-the-package-itself.html#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="now-to-the-package-itself.html#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(prop_feats_remove <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb3-47"><a href="now-to-the-package-itself.html#cb3-47" aria-hidden="true" tabindex="-1"></a>        subsamples <span class="ot">&lt;-</span> <a href='now-to-the-package-itself.html#getSubsamps'>getSubsamps</a>(n, B, sampling_type)</span>
<span id="cb3-48"><a href="now-to-the-package-itself.html#cb3-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(subsamples)</span>
<span id="cb3-49"><a href="now-to-the-package-itself.html#cb3-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb3-50"><a href="now-to-the-package-itself.html#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In this case, we generate subsamples as well as logical vectors</span></span>
<span id="cb3-51"><a href="now-to-the-package-itself.html#cb3-51" aria-hidden="true" tabindex="-1"></a>        <span class="co"># of features to keep</span></span>
<span id="cb3-52"><a href="now-to-the-package-itself.html#cb3-52" aria-hidden="true" tabindex="-1"></a>        subsamps_and_feats <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-53"><a href="now-to-the-package-itself.html#cb3-53" aria-hidden="true" tabindex="-1"></a>        subsamples <span class="ot">&lt;-</span> <a href='now-to-the-package-itself.html#getSubsamps'>getSubsamps</a>(n, B, sampling_type)</span>
<span id="cb3-54"><a href="now-to-the-package-itself.html#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb3-55"><a href="now-to-the-package-itself.html#cb3-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Logical p-vector, where each entry is TRUE with probability</span></span>
<span id="cb3-56"><a href="now-to-the-package-itself.html#cb3-56" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1 - prop_feats_remove</span></span>
<span id="cb3-57"><a href="now-to-the-package-itself.html#cb3-57" aria-hidden="true" tabindex="-1"></a>            feats_to_keep_i <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(stats<span class="sc">::</span><span class="fu">rbinom</span>(<span class="at">n=</span>p, <span class="at">size=</span><span class="dv">1</span>,</span>
<span id="cb3-58"><a href="now-to-the-package-itself.html#cb3-58" aria-hidden="true" tabindex="-1"></a>                <span class="at">prob=</span><span class="dv">1</span> <span class="sc">-</span> prop_feats_remove))</span>
<span id="cb3-59"><a href="now-to-the-package-itself.html#cb3-59" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make sure at least two entries are equal to TRUE (so that at</span></span>
<span id="cb3-60"><a href="now-to-the-package-itself.html#cb3-60" aria-hidden="true" tabindex="-1"></a>            <span class="co"># least two features are present for every subsample)--if not,</span></span>
<span id="cb3-61"><a href="now-to-the-package-itself.html#cb3-61" aria-hidden="true" tabindex="-1"></a>            <span class="co"># randomly choose features to add</span></span>
<span id="cb3-62"><a href="now-to-the-package-itself.html#cb3-62" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span>(<span class="fu">sum</span>(feats_to_keep_i) <span class="sc">&lt;</span> <span class="dv">2</span>){</span>
<span id="cb3-63"><a href="now-to-the-package-itself.html#cb3-63" aria-hidden="true" tabindex="-1"></a>                false_inds <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>feats_to_keep_i)</span>
<span id="cb3-64"><a href="now-to-the-package-itself.html#cb3-64" aria-hidden="true" tabindex="-1"></a>                sel_feat <span class="ot">&lt;-</span> <span class="fu">sample</span>(false_inds, <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb3-65"><a href="now-to-the-package-itself.html#cb3-65" aria-hidden="true" tabindex="-1"></a>                feats_to_keep_i[sel_feat] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb3-66"><a href="now-to-the-package-itself.html#cb3-66" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-67"><a href="now-to-the-package-itself.html#cb3-67" aria-hidden="true" tabindex="-1"></a>            subsamps_and_feats[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">subsample=</span>subsamples[[i]],</span>
<span id="cb3-68"><a href="now-to-the-package-itself.html#cb3-68" aria-hidden="true" tabindex="-1"></a>                <span class="at">feats_to_keep=</span>feats_to_keep_i)</span>
<span id="cb3-69"><a href="now-to-the-package-itself.html#cb3-69" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-70"><a href="now-to-the-package-itself.html#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="now-to-the-package-itself.html#cb3-71" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb3-72"><a href="now-to-the-package-itself.html#cb3-72" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb3-73"><a href="now-to-the-package-itself.html#cb3-73" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb3-74"><a href="now-to-the-package-itself.html#cb3-74" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep the same features as in the other subsample (this</span></span>
<span id="cb3-75"><a href="now-to-the-package-itself.html#cb3-75" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ensures that the theoretical guarantee of Shah and Samworth</span></span>
<span id="cb3-76"><a href="now-to-the-package-itself.html#cb3-76" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 2013 remains valid on every individual pair of subsamples)</span></span>
<span id="cb3-77"><a href="now-to-the-package-itself.html#cb3-77" aria-hidden="true" tabindex="-1"></a>                subsamps_and_feats[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">subsample=</span>subsamples[[B <span class="sc">+</span> i]],</span>
<span id="cb3-78"><a href="now-to-the-package-itself.html#cb3-78" aria-hidden="true" tabindex="-1"></a>                    <span class="at">feats_to_keep=</span>subsamps_and_feats[[i]]<span class="sc">$</span>feats_to_keep)</span>
<span id="cb3-79"><a href="now-to-the-package-itself.html#cb3-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb3-80"><a href="now-to-the-package-itself.html#cb3-80" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb3-81"><a href="now-to-the-package-itself.html#cb3-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-82"><a href="now-to-the-package-itself.html#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check output</span></span>
<span id="cb3-83"><a href="now-to-the-package-itself.html#cb3-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">names</span>(subsamps_and_feats) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;subsample&quot;</span>,</span>
<span id="cb3-84"><a href="now-to-the-package-itself.html#cb3-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;feats_to_keep&quot;</span>)))</span>
<span id="cb3-85"><a href="now-to-the-package-itself.html#cb3-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-86"><a href="now-to-the-package-itself.html#cb3-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(subsamps_and_feats)</span>
<span id="cb3-87"><a href="now-to-the-package-itself.html#cb3-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-88"><a href="now-to-the-package-itself.html#cb3-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shouldn&#39;t be possible to reach this part of function</span></span>
<span id="cb3-89"><a href="now-to-the-package-itself.html#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;createSubsamples failed to return anything&quot;</span>)</span>
<span id="cb3-90"><a href="now-to-the-package-itself.html#cb3-90" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that createSubsamples calls some helper functions to check the inputs (again, these are specified later in the helper functions section). createSubsamples also calls the workhorse function getSubsamps to generate a list of subsamples.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="now-to-the-package-itself.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate list of subsamples</span></span>
<span id="cb4-2"><a href="now-to-the-package-itself.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb4-3"><a href="now-to-the-package-itself.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#` Generate list of `B` (or `2*B` for sampling_type=&quot;SS&quot;) subsamples of size</span></span>
<span id="cb4-4"><a href="now-to-the-package-itself.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#` `n/2`</span></span>
<span id="cb4-5"><a href="now-to-the-package-itself.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; sample size of the data set.</span></span>
<span id="cb4-6"><a href="now-to-the-package-itself.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb4-7"><a href="now-to-the-package-itself.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the number of lasso fits will be `B`; for</span></span>
<span id="cb4-8"><a href="now-to-the-package-itself.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of lasso fits will be `2*B`.</span></span>
<span id="cb4-9"><a href="now-to-the-package-itself.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector (either &quot;SS&quot; or &quot;MB&quot;); the sampling</span></span>
<span id="cb4-10"><a href="now-to-the-package-itself.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; type used for stability selection.</span></span>
<span id="cb4-11"><a href="now-to-the-package-itself.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of length `B` (or `2*B` for sampling_type=&quot;SS&quot;), where each</span></span>
<span id="cb4-12"><a href="now-to-the-package-itself.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; element is an integer vector of length floor(`n/2`) containing the indices</span></span>
<span id="cb4-13"><a href="now-to-the-package-itself.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of a subsample of 1:`n`. For sampling_type==&quot;SS&quot;, the last `B` subsamples</span></span>
<span id="cb4-14"><a href="now-to-the-package-itself.html#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be complementary pairs of the first `B` subsamples (see Faletto and</span></span>
<span id="cb4-15"><a href="now-to-the-package-itself.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bien 2022 or Shah and Samworth 2013 for details).</span></span>
<span id="cb4-16"><a href="now-to-the-package-itself.html#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb4-17"><a href="now-to-the-package-itself.html#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Faletto, G., &amp; Bien, J. (2022). Cluster Stability Selection.</span></span>
<span id="cb4-18"><a href="now-to-the-package-itself.html#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \emph{arXiv preprint arXiv:2201.00494}.</span></span>
<span id="cb4-19"><a href="now-to-the-package-itself.html#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://arxiv.org/abs/2201.00494}. \cr Shah, R. D., &amp; Samworth, R. J.</span></span>
<span id="cb4-20"><a href="now-to-the-package-itself.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2013). Variable selection with error control: Another look at stability</span></span>
<span id="cb4-21"><a href="now-to-the-package-itself.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection. \emph{Journal of the Royal Statistical Society. Series B:</span></span>
<span id="cb4-22"><a href="now-to-the-package-itself.html#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Methodology}, 75(1), 55–80.</span></span>
<span id="cb4-23"><a href="now-to-the-package-itself.html#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1109/RITA.2014.2302071}.</span></span>
<span id="cb4-24"><a href="now-to-the-package-itself.html#cb4-24" aria-hidden="true" tabindex="-1"></a><span id='getSubsamps'>getSubsamps</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, B, sampling_type){</span>
<span id="cb4-25"><a href="now-to-the-package-itself.html#cb4-25" aria-hidden="true" tabindex="-1"></a>    subsamples <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb4-26"><a href="now-to-the-package-itself.html#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb4-27"><a href="now-to-the-package-itself.html#cb4-27" aria-hidden="true" tabindex="-1"></a>        subsamples[[i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample.int</span>(<span class="at">n=</span>n, <span class="at">size=</span><span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>), <span class="at">replace=</span><span class="cn">FALSE</span>))</span>
<span id="cb4-28"><a href="now-to-the-package-itself.html#cb4-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-29"><a href="now-to-the-package-itself.html#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> B)</span>
<span id="cb4-30"><a href="now-to-the-package-itself.html#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): add support for sampling_type=&quot;MS&quot;</span></span>
<span id="cb4-31"><a href="now-to-the-package-itself.html#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb4-32"><a href="now-to-the-package-itself.html#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb4-33"><a href="now-to-the-package-itself.html#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For the ith entry, take a subsample of size floor(n/2) from the</span></span>
<span id="cb4-34"><a href="now-to-the-package-itself.html#cb4-34" aria-hidden="true" tabindex="-1"></a>            <span class="co"># remaining n - floor(n/2) observations. (Only necessary to actually</span></span>
<span id="cb4-35"><a href="now-to-the-package-itself.html#cb4-35" aria-hidden="true" tabindex="-1"></a>            <span class="co"># take the subsample if n is odd; if not, the set we want is</span></span>
<span id="cb4-36"><a href="now-to-the-package-itself.html#cb4-36" aria-hidden="true" tabindex="-1"></a>            <span class="co"># setdiff(1:n, subsamples[[i]]), so skip the sample function.)</span></span>
<span id="cb4-37"><a href="now-to-the-package-itself.html#cb4-37" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(n<span class="sc">/</span><span class="dv">2</span> <span class="sc">==</span> <span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>)){</span>
<span id="cb4-38"><a href="now-to-the-package-itself.html#cb4-38" aria-hidden="true" tabindex="-1"></a>                subsamples[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, subsamples[[i]]))</span>
<span id="cb4-39"><a href="now-to-the-package-itself.html#cb4-39" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span>{</span>
<span id="cb4-40"><a href="now-to-the-package-itself.html#cb4-40" aria-hidden="true" tabindex="-1"></a>                subsamples[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(<span class="at">x=</span><span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb4-41"><a href="now-to-the-package-itself.html#cb4-41" aria-hidden="true" tabindex="-1"></a>                    subsamples[[i]]), <span class="at">size=</span><span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>), <span class="at">replace=</span><span class="cn">FALSE</span>))</span>
<span id="cb4-42"><a href="now-to-the-package-itself.html#cb4-42" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb4-43"><a href="now-to-the-package-itself.html#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="now-to-the-package-itself.html#cb4-44" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check output</span></span>
<span id="cb4-45"><a href="now-to-the-package-itself.html#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="now-to-the-package-itself.html#cb4-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(subsamples[[B <span class="sc">+</span> i]]))</span>
<span id="cb4-47"><a href="now-to-the-package-itself.html#cb4-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(subsamples[[B <span class="sc">+</span> i]] <span class="sc">==</span></span>
<span id="cb4-48"><a href="now-to-the-package-itself.html#cb4-48" aria-hidden="true" tabindex="-1"></a>                <span class="fu">round</span>(subsamples[[B <span class="sc">+</span> i]])))</span>
<span id="cb4-49"><a href="now-to-the-package-itself.html#cb4-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>) <span class="sc">==</span> <span class="fu">length</span>(subsamples[[B <span class="sc">+</span> i]]))</span>
<span id="cb4-50"><a href="now-to-the-package-itself.html#cb4-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples[[B <span class="sc">+</span> i]]) <span class="sc">==</span></span>
<span id="cb4-51"><a href="now-to-the-package-itself.html#cb4-51" aria-hidden="true" tabindex="-1"></a>                <span class="fu">length</span>(<span class="fu">unique</span>(subsamples[[B <span class="sc">+</span> i]])))</span>
<span id="cb4-52"><a href="now-to-the-package-itself.html#cb4-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb4-53"><a href="now-to-the-package-itself.html#cb4-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb4-54"><a href="now-to-the-package-itself.html#cb4-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-55"><a href="now-to-the-package-itself.html#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(subsamples)</span>
<span id="cb4-56"><a href="now-to-the-package-itself.html#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The next function called in the body of css is getSelMatrix.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="now-to-the-package-itself.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generates matrix of selection indicators from stability selection.</span></span>
<span id="cb5-2"><a href="now-to-the-package-itself.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb5-3"><a href="now-to-the-package-itself.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x an n x p numeric matrix or a data.frame containing the predictors.</span></span>
<span id="cb5-4"><a href="now-to-the-package-itself.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A response vector; can be any response that takes the form of a</span></span>
<span id="cb5-5"><a href="now-to-the-package-itself.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n vector and is used (or not used) by fitfun. Typically (and for</span></span>
<span id="cb5-6"><a href="now-to-the-package-itself.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; default fitfun = cssLasso), y should be an n-dimensional numeric vector</span></span>
<span id="cb5-7"><a href="now-to-the-package-itself.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; containing the response.</span></span>
<span id="cb5-8"><a href="now-to-the-package-itself.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb5-9"><a href="now-to-the-package-itself.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method. For example, in the default case when</span></span>
<span id="cb5-10"><a href="now-to-the-package-itself.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fitfun = cssLasso, lambda is a numeric: the penalty to use for each lasso</span></span>
<span id="cb5-11"><a href="now-to-the-package-itself.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fit.</span></span>
<span id="cb5-12"><a href="now-to-the-package-itself.html#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb5-13"><a href="now-to-the-package-itself.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the number of lasso fits will be `B`; for</span></span>
<span id="cb5-14"><a href="now-to-the-package-itself.html#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of lasso fits will be `2*B`.</span></span>
<span id="cb5-15"><a href="now-to-the-package-itself.html#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector (either &quot;SS&quot; or &quot;MB&quot;); the sampling</span></span>
<span id="cb5-16"><a href="now-to-the-package-itself.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; type used for stability selection.</span></span>
<span id="cb5-17"><a href="now-to-the-package-itself.html#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subsamps_object A list of length `B` (or `2*B` if sampling_type=&quot;SS&quot;),</span></span>
<span id="cb5-18"><a href="now-to-the-package-itself.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; where each element is one of the following: \item{subsample}{An integer</span></span>
<span id="cb5-19"><a href="now-to-the-package-itself.html#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of size `n/2` containing the indices of the observations in the</span></span>
<span id="cb5-20"><a href="now-to-the-package-itself.html#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample.} \item{drop_var_input}{A named list containing two elements: one</span></span>
<span id="cb5-21"><a href="now-to-the-package-itself.html#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;subsample&quot;, matching the previous description, and a logical vector</span></span>
<span id="cb5-22"><a href="now-to-the-package-itself.html#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;feats_to_keep&quot; containing the indices of the features to be</span></span>
<span id="cb5-23"><a href="now-to-the-package-itself.html#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; automatically selected.} (The first object is the output of the function</span></span>
<span id="cb5-24"><a href="now-to-the-package-itself.html#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; createSubsamples when the provided prop_feats_remove is 0, the default, and</span></span>
<span id="cb5-25"><a href="now-to-the-package-itself.html#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the second object is the output of createSubsamples when prop_feats_remove &gt;</span></span>
<span id="cb5-26"><a href="now-to-the-package-itself.html#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0.)</span></span>
<span id="cb5-27"><a href="now-to-the-package-itself.html#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb5-28"><a href="now-to-the-package-itself.html#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (num_cores will be supplied</span></span>
<span id="cb5-29"><a href="now-to-the-package-itself.html#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the mc.cores argument of parallel::mclapply).</span></span>
<span id="cb5-30"><a href="now-to-the-package-itself.html#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function that takes in arguments X, y, and lambda and returns</span></span>
<span id="cb5-31"><a href="now-to-the-package-itself.html#cb5-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a vector of indices of the columns of X (selected features). Default is</span></span>
<span id="cb5-32"><a href="now-to-the-package-itself.html#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cssLasso, an implementation of the lasso using glmnet.</span></span>
<span id="cb5-33"><a href="now-to-the-package-itself.html#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A binary integer matrix of dimension `B` x `p` (if sampling_type ==</span></span>
<span id="cb5-34"><a href="now-to-the-package-itself.html#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;MB&quot;) or `2*B` x `p` (if sampling_type == &quot;SS&quot;). res[i, j] = 1 if feature j</span></span>
<span id="cb5-35"><a href="now-to-the-package-itself.html#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; was selected on subsample i and equals 0 otherwise. (That is, each row is a</span></span>
<span id="cb5-36"><a href="now-to-the-package-itself.html#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected set.)</span></span>
<span id="cb5-37"><a href="now-to-the-package-itself.html#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb5-38"><a href="now-to-the-package-itself.html#cb5-38" aria-hidden="true" tabindex="-1"></a><span id='getSelMatrix'>getSelMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, lambda, B, sampling_type, subsamps_object,</span>
<span id="cb5-39"><a href="now-to-the-package-itself.html#cb5-39" aria-hidden="true" tabindex="-1"></a>    num_cores, <span class="at">fitfun=</span>cssLasso){</span>
<span id="cb5-40"><a href="now-to-the-package-itself.html#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="now-to-the-package-itself.html#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb5-42"><a href="now-to-the-package-itself.html#cb5-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-43"><a href="now-to-the-package-itself.html#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb5-44"><a href="now-to-the-package-itself.html#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb5-45"><a href="now-to-the-package-itself.html#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="now-to-the-package-itself.html#cb5-46" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb5-47"><a href="now-to-the-package-itself.html#cb5-47" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb5-48"><a href="now-to-the-package-itself.html#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="now-to-the-package-itself.html#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb5-50"><a href="now-to-the-package-itself.html#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb5-51"><a href="now-to-the-package-itself.html#cb5-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb5-52"><a href="now-to-the-package-itself.html#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb5-53"><a href="now-to-the-package-itself.html#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="now-to-the-package-itself.html#cb5-54" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb5-55"><a href="now-to-the-package-itself.html#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="now-to-the-package-itself.html#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get list of selected feature sets from subsamples</span></span>
<span id="cb5-57"><a href="now-to-the-package-itself.html#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="now-to-the-package-itself.html#cb5-58" aria-hidden="true" tabindex="-1"></a>    res_list <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(<span class="at">X=</span>subsamps_object, <span class="at">FUN=</span>cssLoop, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb5-59"><a href="now-to-the-package-itself.html#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda=</span>lambda, <span class="at">fitfun=</span>fitfun, <span class="at">mc.cores=</span>num_cores)</span>
<span id="cb5-60"><a href="now-to-the-package-itself.html#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="now-to-the-package-itself.html#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store selected sets in B x p (or `2*B` x p for &quot;SS&quot;) binary matrix</span></span>
<span id="cb5-62"><a href="now-to-the-package-itself.html#cb5-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb5-63"><a href="now-to-the-package-itself.html#cb5-63" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(0L, <span class="dv">2</span><span class="sc">*</span>B, p)</span>
<span id="cb5-64"><a href="now-to-the-package-itself.html#cb5-64" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;MB&quot;</span>){</span>
<span id="cb5-65"><a href="now-to-the-package-itself.html#cb5-65" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(0L, B, p)</span>
<span id="cb5-66"><a href="now-to-the-package-itself.html#cb5-66" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb5-67"><a href="now-to-the-package-itself.html#cb5-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;!(sampling_type %in% c(SS, MB)) (don&#39;t know how to set dimensions of res&quot;</span>)</span>
<span id="cb5-68"><a href="now-to-the-package-itself.html#cb5-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-69"><a href="now-to-the-package-itself.html#cb5-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-70"><a href="now-to-the-package-itself.html#cb5-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list) <span class="sc">==</span> <span class="fu">nrow</span>(res))</span>
<span id="cb5-71"><a href="now-to-the-package-itself.html#cb5-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-72"><a href="now-to-the-package-itself.html#cb5-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selected sets into matrix res</span></span>
<span id="cb5-73"><a href="now-to-the-package-itself.html#cb5-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-74"><a href="now-to-the-package-itself.html#cb5-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res)){</span>
<span id="cb5-75"><a href="now-to-the-package-itself.html#cb5-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb5-76"><a href="now-to-the-package-itself.html#cb5-76" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If no features are selected, don&#39;t fill in anything in this row</span></span>
<span id="cb5-77"><a href="now-to-the-package-itself.html#cb5-77" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb5-78"><a href="now-to-the-package-itself.html#cb5-78" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-79"><a href="now-to-the-package-itself.html#cb5-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-80"><a href="now-to-the-package-itself.html#cb5-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.integer</span>(res_list[[i]])){</span>
<span id="cb5-81"><a href="now-to-the-package-itself.html#cb5-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;failed on iteration&quot;</span>, i))</span>
<span id="cb5-82"><a href="now-to-the-package-itself.html#cb5-82" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(res_list[[i]])</span>
<span id="cb5-83"><a href="now-to-the-package-itself.html#cb5-83" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Something seems to be wrong with the feature selection method (fitfun failed to return an integer vector)&quot;</span>)</span>
<span id="cb5-84"><a href="now-to-the-package-itself.html#cb5-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb5-85"><a href="now-to-the-package-itself.html#cb5-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">&lt;=</span> p <span class="sc">&amp;</span> <span class="fu">length</span>(res_list[[i]]) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-86"><a href="now-to-the-package-itself.html#cb5-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_list[[i]])))</span>
<span id="cb5-87"><a href="now-to-the-package-itself.html#cb5-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">max</span>(res_list[[i]]) <span class="sc">&lt;=</span> p)</span>
<span id="cb5-88"><a href="now-to-the-package-itself.html#cb5-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">min</span>(res_list[[i]]) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb5-89"><a href="now-to-the-package-itself.html#cb5-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(res_list[[i]])))</span>
<span id="cb5-90"><a href="now-to-the-package-itself.html#cb5-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb5-91"><a href="now-to-the-package-itself.html#cb5-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb5-92"><a href="now-to-the-package-itself.html#cb5-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb5-93"><a href="now-to-the-package-itself.html#cb5-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]])))</span>
<span id="cb5-94"><a href="now-to-the-package-itself.html#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="now-to-the-package-itself.html#cb5-95" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store selected variables in the ith row of res</span></span>
<span id="cb5-96"><a href="now-to-the-package-itself.html#cb5-96" aria-hidden="true" tabindex="-1"></a>        res[i, res_list[[i]]] <span class="ot">&lt;-</span> 1L</span>
<span id="cb5-97"><a href="now-to-the-package-itself.html#cb5-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-98"><a href="now-to-the-package-itself.html#cb5-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-99"><a href="now-to-the-package-itself.html#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb5-100"><a href="now-to-the-package-itself.html#cb5-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-101"><a href="now-to-the-package-itself.html#cb5-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb5-102"><a href="now-to-the-package-itself.html#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb5-103"><a href="now-to-the-package-itself.html#cb5-103" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb5-104"><a href="now-to-the-package-itself.html#cb5-104" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb5-105"><a href="now-to-the-package-itself.html#cb5-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">==</span> B)</span>
<span id="cb5-106"><a href="now-to-the-package-itself.html#cb5-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-107"><a href="now-to-the-package-itself.html#cb5-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(res) <span class="sc">==</span> p)</span>
<span id="cb5-108"><a href="now-to-the-package-itself.html#cb5-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb5-109"><a href="now-to-the-package-itself.html#cb5-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-110"><a href="now-to-the-package-itself.html#cb5-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb5-111"><a href="now-to-the-package-itself.html#cb5-111" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Again, getSelMatrix uses some helper functions to check the inputs for safety. getSelMatrix leverages the function mclapply from the parallel package, in order to allow for parallel processing if the user has set this up. This requires a helper function cssLoop, which is also specified in the later section for helper functions.</p>
<p>getSelMatrix also uses a feature selection function fitfun as an input. fitfun can be provided by the user as an input to css. We provide one default fitfun, cssLasso, which works on a real-valued response y given a specified penalty parameter lambda &gt; 0. Both for its own importance and to show an example of a valid fitfun, we show cssLasso here.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="now-to-the-package-itself.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Provided fitfun implementing the lasso</span></span>
<span id="cb6-2"><a href="now-to-the-package-itself.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb6-3"><a href="now-to-the-package-itself.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Function used to select features with the lasso on each subsample in cluster</span></span>
<span id="cb6-4"><a href="now-to-the-package-itself.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stability selection. Uses glmnet implementation of the lasso.</span></span>
<span id="cb6-5"><a href="now-to-the-package-itself.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X A design matrix containing the predictors. (In practice this will</span></span>
<span id="cb6-6"><a href="now-to-the-package-itself.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be a subsample of the full design matrix provided to css.)</span></span>
<span id="cb6-7"><a href="now-to-the-package-itself.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric vector containing the response.</span></span>
<span id="cb6-8"><a href="now-to-the-package-itself.html#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda Numeric; a nonnegative number for the lasso penalty to use</span></span>
<span id="cb6-9"><a href="now-to-the-package-itself.html#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on each subsample. (For now, only one lambda value can be provided to</span></span>
<span id="cb6-10"><a href="now-to-the-package-itself.html#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cssLasso; in the future, we plan to allow for multiple lambda values to be</span></span>
<span id="cb6-11"><a href="now-to-the-package-itself.html#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to cssLasso, as described in Faletto and Bien 2022.)</span></span>
<span id="cb6-12"><a href="now-to-the-package-itself.html#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector; the indices of the features selected by the lasso.</span></span>
<span id="cb6-13"><a href="now-to-the-package-itself.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb6-14"><a href="now-to-the-package-itself.html#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Faletto, G., &amp; Bien, J. (2022). Cluster Stability Selection.</span></span>
<span id="cb6-15"><a href="now-to-the-package-itself.html#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \emph{arXiv preprint arXiv:2201.00494}.</span></span>
<span id="cb6-16"><a href="now-to-the-package-itself.html#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://arxiv.org/abs/2201.00494}. \cr Jerome Friedman, Trevor Hastie,</span></span>
<span id="cb6-17"><a href="now-to-the-package-itself.html#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Robert Tibshirani (2010). Regularization Paths for Generalized Linear Models</span></span>
<span id="cb6-18"><a href="now-to-the-package-itself.html#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; via Coordinate Descent. \emph{Journal of Statistical Software}, 33(1), 1-22.</span></span>
<span id="cb6-19"><a href="now-to-the-package-itself.html#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb6-20"><a href="now-to-the-package-itself.html#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb6-21"><a href="now-to-the-package-itself.html#cb6-21" aria-hidden="true" tabindex="-1"></a><span id='cssLasso'>cssLasso</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb6-22"><a href="now-to-the-package-itself.html#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb6-23"><a href="now-to-the-package-itself.html#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="now-to-the-package-itself.html#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto) allow cssLasso to accept a vector of lambda values rather</span></span>
<span id="cb6-25"><a href="now-to-the-package-itself.html#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># than just a single one.</span></span>
<span id="cb6-26"><a href="now-to-the-package-itself.html#cb6-26" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(X, y, lambda)</span>
<span id="cb6-27"><a href="now-to-the-package-itself.html#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="now-to-the-package-itself.html#cb6-28" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb6-29"><a href="now-to-the-package-itself.html#cb6-29" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb6-30"><a href="now-to-the-package-itself.html#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="now-to-the-package-itself.html#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a lasso path (full path for speed, per glmnet documentation)</span></span>
<span id="cb6-32"><a href="now-to-the-package-itself.html#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="now-to-the-package-itself.html#cb6-33" aria-hidden="true" tabindex="-1"></a>    lasso_model <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">glmnet</span>(X, y, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb6-34"><a href="now-to-the-package-itself.html#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">class</span>(lasso_model), <span class="fu">c</span>(<span class="st">&quot;elnet&quot;</span>, <span class="st">&quot;glmnet&quot;</span>)))</span>
<span id="cb6-35"><a href="now-to-the-package-itself.html#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="now-to-the-package-itself.html#cb6-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get coefficients at desired lambda</span></span>
<span id="cb6-37"><a href="now-to-the-package-itself.html#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="now-to-the-package-itself.html#cb6-38" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">predict.glmnet</span>(lasso_model, <span class="at">type=</span><span class="st">&quot;nonzero&quot;</span>,</span>
<span id="cb6-39"><a href="now-to-the-package-itself.html#cb6-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">s=</span>lambda, <span class="at">exact=</span><span class="cn">TRUE</span>, <span class="at">newx=</span>X, <span class="at">x=</span>X, <span class="at">y=</span>y)</span>
<span id="cb6-40"><a href="now-to-the-package-itself.html#cb6-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-41"><a href="now-to-the-package-itself.html#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(pred[[<span class="dv">1</span>]])){<span class="fu">return</span>(<span class="fu">integer</span>())}</span>
<span id="cb6-42"><a href="now-to-the-package-itself.html#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="now-to-the-package-itself.html#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(pred))</span>
<span id="cb6-44"><a href="now-to-the-package-itself.html#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span> <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span></span>
<span id="cb6-45"><a href="now-to-the-package-itself.html#cb6-45" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span> <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred)))</span>
<span id="cb6-46"><a href="now-to-the-package-itself.html#cb6-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-47"><a href="now-to-the-package-itself.html#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb6-48"><a href="now-to-the-package-itself.html#cb6-48" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred[, <span class="dv">1</span>]</span>
<span id="cb6-49"><a href="now-to-the-package-itself.html#cb6-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb6-50"><a href="now-to-the-package-itself.html#cb6-50" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb6-51"><a href="now-to-the-package-itself.html#cb6-51" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb6-52"><a href="now-to-the-package-itself.html#cb6-52" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred</span>
<span id="cb6-53"><a href="now-to-the-package-itself.html#cb6-53" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb6-54"><a href="now-to-the-package-itself.html#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;length(dim(pred)) not 1, 2, or 3&quot;</span>)</span>
<span id="cb6-55"><a href="now-to-the-package-itself.html#cb6-55" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-56"><a href="now-to-the-package-itself.html#cb6-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-57"><a href="now-to-the-package-itself.html#cb6-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb6-58"><a href="now-to-the-package-itself.html#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">&lt;=</span> <span class="fu">ncol</span>(X))</span>
<span id="cb6-59"><a href="now-to-the-package-itself.html#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(selected_glmnet <span class="sc">==</span> <span class="fu">round</span>(selected_glmnet)))</span>
<span id="cb6-60"><a href="now-to-the-package-itself.html#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(selected_glmnet)))</span>
<span id="cb6-61"><a href="now-to-the-package-itself.html#cb6-61" aria-hidden="true" tabindex="-1"></a>    selected_glmnet <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(selected_glmnet)</span>
<span id="cb6-62"><a href="now-to-the-package-itself.html#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="now-to-the-package-itself.html#cb6-63" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sort</span>(selected_glmnet)</span>
<span id="cb6-64"><a href="now-to-the-package-itself.html#cb6-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-65"><a href="now-to-the-package-itself.html#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb6-66"><a href="now-to-the-package-itself.html#cb6-66" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that cssLasso depends on the package glmnet, and calls the function checkCssLassoInputs, which verifies that the inputs to cssLasso are as needed. (In particular, the function css imposes very few requirements on lambda and y to allow the end user flexibility for any specified fitfun. checkCssLassoInputs ensures that y is a real-valued response, lambda is a nonnegative real number, etc.) checkCssLassoInputs is specified in the helper functions section later.</p>
<p>Finally, getClusterSelMatrix is the last significant function called within css.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="now-to-the-package-itself.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get cluster selection matrix</span></span>
<span id="cb7-2"><a href="now-to-the-package-itself.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb7-3"><a href="now-to-the-package-itself.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Given a matrix of feature selection indicator variables and a list of</span></span>
<span id="cb7-4"><a href="now-to-the-package-itself.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters of features, returns a matrix of cluster indicator variables.</span></span>
<span id="cb7-5"><a href="now-to-the-package-itself.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb7-6"><a href="now-to-the-package-itself.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb7-7"><a href="now-to-the-package-itself.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of formatClusters.</span></span>
<span id="cb7-8"><a href="now-to-the-package-itself.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb7-9"><a href="now-to-the-package-itself.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb7-10"><a href="now-to-the-package-itself.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb7-11"><a href="now-to-the-package-itself.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).</span></span>
<span id="cb7-12"><a href="now-to-the-package-itself.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param res A binary integer matrix. es[i, j] = 1 if feature j was selected</span></span>
<span id="cb7-13"><a href="now-to-the-package-itself.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on subsample i and equals 0 otherwise, as in the output of getSelMatrix.</span></span>
<span id="cb7-14"><a href="now-to-the-package-itself.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (That is, each row is a selected set.)</span></span>
<span id="cb7-15"><a href="now-to-the-package-itself.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A binary integer matrix with the same number of rows</span></span>
<span id="cb7-16"><a href="now-to-the-package-itself.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as res and length(clusters) columns. Entry i, j is 1 if at least</span></span>
<span id="cb7-17"><a href="now-to-the-package-itself.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one member of cluster j was selected on subsample i, and 0 otherwise.</span></span>
<span id="cb7-18"><a href="now-to-the-package-itself.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb7-19"><a href="now-to-the-package-itself.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span id='getClusterSelMatrix'>getClusterSelMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, res){</span>
<span id="cb7-20"><a href="now-to-the-package-itself.html#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="now-to-the-package-itself.html#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input</span></span>
<span id="cb7-22"><a href="now-to-the-package-itself.html#cb7-22" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(clusters, res)</span>
<span id="cb7-23"><a href="now-to-the-package-itself.html#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="now-to-the-package-itself.html#cb7-24" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(res)</span>
<span id="cb7-25"><a href="now-to-the-package-itself.html#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="now-to-the-package-itself.html#cb7-26" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb7-27"><a href="now-to-the-package-itself.html#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="now-to-the-package-itself.html#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Matrix of cluster selection proportions (with n_clusters columns)</span></span>
<span id="cb7-29"><a href="now-to-the-package-itself.html#cb7-29" aria-hidden="true" tabindex="-1"></a>    res_n_clusters <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(0L, <span class="fu">nrow</span>(res)<span class="sc">*</span>n_clusters), <span class="at">nrow=</span><span class="fu">nrow</span>(res),</span>
<span id="cb7-30"><a href="now-to-the-package-itself.html#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">ncol=</span>n_clusters)</span>
<span id="cb7-31"><a href="now-to-the-package-itself.html#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(res_n_clusters) <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb7-32"><a href="now-to-the-package-itself.html#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="now-to-the-package-itself.html#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb7-34"><a href="now-to-the-package-itself.html#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify rows of res where at least one feature from this cluster</span></span>
<span id="cb7-35"><a href="now-to-the-package-itself.html#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># was selected</span></span>
<span id="cb7-36"><a href="now-to-the-package-itself.html#cb7-36" aria-hidden="true" tabindex="-1"></a>        rows_j_sel <span class="ot">&lt;-</span> <span class="fu">apply</span>(res, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">any</span>(x[clusters[[j]]] <span class="sc">==</span> <span class="dv">1</span>)})</span>
<span id="cb7-37"><a href="now-to-the-package-itself.html#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="now-to-the-package-itself.html#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Put ones in these rows of res_n_clusters[, j]</span></span>
<span id="cb7-39"><a href="now-to-the-package-itself.html#cb7-39" aria-hidden="true" tabindex="-1"></a>        res_n_clusters[rows_j_sel, j] <span class="ot">&lt;-</span> 1L</span>
<span id="cb7-40"><a href="now-to-the-package-itself.html#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="now-to-the-package-itself.html#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters[[j]]) <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb7-42"><a href="now-to-the-package-itself.html#cb7-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb7-43"><a href="now-to-the-package-itself.html#cb7-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-44"><a href="now-to-the-package-itself.html#cb7-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-45"><a href="now-to-the-package-itself.html#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="now-to-the-package-itself.html#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb7-47"><a href="now-to-the-package-itself.html#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res_n_clusters))</span>
<span id="cb7-48"><a href="now-to-the-package-itself.html#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(res_n_clusters), <span class="fu">names</span>(clusters)))</span>
<span id="cb7-49"><a href="now-to-the-package-itself.html#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res_n_clusters <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb7-50"><a href="now-to-the-package-itself.html#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(res_n_clusters) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb7-51"><a href="now-to-the-package-itself.html#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="now-to-the-package-itself.html#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res_n_clusters)</span>
<span id="cb7-53"><a href="now-to-the-package-itself.html#cb7-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The helper function checkGetClusterSelMatrixInput verifies the inputs to getClusterSelMatrix.</p>
<p>With the above and the helper functions below, the css function is complete!</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="helper-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
