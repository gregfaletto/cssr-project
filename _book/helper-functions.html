<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Helper functions | Creating the cssr R package</title>
  <meta name="description" content="4 Helper functions | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Helper functions | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Helper functions | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-01-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="css.html"/>
<link rel="next" href="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a></li>
<li class="chapter" data-level="4" data-path="helper-functions.html"><a href="helper-functions.html"><i class="fa fa-check"></i><b>4</b> Helper functions</a></li>
<li class="chapter" data-level="5" data-path="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html"><i class="fa fa-check"></i><b>5</b> Tests for main functions in <code>cssr</code> (now that helper functions have been defined)</a></li>
<li class="chapter" data-level="6" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>6</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="7" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>7</b> Other useful functions</a></li>
<li class="chapter" data-level="8" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>8</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="9" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>9</b> Competitor Methods</a></li>
<li class="chapter" data-level="10" data-path="documenting-the-package-and-adding-readme.html"><a href="documenting-the-package-and-adding-readme.html"><i class="fa fa-check"></i><b>10</b> Documenting the package and adding README</a>
<ul>
<li class="chapter" data-level="10.1" data-path="documenting-the-package-and-adding-readme.html"><a href="documenting-the-package-and-adding-readme.html#add-readme"><i class="fa fa-check"></i><b>10.1</b> Add README</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="helper-functions" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Helper functions<a href="helper-functions.html#helper-functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Below, we specify some of the helper functions for <code><a href='css.html#css'>css</a>()</code>, which are less important for understanding what <code><a href='css.html#css'>css</a>()</code> does.</p>
<ul>
<li>The function checkCssInputs is called at the beginning of the <code><a href='css.html#css'>css</a>()</code> function. It confirms that the inputs to <code><a href='css.html#css'>css</a>()</code> are as expected. Also, <code><a href='css.html#css'>css</a>()</code> allows some flexibility in how the inputs are formatted, and <code><a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>()</code> converts the inputs into consistent formats for later use.
<ul>
<li>The function <code><a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>()</code> is called within <code><a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>()</code>, and specifically checks the clusters input.</li>
<li><code><a href='helper-functions.html#formatClusters'>formatClusters</a>()</code> modifies clusters, ensuring every feature appears in exactly one cluster (any unclustered features are put in a “cluster” by themselves).
<ul>
<li><code><a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>()</code> verifies the input to <code><a href='helper-functions.html#formatClusters'>formatClusters</a>()</code> for safety (this might seem a little redundant here, but <code><a href='helper-functions.html#formatClusters'>formatClusters</a>()</code> is also called by different functions in this package).
<ul>
<li><code><a href='helper-functions.html#checkY'>checkY</a>()</code> ensures (here and elsewhere) that the provided <code>y</code> is as expected. (In particular, in general the inputted <code>y</code> can be a vector of any type as long as the specified <code>fitfun</code> can handle <code>y</code> appropriately. For some function inputs, <code>y</code> must be a numeric vector. <code><a href='helper-functions.html#checkY'>checkY</a>()</code> enforces this, among other things.)</li>
</ul></li>
<li><code><a href='helper-functions.html#checkClusters'>checkClusters</a>()</code> verifies that the output of <code><a href='helper-functions.html#formatClusters'>formatClusters</a>()</code> is as expected.</li>
<li><code><a href='helper-functions.html#getPrototypes'>getPrototypes</a>()</code> identifies the prototypes of each cluster–the feature within each cluster that has the largest marginal sample correlation with <code>y</code>.
<ul>
<li><code><a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>()</code> is the workhorse of <code><a href='helper-functions.html#getPrototypes'>getPrototypes</a>()</code>, identifying the prototype given a single cluster.
<ul>
<li><code><a href='helper-functions.html#corFunction'>corFunction</a>()</code> is a helper function called within <code><a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>()</code> to calculate the absolute value of the correlation between two vectors.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code><a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>()</code> ensures that the input <code>sampling_type</code> is as expected.</li>
<li><code><a href='helper-functions.html#checkB'>checkB</a>()</code> ensures that the input <code>B</code> is as expected.</li>
<li><code><a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>()</code> ensures that the input <code>prop_feats_remove</code> is as expected.</li>
</ul></li>
<li>The function <code><a href='helper-functions.html#cssLoop'>cssLoop</a>()</code> is called within <code><a href='css.html#css'>css</a>()</code>. In particular, it is a helper function needed in order to allow for parallel processing of the feature selection method on each of the subsamples.
<ul>
<li><code><a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code> verifies that the output of <code><a href='helper-functions.html#cssLoop'>cssLoop</a>()</code> is as expected. This is particularly important because the user can specify their own feature selection method; <code><a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code> verifies that the output of the feature selection method is valid, and provides an informative error message if not.</li>
</ul></li>
<li><code><a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code> checks that the inputs to the provided <code>fitfun</code>, <code><a href='css.html#cssLasso'>cssLasso</a>()</code>, are as needed.</li>
<li><code><a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>()</code> verifies that the input to <code><a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>()</code> is as expected.</li>
</ul>
<p>Tests are written for all of these functions and appear as early as possible after the function is defined. (For functions that don’t depend on any other functions, tests appear immediately after the function; for functions with dependencies, the tests appear after all dependencies have been defined.)</p>
<p><code><a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="helper-functions.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that inputs to the function `<a href='css.html#css'>css</a>()` are as expected,</span></span>
<span id="cb16-2"><a href="helper-functions.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and modify inputs if needed</span></span>
<span id="cb16-3"><a href="helper-functions.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb16-4"><a href="helper-functions.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb16-5"><a href="helper-functions.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb16-6"><a href="helper-functions.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; p &gt;= 2 features/predictors.</span></span>
<span id="cb16-7"><a href="helper-functions.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; can be anything that takes the form of an</span></span>
<span id="cb16-8"><a href="helper-functions.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n-dimensional vector, with the ith entry corresponding to the ith row of X.</span></span>
<span id="cb16-9"><a href="helper-functions.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Typically (and for default fitfun = cssLasso), y should be an n-dimensional</span></span>
<span id="cb16-10"><a href="helper-functions.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector.</span></span>
<span id="cb16-11"><a href="helper-functions.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb16-12"><a href="helper-functions.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method fitfun. In the default case when</span></span>
<span id="cb16-13"><a href="helper-functions.html#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fitfun = cssLasso, lambda should be a numeric: the penalty to use for each</span></span>
<span id="cb16-14"><a href="helper-functions.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lasso fit. (css does not require lambda to be any particular object because</span></span>
<span id="cb16-15"><a href="helper-functions.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for a user-specified feature selection method fitfun, lambda can be an</span></span>
<span id="cb16-16"><a href="helper-functions.html#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arbitrary object. See the description of fitfun below.)</span></span>
<span id="cb16-17"><a href="helper-functions.html#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list of integer vectors; each vector should contain the </span></span>
<span id="cb16-18"><a href="helper-functions.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of a cluster of features (a subset of 1:p). (If there is only one</span></span>
<span id="cb16-19"><a href="helper-functions.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster, clusters can either be a list of length 1 or an integer vector.)</span></span>
<span id="cb16-20"><a href="helper-functions.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; All of the provided clusters must be non-overlapping. Every feature not</span></span>
<span id="cb16-21"><a href="helper-functions.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; appearing in any cluster will be assumed to be unclustered (that is, they</span></span>
<span id="cb16-22"><a href="helper-functions.html#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be treated as if they are in a &quot;cluster&quot; containing only themselves). If</span></span>
<span id="cb16-23"><a href="helper-functions.html#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters is a list of length 0 (or a list only containing clusters of length</span></span>
<span id="cb16-24"><a href="helper-functions.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1), then <a href='css.html#css'>css</a>() returns the same results as stability selection (so the</span></span>
<span id="cb16-25"><a href="helper-functions.html#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned feat_sel_mat will be identical to clus_sel_mat). Names for the</span></span>
<span id="cb16-26"><a href="helper-functions.html#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters will be needed later; any clusters that are not given names in the</span></span>
<span id="cb16-27"><a href="helper-functions.html#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided list will be given names automatically by css. Default is list() (so</span></span>
<span id="cb16-28"><a href="helper-functions.html#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; no clusters are specified).</span></span>
<span id="cb16-29"><a href="helper-functions.html#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function; the feature selection function used on each</span></span>
<span id="cb16-30"><a href="helper-functions.html#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample by cluster stability selection. This can be any feature selection</span></span>
<span id="cb16-31"><a href="helper-functions.html#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method; the only requirement is that it accepts the arguments (and only the</span></span>
<span id="cb16-32"><a href="helper-functions.html#cb16-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arguments) X, y, and lambda and returns an integer vector that is a subset of</span></span>
<span id="cb16-33"><a href="helper-functions.html#cb16-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1:p. For example, fitfun could be best subset selection or forward stepwise</span></span>
<span id="cb16-34"><a href="helper-functions.html#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection or LARS and lambda could be the desired model size; or fitfun could be the</span></span>
<span id="cb16-35"><a href="helper-functions.html#cb16-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; elastic net and lambda could be a length-two vector specifying lambda and</span></span>
<span id="cb16-36"><a href="helper-functions.html#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; alpha. Default is cssLasso, an implementation of lasso (relying on the R</span></span>
<span id="cb16-37"><a href="helper-functions.html#cb16-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; package glmnet), where lambda must be a positive numeric specifying the L1</span></span>
<span id="cb16-38"><a href="helper-functions.html#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; penalty for the lasso.</span></span>
<span id="cb16-39"><a href="helper-functions.html#cb16-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. For &quot;MB&quot;,</span></span>
<span id="cb16-40"><a href="helper-functions.html#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; all B subsamples are drawn randomly (as proposed by Meinshausen and Bühlmann</span></span>
<span id="cb16-41"><a href="helper-functions.html#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2010). For &quot;SS&quot;, in addition to these B subsamples, the B complementary pair</span></span>
<span id="cb16-42"><a href="helper-functions.html#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsamples will be drawn as well (see Faletto and Bien 2022 or Shah and</span></span>
<span id="cb16-43"><a href="helper-functions.html#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Samworth 2013 for details). Default is &quot;SS&quot;, and &quot;MB&quot; is not supported yet.</span></span>
<span id="cb16-44"><a href="helper-functions.html#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb16-45"><a href="helper-functions.html#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the total number of subsamples will be `B`; for</span></span>
<span id="cb16-46"><a href="helper-functions.html#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of subsamples will be `2*B`. Default is 100</span></span>
<span id="cb16-47"><a href="helper-functions.html#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for sampling_type=&quot;MB&quot; and 50 for sampling_type=&quot;SS&quot;.</span></span>
<span id="cb16-48"><a href="helper-functions.html#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; if prop_feats_remove is greater than 0,</span></span>
<span id="cb16-49"><a href="helper-functions.html#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then on each subsample, each feature is randomly dropped from the design</span></span>
<span id="cb16-50"><a href="helper-functions.html#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix that is provided to fitfun with probability prop_feats_remove</span></span>
<span id="cb16-51"><a href="helper-functions.html#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (independently across features). That is, in a typical subsample,</span></span>
<span id="cb16-52"><a href="helper-functions.html#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prop_feats_remove*p features will be dropped (though this number will vary).</span></span>
<span id="cb16-53"><a href="helper-functions.html#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is similar in spirit (but distinct from) extended stability selection</span></span>
<span id="cb16-54"><a href="helper-functions.html#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (Beinrucker et. al. 2016); see their paper for some of the benefits of</span></span>
<span id="cb16-55"><a href="helper-functions.html#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropping features (besides increasing computational speed and decreasing</span></span>
<span id="cb16-56"><a href="helper-functions.html#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; memory requirements). For sampling_type=&quot;SS&quot;, the features dropped in</span></span>
<span id="cb16-57"><a href="helper-functions.html#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each complementary pair of subsamples are identical in order to ensure that</span></span>
<span id="cb16-58"><a href="helper-functions.html#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the theoretical guarantees of Faletto and Bien (2022) are retained within</span></span>
<span id="cb16-59"><a href="helper-functions.html#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each individual pair of subsamples. (Note that this feature is not</span></span>
<span id="cb16-60"><a href="helper-functions.html#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; investigated either theoretically or in simulations by Faletto and Bien</span></span>
<span id="cb16-61"><a href="helper-functions.html#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2022). Must be between 0 and 1. Default is 0.</span></span>
<span id="cb16-62"><a href="helper-functions.html#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param train_inds Optional; an integer or numeric vector containing the</span></span>
<span id="cb16-63"><a href="helper-functions.html#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of observations in X and y to set aside for model training by the</span></span>
<span id="cb16-64"><a href="helper-functions.html#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function getCssPreds after feature selection. (This will only work if y is</span></span>
<span id="cb16-65"><a href="helper-functions.html#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; real-valued, because getCssPreds using ordinary least squares regression to</span></span>
<span id="cb16-66"><a href="helper-functions.html#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate predictions.) If train_inds is not provided, all of the observations</span></span>
<span id="cb16-67"><a href="helper-functions.html#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the provided data set will be used for feature selection.</span></span>
<span id="cb16-68"><a href="helper-functions.html#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb16-69"><a href="helper-functions.html#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (num_cores will be supplied</span></span>
<span id="cb16-70"><a href="helper-functions.html#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the mc.cores argument of parallel::mclapply).</span></span>
<span id="cb16-71"><a href="helper-functions.html#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{feat_names}{A </span></span>
<span id="cb16-72"><a href="helper-functions.html#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; character vector containing the column names of X (if the provided X</span></span>
<span id="cb16-73"><a href="helper-functions.html#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; had column names). If the provided X did not have column names, feat_names</span></span>
<span id="cb16-74"><a href="helper-functions.html#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be NA.} \item{X}{The provided X, converted to a matrix if it was</span></span>
<span id="cb16-75"><a href="helper-functions.html#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; originally provided as a data.frame, and with feature names removed if they</span></span>
<span id="cb16-76"><a href="helper-functions.html#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; had been provided.}\item{clusters}{A list of integer vectors; each vector</span></span>
<span id="cb16-77"><a href="helper-functions.html#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will contain the indices of a cluster of features. Any duplicated clusters</span></span>
<span id="cb16-78"><a href="helper-functions.html#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided in the input will be removed.}</span></span>
<span id="cb16-79"><a href="helper-functions.html#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb16-80"><a href="helper-functions.html#cb16-80" aria-hidden="true" tabindex="-1"></a><span id='checkCssInputs'>checkCssInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda, clusters, fitfun, sampling_type, B,</span>
<span id="cb16-81"><a href="helper-functions.html#cb16-81" aria-hidden="true" tabindex="-1"></a>    prop_feats_remove, train_inds, num_cores){</span>
<span id="cb16-82"><a href="helper-functions.html#cb16-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-83"><a href="helper-functions.html#cb16-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X) <span class="sc">|</span> <span class="fu">is.data.frame</span>(X))</span>
<span id="cb16-84"><a href="helper-functions.html#cb16-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-85"><a href="helper-functions.html#cb16-85" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb16-86"><a href="helper-functions.html#cb16-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">is.list</span>(clusters)){</span>
<span id="cb16-87"><a href="helper-functions.html#cb16-87" aria-hidden="true" tabindex="-1"></a>        clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb16-88"><a href="helper-functions.html#cb16-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-89"><a href="helper-functions.html#cb16-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-90"><a href="helper-functions.html#cb16-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb16-91"><a href="helper-functions.html#cb16-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(X)){</span>
<span id="cb16-92"><a href="helper-functions.html#cb16-92" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X)</span>
<span id="cb16-93"><a href="helper-functions.html#cb16-93" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> X[, <span class="fu">colnames</span>(X) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb16-94"><a href="helper-functions.html#cb16-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-95"><a href="helper-functions.html#cb16-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-96"><a href="helper-functions.html#cb16-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb16-97"><a href="helper-functions.html#cb16-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X)))</span>
<span id="cb16-98"><a href="helper-functions.html#cb16-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-99"><a href="helper-functions.html#cb16-99" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb16-100"><a href="helper-functions.html#cb16-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(X))){</span>
<span id="cb16-101"><a href="helper-functions.html#cb16-101" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb16-102"><a href="helper-functions.html#cb16-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-103"><a href="helper-functions.html#cb16-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-104"><a href="helper-functions.html#cb16-104" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb16-105"><a href="helper-functions.html#cb16-105" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb16-106"><a href="helper-functions.html#cb16-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-107"><a href="helper-functions.html#cb16-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(X))){</span>
<span id="cb16-108"><a href="helper-functions.html#cb16-108" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb16-109"><a href="helper-functions.html#cb16-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-110"><a href="helper-functions.html#cb16-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-111"><a href="helper-functions.html#cb16-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb16-112"><a href="helper-functions.html#cb16-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(feat_names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb16-113"><a href="helper-functions.html#cb16-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(feat_names) <span class="sc">==</span> p)</span>
<span id="cb16-114"><a href="helper-functions.html#cb16-114" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb16-115"><a href="helper-functions.html#cb16-115" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.na</span>(feat_names))</span>
<span id="cb16-116"><a href="helper-functions.html#cb16-116" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-117"><a href="helper-functions.html#cb16-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-118"><a href="helper-functions.html#cb16-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb16-119"><a href="helper-functions.html#cb16-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-120"><a href="helper-functions.html#cb16-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb16-121"><a href="helper-functions.html#cb16-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb16-122"><a href="helper-functions.html#cb16-122" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb16-123"><a href="helper-functions.html#cb16-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-124"><a href="helper-functions.html#cb16-124" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check clusters argument</span></span>
<span id="cb16-125"><a href="helper-functions.html#cb16-125" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(clusters)</span>
<span id="cb16-126"><a href="helper-functions.html#cb16-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-127"><a href="helper-functions.html#cb16-127" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Format clusters into a list where all features are in exactly one</span></span>
<span id="cb16-128"><a href="helper-functions.html#cb16-128" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster (any unclustered features are put in their own &quot;cluster&quot; of size</span></span>
<span id="cb16-129"><a href="helper-functions.html#cb16-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1).</span></span>
<span id="cb16-130"><a href="helper-functions.html#cb16-130" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='helper-functions.html#formatClusters'>formatClusters</a>(clusters, <span class="at">p=</span>p, <span class="at">clust_names=</span>clust_names)<span class="sc">$</span>clusters</span>
<span id="cb16-131"><a href="helper-functions.html#cb16-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-132"><a href="helper-functions.html#cb16-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(fitfun) <span class="sc">==</span> <span class="st">&quot;function&quot;</span>)</span>
<span id="cb16-133"><a href="helper-functions.html#cb16-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(fitfun) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb16-134"><a href="helper-functions.html#cb16-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">identical</span>(<span class="fu">formals</span>(fitfun), <span class="fu">formals</span>(cssLasso))){</span>
<span id="cb16-135"><a href="helper-functions.html#cb16-135" aria-hidden="true" tabindex="-1"></a>        err_mess <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;fitfun must accept arguments named X, y, and lambda. Detected arguments to fitfun:&quot;</span>,</span>
<span id="cb16-136"><a href="helper-functions.html#cb16-136" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">formals</span>(fitfun)), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>))</span>
<span id="cb16-137"><a href="helper-functions.html#cb16-137" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(err_mess)</span>
<span id="cb16-138"><a href="helper-functions.html#cb16-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-139"><a href="helper-functions.html#cb16-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-140"><a href="helper-functions.html#cb16-140" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb16-141"><a href="helper-functions.html#cb16-141" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkB'>checkB</a>(B)</span>
<span id="cb16-142"><a href="helper-functions.html#cb16-142" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(prop_feats_remove, p)</span>
<span id="cb16-143"><a href="helper-functions.html#cb16-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-144"><a href="helper-functions.html#cb16-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(train_inds) <span class="sc">|</span> <span class="fu">is.integer</span>(train_inds))</span>
<span id="cb16-145"><a href="helper-functions.html#cb16-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(train_inds) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb16-146"><a href="helper-functions.html#cb16-146" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(train_inds)))</span>
<span id="cb16-147"><a href="helper-functions.html#cb16-147" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">round</span>(train_inds) <span class="sc">==</span> train_inds))</span>
<span id="cb16-148"><a href="helper-functions.html#cb16-148" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(train_inds)))</span>
<span id="cb16-149"><a href="helper-functions.html#cb16-149" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(train_inds <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb16-150"><a href="helper-functions.html#cb16-150" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(train_inds) <span class="sc">&lt;=</span> n)</span>
<span id="cb16-151"><a href="helper-functions.html#cb16-151" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">&lt;=</span> n <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb16-152"><a href="helper-functions.html#cb16-152" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb16-153"><a href="helper-functions.html#cb16-153" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-154"><a href="helper-functions.html#cb16-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-155"><a href="helper-functions.html#cb16-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(num_cores) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb16-156"><a href="helper-functions.html#cb16-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(num_cores) <span class="sc">|</span> <span class="fu">is.numeric</span>(num_cores))</span>
<span id="cb16-157"><a href="helper-functions.html#cb16-157" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(num_cores))</span>
<span id="cb16-158"><a href="helper-functions.html#cb16-158" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">==</span> <span class="fu">round</span>(num_cores))</span>
<span id="cb16-159"><a href="helper-functions.html#cb16-159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb16-160"><a href="helper-functions.html#cb16-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">&lt;=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb16-161"><a href="helper-functions.html#cb16-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-162"><a href="helper-functions.html#cb16-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">feat_names=</span>feat_names, <span class="at">X=</span>X, <span class="at">clusters=</span>clusters))</span>
<span id="cb16-163"><a href="helper-functions.html#cb16-163" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkCssClustersInput:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="helper-functions.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that clusters input to css is as expected</span></span>
<span id="cb17-2"><a href="helper-functions.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb17-3"><a href="helper-functions.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list of integer vectors; each vector should contain the </span></span>
<span id="cb17-4"><a href="helper-functions.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of a cluster of features (a subset of 1:p). (If there is only one</span></span>
<span id="cb17-5"><a href="helper-functions.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster, clusters can either be a list of length 1 or an integer vector.)</span></span>
<span id="cb17-6"><a href="helper-functions.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; All of the provided clusters must be non-overlapping. Every feature not</span></span>
<span id="cb17-7"><a href="helper-functions.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; appearing in any cluster will be assumed to be unclustered (that is, they</span></span>
<span id="cb17-8"><a href="helper-functions.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be treated as if they are in a &quot;cluster&quot; containing only themselves). If</span></span>
<span id="cb17-9"><a href="helper-functions.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters is a list of length 0 (or a list only containing clusters of length</span></span>
<span id="cb17-10"><a href="helper-functions.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1), then <a href='css.html#css'>css</a>() returns the same results as stability selection (so the</span></span>
<span id="cb17-11"><a href="helper-functions.html#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned feat_sel_mat will be identical to clus_sel_mat). Names for the</span></span>
<span id="cb17-12"><a href="helper-functions.html#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters will be needed later; any clusters that are not given names in the</span></span>
<span id="cb17-13"><a href="helper-functions.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided list will be given names automatically by css. Default is list() (so</span></span>
<span id="cb17-14"><a href="helper-functions.html#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; no clusters are specified).</span></span>
<span id="cb17-15"><a href="helper-functions.html#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Same as the input, but all of the clusters will be coerced to</span></span>
<span id="cb17-16"><a href="helper-functions.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; integers.</span></span>
<span id="cb17-17"><a href="helper-functions.html#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb17-18"><a href="helper-functions.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span id='checkCssClustersInput'>checkCssClustersInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters){</span>
<span id="cb17-19"><a href="helper-functions.html#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters))</span>
<span id="cb17-20"><a href="helper-functions.html#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb17-21"><a href="helper-functions.html#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb17-22"><a href="helper-functions.html#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb17-23"><a href="helper-functions.html#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="helper-functions.html#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb17-25"><a href="helper-functions.html#cb17-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb17-26"><a href="helper-functions.html#cb17-26" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb17-27"><a href="helper-functions.html#cb17-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb17-28"><a href="helper-functions.html#cb17-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]) <span class="sc">|</span> <span class="fu">is.numeric</span>(clusters[[i]]))</span>
<span id="cb17-29"><a href="helper-functions.html#cb17-29" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">==</span> <span class="fu">round</span>(clusters[[i]])))</span>
<span id="cb17-30"><a href="helper-functions.html#cb17-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb17-31"><a href="helper-functions.html#cb17-31" aria-hidden="true" tabindex="-1"></a>                clusters[[i]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(clusters[[i]])</span>
<span id="cb17-32"><a href="helper-functions.html#cb17-32" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb17-33"><a href="helper-functions.html#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="helper-functions.html#cb17-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb17-35"><a href="helper-functions.html#cb17-35" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb17-36"><a href="helper-functions.html#cb17-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb17-37"><a href="helper-functions.html#cb17-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb17-38"><a href="helper-functions.html#cb17-38" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]], clusters[[j]])) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb17-39"><a href="helper-functions.html#cb17-39" aria-hidden="true" tabindex="-1"></a>                            error_mes <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: &quot;</span>,</span>
<span id="cb17-40"><a href="helper-functions.html#cb17-40" aria-hidden="true" tabindex="-1"></a>                                i, <span class="st">&quot;, &quot;</span>, j, <span class="st">&quot;.&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb17-41"><a href="helper-functions.html#cb17-41" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">stop</span>(error_mes)</span>
<span id="cb17-42"><a href="helper-functions.html#cb17-42" aria-hidden="true" tabindex="-1"></a>                        }</span>
<span id="cb17-43"><a href="helper-functions.html#cb17-43" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb17-44"><a href="helper-functions.html#cb17-44" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb17-45"><a href="helper-functions.html#cb17-45" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb17-46"><a href="helper-functions.html#cb17-46" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb17-47"><a href="helper-functions.html#cb17-47" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb17-48"><a href="helper-functions.html#cb17-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If clusters is not a list, it should be a vector of indices of</span></span>
<span id="cb17-49"><a href="helper-functions.html#cb17-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># features that are in the (one) cluster</span></span>
<span id="cb17-50"><a href="helper-functions.html#cb17-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(clusters))</span>
<span id="cb17-51"><a href="helper-functions.html#cb17-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb17-52"><a href="helper-functions.html#cb17-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb17-53"><a href="helper-functions.html#cb17-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters) <span class="sc">|</span> <span class="fu">is.numeric</span>(clusters))</span>
<span id="cb17-54"><a href="helper-functions.html#cb17-54" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters <span class="sc">==</span> <span class="fu">round</span>(clusters)))</span>
<span id="cb17-55"><a href="helper-functions.html#cb17-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb17-56"><a href="helper-functions.html#cb17-56" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(clusters)</span>
<span id="cb17-57"><a href="helper-functions.html#cb17-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-58"><a href="helper-functions.html#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clusters)</span>
<span id="cb17-59"><a href="helper-functions.html#cb17-59" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>tests for checkCssClustersInput:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="helper-functions.html#cb18-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssClustersInput works&quot;</span>, {</span>
<span id="cb18-2"><a href="helper-functions.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-3"><a href="helper-functions.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb18-4"><a href="helper-functions.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb18-5"><a href="helper-functions.html#cb18-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>4L, <span class="at">green_cluster=</span>5L<span class="sc">:</span>8L)</span>
<span id="cb18-6"><a href="helper-functions.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-7"><a href="helper-functions.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(good_clusters)</span>
<span id="cb18-8"><a href="helper-functions.html#cb18-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-9"><a href="helper-functions.html#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb18-10"><a href="helper-functions.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb18-11"><a href="helper-functions.html#cb18-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="fu">length</span>(<span class="fu">names</span>(res)))</span>
<span id="cb18-12"><a href="helper-functions.html#cb18-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res))))</span>
<span id="cb18-13"><a href="helper-functions.html#cb18-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res))))</span>
<span id="cb18-14"><a href="helper-functions.html#cb18-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res))))</span>
<span id="cb18-15"><a href="helper-functions.html#cb18-15" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb18-16"><a href="helper-functions.html#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb18-17"><a href="helper-functions.html#cb18-17" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb18-18"><a href="helper-functions.html#cb18-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-19"><a href="helper-functions.html#cb18-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb18-20"><a href="helper-functions.html#cb18-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb18-21"><a href="helper-functions.html#cb18-21" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb18-22"><a href="helper-functions.html#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="helper-functions.html#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb18-24"><a href="helper-functions.html#cb18-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-25"><a href="helper-functions.html#cb18-25" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb18-26"><a href="helper-functions.html#cb18-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-27"><a href="helper-functions.html#cb18-27" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(unnamed_clusters)</span>
<span id="cb18-28"><a href="helper-functions.html#cb18-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-29"><a href="helper-functions.html#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb18-30"><a href="helper-functions.html#cb18-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb18-31"><a href="helper-functions.html#cb18-31" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb18-32"><a href="helper-functions.html#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb18-33"><a href="helper-functions.html#cb18-33" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb18-34"><a href="helper-functions.html#cb18-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-35"><a href="helper-functions.html#cb18-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb18-36"><a href="helper-functions.html#cb18-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb18-37"><a href="helper-functions.html#cb18-37" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb18-38"><a href="helper-functions.html#cb18-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-39"><a href="helper-functions.html#cb18-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb18-40"><a href="helper-functions.html#cb18-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: 1, 2.&quot;</span>,</span>
<span id="cb18-41"><a href="helper-functions.html#cb18-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-42"><a href="helper-functions.html#cb18-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-43"><a href="helper-functions.html#cb18-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb18-44"><a href="helper-functions.html#cb18-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb18-45"><a href="helper-functions.html#cb18-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-46"><a href="helper-functions.html#cb18-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-47"><a href="helper-functions.html#cb18-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>))),</span>
<span id="cb18-48"><a href="helper-functions.html#cb18-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(clusters) are not all TRUE&quot;</span>,</span>
<span id="cb18-49"><a href="helper-functions.html#cb18-49" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-50"><a href="helper-functions.html#cb18-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-51"><a href="helper-functions.html#cb18-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))),</span>
<span id="cb18-52"><a href="helper-functions.html#cb18-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb18-53"><a href="helper-functions.html#cb18-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-54"><a href="helper-functions.html#cb18-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-55"><a href="helper-functions.html#cb18-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb18-56"><a href="helper-functions.html#cb18-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb18-57"><a href="helper-functions.html#cb18-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-58"><a href="helper-functions.html#cb18-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-59"><a href="helper-functions.html#cb18-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)),</span>
<span id="cb18-60"><a href="helper-functions.html#cb18-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters == round(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb18-61"><a href="helper-functions.html#cb18-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb18-62"><a href="helper-functions.html#cb18-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-63"><a href="helper-functions.html#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb18-64"><a href="helper-functions.html#cb18-64" aria-hidden="true" tabindex="-1"></a>  res_sing_clust <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb18-65"><a href="helper-functions.html#cb18-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_sing_clust), <span class="dv">4</span>)</span>
<span id="cb18-66"><a href="helper-functions.html#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="helper-functions.html#cb18-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-68"><a href="helper-functions.html#cb18-68" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>formatClusters:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="helper-functions.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Formats clusters in standardized way, optionally estimating cluster</span></span>
<span id="cb20-2"><a href="helper-functions.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototypes</span></span>
<span id="cb20-3"><a href="helper-functions.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb20-4"><a href="helper-functions.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters Either an integer vector of a list of integer vectors; each</span></span>
<span id="cb20-5"><a href="helper-functions.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector should contain the indices of a cluster of features. (If there is only</span></span>
<span id="cb20-6"><a href="helper-functions.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster, clusters can either be a list of length 1 or simply an integer</span></span>
<span id="cb20-7"><a href="helper-functions.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector.) If clusters is specified then R is ignored.</span></span>
<span id="cb20-8"><a href="helper-functions.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p integer or numeric; the numbe of features in x (should match </span></span>
<span id="cb20-9"><a href="helper-functions.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ncol(x), if x is provided)</span></span>
<span id="cb20-10"><a href="helper-functions.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clust_names A character vector of the names of the clusters in</span></span>
<span id="cb20-11"><a href="helper-functions.html#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.</span></span>
<span id="cb20-12"><a href="helper-functions.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param get_prototypes Logical: if TRUE, will identify prototype from each</span></span>
<span id="cb20-13"><a href="helper-functions.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster (the feature from each cluster that is most correlated with the</span></span>
<span id="cb20-14"><a href="helper-functions.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response) for the protolasso. In this case, x and y must be provided.</span></span>
<span id="cb20-15"><a href="helper-functions.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix. Only needs to be provided if</span></span>
<span id="cb20-16"><a href="helper-functions.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; get_prototypes is TRUE.</span></span>
<span id="cb20-17"><a href="helper-functions.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector; only needs to be provided if get_prototypes</span></span>
<span id="cb20-18"><a href="helper-functions.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is TRUE. Note: in general, the css function does not require y to be a</span></span>
<span id="cb20-19"><a href="helper-functions.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector, because the provided fitfun could use a different form of y</span></span>
<span id="cb20-20"><a href="helper-functions.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (for example, a categorical response variable). However, y must be numeric in</span></span>
<span id="cb20-21"><a href="helper-functions.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order to provide prototypes because the prototypes are determined using the</span></span>
<span id="cb20-22"><a href="helper-functions.html#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between cluster members (columns of x) and y.</span></span>
<span id="cb20-23"><a href="helper-functions.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param R Numeric p x p matrix; not currently used. Entry ij contains the </span></span>
<span id="cb20-24"><a href="helper-functions.html#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;substitutive value&quot; of feature i for feature j (diagonal must consist of</span></span>
<span id="cb20-25"><a href="helper-functions.html#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ones, all entries must be between 0 and 1, and matrix must be symmetric)</span></span>
<span id="cb20-26"><a href="helper-functions.html#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{clusters}{A named</span></span>
<span id="cb20-27"><a href="helper-functions.html#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; list where each entry is an integer vector of indices of features that are in</span></span>
<span id="cb20-28"><a href="helper-functions.html#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a common cluster. (The length of list clusters is equal to the number of</span></span>
<span id="cb20-29"><a href="helper-functions.html#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.) All identified clusters are non-overlapping. All features appear</span></span>
<span id="cb20-30"><a href="helper-functions.html#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in exactly one cluster (any unclustered features will be put in their own</span></span>
<span id="cb20-31"><a href="helper-functions.html#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).} \item{multiple}{Logical; TRUE if there is more than</span></span>
<span id="cb20-32"><a href="helper-functions.html#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster of size greater than 1, FALSE otherwise.} \item{prototypes}{only</span></span>
<span id="cb20-33"><a href="helper-functions.html#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned if get_prototypes=TRUE. An integer vector whose length is equal to</span></span>
<span id="cb20-34"><a href="helper-functions.html#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the number of clusters. Entry i is the index of the feature belonging to</span></span>
<span id="cb20-35"><a href="helper-functions.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster i that is most highly correlated with y (that is, the prototype for</span></span>
<span id="cb20-36"><a href="helper-functions.html#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cluster, as in the protolasso; see Reid and Tibshirani 2016).}</span></span>
<span id="cb20-37"><a href="helper-functions.html#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb20-38"><a href="helper-functions.html#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Reid, S., &amp; Tibshirani, R. (2016). Sparse regression and marginal</span></span>
<span id="cb20-39"><a href="helper-functions.html#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testing using cluster prototypes. \emph{Biostatistics}, 17(2), 364–376.</span></span>
<span id="cb20-40"><a href="helper-functions.html#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1093/biostatistics/kxv049}.</span></span>
<span id="cb20-41"><a href="helper-functions.html#cb20-41" aria-hidden="true" tabindex="-1"></a><span id='formatClusters'>formatClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">clusters=</span><span class="cn">NA</span>, <span class="at">p=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">clust_names=</span><span class="cn">NA</span>, </span>
<span id="cb20-42"><a href="helper-functions.html#cb20-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>){</span>
<span id="cb20-43"><a href="helper-functions.html#cb20-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-44"><a href="helper-functions.html#cb20-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb20-45"><a href="helper-functions.html#cb20-45" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(clusters, p, clust_names,</span>
<span id="cb20-46"><a href="helper-functions.html#cb20-46" aria-hidden="true" tabindex="-1"></a>        get_prototypes, x, y, R)</span>
<span id="cb20-47"><a href="helper-functions.html#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="helper-functions.html#cb20-48" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb20-49"><a href="helper-functions.html#cb20-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-50"><a href="helper-functions.html#cb20-50" aria-hidden="true" tabindex="-1"></a>    multiple <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb20-51"><a href="helper-functions.html#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="helper-functions.html#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;</span> <span class="dv">1</span>)){ <span class="co"># &amp; length(clusters) &gt; 1</span></span>
<span id="cb20-53"><a href="helper-functions.html#cb20-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only care about clusters with more than one element (only ones that</span></span>
<span id="cb20-54"><a href="helper-functions.html#cb20-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># need to be treated differently)</span></span>
<span id="cb20-55"><a href="helper-functions.html#cb20-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># keep track of whether there&#39;s more than one cluster or not</span></span>
<span id="cb20-56"><a href="helper-functions.html#cb20-56" aria-hidden="true" tabindex="-1"></a>        multiple <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb20-57"><a href="helper-functions.html#cb20-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-58"><a href="helper-functions.html#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="helper-functions.html#cb20-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For any features not already in a cluster, add a cluster containing only</span></span>
<span id="cb20-60"><a href="helper-functions.html#cb20-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># that feature</span></span>
<span id="cb20-61"><a href="helper-functions.html#cb20-61" aria-hidden="true" tabindex="-1"></a>    orig_length_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb20-62"><a href="helper-functions.html#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="helper-functions.html#cb20-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb20-64"><a href="helper-functions.html#cb20-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb20-65"><a href="helper-functions.html#cb20-65" aria-hidden="true" tabindex="-1"></a>        feat_i_found <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb20-66"><a href="helper-functions.html#cb20-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(orig_length_clusters <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb20-67"><a href="helper-functions.html#cb20-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>orig_length_clusters){</span>
<span id="cb20-68"><a href="helper-functions.html#cb20-68" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If i is in cluster j, break out of this loop and consider the</span></span>
<span id="cb20-69"><a href="helper-functions.html#cb20-69" aria-hidden="true" tabindex="-1"></a>                <span class="co"># next i</span></span>
<span id="cb20-70"><a href="helper-functions.html#cb20-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(i <span class="sc">%in%</span> clusters[[j]]){</span>
<span id="cb20-71"><a href="helper-functions.html#cb20-71" aria-hidden="true" tabindex="-1"></a>                    feat_i_found <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb20-72"><a href="helper-functions.html#cb20-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb20-73"><a href="helper-functions.html#cb20-73" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb20-74"><a href="helper-functions.html#cb20-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-75"><a href="helper-functions.html#cb20-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-76"><a href="helper-functions.html#cb20-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-77"><a href="helper-functions.html#cb20-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If feature i wasn&#39;t found in any cluster, add a cluster containing</span></span>
<span id="cb20-78"><a href="helper-functions.html#cb20-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># just feature i</span></span>
<span id="cb20-79"><a href="helper-functions.html#cb20-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span>feat_i_found){</span>
<span id="cb20-80"><a href="helper-functions.html#cb20-80" aria-hidden="true" tabindex="-1"></a>            clusters[[<span class="fu">length</span>(clusters) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> i</span>
<span id="cb20-81"><a href="helper-functions.html#cb20-81" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-82"><a href="helper-functions.html#cb20-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-83"><a href="helper-functions.html#cb20-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-84"><a href="helper-functions.html#cb20-84" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb20-85"><a href="helper-functions.html#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="helper-functions.html#cb20-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add names to clusters</span></span>
<span id="cb20-87"><a href="helper-functions.html#cb20-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(<span class="fu">names</span>(clusters))){</span>
<span id="cb20-88"><a href="helper-functions.html#cb20-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(clusters) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb20-89"><a href="helper-functions.html#cb20-89" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb20-90"><a href="helper-functions.html#cb20-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What clusters need names?</span></span>
<span id="cb20-91"><a href="helper-functions.html#cb20-91" aria-hidden="true" tabindex="-1"></a>        unnamed_clusts <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(<span class="fu">names</span>(clusters)) <span class="sc">|</span> <span class="fu">names</span>(clusters) <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb20-92"><a href="helper-functions.html#cb20-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(unnamed_clusts) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb20-93"><a href="helper-functions.html#cb20-93" aria-hidden="true" tabindex="-1"></a>            proposed_clust_names <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>, unnamed_clusts, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb20-94"><a href="helper-functions.html#cb20-94" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Replace any proposed cluster names that are already in use</span></span>
<span id="cb20-95"><a href="helper-functions.html#cb20-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters))){</span>
<span id="cb20-96"><a href="helper-functions.html#cb20-96" aria-hidden="true" tabindex="-1"></a>                proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>,</span>
<span id="cb20-97"><a href="helper-functions.html#cb20-97" aria-hidden="true" tabindex="-1"></a>                    unnamed_clusts[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="sc">+</span> p,</span>
<span id="cb20-98"><a href="helper-functions.html#cb20-98" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb20-99"><a href="helper-functions.html#cb20-99" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-100"><a href="helper-functions.html#cb20-100" aria-hidden="true" tabindex="-1"></a>            while_counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb20-101"><a href="helper-functions.html#cb20-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span>(<span class="fu">any</span>(proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters))){</span>
<span id="cb20-102"><a href="helper-functions.html#cb20-102" aria-hidden="true" tabindex="-1"></a>                proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)],</span>
<span id="cb20-103"><a href="helper-functions.html#cb20-103" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;_1&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb20-104"><a href="helper-functions.html#cb20-104" aria-hidden="true" tabindex="-1"></a>                while_counter <span class="ot">&lt;-</span> while_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb20-105"><a href="helper-functions.html#cb20-105" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(while_counter <span class="sc">&gt;=</span> <span class="dv">100</span>){</span>
<span id="cb20-106"><a href="helper-functions.html#cb20-106" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">stop</span>(<span class="st">&quot;Function formatClusters stuck in an infinite while loop&quot;</span>)</span>
<span id="cb20-107"><a href="helper-functions.html#cb20-107" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb20-108"><a href="helper-functions.html#cb20-108" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-109"><a href="helper-functions.html#cb20-109" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(unnamed_clusts) <span class="sc">==</span> <span class="fu">length</span>(proposed_clust_names))</span>
<span id="cb20-110"><a href="helper-functions.html#cb20-110" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(clusters)[unnamed_clusts] <span class="ot">&lt;-</span> proposed_clust_names</span>
<span id="cb20-111"><a href="helper-functions.html#cb20-111" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-112"><a href="helper-functions.html#cb20-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-113"><a href="helper-functions.html#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="helper-functions.html#cb20-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb20-115"><a href="helper-functions.html#cb20-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-116"><a href="helper-functions.html#cb20-116" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkClusters'>checkClusters</a>(clusters, p)</span>
<span id="cb20-117"><a href="helper-functions.html#cb20-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(multiple))</span>
<span id="cb20-118"><a href="helper-functions.html#cb20-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(multiple) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb20-119"><a href="helper-functions.html#cb20-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(multiple))</span>
<span id="cb20-120"><a href="helper-functions.html#cb20-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-121"><a href="helper-functions.html#cb20-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(get_prototypes){</span>
<span id="cb20-122"><a href="helper-functions.html#cb20-122" aria-hidden="true" tabindex="-1"></a>        prototypes <span class="ot">&lt;-</span> <a href='helper-functions.html#getPrototypes'>getPrototypes</a>(clusters, x, y)</span>
<span id="cb20-123"><a href="helper-functions.html#cb20-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-124"><a href="helper-functions.html#cb20-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">clusters=</span>clusters, <span class="at">multiple=</span>multiple,</span>
<span id="cb20-125"><a href="helper-functions.html#cb20-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">prototypes=</span>prototypes))</span>
<span id="cb20-126"><a href="helper-functions.html#cb20-126" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb20-127"><a href="helper-functions.html#cb20-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">clusters=</span>clusters, <span class="at">multiple=</span>multiple))</span>
<span id="cb20-128"><a href="helper-functions.html#cb20-128" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-129"><a href="helper-functions.html#cb20-129" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkFormatClustersInput:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="helper-functions.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to ensure that the inputs to formatClusters are as expected</span></span>
<span id="cb21-2"><a href="helper-functions.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb21-3"><a href="helper-functions.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters Either an integer vector of a list of integer vectors; each</span></span>
<span id="cb21-4"><a href="helper-functions.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector should contain the indices of a cluster of features. (If there is only</span></span>
<span id="cb21-5"><a href="helper-functions.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster, clusters can either be a list of length 1 or simply an integer</span></span>
<span id="cb21-6"><a href="helper-functions.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector.) If clusters is specified then R is ignored.</span></span>
<span id="cb21-7"><a href="helper-functions.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p integer or numeric; the numbe of features in x (should match </span></span>
<span id="cb21-8"><a href="helper-functions.html#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ncol(x), if x is provided)</span></span>
<span id="cb21-9"><a href="helper-functions.html#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clust_names A character vector of the names of the clusters in clusters.</span></span>
<span id="cb21-10"><a href="helper-functions.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param get_prototypes Logical: if TRUE, will identify prototype from each</span></span>
<span id="cb21-11"><a href="helper-functions.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster (the feature from each cluster that is most correlated with the</span></span>
<span id="cb21-12"><a href="helper-functions.html#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response) for the protolasso. In this case, x and y must be provided.</span></span>
<span id="cb21-13"><a href="helper-functions.html#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix. Only needs to be provided if</span></span>
<span id="cb21-14"><a href="helper-functions.html#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; get_prototypes is TRUE.</span></span>
<span id="cb21-15"><a href="helper-functions.html#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector; only needs to be provided if get_prototypes</span></span>
<span id="cb21-16"><a href="helper-functions.html#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is TRUE. Note: in general, the css function does not require y to be a</span></span>
<span id="cb21-17"><a href="helper-functions.html#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector, because the provided fitfun could use a different form of y</span></span>
<span id="cb21-18"><a href="helper-functions.html#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (for example, a categorical response variable). However, y must be numeric in</span></span>
<span id="cb21-19"><a href="helper-functions.html#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order to provide prototypes because the prototypes are determined using the</span></span>
<span id="cb21-20"><a href="helper-functions.html#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between cluster members (columns of x) and y.</span></span>
<span id="cb21-21"><a href="helper-functions.html#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param R Numeric p x p matrix; not currently used. Entry ij contains the </span></span>
<span id="cb21-22"><a href="helper-functions.html#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;substitutive value&quot; of feature i for feature j (diagonal must consist of</span></span>
<span id="cb21-23"><a href="helper-functions.html#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ones, all entries must be between 0 and 1, and matrix must be symmetric)</span></span>
<span id="cb21-24"><a href="helper-functions.html#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of integer vectors; each vector will contain the indices of a</span></span>
<span id="cb21-25"><a href="helper-functions.html#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster of features. Any duplicated clusters provided in the input will be</span></span>
<span id="cb21-26"><a href="helper-functions.html#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; removed.</span></span>
<span id="cb21-27"><a href="helper-functions.html#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb21-28"><a href="helper-functions.html#cb21-28" aria-hidden="true" tabindex="-1"></a><span id='checkFormatClustersInput'>checkFormatClustersInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, p, clust_names, </span>
<span id="cb21-29"><a href="helper-functions.html#cb21-29" aria-hidden="true" tabindex="-1"></a>    get_prototypes, x, y, R){</span>
<span id="cb21-30"><a href="helper-functions.html#cb21-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-31"><a href="helper-functions.html#cb21-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">any</span>(<span class="fu">is.na</span>(R))){</span>
<span id="cb21-32"><a href="helper-functions.html#cb21-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>)</span>
<span id="cb21-33"><a href="helper-functions.html#cb21-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-34"><a href="helper-functions.html#cb21-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-35"><a href="helper-functions.html#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(p) <span class="sc">|</span> <span class="fu">is.numeric</span>(p))</span>
<span id="cb21-36"><a href="helper-functions.html#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(p) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb21-37"><a href="helper-functions.html#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">==</span> <span class="fu">round</span>(p))</span>
<span id="cb21-38"><a href="helper-functions.html#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(p))</span>
<span id="cb21-39"><a href="helper-functions.html#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb21-40"><a href="helper-functions.html#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb21-41"><a href="helper-functions.html#cb21-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-42"><a href="helper-functions.html#cb21-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-43"><a href="helper-functions.html#cb21-43" aria-hidden="true" tabindex="-1"></a>    use_R <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb21-44"><a href="helper-functions.html#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(clusters)) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb21-45"><a href="helper-functions.html#cb21-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(R))){</span>
<span id="cb21-46"><a href="helper-functions.html#cb21-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(R))</span>
<span id="cb21-47"><a href="helper-functions.html#cb21-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">dim</span>(R) <span class="sc">==</span> p))</span>
<span id="cb21-48"><a href="helper-functions.html#cb21-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">diag</span>(R) <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb21-49"><a href="helper-functions.html#cb21-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">identical</span>(R, <span class="fu">t</span>(R)))</span>
<span id="cb21-50"><a href="helper-functions.html#cb21-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(R)))</span>
<span id="cb21-51"><a href="helper-functions.html#cb21-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(R <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb21-52"><a href="helper-functions.html#cb21-52" aria-hidden="true" tabindex="-1"></a>            use_R <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb21-53"><a href="helper-functions.html#cb21-53" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-54"><a href="helper-functions.html#cb21-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb21-55"><a href="helper-functions.html#cb21-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb21-56"><a href="helper-functions.html#cb21-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb21-57"><a href="helper-functions.html#cb21-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb21-58"><a href="helper-functions.html#cb21-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-59"><a href="helper-functions.html#cb21-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters) <span class="sc">&amp;</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb21-60"><a href="helper-functions.html#cb21-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb21-61"><a href="helper-functions.html#cb21-61" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb21-62"><a href="helper-functions.html#cb21-62" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb21-63"><a href="helper-functions.html#cb21-63" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb21-64"><a href="helper-functions.html#cb21-64" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb21-65"><a href="helper-functions.html#cb21-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-66"><a href="helper-functions.html#cb21-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-67"><a href="helper-functions.html#cb21-67" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb21-68"><a href="helper-functions.html#cb21-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-69"><a href="helper-functions.html#cb21-69" aria-hidden="true" tabindex="-1"></a>            clusters <span class="ot">&lt;-</span> clusters[<span class="sc">!</span><span class="fu">duplicated</span>(clusters)]</span>
<span id="cb21-70"><a href="helper-functions.html#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="helper-functions.html#cb21-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb21-72"><a href="helper-functions.html#cb21-72" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb21-73"><a href="helper-functions.html#cb21-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb21-74"><a href="helper-functions.html#cb21-74" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb21-75"><a href="helper-functions.html#cb21-75" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]],</span>
<span id="cb21-76"><a href="helper-functions.html#cb21-76" aria-hidden="true" tabindex="-1"></a>                            clusters[[j]])) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb21-77"><a href="helper-functions.html#cb21-77" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb21-78"><a href="helper-functions.html#cb21-78" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb21-79"><a href="helper-functions.html#cb21-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-80"><a href="helper-functions.html#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="helper-functions.html#cb21-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(clust_names))){</span>
<span id="cb21-82"><a href="helper-functions.html#cb21-82" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clust_names) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb21-83"><a href="helper-functions.html#cb21-83" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-84"><a href="helper-functions.html#cb21-84" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters)){</span>
<span id="cb21-85"><a href="helper-functions.html#cb21-85" aria-hidden="true" tabindex="-1"></a>            clusters_temp <span class="ot">&lt;-</span> clusters</span>
<span id="cb21-86"><a href="helper-functions.html#cb21-86" aria-hidden="true" tabindex="-1"></a>            clusters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb21-87"><a href="helper-functions.html#cb21-87" aria-hidden="true" tabindex="-1"></a>            clusters[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> clusters_temp</span>
<span id="cb21-88"><a href="helper-functions.html#cb21-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rm</span>(clusters_temp)</span>
<span id="cb21-89"><a href="helper-functions.html#cb21-89" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-90"><a href="helper-functions.html#cb21-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-91"><a href="helper-functions.html#cb21-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-92"><a href="helper-functions.html#cb21-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(get_prototypes) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb21-93"><a href="helper-functions.html#cb21-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(get_prototypes))</span>
<span id="cb21-94"><a href="helper-functions.html#cb21-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-95"><a href="helper-functions.html#cb21-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(clust_names))){</span>
<span id="cb21-96"><a href="helper-functions.html#cb21-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(clust_names))</span>
<span id="cb21-97"><a href="helper-functions.html#cb21-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-98"><a href="helper-functions.html#cb21-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-99"><a href="helper-functions.html#cb21-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(get_prototypes){</span>
<span id="cb21-100"><a href="helper-functions.html#cb21-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb21-101"><a href="helper-functions.html#cb21-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb21-102"><a href="helper-functions.html#cb21-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-103"><a href="helper-functions.html#cb21-103" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb21-104"><a href="helper-functions.html#cb21-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-105"><a href="helper-functions.html#cb21-105" aria-hidden="true" tabindex="-1"></a>        <a href='helper-functions.html#checkY'>checkY</a>(y, n)</span>
<span id="cb21-106"><a href="helper-functions.html#cb21-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-107"><a href="helper-functions.html#cb21-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-108"><a href="helper-functions.html#cb21-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(use_R){</span>
<span id="cb21-109"><a href="helper-functions.html#cb21-109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine clusters from R</span></span>
<span id="cb21-110"><a href="helper-functions.html#cb21-110" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb21-111"><a href="helper-functions.html#cb21-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-112"><a href="helper-functions.html#cb21-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(R)){</span>
<span id="cb21-113"><a href="helper-functions.html#cb21-113" aria-hidden="true" tabindex="-1"></a>            clusters[[i]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">which</span>(R[i, ] <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb21-114"><a href="helper-functions.html#cb21-114" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb21-115"><a href="helper-functions.html#cb21-115" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb21-116"><a href="helper-functions.html#cb21-116" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb21-117"><a href="helper-functions.html#cb21-117" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-118"><a href="helper-functions.html#cb21-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-119"><a href="helper-functions.html#cb21-119" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">unique</span>(clusters)</span>
<span id="cb21-120"><a href="helper-functions.html#cb21-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb21-121"><a href="helper-functions.html#cb21-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-122"><a href="helper-functions.html#cb21-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb21-123"><a href="helper-functions.html#cb21-123" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb21-124"><a href="helper-functions.html#cb21-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb21-125"><a href="helper-functions.html#cb21-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb21-126"><a href="helper-functions.html#cb21-126" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]], clusters[[j]])) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb21-127"><a href="helper-functions.html#cb21-127" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">stop</span>(<span class="st">&quot;Invalid R matrix with overlapping clusters (clusters must not be overlapping)&quot;</span>)</span>
<span id="cb21-128"><a href="helper-functions.html#cb21-128" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb21-129"><a href="helper-functions.html#cb21-129" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb21-130"><a href="helper-functions.html#cb21-130" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-131"><a href="helper-functions.html#cb21-131" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-132"><a href="helper-functions.html#cb21-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-133"><a href="helper-functions.html#cb21-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-134"><a href="helper-functions.html#cb21-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb21-135"><a href="helper-functions.html#cb21-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-136"><a href="helper-functions.html#cb21-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clusters)</span>
<span id="cb21-137"><a href="helper-functions.html#cb21-137" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkY:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="helper-functions.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument y to several functions is</span></span>
<span id="cb22-2"><a href="helper-functions.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as expected</span></span>
<span id="cb22-3"><a href="helper-functions.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb22-4"><a href="helper-functions.html#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector.</span></span>
<span id="cb22-5"><a href="helper-functions.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Number of observations of covariates; should match length of y.</span></span>
<span id="cb22-6"><a href="helper-functions.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb22-7"><a href="helper-functions.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span id='checkY'>checkY</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(y, n){</span>
<span id="cb22-8"><a href="helper-functions.html#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(y)))</span>
<span id="cb22-9"><a href="helper-functions.html#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb22-10"><a href="helper-functions.html#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb22-11"><a href="helper-functions.html#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb22-12"><a href="helper-functions.html#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(n))</span>
<span id="cb22-13"><a href="helper-functions.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n) <span class="sc">|</span> <span class="fu">is.integer</span>(n))</span>
<span id="cb22-14"><a href="helper-functions.html#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">round</span>(n))</span>
<span id="cb22-15"><a href="helper-functions.html#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb22-16"><a href="helper-functions.html#cb22-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb22-17"><a href="helper-functions.html#cb22-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkY:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="helper-functions.html#cb23-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkY works&quot;</span>, {</span>
<span id="cb23-2"><a href="helper-functions.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)<span class="sc">*</span>.<span class="dv">1</span>, <span class="dv">20</span>))</span>
<span id="cb23-3"><a href="helper-functions.html#cb23-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkY'>checkY</a>(1L<span class="sc">:</span>15L, <span class="dv">15</span>))</span>
<span id="cb23-4"><a href="helper-functions.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">8</span>), <span class="st">&quot;n == length(y) is not TRUE&quot;</span>,</span>
<span id="cb23-5"><a href="helper-functions.html#cb23-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-6"><a href="helper-functions.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="sc">-</span><span class="dv">7</span>), <span class="st">&quot;n &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-7"><a href="helper-functions.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="fu">rep</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="dv">13</span>), <span class="dv">13</span>),</span>
<span id="cb23-8"><a href="helper-functions.html#cb23-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(y)) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-9"><a href="helper-functions.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="fu">rep</span>(<span class="fl">5.2</span>, <span class="dv">9</span>), <span class="dv">9</span>),</span>
<span id="cb23-10"><a href="helper-functions.html#cb23-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(unique(y)) &gt; 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-11"><a href="helper-functions.html#cb23-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkY'>checkY</a>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="dv">3</span>),</span>
<span id="cb23-12"><a href="helper-functions.html#cb23-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb23-13"><a href="helper-functions.html#cb23-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb23-14"><a href="helper-functions.html#cb23-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p>Tests for checkFormatClustersInput:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="helper-functions.html#cb25-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkFormatClustersInput works&quot;</span>, {</span>
<span id="cb25-2"><a href="helper-functions.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="helper-functions.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb25-4"><a href="helper-functions.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb25-5"><a href="helper-functions.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>4L, <span class="at">green_cluster=</span>5L<span class="sc">:</span>8L)</span>
<span id="cb25-6"><a href="helper-functions.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-7"><a href="helper-functions.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(good_clusters, <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-8"><a href="helper-functions.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">clust_names=</span><span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>),</span>
<span id="cb25-9"><a href="helper-functions.html#cb25-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)</span>
<span id="cb25-10"><a href="helper-functions.html#cb25-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-11"><a href="helper-functions.html#cb25-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb25-12"><a href="helper-functions.html#cb25-12" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb25-13"><a href="helper-functions.html#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb25-14"><a href="helper-functions.html#cb25-14" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb25-15"><a href="helper-functions.html#cb25-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-16"><a href="helper-functions.html#cb25-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb25-17"><a href="helper-functions.html#cb25-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb25-18"><a href="helper-functions.html#cb25-18" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb25-19"><a href="helper-functions.html#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="helper-functions.html#cb25-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb25-21"><a href="helper-functions.html#cb25-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-22"><a href="helper-functions.html#cb25-22" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb25-23"><a href="helper-functions.html#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="helper-functions.html#cb25-24" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(unnamed_clusters, <span class="at">p=</span><span class="dv">10</span>, <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-25"><a href="helper-functions.html#cb25-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)</span>
<span id="cb25-26"><a href="helper-functions.html#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="helper-functions.html#cb25-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb25-28"><a href="helper-functions.html#cb25-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb25-29"><a href="helper-functions.html#cb25-29" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb25-30"><a href="helper-functions.html#cb25-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb25-31"><a href="helper-functions.html#cb25-31" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb25-32"><a href="helper-functions.html#cb25-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-33"><a href="helper-functions.html#cb25-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb25-34"><a href="helper-functions.html#cb25-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb25-35"><a href="helper-functions.html#cb25-35" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb25-36"><a href="helper-functions.html#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="helper-functions.html#cb25-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-38"><a href="helper-functions.html#cb25-38" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-39"><a href="helper-functions.html#cb25-39" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-40"><a href="helper-functions.html#cb25-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-41"><a href="helper-functions.html#cb25-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(intersect(clusters[[i]], clusters[[j]])) == 0 is not TRUE&quot;</span>,</span>
<span id="cb25-42"><a href="helper-functions.html#cb25-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-43"><a href="helper-functions.html#cb25-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-44"><a href="helper-functions.html#cb25-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">clust_names=</span><span class="cn">NA</span>, <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-45"><a href="helper-functions.html#cb25-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-46"><a href="helper-functions.html#cb25-46" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb25-47"><a href="helper-functions.html#cb25-47" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-48"><a href="helper-functions.html#cb25-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-49"><a href="helper-functions.html#cb25-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>)),</span>
<span id="cb25-50"><a href="helper-functions.html#cb25-50" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-51"><a href="helper-functions.html#cb25-51" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-52"><a href="helper-functions.html#cb25-52" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-53"><a href="helper-functions.html#cb25-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-54"><a href="helper-functions.html#cb25-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>,</span>
<span id="cb25-55"><a href="helper-functions.html#cb25-55" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-56"><a href="helper-functions.html#cb25-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-57"><a href="helper-functions.html#cb25-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb25-58"><a href="helper-functions.html#cb25-58" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-59"><a href="helper-functions.html#cb25-59" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-60"><a href="helper-functions.html#cb25-60" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-61"><a href="helper-functions.html#cb25-61" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-62"><a href="helper-functions.html#cb25-62" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb25-63"><a href="helper-functions.html#cb25-63" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-64"><a href="helper-functions.html#cb25-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-65"><a href="helper-functions.html#cb25-65" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb25-66"><a href="helper-functions.html#cb25-66" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-67"><a href="helper-functions.html#cb25-67" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-68"><a href="helper-functions.html#cb25-68" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-69"><a href="helper-functions.html#cb25-69" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-70"><a href="helper-functions.html#cb25-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb25-71"><a href="helper-functions.html#cb25-71" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-72"><a href="helper-functions.html#cb25-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-73"><a href="helper-functions.html#cb25-73" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>)),</span>
<span id="cb25-74"><a href="helper-functions.html#cb25-74" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-75"><a href="helper-functions.html#cb25-75" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-76"><a href="helper-functions.html#cb25-76" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb25-77"><a href="helper-functions.html#cb25-77" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb25-78"><a href="helper-functions.html#cb25-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.integer(clusters[[i]]) is not TRUE&quot;</span>,</span>
<span id="cb25-79"><a href="helper-functions.html#cb25-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb25-80"><a href="helper-functions.html#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="helper-functions.html#cb25-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb25-82"><a href="helper-functions.html#cb25-82" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='helper-functions.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb25-83"><a href="helper-functions.html#cb25-83" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb25-84"><a href="helper-functions.html#cb25-84" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">get_prototypes=</span><span class="cn">FALSE</span>,</span>
<span id="cb25-85"><a href="helper-functions.html#cb25-85" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)))</span>
<span id="cb25-86"><a href="helper-functions.html#cb25-86" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p>checkClusters:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="helper-functions.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument clusters to several functions is</span></span>
<span id="cb27-2"><a href="helper-functions.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as expected</span></span>
<span id="cb27-3"><a href="helper-functions.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb27-4"><a href="helper-functions.html#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb27-5"><a href="helper-functions.html#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of css or</span></span>
<span id="cb27-6"><a href="helper-functions.html#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formatClusters. (The length of list clusters is equal to the number of</span></span>
<span id="cb27-7"><a href="helper-functions.html#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.) All identified clusters must be non-overlapping, and all features</span></span>
<span id="cb27-8"><a href="helper-functions.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; must appear in exactly one cluster (any unclustered features should be in</span></span>
<span id="cb27-9"><a href="helper-functions.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; their own &quot;cluster&quot; of size 1).</span></span>
<span id="cb27-10"><a href="helper-functions.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; must be at least as large as the number of</span></span>
<span id="cb27-11"><a href="helper-functions.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.</span></span>
<span id="cb27-12"><a href="helper-functions.html#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb27-13"><a href="helper-functions.html#cb27-13" aria-hidden="true" tabindex="-1"></a><span id='checkClusters'>checkClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, p){</span>
<span id="cb27-14"><a href="helper-functions.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb27-15"><a href="helper-functions.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb27-16"><a href="helper-functions.html#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb27-17"><a href="helper-functions.html#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="helper-functions.html#cb27-18" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb27-19"><a href="helper-functions.html#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="helper-functions.html#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb27-21"><a href="helper-functions.html#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&lt;=</span> p)</span>
<span id="cb27-22"><a href="helper-functions.html#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)))</span>
<span id="cb27-23"><a href="helper-functions.html#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(<span class="fu">names</span>(clusters)))</span>
<span id="cb27-24"><a href="helper-functions.html#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">names</span>(clusters) <span class="sc">!=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb27-25"><a href="helper-functions.html#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(clusters))) <span class="sc">==</span> n_clusters)</span>
<span id="cb27-26"><a href="helper-functions.html#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="helper-functions.html#cb27-27" aria-hidden="true" tabindex="-1"></a>    all_clustered_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb27-28"><a href="helper-functions.html#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb27-29"><a href="helper-functions.html#cb27-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb27-30"><a href="helper-functions.html#cb27-30" aria-hidden="true" tabindex="-1"></a>        all_clustered_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(all_clustered_feats, clusters[[i]])</span>
<span id="cb27-31"><a href="helper-functions.html#cb27-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-32"><a href="helper-functions.html#cb27-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-33"><a href="helper-functions.html#cb27-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(all_clustered_feats) <span class="sc">==</span> p)</span>
<span id="cb27-34"><a href="helper-functions.html#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(all_clustered_feats)) <span class="sc">==</span> p)</span>
<span id="cb27-35"><a href="helper-functions.html#cb27-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(all_clustered_feats <span class="sc">&lt;=</span> p))</span>
<span id="cb27-36"><a href="helper-functions.html#cb27-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(all_clustered_feats <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb27-37"><a href="helper-functions.html#cb27-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkClusters</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="helper-functions.html#cb28-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkClusters works&quot;</span>, {</span>
<span id="cb28-2"><a href="helper-functions.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L)</span>
<span id="cb28-3"><a href="helper-functions.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-4"><a href="helper-functions.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(good_clusters, <span class="dv">9</span>))</span>
<span id="cb28-5"><a href="helper-functions.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(good_clusters, <span class="dv">10</span>),</span>
<span id="cb28-6"><a href="helper-functions.html#cb28-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb28-7"><a href="helper-functions.html#cb28-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-8"><a href="helper-functions.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(1L<span class="sc">:</span>10L, <span class="dv">10</span>),</span>
<span id="cb28-9"><a href="helper-functions.html#cb28-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(clusters) is not TRUE&quot;</span>,</span>
<span id="cb28-10"><a href="helper-functions.html#cb28-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-11"><a href="helper-functions.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb28-12"><a href="helper-functions.html#cb28-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">integer</span>()), <span class="dv">9</span>),</span>
<span id="cb28-13"><a href="helper-functions.html#cb28-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(clusters) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb28-14"><a href="helper-functions.html#cb28-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-15"><a href="helper-functions.html#cb28-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb28-16"><a href="helper-functions.html#cb28-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="dv">9</span>),</span>
<span id="cb28-17"><a href="helper-functions.html#cb28-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb28-18"><a href="helper-functions.html#cb28-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-19"><a href="helper-functions.html#cb28-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb28-20"><a href="helper-functions.html#cb28-20" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L), <span class="dv">9</span>),</span>
<span id="cb28-21"><a href="helper-functions.html#cb28-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb28-22"><a href="helper-functions.html#cb28-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-23"><a href="helper-functions.html#cb28-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>10L), <span class="dv">9</span>),</span>
<span id="cb28-24"><a href="helper-functions.html#cb28-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(all_clustered_feats &lt;= p) is not TRUE&quot;</span>,</span>
<span id="cb28-25"><a href="helper-functions.html#cb28-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb28-26"><a href="helper-functions.html#cb28-26" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p>getPrototypes:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="helper-functions.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Estimate prototypes from a list of clusters</span></span>
<span id="cb30-2"><a href="helper-functions.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb30-3"><a href="helper-functions.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in list of clusters, x, and y and returns an integer vector (of length</span></span>
<span id="cb30-4"><a href="helper-functions.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; equal to the number of clusters) of the indices of the feature prototypes</span></span>
<span id="cb30-5"><a href="helper-functions.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (the features from each cluster most correlated with the response).</span></span>
<span id="cb30-6"><a href="helper-functions.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb30-7"><a href="helper-functions.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list where each entry is an integer vector of indices of</span></span>
<span id="cb30-8"><a href="helper-functions.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that are in a common cluster. (The length of list clusters must be</span></span>
<span id="cb30-9"><a href="helper-functions.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; equal to the number of clusters.) All identified clusters must be</span></span>
<span id="cb30-10"><a href="helper-functions.html#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; non-overlapping. Must only include clusters of size 2 or larger.</span></span>
<span id="cb30-11"><a href="helper-functions.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix.</span></span>
<span id="cb30-12"><a href="helper-functions.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector. Note: in general, the css function does not</span></span>
<span id="cb30-13"><a href="helper-functions.html#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; require y to be a numeric vector, because the provided fitfun could use a</span></span>
<span id="cb30-14"><a href="helper-functions.html#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different form of y (for example, a categorical response variable). However,</span></span>
<span id="cb30-15"><a href="helper-functions.html#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y must be numeric in order to provide prototypes because the prototypes are</span></span>
<span id="cb30-16"><a href="helper-functions.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; determined using the correlation between cluster members (columns of x) and</span></span>
<span id="cb30-17"><a href="helper-functions.html#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y.</span></span>
<span id="cb30-18"><a href="helper-functions.html#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector of the same length as clusters. Entry j is the</span></span>
<span id="cb30-19"><a href="helper-functions.html#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; index of the feature identified as the prototype for cluster j.</span></span>
<span id="cb30-20"><a href="helper-functions.html#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb30-21"><a href="helper-functions.html#cb30-21" aria-hidden="true" tabindex="-1"></a><span id='getPrototypes'>getPrototypes</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, x, y){</span>
<span id="cb30-22"><a href="helper-functions.html#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb30-23"><a href="helper-functions.html#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="helper-functions.html#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb30-25"><a href="helper-functions.html#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb30-26"><a href="helper-functions.html#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="helper-functions.html#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb30-28"><a href="helper-functions.html#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb30-29"><a href="helper-functions.html#cb30-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-30"><a href="helper-functions.html#cb30-30" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb30-31"><a href="helper-functions.html#cb30-31" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb30-32"><a href="helper-functions.html#cb30-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-33"><a href="helper-functions.html#cb30-33" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkY'>checkY</a>(y, n)</span>
<span id="cb30-34"><a href="helper-functions.html#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="helper-functions.html#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify prototypes</span></span>
<span id="cb30-36"><a href="helper-functions.html#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb30-37"><a href="helper-functions.html#cb30-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb30-38"><a href="helper-functions.html#cb30-38" aria-hidden="true" tabindex="-1"></a>            prototypes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.integer</span>(<span class="cn">NA</span>), <span class="fu">length</span>(clusters))</span>
<span id="cb30-39"><a href="helper-functions.html#cb30-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb30-40"><a href="helper-functions.html#cb30-40" aria-hidden="true" tabindex="-1"></a>                prototypes[i] <span class="ot">&lt;-</span> <a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(clusters[[i]], x, y)</span>
<span id="cb30-41"><a href="helper-functions.html#cb30-41" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb30-42"><a href="helper-functions.html#cb30-42" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb30-43"><a href="helper-functions.html#cb30-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If clusters is not a list, then there is only one cluster.</span></span>
<span id="cb30-44"><a href="helper-functions.html#cb30-44" aria-hidden="true" tabindex="-1"></a>            prototypes <span class="ot">&lt;-</span> <a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(clusters, x, y)</span>
<span id="cb30-45"><a href="helper-functions.html#cb30-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-46"><a href="helper-functions.html#cb30-46" aria-hidden="true" tabindex="-1"></a>    }  <span class="cf">else</span>{</span>
<span id="cb30-47"><a href="helper-functions.html#cb30-47" aria-hidden="true" tabindex="-1"></a>        prototypes <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb30-48"><a href="helper-functions.html#cb30-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-49"><a href="helper-functions.html#cb30-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-50"><a href="helper-functions.html#cb30-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb30-51"><a href="helper-functions.html#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="helper-functions.html#cb30-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(prototypes))</span>
<span id="cb30-53"><a href="helper-functions.html#cb30-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb30-54"><a href="helper-functions.html#cb30-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb30-55"><a href="helper-functions.html#cb30-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb30-56"><a href="helper-functions.html#cb30-56" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb30-57"><a href="helper-functions.html#cb30-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb30-58"><a href="helper-functions.html#cb30-58" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb30-59"><a href="helper-functions.html#cb30-59" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb30-60"><a href="helper-functions.html#cb30-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb30-61"><a href="helper-functions.html#cb30-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-62"><a href="helper-functions.html#cb30-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-63"><a href="helper-functions.html#cb30-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(prototypes)))</span>
<span id="cb30-64"><a href="helper-functions.html#cb30-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(prototypes)))</span>
<span id="cb30-65"><a href="helper-functions.html#cb30-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-66"><a href="helper-functions.html#cb30-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(prototypes)</span>
<span id="cb30-67"><a href="helper-functions.html#cb30-67" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>identifyPrototype:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="helper-functions.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Estimate prototypes from a single cluster</span></span>
<span id="cb31-2"><a href="helper-functions.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb31-3"><a href="helper-functions.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in a single cluster, x, and y and returns an integer of the index of</span></span>
<span id="cb31-4"><a href="helper-functions.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the feature prototype (the feature from the cluster most correlated with the</span></span>
<span id="cb31-5"><a href="helper-functions.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response).</span></span>
<span id="cb31-6"><a href="helper-functions.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb31-7"><a href="helper-functions.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_members_i An integer vector of indices of features that are in</span></span>
<span id="cb31-8"><a href="helper-functions.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a common cluster. Must have length at least 2.</span></span>
<span id="cb31-9"><a href="helper-functions.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix.</span></span>
<span id="cb31-10"><a href="helper-functions.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector. Note: in general, the css function does not</span></span>
<span id="cb31-11"><a href="helper-functions.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; require y to be a numeric vector, because the provided fitfun could use a</span></span>
<span id="cb31-12"><a href="helper-functions.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different form of y (for example, a categorical response variable). However,</span></span>
<span id="cb31-13"><a href="helper-functions.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y must be numeric in order to provide prototypes because the prototypes are</span></span>
<span id="cb31-14"><a href="helper-functions.html#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; determined using the correlation between cluster members (columns of x) and</span></span>
<span id="cb31-15"><a href="helper-functions.html#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y.</span></span>
<span id="cb31-16"><a href="helper-functions.html#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return integer; the index of the feature identified as the prototype for</span></span>
<span id="cb31-17"><a href="helper-functions.html#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cluster.</span></span>
<span id="cb31-18"><a href="helper-functions.html#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb31-19"><a href="helper-functions.html#cb31-19" aria-hidden="true" tabindex="-1"></a><span id='identifyPrototype'>identifyPrototype</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(cluster_members_i, x, y){</span>
<span id="cb31-20"><a href="helper-functions.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input</span></span>
<span id="cb31-21"><a href="helper-functions.html#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(cluster_members_i))</span>
<span id="cb31-22"><a href="helper-functions.html#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If cluster only has one member, that member is the prototype</span></span>
<span id="cb31-23"><a href="helper-functions.html#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(cluster_members_i) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb31-24"><a href="helper-functions.html#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(cluster_members_i)</span>
<span id="cb31-25"><a href="helper-functions.html#cb31-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-26"><a href="helper-functions.html#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="helper-functions.html#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose which cluster member to represent cluster for stability</span></span>
<span id="cb31-28"><a href="helper-functions.html#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># metric purposes by choosing the one most highly correlated</span></span>
<span id="cb31-29"><a href="helper-functions.html#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with y</span></span>
<span id="cb31-30"><a href="helper-functions.html#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="helper-functions.html#cb31-31" aria-hidden="true" tabindex="-1"></a>    cors_i <span class="ot">&lt;-</span> <span class="fu">apply</span>(x[, cluster_members_i], <span class="dv">2</span>, corFunction, <span class="at">y=</span>y)</span>
<span id="cb31-32"><a href="helper-functions.html#cb31-32" aria-hidden="true" tabindex="-1"></a>    max_index_i <span class="ot">&lt;-</span> <span class="fu">which.max</span>(cors_i)[<span class="dv">1</span>]</span>
<span id="cb31-33"><a href="helper-functions.html#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="helper-functions.html#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(max_index_i) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb31-35"><a href="helper-functions.html#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(max_index_i <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cluster_members_i))</span>
<span id="cb31-36"><a href="helper-functions.html#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="helper-functions.html#cb31-37" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> cluster_members_i[max_index_i]</span>
<span id="cb31-38"><a href="helper-functions.html#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="helper-functions.html#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb31-40"><a href="helper-functions.html#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="helper-functions.html#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb31-42"><a href="helper-functions.html#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(ret) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb31-43"><a href="helper-functions.html#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(ret <span class="sc">%in%</span> cluster_members_i)</span>
<span id="cb31-44"><a href="helper-functions.html#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">identical</span>(x[, cluster_members_i][, max_index_i],</span>
<span id="cb31-45"><a href="helper-functions.html#cb31-45" aria-hidden="true" tabindex="-1"></a>        x[, ret]))</span>
<span id="cb31-46"><a href="helper-functions.html#cb31-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-47"><a href="helper-functions.html#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb31-48"><a href="helper-functions.html#cb31-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>corFunction:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="helper-functions.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Absolute value of sample correlation between two vectors</span></span>
<span id="cb32-2"><a href="helper-functions.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb32-3"><a href="helper-functions.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculates the absolute value of correlation of t and y. If either input has</span></span>
<span id="cb32-4"><a href="helper-functions.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; only one unique value, returns 0 by definition.</span></span>
<span id="cb32-5"><a href="helper-functions.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param t A numeric or integer vector.</span></span>
<span id="cb32-6"><a href="helper-functions.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric or integer vector; must have the same length as t.</span></span>
<span id="cb32-7"><a href="helper-functions.html#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric vector of the same length as cluster_i containing the</span></span>
<span id="cb32-8"><a href="helper-functions.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; weights corresponding to each of the features in cluster_i. The weights</span></span>
<span id="cb32-9"><a href="helper-functions.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will all be nonnegative and sum to 1.</span></span>
<span id="cb32-10"><a href="helper-functions.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb32-11"><a href="helper-functions.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span id='corFunction'>corFunction</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(t, y){</span>
<span id="cb32-12"><a href="helper-functions.html#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb32-13"><a href="helper-functions.html#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(t) <span class="sc">|</span> <span class="fu">is.integer</span>(t))</span>
<span id="cb32-14"><a href="helper-functions.html#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb32-15"><a href="helper-functions.html#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(t) <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb32-16"><a href="helper-functions.html#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(t)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb32-17"><a href="helper-functions.html#cb32-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb32-18"><a href="helper-functions.html#cb32-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-19"><a href="helper-functions.html#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb32-20"><a href="helper-functions.html#cb32-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;The second argument to corFunction only had one unique entry&quot;</span>)</span>
<span id="cb32-21"><a href="helper-functions.html#cb32-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb32-22"><a href="helper-functions.html#cb32-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-23"><a href="helper-functions.html#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">abs</span>(stats<span class="sc">::</span><span class="fu">cor</span>(t, y)))</span>
<span id="cb32-24"><a href="helper-functions.html#cb32-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for corFunction</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="helper-functions.html#cb33-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;corFunction works&quot;</span>, {</span>
<span id="cb33-2"><a href="helper-functions.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="dv">0</span>)</span>
<span id="cb33-3"><a href="helper-functions.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">5</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="dv">0</span>)</span>
<span id="cb33-4"><a href="helper-functions.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-5"><a href="helper-functions.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23451</span>)</span>
<span id="cb33-6"><a href="helper-functions.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-7"><a href="helper-functions.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb33-8"><a href="helper-functions.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb33-9"><a href="helper-functions.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(x, y), <span class="fu">abs</span>(stats<span class="sc">::</span><span class="fu">cor</span>(x, y)))</span>
<span id="cb33-10"><a href="helper-functions.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">5</span>)),</span>
<span id="cb33-11"><a href="helper-functions.html#cb33-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;The second argument to corFunction only had one unique entry&quot;</span>,</span>
<span id="cb33-12"><a href="helper-functions.html#cb33-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb33-13"><a href="helper-functions.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>),</span>
<span id="cb33-14"><a href="helper-functions.html#cb33-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(t) | is.integer(t) is not TRUE&quot;</span>,</span>
<span id="cb33-15"><a href="helper-functions.html#cb33-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb33-16"><a href="helper-functions.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="st">&quot;2&quot;</span>),</span>
<span id="cb33-17"><a href="helper-functions.html#cb33-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb33-18"><a href="helper-functions.html#cb33-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb33-19"><a href="helper-functions.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#corFunction'>corFunction</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb33-20"><a href="helper-functions.html#cb33-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(t) == length(y) is not TRUE&quot;</span>,</span>
<span id="cb33-21"><a href="helper-functions.html#cb33-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb33-22"><a href="helper-functions.html#cb33-22" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>Tests for identifyPrototype (requires corFunction)</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="helper-functions.html#cb35-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;identifyPrototype works&quot;</span>, {</span>
<span id="cb35-2"><a href="helper-functions.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(10L, <span class="st">&quot;a&quot;</span>, <span class="dv">5</span>), 10L)</span>
<span id="cb35-3"><a href="helper-functions.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb35-4"><a href="helper-functions.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb35-5"><a href="helper-functions.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-6"><a href="helper-functions.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">9834</span>)</span>
<span id="cb35-7"><a href="helper-functions.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-8"><a href="helper-functions.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb35-9"><a href="helper-functions.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb35-10"><a href="helper-functions.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(p), X, y), p)</span>
<span id="cb35-11"><a href="helper-functions.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(2L, X, y), <span class="dv">2</span>)</span>
<span id="cb35-12"><a href="helper-functions.html#cb35-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(<span class="dv">2</span><span class="sc">:</span>p), X, y), p)</span>
<span id="cb35-13"><a href="helper-functions.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(<span class="dv">2</span><span class="sc">:</span>p), y, X),</span>
<span id="cb35-14"><a href="helper-functions.html#cb35-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;incorrect number of dimensions&quot;</span>,</span>
<span id="cb35-15"><a href="helper-functions.html#cb35-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb35-16"><a href="helper-functions.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-17"><a href="helper-functions.html#cb35-17" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb35-18"><a href="helper-functions.html#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="helper-functions.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">c</span>(2L, 3L), X, y2)</span>
<span id="cb35-20"><a href="helper-functions.html#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="helper-functions.html#cb35-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb35-22"><a href="helper-functions.html#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="helper-functions.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">1</span>)</span>
<span id="cb35-24"><a href="helper-functions.html#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="helper-functions.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb35-26"><a href="helper-functions.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="helper-functions.html#cb35-27" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>Tests for getPrototypes</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="helper-functions.html#cb37-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getPrototypes works&quot;</span>, {</span>
<span id="cb37-2"><a href="helper-functions.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb37-3"><a href="helper-functions.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb37-4"><a href="helper-functions.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-5"><a href="helper-functions.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">902689</span>)</span>
<span id="cb37-6"><a href="helper-functions.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-7"><a href="helper-functions.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb37-8"><a href="helper-functions.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb37-9"><a href="helper-functions.html#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="helper-functions.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), X, y), <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb37-11"><a href="helper-functions.html#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="helper-functions.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L<span class="sc">:</span>5L), X, y), 5L)</span>
<span id="cb37-13"><a href="helper-functions.html#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="helper-functions.html#cb37-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L<span class="sc">:</span>5L), X, y), <span class="fu">c</span>(1L, 5L))</span>
<span id="cb37-15"><a href="helper-functions.html#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="helper-functions.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(3L<span class="sc">:</span>5L), X, y), 5L)</span>
<span id="cb37-17"><a href="helper-functions.html#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="helper-functions.html#cb37-18" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb37-19"><a href="helper-functions.html#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="helper-functions.html#cb37-20" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, <span class="fu">c</span>(2L, 3L), <span class="fu">c</span>(4L, 5L)), X, y2)</span>
<span id="cb37-21"><a href="helper-functions.html#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="helper-functions.html#cb37-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb37-23"><a href="helper-functions.html#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="helper-functions.html#cb37-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb37-25"><a href="helper-functions.html#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="helper-functions.html#cb37-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res[<span class="dv">1</span>], 1L)</span>
<span id="cb37-27"><a href="helper-functions.html#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="helper-functions.html#cb37-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">2</span>] <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb37-29"><a href="helper-functions.html#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="helper-functions.html#cb37-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">3</span>] <span class="sc">%in%</span> <span class="fu">c</span>(4L, 5L))</span>
<span id="cb37-31"><a href="helper-functions.html#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="helper-functions.html#cb37-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), y, X),</span>
<span id="cb37-33"><a href="helper-functions.html#cb37-33" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;is.matrix(x) is not TRUE&quot;</span>,</span>
<span id="cb37-34"><a href="helper-functions.html#cb37-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-35"><a href="helper-functions.html#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="helper-functions.html#cb37-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), X, y[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]),</span>
<span id="cb37-37"><a href="helper-functions.html#cb37-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n == length(y) is not TRUE&quot;</span>,</span>
<span id="cb37-38"><a href="helper-functions.html#cb37-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-39"><a href="helper-functions.html#cb37-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-40"><a href="helper-functions.html#cb37-40" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>Finally, tests for formatClusters:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="helper-functions.html#cb39-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;formatClusters works&quot;</span>, {</span>
<span id="cb39-2"><a href="helper-functions.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-3"><a href="helper-functions.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb39-4"><a href="helper-functions.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb39-5"><a href="helper-functions.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb39-6"><a href="helper-functions.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-7"><a href="helper-functions.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#formatClusters'>formatClusters</a>(good_clusters, <span class="at">p=</span><span class="dv">10</span>)</span>
<span id="cb39-8"><a href="helper-functions.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-9"><a href="helper-functions.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb39-10"><a href="helper-functions.html#cb39-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;clusters&quot;</span>, <span class="st">&quot;multiple&quot;</span>))</span>
<span id="cb39-11"><a href="helper-functions.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-12"><a href="helper-functions.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clusters</span></span>
<span id="cb39-13"><a href="helper-functions.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb39-14"><a href="helper-functions.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters), <span class="dv">5</span>)</span>
<span id="cb39-15"><a href="helper-functions.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">5</span>, <span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters)))</span>
<span id="cb39-16"><a href="helper-functions.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">5</span>, <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb39-17"><a href="helper-functions.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb39-18"><a href="helper-functions.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb39-19"><a href="helper-functions.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb39-20"><a href="helper-functions.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters) <span class="sc">!=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb39-21"><a href="helper-functions.html#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="helper-functions.html#cb39-22" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb39-23"><a href="helper-functions.html#cb39-23" aria-hidden="true" tabindex="-1"></a>  true_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">10</span>)</span>
<span id="cb39-24"><a href="helper-functions.html#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>clusters)){</span>
<span id="cb39-25"><a href="helper-functions.html#cb39-25" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>clusters[[i]]))</span>
<span id="cb39-26"><a href="helper-functions.html#cb39-26" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])), <span class="dv">0</span>)</span>
<span id="cb39-27"><a href="helper-functions.html#cb39-27" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>clusters[[i]] <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb39-28"><a href="helper-functions.html#cb39-28" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters[[i]]),</span>
<span id="cb39-29"><a href="helper-functions.html#cb39-29" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(<span class="fu">unique</span>(res<span class="sc">$</span>clusters[[i]])))</span>
<span id="cb39-30"><a href="helper-functions.html#cb39-30" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>clusters[[i]] <span class="sc">==</span> true_list[[i]]))</span>
<span id="cb39-31"><a href="helper-functions.html#cb39-31" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])</span>
<span id="cb39-32"><a href="helper-functions.html#cb39-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-33"><a href="helper-functions.html#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="helper-functions.html#cb39-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="dv">10</span>)</span>
<span id="cb39-35"><a href="helper-functions.html#cb39-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">10</span>, <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb39-36"><a href="helper-functions.html#cb39-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">10</span>, <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)))</span>
<span id="cb39-37"><a href="helper-functions.html#cb39-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-38"><a href="helper-functions.html#cb39-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multiple</span></span>
<span id="cb39-39"><a href="helper-functions.html#cb39-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>multiple)</span>
<span id="cb39-40"><a href="helper-functions.html#cb39-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_false</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">10</span>)<span class="sc">$</span>multiple)</span>
<span id="cb39-41"><a href="helper-functions.html#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="helper-functions.html#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb39-43"><a href="helper-functions.html#cb39-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-44"><a href="helper-functions.html#cb39-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">p=</span><span class="dv">15</span>),</span>
<span id="cb39-45"><a href="helper-functions.html#cb39-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(intersect(clusters[[i]], clusters[[j]])) == 0 is not TRUE&quot;</span>,</span>
<span id="cb39-46"><a href="helper-functions.html#cb39-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-47"><a href="helper-functions.html#cb39-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">p=</span><span class="dv">9</span>),</span>
<span id="cb39-48"><a href="helper-functions.html#cb39-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb39-49"><a href="helper-functions.html#cb39-49" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-50"><a href="helper-functions.html#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="helper-functions.html#cb39-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">p=</span><span class="dv">7</span>),</span>
<span id="cb39-52"><a href="helper-functions.html#cb39-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb39-53"><a href="helper-functions.html#cb39-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-54"><a href="helper-functions.html#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="helper-functions.html#cb39-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="at">p=</span><span class="dv">10</span>),</span>
<span id="cb39-56"><a href="helper-functions.html#cb39-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>,</span>
<span id="cb39-57"><a href="helper-functions.html#cb39-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-58"><a href="helper-functions.html#cb39-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-59"><a href="helper-functions.html#cb39-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>)), <span class="at">p=</span><span class="dv">8</span>),</span>
<span id="cb39-60"><a href="helper-functions.html#cb39-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb39-61"><a href="helper-functions.html#cb39-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-62"><a href="helper-functions.html#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="helper-functions.html#cb39-63" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>), <span class="at">p=</span><span class="dv">10</span>),</span>
<span id="cb39-64"><a href="helper-functions.html#cb39-64" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb39-65"><a href="helper-functions.html#cb39-65" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-66"><a href="helper-functions.html#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="helper-functions.html#cb39-67" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>))),</span>
<span id="cb39-68"><a href="helper-functions.html#cb39-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.integer(clusters[[i]]) is not TRUE&quot;</span>,</span>
<span id="cb39-69"><a href="helper-functions.html#cb39-69" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-70"><a href="helper-functions.html#cb39-70" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb39-71"><a href="helper-functions.html#cb39-71" aria-hidden="true" tabindex="-1"></a>   <span class="do">### Test prototypes feature</span></span>
<span id="cb39-72"><a href="helper-functions.html#cb39-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb39-73"><a href="helper-functions.html#cb39-73" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb39-74"><a href="helper-functions.html#cb39-74" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb39-75"><a href="helper-functions.html#cb39-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-76"><a href="helper-functions.html#cb39-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">690289</span>)</span>
<span id="cb39-77"><a href="helper-functions.html#cb39-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-78"><a href="helper-functions.html#cb39-78" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb39-79"><a href="helper-functions.html#cb39-79" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb39-80"><a href="helper-functions.html#cb39-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-81"><a href="helper-functions.html#cb39-81" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(), <span class="at">p=</span>p, <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X, <span class="at">y=</span>y)</span>
<span id="cb39-82"><a href="helper-functions.html#cb39-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-83"><a href="helper-functions.html#cb39-83" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb39-84"><a href="helper-functions.html#cb39-84" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;clusters&quot;</span>, <span class="st">&quot;multiple&quot;</span>,</span>
<span id="cb39-85"><a href="helper-functions.html#cb39-85" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;prototypes&quot;</span>))</span>
<span id="cb39-86"><a href="helper-functions.html#cb39-86" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>prototypes))</span>
<span id="cb39-87"><a href="helper-functions.html#cb39-87" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res<span class="sc">$</span>prototypes, <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb39-88"><a href="helper-functions.html#cb39-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-89"><a href="helper-functions.html#cb39-89" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span>p, <span class="at">p=</span>p,</span>
<span id="cb39-90"><a href="helper-functions.html#cb39-90" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb39-91"><a href="helper-functions.html#cb39-91" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes, p)</span>
<span id="cb39-92"><a href="helper-functions.html#cb39-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-93"><a href="helper-functions.html#cb39-93" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(1L, 2L<span class="sc">:</span>p), <span class="at">p=</span>p,</span>
<span id="cb39-94"><a href="helper-functions.html#cb39-94" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb39-95"><a href="helper-functions.html#cb39-95" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes,</span>
<span id="cb39-96"><a href="helper-functions.html#cb39-96" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, p)))</span>
<span id="cb39-97"><a href="helper-functions.html#cb39-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-98"><a href="helper-functions.html#cb39-98" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span>3L<span class="sc">:</span>p, <span class="at">p=</span>p,</span>
<span id="cb39-99"><a href="helper-functions.html#cb39-99" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb39-100"><a href="helper-functions.html#cb39-100" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes,</span>
<span id="cb39-101"><a href="helper-functions.html#cb39-101" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.integer</span>(<span class="fu">c</span>(p, <span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb39-102"><a href="helper-functions.html#cb39-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-103"><a href="helper-functions.html#cb39-103" aria-hidden="true" tabindex="-1"></a>    y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb39-104"><a href="helper-functions.html#cb39-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-105"><a href="helper-functions.html#cb39-105" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p, <span class="at">get_prototypes=</span><span class="cn">TRUE</span>,</span>
<span id="cb39-106"><a href="helper-functions.html#cb39-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x=</span>X, <span class="at">y=</span>y2)<span class="sc">$</span>prototypes</span>
<span id="cb39-107"><a href="helper-functions.html#cb39-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-108"><a href="helper-functions.html#cb39-108" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb39-109"><a href="helper-functions.html#cb39-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-110"><a href="helper-functions.html#cb39-110" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">4</span>)</span>
<span id="cb39-111"><a href="helper-functions.html#cb39-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-112"><a href="helper-functions.html#cb39-112" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">1</span>] <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb39-113"><a href="helper-functions.html#cb39-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-114"><a href="helper-functions.html#cb39-114" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">2</span>] <span class="sc">%in%</span> <span class="fu">c</span>(4L, 5L))</span>
<span id="cb39-115"><a href="helper-functions.html#cb39-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-116"><a href="helper-functions.html#cb39-116" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(res[<span class="dv">3</span>], 1L)</span>
<span id="cb39-117"><a href="helper-functions.html#cb39-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-118"><a href="helper-functions.html#cb39-118" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(res[<span class="dv">4</span>], p)</span>
<span id="cb39-119"><a href="helper-functions.html#cb39-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-120"><a href="helper-functions.html#cb39-120" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p,</span>
<span id="cb39-121"><a href="helper-functions.html#cb39-121" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>y2, <span class="at">y=</span>X),</span>
<span id="cb39-122"><a href="helper-functions.html#cb39-122" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;is.matrix(x) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-123"><a href="helper-functions.html#cb39-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-124"><a href="helper-functions.html#cb39-124" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p,</span>
<span id="cb39-125"><a href="helper-functions.html#cb39-125" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb39-126"><a href="helper-functions.html#cb39-126" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">y=</span>y2[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]),</span>
<span id="cb39-127"><a href="helper-functions.html#cb39-127" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;n == length(y) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-128"><a href="helper-functions.html#cb39-128" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p>checkSamplingType</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="helper-functions.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument sampling_type to several </span></span>
<span id="cb41-2"><a href="helper-functions.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb41-3"><a href="helper-functions.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb41-4"><a href="helper-functions.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. &quot;MB&quot; is not</span></span>
<span id="cb41-5"><a href="helper-functions.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; supported yet.</span></span>
<span id="cb41-6"><a href="helper-functions.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb41-7"><a href="helper-functions.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span id='checkSamplingType'>checkSamplingType</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(sampling_type){</span>
<span id="cb41-8"><a href="helper-functions.html#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(sampling_type))</span>
<span id="cb41-9"><a href="helper-functions.html#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sampling_type) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb41-10"><a href="helper-functions.html#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(sampling_type))</span>
<span id="cb41-11"><a href="helper-functions.html#cb41-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sampling_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;SS&quot;</span>, <span class="st">&quot;MB&quot;</span>))</span>
<span id="cb41-12"><a href="helper-functions.html#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type <span class="sc">==</span> <span class="st">&quot;MB&quot;</span>){</span>
<span id="cb41-13"><a href="helper-functions.html#cb41-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>)</span>
<span id="cb41-14"><a href="helper-functions.html#cb41-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb41-15"><a href="helper-functions.html#cb41-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkSamplingType</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="helper-functions.html#cb42-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkSamplingType works&quot;</span>, {</span>
<span id="cb42-2"><a href="helper-functions.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(<span class="st">&quot;SS&quot;</span>))</span>
<span id="cb42-3"><a href="helper-functions.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(<span class="st">&quot;MB&quot;</span>),</span>
<span id="cb42-4"><a href="helper-functions.html#cb42-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>,</span>
<span id="cb42-5"><a href="helper-functions.html#cb42-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-6"><a href="helper-functions.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(<span class="fu">c</span>(<span class="st">&quot;SS&quot;</span>, <span class="st">&quot;SS&quot;</span>)),</span>
<span id="cb42-7"><a href="helper-functions.html#cb42-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(sampling_type) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-8"><a href="helper-functions.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(<span class="dv">1</span>),</span>
<span id="cb42-9"><a href="helper-functions.html#cb42-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(sampling_type) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-10"><a href="helper-functions.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkSamplingType'>checkSamplingType</a>(<span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb42-11"><a href="helper-functions.html#cb42-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(sampling_type) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb42-12"><a href="helper-functions.html#cb42-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥇</code></pre>
<p>checkB</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="helper-functions.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument B to several functions is as</span></span>
<span id="cb44-2"><a href="helper-functions.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; expected</span></span>
<span id="cb44-3"><a href="helper-functions.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb44-4"><a href="helper-functions.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb44-5"><a href="helper-functions.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the total number of subsamples will be `B`; for</span></span>
<span id="cb44-6"><a href="helper-functions.html#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of subsamples will be `2*B`.</span></span>
<span id="cb44-7"><a href="helper-functions.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb44-8"><a href="helper-functions.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span id='checkB'>checkB</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(B){</span>
<span id="cb44-9"><a href="helper-functions.html#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(B) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb44-10"><a href="helper-functions.html#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(B) <span class="sc">|</span> <span class="fu">is.integer</span>(B))</span>
<span id="cb44-11"><a href="helper-functions.html#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(B))</span>
<span id="cb44-12"><a href="helper-functions.html#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(B <span class="sc">==</span> <span class="fu">round</span>(B))</span>
<span id="cb44-13"><a href="helper-functions.html#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(B <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb44-14"><a href="helper-functions.html#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(B <span class="sc">&lt;</span> <span class="dv">10</span>){</span>
<span id="cb44-15"><a href="helper-functions.html#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Small values of B may lead to poor results.&quot;</span>)</span>
<span id="cb44-16"><a href="helper-functions.html#cb44-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (B <span class="sc">&gt;</span> <span class="dv">2000</span>){</span>
<span id="cb44-17"><a href="helper-functions.html#cb44-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Large values of B may require long computation times.&quot;</span>)</span>
<span id="cb44-18"><a href="helper-functions.html#cb44-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-19"><a href="helper-functions.html#cb44-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkB</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="helper-functions.html#cb45-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkB works&quot;</span>, {</span>
<span id="cb45-2"><a href="helper-functions.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="dv">1500</span>))</span>
<span id="cb45-3"><a href="helper-functions.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="dv">15</span>))</span>
<span id="cb45-4"><a href="helper-functions.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="st">&quot;B&quot;</span>),</span>
<span id="cb45-5"><a href="helper-functions.html#cb45-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(B) | is.integer(B) is not TRUE&quot;</span>,</span>
<span id="cb45-6"><a href="helper-functions.html#cb45-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-7"><a href="helper-functions.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>), <span class="st">&quot;length(B) == 1 is not TRUE&quot;</span>,</span>
<span id="cb45-8"><a href="helper-functions.html#cb45-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-9"><a href="helper-functions.html#cb45-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="st">&quot;!is.na(B) is not TRUE&quot;</span>,</span>
<span id="cb45-10"><a href="helper-functions.html#cb45-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-11"><a href="helper-functions.html#cb45-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="fl">1.2</span>), <span class="st">&quot;B == round(B) is not TRUE&quot;</span>,</span>
<span id="cb45-12"><a href="helper-functions.html#cb45-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-13"><a href="helper-functions.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="sc">-</span><span class="dv">100</span>), <span class="st">&quot;B &gt; 0 is not TRUE&quot;</span>,</span>
<span id="cb45-14"><a href="helper-functions.html#cb45-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-15"><a href="helper-functions.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="dv">5</span>),</span>
<span id="cb45-16"><a href="helper-functions.html#cb45-16" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Small values of B may lead to poor results.&quot;</span>,</span>
<span id="cb45-17"><a href="helper-functions.html#cb45-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-18"><a href="helper-functions.html#cb45-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='helper-functions.html#checkB'>checkB</a>(<span class="dv">2200</span>),</span>
<span id="cb45-19"><a href="helper-functions.html#cb45-19" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Large values of B may require long computation times.&quot;</span>,</span>
<span id="cb45-20"><a href="helper-functions.html#cb45-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb45-21"><a href="helper-functions.html#cb45-21" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p>checkPropFeatsRemove</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="helper-functions.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument prop_feats_remove to several </span></span>
<span id="cb47-2"><a href="helper-functions.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb47-3"><a href="helper-functions.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb47-4"><a href="helper-functions.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; proportion of features that are dropped on</span></span>
<span id="cb47-5"><a href="helper-functions.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each subsample. Must be between 0 and 1.</span></span>
<span id="cb47-6"><a href="helper-functions.html#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; must be greater than 2 if prop_feats_remove</span></span>
<span id="cb47-7"><a href="helper-functions.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is greater than 0.</span></span>
<span id="cb47-8"><a href="helper-functions.html#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb47-9"><a href="helper-functions.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span id='checkPropFeatsRemove'>checkPropFeatsRemove</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(prop_feats_remove, p){</span>
<span id="cb47-10"><a href="helper-functions.html#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prop_feats_remove) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb47-11"><a href="helper-functions.html#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(prop_feats_remove) <span class="sc">|</span> <span class="fu">is.integer</span>(prop_feats_remove))</span>
<span id="cb47-12"><a href="helper-functions.html#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(prop_feats_remove))</span>
<span id="cb47-13"><a href="helper-functions.html#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(prop_feats_remove <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> prop_feats_remove <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb47-14"><a href="helper-functions.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(prop_feats_remove <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb47-15"><a href="helper-functions.html#cb47-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make sure p is at least 2 or else this doesn&#39;t make sense</span></span>
<span id="cb47-16"><a href="helper-functions.html#cb47-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb47-17"><a href="helper-functions.html#cb47-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-18"><a href="helper-functions.html#cb47-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkPropFeatsRemove</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="helper-functions.html#cb48-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkPropFeatsRemove works&quot;</span>, {</span>
<span id="cb48-2"><a href="helper-functions.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb48-3"><a href="helper-functions.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(.<span class="dv">3</span>, <span class="dv">10</span>))</span>
<span id="cb48-4"><a href="helper-functions.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb48-5"><a href="helper-functions.html#cb48-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;prop_feats_remove &gt;= 0 &amp; prop_feats_remove &lt; 1 is not TRUE&quot;</span>,</span>
<span id="cb48-6"><a href="helper-functions.html#cb48-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-7"><a href="helper-functions.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">6</span>), <span class="dv">17</span>),</span>
<span id="cb48-8"><a href="helper-functions.html#cb48-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(prop_feats_remove) == 1 is not TRUE&quot;</span>,</span>
<span id="cb48-9"><a href="helper-functions.html#cb48-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-10"><a href="helper-functions.html#cb48-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="st">&quot;.3&quot;</span>, <span class="dv">99</span>),</span>
<span id="cb48-11"><a href="helper-functions.html#cb48-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(prop_feats_remove) | is.integer(prop_feats_remove) is not TRUE&quot;</span>,</span>
<span id="cb48-12"><a href="helper-functions.html#cb48-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-13"><a href="helper-functions.html#cb48-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="dv">172</span>),</span>
<span id="cb48-14"><a href="helper-functions.html#cb48-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(prop_feats_remove) is not TRUE&quot;</span>,</span>
<span id="cb48-15"><a href="helper-functions.html#cb48-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-16"><a href="helper-functions.html#cb48-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(.<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb48-17"><a href="helper-functions.html#cb48-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= 2 is not TRUE&quot;</span>,</span>
<span id="cb48-18"><a href="helper-functions.html#cb48-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb48-19"><a href="helper-functions.html#cb48-19" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p>Finally, tests for checkCssInputs:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="helper-functions.html#cb50-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssInputs works&quot;</span>, {</span>
<span id="cb50-2"><a href="helper-functions.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">80526</span>)</span>
<span id="cb50-3"><a href="helper-functions.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-4"><a href="helper-functions.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span><span class="sc">*</span><span class="dv">11</span>), <span class="at">nrow=</span><span class="dv">15</span>, <span class="at">ncol=</span><span class="dv">11</span>)</span>
<span id="cb50-5"><a href="helper-functions.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span>)</span>
<span id="cb50-6"><a href="helper-functions.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-7"><a href="helper-functions.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb50-8"><a href="helper-functions.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb50-9"><a href="helper-functions.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb50-10"><a href="helper-functions.html#cb50-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">green_cluster=</span>6L<span class="sc">:</span>8L</span>
<span id="cb50-11"><a href="helper-functions.html#cb50-11" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># , c4=10:11</span></span>
<span id="cb50-12"><a href="helper-functions.html#cb50-12" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb50-13"><a href="helper-functions.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-14"><a href="helper-functions.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb50-15"><a href="helper-functions.html#cb50-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fitfun =</span> cssLasso, <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb50-16"><a href="helper-functions.html#cb50-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>, <span class="at">train_inds =</span> <span class="fu">integer</span>(),</span>
<span id="cb50-17"><a href="helper-functions.html#cb50-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">num_cores =</span> 1L)</span>
<span id="cb50-18"><a href="helper-functions.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-19"><a href="helper-functions.html#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Basic output</span></span>
<span id="cb50-20"><a href="helper-functions.html#cb50-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb50-21"><a href="helper-functions.html#cb50-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;clusters&quot;</span>))</span>
<span id="cb50-22"><a href="helper-functions.html#cb50-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-23"><a href="helper-functions.html#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># feat_names</span></span>
<span id="cb50-24"><a href="helper-functions.html#cb50-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb50-25"><a href="helper-functions.html#cb50-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb50-26"><a href="helper-functions.html#cb50-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>feat_names), <span class="dv">1</span>)</span>
<span id="cb50-27"><a href="helper-functions.html#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="helper-functions.html#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X</span></span>
<span id="cb50-29"><a href="helper-functions.html#cb50-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>X))</span>
<span id="cb50-30"><a href="helper-functions.html#cb50-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>X)))</span>
<span id="cb50-31"><a href="helper-functions.html#cb50-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>X))</span>
<span id="cb50-32"><a href="helper-functions.html#cb50-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>X), <span class="dv">11</span>)</span>
<span id="cb50-33"><a href="helper-functions.html#cb50-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>X), <span class="dv">15</span>)</span>
<span id="cb50-34"><a href="helper-functions.html#cb50-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-35"><a href="helper-functions.html#cb50-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb50-36"><a href="helper-functions.html#cb50-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb50-37"><a href="helper-functions.html#cb50-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters), <span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters)))</span>
<span id="cb50-38"><a href="helper-functions.html#cb50-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters),</span>
<span id="cb50-39"><a href="helper-functions.html#cb50-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb50-40"><a href="helper-functions.html#cb50-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb50-41"><a href="helper-functions.html#cb50-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb50-42"><a href="helper-functions.html#cb50-42" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb50-43"><a href="helper-functions.html#cb50-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>clusters)){</span>
<span id="cb50-44"><a href="helper-functions.html#cb50-44" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])</span>
<span id="cb50-45"><a href="helper-functions.html#cb50-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-46"><a href="helper-functions.html#cb50-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb50-47"><a href="helper-functions.html#cb50-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb50-48"><a href="helper-functions.html#cb50-48" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)))</span>
<span id="cb50-49"><a href="helper-functions.html#cb50-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-50"><a href="helper-functions.html#cb50-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb50-51"><a href="helper-functions.html#cb50-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-52"><a href="helper-functions.html#cb50-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom fitfun with nonsense lambda (which will be ignored by fitfun, and</span></span>
<span id="cb50-53"><a href="helper-functions.html#cb50-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># shouldn&#39;t throw any error, because the acceptable input for lambda should be</span></span>
<span id="cb50-54"><a href="helper-functions.html#cb50-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># enforced only by fitfun)</span></span>
<span id="cb50-55"><a href="helper-functions.html#cb50-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-56"><a href="helper-functions.html#cb50-56" aria-hidden="true" tabindex="-1"></a>  <span id='testFitfun'>testFitfun</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb50-57"><a href="helper-functions.html#cb50-57" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb50-58"><a href="helper-functions.html#cb50-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb50-59"><a href="helper-functions.html#cb50-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose p/2 features randomly</span></span>
<span id="cb50-60"><a href="helper-functions.html#cb50-60" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(p, <span class="at">size=</span><span class="fu">floor</span>(p<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb50-61"><a href="helper-functions.html#cb50-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb50-62"><a href="helper-functions.html#cb50-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-63"><a href="helper-functions.html#cb50-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-64"><a href="helper-functions.html#cb50-64" aria-hidden="true" tabindex="-1"></a>  res_fitfun <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span>x, <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb50-65"><a href="helper-functions.html#cb50-65" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fitfun =</span> testFitfun, <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>,</span>
<span id="cb50-66"><a href="helper-functions.html#cb50-66" aria-hidden="true" tabindex="-1"></a>                               <span class="at">B =</span> <span class="dv">13</span>, <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-67"><a href="helper-functions.html#cb50-67" aria-hidden="true" tabindex="-1"></a>                               <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L)</span>
<span id="cb50-68"><a href="helper-functions.html#cb50-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_fitfun))</span>
<span id="cb50-69"><a href="helper-functions.html#cb50-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-70"><a href="helper-functions.html#cb50-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb50-71"><a href="helper-functions.html#cb50-71" aria-hidden="true" tabindex="-1"></a>  res_sing_clust <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb50-72"><a href="helper-functions.html#cb50-72" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb50-73"><a href="helper-functions.html#cb50-73" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-74"><a href="helper-functions.html#cb50-74" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb50-75"><a href="helper-functions.html#cb50-75" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-76"><a href="helper-functions.html#cb50-76" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L)</span>
<span id="cb50-77"><a href="helper-functions.html#cb50-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_sing_clust))</span>
<span id="cb50-78"><a href="helper-functions.html#cb50-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_sing_clust<span class="sc">$</span>clusters), <span class="dv">11</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb50-79"><a href="helper-functions.html#cb50-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))) <span class="sc">==</span> <span class="dv">11</span> <span class="sc">-</span></span>
<span id="cb50-80"><a href="helper-functions.html#cb50-80" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb50-81"><a href="helper-functions.html#cb50-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))))</span>
<span id="cb50-82"><a href="helper-functions.html#cb50-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))))</span>
<span id="cb50-83"><a href="helper-functions.html#cb50-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-84"><a href="helper-functions.html#cb50-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other sampling types</span></span>
<span id="cb50-85"><a href="helper-functions.html#cb50-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>,</span>
<span id="cb50-86"><a href="helper-functions.html#cb50-86" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb50-87"><a href="helper-functions.html#cb50-87" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;bar&quot;</span>), <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb50-88"><a href="helper-functions.html#cb50-88" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-89"><a href="helper-functions.html#cb50-89" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;MB&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb50-90"><a href="helper-functions.html#cb50-90" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-91"><a href="helper-functions.html#cb50-91" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb50-92"><a href="helper-functions.html#cb50-92" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>,</span>
<span id="cb50-93"><a href="helper-functions.html#cb50-93" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb50-94"><a href="helper-functions.html#cb50-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-95"><a href="helper-functions.html#cb50-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb50-96"><a href="helper-functions.html#cb50-96" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>,</span>
<span id="cb50-97"><a href="helper-functions.html#cb50-97" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb50-98"><a href="helper-functions.html#cb50-98" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;bar&quot;</span>), <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb50-99"><a href="helper-functions.html#cb50-99" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-100"><a href="helper-functions.html#cb50-100" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;S&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb50-101"><a href="helper-functions.html#cb50-101" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-102"><a href="helper-functions.html#cb50-102" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L))</span>
<span id="cb50-103"><a href="helper-functions.html#cb50-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-104"><a href="helper-functions.html#cb50-104" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb50-105"><a href="helper-functions.html#cb50-105" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb50-106"><a href="helper-functions.html#cb50-106" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-107"><a href="helper-functions.html#cb50-107" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb50-108"><a href="helper-functions.html#cb50-108" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-109"><a href="helper-functions.html#cb50-109" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb50-110"><a href="helper-functions.html#cb50-110" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(sampling_type) is not TRUE&quot;</span>,</span>
<span id="cb50-111"><a href="helper-functions.html#cb50-111" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb50-112"><a href="helper-functions.html#cb50-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-113"><a href="helper-functions.html#cb50-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># B</span></span>
<span id="cb50-114"><a href="helper-functions.html#cb50-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb50-115"><a href="helper-functions.html#cb50-115" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb50-116"><a href="helper-functions.html#cb50-116" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-117"><a href="helper-functions.html#cb50-117" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">5</span>,</span>
<span id="cb50-118"><a href="helper-functions.html#cb50-118" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-119"><a href="helper-functions.html#cb50-119" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb50-120"><a href="helper-functions.html#cb50-120" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Small values of B may lead to poor results.&quot;</span>,</span>
<span id="cb50-121"><a href="helper-functions.html#cb50-121" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb50-122"><a href="helper-functions.html#cb50-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-123"><a href="helper-functions.html#cb50-123" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb50-124"><a href="helper-functions.html#cb50-124" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb50-125"><a href="helper-functions.html#cb50-125" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb50-126"><a href="helper-functions.html#cb50-126" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="st">&quot;foo&quot;</span>,</span>
<span id="cb50-127"><a href="helper-functions.html#cb50-127" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb50-128"><a href="helper-functions.html#cb50-128" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb50-129"><a href="helper-functions.html#cb50-129" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;is.numeric(B) | is.integer(B) is not TRUE&quot;</span>,</span>
<span id="cb50-130"><a href="helper-functions.html#cb50-130" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb50-131"><a href="helper-functions.html#cb50-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-132"><a href="helper-functions.html#cb50-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prop_feats_remove</span></span>
<span id="cb50-133"><a href="helper-functions.html#cb50-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb50-134"><a href="helper-functions.html#cb50-134" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb50-135"><a href="helper-functions.html#cb50-135" aria-hidden="true" tabindex="-1"></a>                                                        <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb50-136"><a href="helper-functions.html#cb50-136" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun=</span>testFitfun,</span>
<span id="cb50-137"><a href="helper-functions.html#cb50-137" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">12</span>,</span>
<span id="cb50-138"><a href="helper-functions.html#cb50-138" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">prop_feats_remove =</span> <span class="fl">0.3</span>,</span>
<span id="cb50-139"><a href="helper-functions.html#cb50-139" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">train_inds =</span> <span class="fu">integer</span>(),</span>
<span id="cb50-140"><a href="helper-functions.html#cb50-140" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">num_cores =</span> 1L)))</span>
<span id="cb50-141"><a href="helper-functions.html#cb50-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-142"><a href="helper-functions.html#cb50-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use train_inds argument</span></span>
<span id="cb50-143"><a href="helper-functions.html#cb50-143" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='helper-functions.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb50-144"><a href="helper-functions.html#cb50-144" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb50-145"><a href="helper-functions.html#cb50-145" aria-hidden="true" tabindex="-1"></a>                                                        <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb50-146"><a href="helper-functions.html#cb50-146" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun=</span>testFitfun,</span>
<span id="cb50-147"><a href="helper-functions.html#cb50-147" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">12</span>,</span>
<span id="cb50-148"><a href="helper-functions.html#cb50-148" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">prop_feats_remove =</span> <span class="fl">0.3</span>,</span>
<span id="cb50-149"><a href="helper-functions.html#cb50-149" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">train_inds =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb50-150"><a href="helper-functions.html#cb50-150" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">num_cores =</span> 1L)))</span>
<span id="cb50-151"><a href="helper-functions.html#cb50-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-152"><a href="helper-functions.html#cb50-152" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p>cssLoop:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="helper-functions.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function run on each subsample</span></span>
<span id="cb52-2"><a href="helper-functions.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb52-3"><a href="helper-functions.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Runs provided feature selection method fitfun on each subsample for cluster</span></span>
<span id="cb52-4"><a href="helper-functions.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stability selection (this function is called within mclapply).</span></span>
<span id="cb52-5"><a href="helper-functions.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param input Could be one of two things: \item{subsample}{An integer vector</span></span>
<span id="cb52-6"><a href="helper-functions.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of size `n/2` containing the indices of the observations in the subsample.}</span></span>
<span id="cb52-7"><a href="helper-functions.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{drop_var_input}{A named list containing two elements: one named</span></span>
<span id="cb52-8"><a href="helper-functions.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;subsample&quot; and the same as the previous description, and a logical vector</span></span>
<span id="cb52-9"><a href="helper-functions.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;feats_to_keep&quot; containing the indices of the features to be</span></span>
<span id="cb52-10"><a href="helper-functions.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; automatically selected.} (The first object is the output of the function</span></span>
<span id="cb52-11"><a href="helper-functions.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; createSubsamples when the provided prop_feats_remove is 0, the default, and</span></span>
<span id="cb52-12"><a href="helper-functions.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the second object is the output of createSubsamples when prop_feats_remove &gt;</span></span>
<span id="cb52-13"><a href="helper-functions.html#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0.)</span></span>
<span id="cb52-14"><a href="helper-functions.html#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x an n x p numeric matrix containing the predictors. (This should be</span></span>
<span id="cb52-15"><a href="helper-functions.html#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the full design matrix provided to css.)</span></span>
<span id="cb52-16"><a href="helper-functions.html#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A response; can be any response that takes the form of a length n</span></span>
<span id="cb52-17"><a href="helper-functions.html#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector and is used (or not used) by fitfun. Typically (and for default fitfun</span></span>
<span id="cb52-18"><a href="helper-functions.html#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; = cssLasso), y should be an n-dimensional numeric vector containing the</span></span>
<span id="cb52-19"><a href="helper-functions.html#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response. This should be the full response provided to css.</span></span>
<span id="cb52-20"><a href="helper-functions.html#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb52-21"><a href="helper-functions.html#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method. For example, in the default case when</span></span>
<span id="cb52-22"><a href="helper-functions.html#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fitfun = cssLasso, lambda is a numeric: the penalty to use for each lasso</span></span>
<span id="cb52-23"><a href="helper-functions.html#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fit.</span></span>
<span id="cb52-24"><a href="helper-functions.html#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function that takes in arguments X, y, and lambda and returns</span></span>
<span id="cb52-25"><a href="helper-functions.html#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a vector of indices of the columns of X (selected features).</span></span>
<span id="cb52-26"><a href="helper-functions.html#cb52-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector; the indices of the features selected by fitfun.</span></span>
<span id="cb52-27"><a href="helper-functions.html#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb52-28"><a href="helper-functions.html#cb52-28" aria-hidden="true" tabindex="-1"></a><span id='cssLoop'>cssLoop</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(input, x, y, lambda, fitfun){</span>
<span id="cb52-29"><a href="helper-functions.html#cb52-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb52-30"><a href="helper-functions.html#cb52-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb52-31"><a href="helper-functions.html#cb52-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb52-32"><a href="helper-functions.html#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="helper-functions.html#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb52-34"><a href="helper-functions.html#cb52-34" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb52-35"><a href="helper-functions.html#cb52-35" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb52-36"><a href="helper-functions.html#cb52-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-37"><a href="helper-functions.html#cb52-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb52-38"><a href="helper-functions.html#cb52-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb52-39"><a href="helper-functions.html#cb52-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb52-40"><a href="helper-functions.html#cb52-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb52-41"><a href="helper-functions.html#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="helper-functions.html#cb52-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.list</span>(input)){</span>
<span id="cb52-43"><a href="helper-functions.html#cb52-43" aria-hidden="true" tabindex="-1"></a>        subsample <span class="ot">&lt;-</span> input</span>
<span id="cb52-44"><a href="helper-functions.html#cb52-44" aria-hidden="true" tabindex="-1"></a>        feats_to_keep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">TRUE</span>, p)</span>
<span id="cb52-45"><a href="helper-functions.html#cb52-45" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb52-46"><a href="helper-functions.html#cb52-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">names</span>(input) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;subsample&quot;</span>, <span class="st">&quot;feats_to_keep&quot;</span>)))</span>
<span id="cb52-47"><a href="helper-functions.html#cb52-47" aria-hidden="true" tabindex="-1"></a>        subsample <span class="ot">&lt;-</span> input<span class="sc">$</span>subsample</span>
<span id="cb52-48"><a href="helper-functions.html#cb52-48" aria-hidden="true" tabindex="-1"></a>        feats_to_keep <span class="ot">&lt;-</span> input<span class="sc">$</span>feats_to_keep</span>
<span id="cb52-49"><a href="helper-functions.html#cb52-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-50"><a href="helper-functions.html#cb52-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-51"><a href="helper-functions.html#cb52-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(subsample))</span>
<span id="cb52-52"><a href="helper-functions.html#cb52-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(subsample <span class="sc">==</span> <span class="fu">round</span>(subsample)))</span>
<span id="cb52-53"><a href="helper-functions.html#cb52-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>) <span class="sc">==</span> <span class="fu">length</span>(subsample))</span>
<span id="cb52-54"><a href="helper-functions.html#cb52-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsample) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(subsample)))</span>
<span id="cb52-55"><a href="helper-functions.html#cb52-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-56"><a href="helper-functions.html#cb52-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(feats_to_keep))</span>
<span id="cb52-57"><a href="helper-functions.html#cb52-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(feats_to_keep) <span class="sc">==</span> p)</span>
<span id="cb52-58"><a href="helper-functions.html#cb52-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="helper-functions.html#cb52-59" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">do.call</span>(fitfun, <span class="fu">list</span>(<span class="at">X=</span>x[subsample, feats_to_keep],</span>
<span id="cb52-60"><a href="helper-functions.html#cb52-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>y[subsample], <span class="at">lambda=</span>lambda))</span>
<span id="cb52-61"><a href="helper-functions.html#cb52-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-62"><a href="helper-functions.html#cb52-62" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">which</span>(feats_to_keep)[selected]</span>
<span id="cb52-63"><a href="helper-functions.html#cb52-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-64"><a href="helper-functions.html#cb52-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb52-65"><a href="helper-functions.html#cb52-65" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(selected, p, <span class="fu">as.integer</span>(<span class="fu">which</span>(feats_to_keep)))</span>
<span id="cb52-66"><a href="helper-functions.html#cb52-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-67"><a href="helper-functions.html#cb52-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.integer</span>(selected))</span>
<span id="cb52-68"><a href="helper-functions.html#cb52-68" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkCssLoopOutput:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="helper-functions.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the outputs of the provided feature selection</span></span>
<span id="cb53-2"><a href="helper-functions.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method are as required. </span></span>
<span id="cb53-3"><a href="helper-functions.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb53-4"><a href="helper-functions.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected An integer vector; the indices of the features selected by</span></span>
<span id="cb53-5"><a href="helper-functions.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the lasso.</span></span>
<span id="cb53-6"><a href="helper-functions.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The total number of observed features; all selected features must be</span></span>
<span id="cb53-7"><a href="helper-functions.html#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in 1:p.</span></span>
<span id="cb53-8"><a href="helper-functions.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param feats_on_subsamp Integer; the indices of the features considered by</span></span>
<span id="cb53-9"><a href="helper-functions.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the feature selection method. All selected features must be among these</span></span>
<span id="cb53-10"><a href="helper-functions.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features.</span></span>
<span id="cb53-11"><a href="helper-functions.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb53-12"><a href="helper-functions.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span id='checkCssLoopOutput'>checkCssLoopOutput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(selected, p, feats_on_subsamp){</span>
<span id="cb53-13"><a href="helper-functions.html#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;selected&quot;</span>)){</span>
<span id="cb53-14"><a href="helper-functions.html#cb53-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return anything on (at least) one subsample&quot;</span>)</span>
<span id="cb53-15"><a href="helper-functions.html#cb53-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-16"><a href="helper-functions.html#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.integer</span>(selected) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.numeric</span>(selected)){</span>
<span id="cb53-17"><a href="helper-functions.html#cb53-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return an integer or numeric vector on (at least) one subsample&quot;</span>)</span>
<span id="cb53-18"><a href="helper-functions.html#cb53-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-19"><a href="helper-functions.html#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(selected))){</span>
<span id="cb53-20"><a href="helper-functions.html#cb53-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector containing NA values on (at least) one subsample&quot;</span>)</span>
<span id="cb53-21"><a href="helper-functions.html#cb53-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-22"><a href="helper-functions.html#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(selected <span class="sc">==</span> <span class="fu">round</span>(selected))){</span>
<span id="cb53-23"><a href="helper-functions.html#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return a vector of valid (integer) indices on (at least) one subsample&quot;</span>)</span>
<span id="cb53-24"><a href="helper-functions.html#cb53-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-25"><a href="helper-functions.html#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">!=</span> <span class="fu">length</span>(<span class="fu">unique</span>(selected))){</span>
<span id="cb53-26"><a href="helper-functions.html#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing repeated indices on (at least) one subsample&quot;</span>)</span>
<span id="cb53-27"><a href="helper-functions.html#cb53-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-28"><a href="helper-functions.html#cb53-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">&gt;</span> p){</span>
<span id="cb53-29"><a href="helper-functions.html#cb53-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features longer than p on (at least) one subsample&quot;</span>)</span>
<span id="cb53-30"><a href="helper-functions.html#cb53-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-31"><a href="helper-functions.html#cb53-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb53-32"><a href="helper-functions.html#cb53-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">max</span>(selected) <span class="sc">&gt;</span> p){</span>
<span id="cb53-33"><a href="helper-functions.html#cb53-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing an index greater than ncol(X) on (at least) one subsample&quot;</span>)</span>
<span id="cb53-34"><a href="helper-functions.html#cb53-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb53-35"><a href="helper-functions.html#cb53-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">min</span>(selected) <span class="sc">&lt;=</span> <span class="dv">0</span>){</span>
<span id="cb53-36"><a href="helper-functions.html#cb53-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>)</span>
<span id="cb53-37"><a href="helper-functions.html#cb53-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb53-38"><a href="helper-functions.html#cb53-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-39"><a href="helper-functions.html#cb53-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span></span>
<span id="cb53-40"><a href="helper-functions.html#cb53-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span> <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span></span>
<span id="cb53-41"><a href="helper-functions.html#cb53-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected)){</span>
<span id="cb53-42"><a href="helper-functions.html#cb53-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned an error on (at least) one subsample&quot;</span>)</span>
<span id="cb53-43"><a href="helper-functions.html#cb53-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-44"><a href="helper-functions.html#cb53-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(selected <span class="sc">%in%</span> feats_on_subsamp)){</span>
<span id="cb53-45"><a href="helper-functions.html#cb53-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method somehow selected features that were not provided for it to consider.&quot;</span>)</span>
<span id="cb53-46"><a href="helper-functions.html#cb53-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb53-47"><a href="helper-functions.html#cb53-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkCssLoopOutput:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="helper-functions.html#cb54-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssLoopOutput works&quot;</span>, {</span>
<span id="cb54-2"><a href="helper-functions.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">6</span>,</span>
<span id="cb54-3"><a href="helper-functions.html#cb54-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb54-4"><a href="helper-functions.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-5"><a href="helper-functions.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">4</span>,</span>
<span id="cb54-6"><a href="helper-functions.html#cb54-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb54-7"><a href="helper-functions.html#cb54-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features longer than p on (at least) one subsample&quot;</span>,</span>
<span id="cb54-8"><a href="helper-functions.html#cb54-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-9"><a href="helper-functions.html#cb54-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-10"><a href="helper-functions.html#cb54-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-11"><a href="helper-functions.html#cb54-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb54-12"><a href="helper-functions.html#cb54-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method somehow selected features that were not provided for it to consider.&quot;</span>,</span>
<span id="cb54-13"><a href="helper-functions.html#cb54-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-14"><a href="helper-functions.html#cb54-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-15"><a href="helper-functions.html#cb54-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="fl">4.4</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-16"><a href="helper-functions.html#cb54-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-17"><a href="helper-functions.html#cb54-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun failed to return a vector of valid (integer) indices on (at least) one subsample&quot;</span>,</span>
<span id="cb54-18"><a href="helper-functions.html#cb54-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-19"><a href="helper-functions.html#cb54-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-20"><a href="helper-functions.html#cb54-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-21"><a href="helper-functions.html#cb54-21" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-22"><a href="helper-functions.html#cb54-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing repeated indices on (at least) one subsample&quot;</span>,</span>
<span id="cb54-23"><a href="helper-functions.html#cb54-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-24"><a href="helper-functions.html#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="helper-functions.html#cb54-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-26"><a href="helper-functions.html#cb54-26" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-27"><a href="helper-functions.html#cb54-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>,</span>
<span id="cb54-28"><a href="helper-functions.html#cb54-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-29"><a href="helper-functions.html#cb54-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-30"><a href="helper-functions.html#cb54-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-31"><a href="helper-functions.html#cb54-31" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-32"><a href="helper-functions.html#cb54-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>,</span>
<span id="cb54-33"><a href="helper-functions.html#cb54-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-34"><a href="helper-functions.html#cb54-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-35"><a href="helper-functions.html#cb54-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-36"><a href="helper-functions.html#cb54-36" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-37"><a href="helper-functions.html#cb54-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector containing NA values on (at least) one subsample&quot;</span>,</span>
<span id="cb54-38"><a href="helper-functions.html#cb54-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-39"><a href="helper-functions.html#cb54-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-40"><a href="helper-functions.html#cb54-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb54-41"><a href="helper-functions.html#cb54-41" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb54-42"><a href="helper-functions.html#cb54-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun failed to return an integer or numeric vector on (at least) one subsample&quot;</span>,</span>
<span id="cb54-43"><a href="helper-functions.html#cb54-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-44"><a href="helper-functions.html#cb54-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-45"><a href="helper-functions.html#cb54-45" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🌈</code></pre>
<p>checkCssLassoInputs:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="helper-functions.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the inputs to cssLasso are as expected. </span></span>
<span id="cb56-2"><a href="helper-functions.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb56-3"><a href="helper-functions.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X A design matrix containing the predictors. (Note that we don&#39;t need</span></span>
<span id="cb56-4"><a href="helper-functions.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to check X very much, because X will have already been checked by the</span></span>
<span id="cb56-5"><a href="helper-functions.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function checkCssInputs when it was provided to css.)</span></span>
<span id="cb56-6"><a href="helper-functions.html#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric vector containing the response.</span></span>
<span id="cb56-7"><a href="helper-functions.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda Numeric; a nonnegative number for the lasso penalty to use</span></span>
<span id="cb56-8"><a href="helper-functions.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on each subsample. (For now, only one lambda value can be provided to</span></span>
<span id="cb56-9"><a href="helper-functions.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cssLasso; in the future, we plan to allow for multiple lambda values to be</span></span>
<span id="cb56-10"><a href="helper-functions.html#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to cssLasso, as described in Faletto and Bien 2022.)</span></span>
<span id="cb56-11"><a href="helper-functions.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb56-12"><a href="helper-functions.html#cb56-12" aria-hidden="true" tabindex="-1"></a><span id='checkCssLassoInputs'>checkCssLassoInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb56-13"><a href="helper-functions.html#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="helper-functions.html#cb56-14" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb56-15"><a href="helper-functions.html#cb56-15" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb56-16"><a href="helper-functions.html#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="helper-functions.html#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y)){</span>
<span id="cb56-18"><a href="helper-functions.html#cb56-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>)</span>
<span id="cb56-19"><a href="helper-functions.html#cb56-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-20"><a href="helper-functions.html#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.matrix</span>(y)){</span>
<span id="cb56-21"><a href="helper-functions.html#cb56-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a numeric vector (inputted y was a matrix).&quot;</span>)</span>
<span id="cb56-22"><a href="helper-functions.html#cb56-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-23"><a href="helper-functions.html#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n <span class="sc">!=</span> <span class="fu">length</span>(y)){</span>
<span id="cb56-24"><a href="helper-functions.html#cb56-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a vector of length equal to nrow(X).&quot;</span>)</span>
<span id="cb56-25"><a href="helper-functions.html#cb56-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-26"><a href="helper-functions.html#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb56-27"><a href="helper-functions.html#cb56-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Subsample with only one unique value of y detected--for method cssLasso, all subsamples of y of size floor(n/2) must have more than one unique value.&quot;</span>)</span>
<span id="cb56-28"><a href="helper-functions.html#cb56-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-29"><a href="helper-functions.html#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(lambda) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(lambda)){</span>
<span id="cb56-30"><a href="helper-functions.html#cb56-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be a numeric.&quot;</span>)</span>
<span id="cb56-31"><a href="helper-functions.html#cb56-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-32"><a href="helper-functions.html#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(lambda))){</span>
<span id="cb56-33"><a href="helper-functions.html#cb56-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;NA detected in provided lambda input to cssLasso&quot;</span>)</span>
<span id="cb56-34"><a href="helper-functions.html#cb56-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-35"><a href="helper-functions.html#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(lambda) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb56-36"><a href="helper-functions.html#cb56-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>)</span>
<span id="cb56-37"><a href="helper-functions.html#cb56-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-38"><a href="helper-functions.html#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(lambda <span class="sc">&lt;</span> <span class="dv">0</span>){</span>
<span id="cb56-39"><a href="helper-functions.html#cb56-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>)</span>
<span id="cb56-40"><a href="helper-functions.html#cb56-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-41"><a href="helper-functions.html#cb56-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkCssLassoInputs</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="helper-functions.html#cb57-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssLassoInputs works&quot;</span>, {</span>
<span id="cb57-2"><a href="helper-functions.html#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">761</span>)</span>
<span id="cb57-3"><a href="helper-functions.html#cb57-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-4"><a href="helper-functions.html#cb57-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span><span class="sc">*</span><span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">15</span>, <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb57-5"><a href="helper-functions.html#cb57-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span>)</span>
<span id="cb57-6"><a href="helper-functions.html#cb57-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-7"><a href="helper-functions.html#cb57-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>))</span>
<span id="cb57-8"><a href="helper-functions.html#cb57-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-9"><a href="helper-functions.html#cb57-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="fu">logical</span>(<span class="dv">15</span>), <span class="at">lambda=</span><span class="fl">0.05</span>),</span>
<span id="cb57-10"><a href="helper-functions.html#cb57-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>,</span>
<span id="cb57-11"><a href="helper-functions.html#cb57-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-12"><a href="helper-functions.html#cb57-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-13"><a href="helper-functions.html#cb57-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, ], <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>),</span>
<span id="cb57-14"><a href="helper-functions.html#cb57-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a vector of length equal to nrow(X).&quot;</span>,</span>
<span id="cb57-15"><a href="helper-functions.html#cb57-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-16"><a href="helper-functions.html#cb57-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-17"><a href="helper-functions.html#cb57-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">15</span>), <span class="at">lambda=</span><span class="fl">0.05</span>),</span>
<span id="cb57-18"><a href="helper-functions.html#cb57-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Subsample with only one unique value of y detected--for method cssLasso, all subsamples of y of size floor(n/2) must have more than one unique value.&quot;</span>,</span>
<span id="cb57-19"><a href="helper-functions.html#cb57-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-20"><a href="helper-functions.html#cb57-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-21"><a href="helper-functions.html#cb57-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="cn">TRUE</span>),</span>
<span id="cb57-22"><a href="helper-functions.html#cb57-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric.&quot;</span>,</span>
<span id="cb57-23"><a href="helper-functions.html#cb57-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-24"><a href="helper-functions.html#cb57-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-25"><a href="helper-functions.html#cb57-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)),</span>
<span id="cb57-26"><a href="helper-functions.html#cb57-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;NA detected in provided lambda input to cssLasso&quot;</span>,</span>
<span id="cb57-27"><a href="helper-functions.html#cb57-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-28"><a href="helper-functions.html#cb57-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-29"><a href="helper-functions.html#cb57-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="sc">-</span><span class="fl">0.01</span>),</span>
<span id="cb57-30"><a href="helper-functions.html#cb57-30" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>,</span>
<span id="cb57-31"><a href="helper-functions.html#cb57-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-32"><a href="helper-functions.html#cb57-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-33"><a href="helper-functions.html#cb57-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span>x),</span>
<span id="cb57-34"><a href="helper-functions.html#cb57-34" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb57-35"><a href="helper-functions.html#cb57-35" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-36"><a href="helper-functions.html#cb57-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-37"><a href="helper-functions.html#cb57-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">numeric</span>()),</span>
<span id="cb57-38"><a href="helper-functions.html#cb57-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb57-39"><a href="helper-functions.html#cb57-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-40"><a href="helper-functions.html#cb57-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-41"><a href="helper-functions.html#cb57-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="sc">-</span><span class="fl">0.01</span>),</span>
<span id="cb57-42"><a href="helper-functions.html#cb57-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>,</span>
<span id="cb57-43"><a href="helper-functions.html#cb57-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-44"><a href="helper-functions.html#cb57-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-45"><a href="helper-functions.html#cb57-45" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🌈</code></pre>
<p>Tests for cssLoop (had to define checkCssLassoInputs first):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="helper-functions.html#cb59-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;cssLoop works&quot;</span>, {</span>
<span id="cb59-2"><a href="helper-functions.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">89134</span>)</span>
<span id="cb59-3"><a href="helper-functions.html#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="helper-functions.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">9</span><span class="sc">*</span><span class="dv">8</span>), <span class="at">nrow=</span><span class="dv">9</span>, <span class="at">ncol=</span><span class="dv">8</span>)</span>
<span id="cb59-5"><a href="helper-functions.html#cb59-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">9</span>)</span>
<span id="cb59-6"><a href="helper-functions.html#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="helper-functions.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.05</span>,</span>
<span id="cb59-8"><a href="helper-functions.html#cb59-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fitfun=</span>cssLasso)</span>
<span id="cb59-9"><a href="helper-functions.html#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="helper-functions.html#cb59-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(output))</span>
<span id="cb59-11"><a href="helper-functions.html#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="helper-functions.html#cb59-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(output), <span class="fu">length</span>(<span class="fu">unique</span>(output)))</span>
<span id="cb59-13"><a href="helper-functions.html#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="helper-functions.html#cb59-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(output) <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb59-15"><a href="helper-functions.html#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="helper-functions.html#cb59-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb59-17"><a href="helper-functions.html#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="helper-functions.html#cb59-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output <span class="sc">&lt;=</span> <span class="dv">8</span>))</span>
<span id="cb59-19"><a href="helper-functions.html#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="helper-functions.html#cb59-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>6L, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.05</span>,</span>
<span id="cb59-21"><a href="helper-functions.html#cb59-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb59-22"><a href="helper-functions.html#cb59-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;floor(n/2) == length(subsample) is not TRUE&quot;</span>,</span>
<span id="cb59-23"><a href="helper-functions.html#cb59-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-24"><a href="helper-functions.html#cb59-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-25"><a href="helper-functions.html#cb59-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb59-26"><a href="helper-functions.html#cb59-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span><span class="fl">0.05</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb59-27"><a href="helper-functions.html#cb59-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(y) == n is not TRUE&quot;</span>,</span>
<span id="cb59-28"><a href="helper-functions.html#cb59-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-29"><a href="helper-functions.html#cb59-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-30"><a href="helper-functions.html#cb59-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span><span class="fu">logical</span>(<span class="dv">9</span>),</span>
<span id="cb59-31"><a href="helper-functions.html#cb59-31" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span><span class="fl">0.05</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb59-32"><a href="helper-functions.html#cb59-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>,</span>
<span id="cb59-33"><a href="helper-functions.html#cb59-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-34"><a href="helper-functions.html#cb59-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-35"><a href="helper-functions.html#cb59-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb59-36"><a href="helper-functions.html#cb59-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span>x, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb59-37"><a href="helper-functions.html#cb59-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb59-38"><a href="helper-functions.html#cb59-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-39"><a href="helper-functions.html#cb59-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-40"><a href="helper-functions.html#cb59-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test other input format</span></span>
<span id="cb59-41"><a href="helper-functions.html#cb59-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-42"><a href="helper-functions.html#cb59-42" aria-hidden="true" tabindex="-1"></a>  alt_input <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;subsample&quot;</span><span class="ot">=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;feats_to_keep&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="dv">4</span>),</span>
<span id="cb59-43"><a href="helper-functions.html#cb59-43" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">2</span>), <span class="cn">TRUE</span>))</span>
<span id="cb59-44"><a href="helper-functions.html#cb59-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-45"><a href="helper-functions.html#cb59-45" aria-hidden="true" tabindex="-1"></a>  output2 <span class="ot">&lt;-</span> <a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>alt_input, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.08</span>, <span class="at">fitfun=</span>cssLasso)</span>
<span id="cb59-46"><a href="helper-functions.html#cb59-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-47"><a href="helper-functions.html#cb59-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(output2))</span>
<span id="cb59-48"><a href="helper-functions.html#cb59-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-49"><a href="helper-functions.html#cb59-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(output2), <span class="fu">length</span>(<span class="fu">unique</span>(output2)))</span>
<span id="cb59-50"><a href="helper-functions.html#cb59-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-51"><a href="helper-functions.html#cb59-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(output2) <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb59-52"><a href="helper-functions.html#cb59-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-53"><a href="helper-functions.html#cb59-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>)))</span>
<span id="cb59-54"><a href="helper-functions.html#cb59-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-55"><a href="helper-functions.html#cb59-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span> <span class="fu">list</span>(<span class="st">&quot;subsample&quot;</span><span class="ot">=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb59-56"><a href="helper-functions.html#cb59-56" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;feats_to_keep&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="cn">FALSE</span>,</span>
<span id="cb59-57"><a href="helper-functions.html#cb59-57" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="dv">4</span>),</span>
<span id="cb59-58"><a href="helper-functions.html#cb59-58" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">2</span>))),</span>
<span id="cb59-59"><a href="helper-functions.html#cb59-59" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.08</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb59-60"><a href="helper-functions.html#cb59-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(feats_to_keep) == p is not TRUE&quot;</span>,</span>
<span id="cb59-61"><a href="helper-functions.html#cb59-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb59-62"><a href="helper-functions.html#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="helper-functions.html#cb59-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom fitfun with nonsense lambda (which will be ignored by fitfun, and</span></span>
<span id="cb59-64"><a href="helper-functions.html#cb59-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># shouldn&#39;t throw any error, because the acceptable input for lambda should be</span></span>
<span id="cb59-65"><a href="helper-functions.html#cb59-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># enforced only by fitfun) and nonsense y</span></span>
<span id="cb59-66"><a href="helper-functions.html#cb59-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-67"><a href="helper-functions.html#cb59-67" aria-hidden="true" tabindex="-1"></a>  <span id='testFitfun'>testFitfun</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb59-68"><a href="helper-functions.html#cb59-68" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb59-69"><a href="helper-functions.html#cb59-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb59-70"><a href="helper-functions.html#cb59-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose p/2 features randomly</span></span>
<span id="cb59-71"><a href="helper-functions.html#cb59-71" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(p, <span class="at">size=</span><span class="fu">floor</span>(p<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb59-72"><a href="helper-functions.html#cb59-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb59-73"><a href="helper-functions.html#cb59-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-74"><a href="helper-functions.html#cb59-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-75"><a href="helper-functions.html#cb59-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb59-76"><a href="helper-functions.html#cb59-76" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">lambda=</span><span class="cn">TRUE</span>, <span class="at">fitfun=</span>testFitfun)))</span>
<span id="cb59-77"><a href="helper-functions.html#cb59-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-78"><a href="helper-functions.html#cb59-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(<a href='helper-functions.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x,</span>
<span id="cb59-79"><a href="helper-functions.html#cb59-79" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">y=</span><span class="fu">character</span>(<span class="dv">9</span>), <span class="at">lambda=</span>.<span class="dv">05</span>,</span>
<span id="cb59-80"><a href="helper-functions.html#cb59-80" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">fitfun=</span>testFitfun)))</span>
<span id="cb59-81"><a href="helper-functions.html#cb59-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-82"><a href="helper-functions.html#cb59-82" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>checkGetClusterSelMatrixInput:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="helper-functions.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to check inputs to getClusterSelMatrix function</span></span>
<span id="cb61-2"><a href="helper-functions.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb61-3"><a href="helper-functions.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb61-4"><a href="helper-functions.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of formatClusters.</span></span>
<span id="cb61-5"><a href="helper-functions.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb61-6"><a href="helper-functions.html#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb61-7"><a href="helper-functions.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb61-8"><a href="helper-functions.html#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).</span></span>
<span id="cb61-9"><a href="helper-functions.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param res A binary integer matrix. res[i, j] = 1 if feature j was selected</span></span>
<span id="cb61-10"><a href="helper-functions.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on subsample i and equals 0 otherwise, as in the output of getSelMatrix.</span></span>
<span id="cb61-11"><a href="helper-functions.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (That is, each row is a selected set.)</span></span>
<span id="cb61-12"><a href="helper-functions.html#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The parameter B, corresponding to half of the subsamples for </span></span>
<span id="cb61-13"><a href="helper-functions.html#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type &quot;SS&quot;.</span></span>
<span id="cb61-14"><a href="helper-functions.html#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb61-15"><a href="helper-functions.html#cb61-15" aria-hidden="true" tabindex="-1"></a><span id='checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, res){</span>
<span id="cb61-16"><a href="helper-functions.html#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb61-17"><a href="helper-functions.html#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb61-18"><a href="helper-functions.html#cb61-18" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(res)</span>
<span id="cb61-19"><a href="helper-functions.html#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb61-20"><a href="helper-functions.html#cb61-20" aria-hidden="true" tabindex="-1"></a>    <a href='helper-functions.html#checkClusters'>checkClusters</a>(clusters, p)</span>
<span id="cb61-21"><a href="helper-functions.html#cb61-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkGetClusterSelMatrixInput</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="helper-functions.html#cb62-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGetClusterSelMatrixInput works&quot;</span>, {</span>
<span id="cb62-2"><a href="helper-functions.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-3"><a href="helper-functions.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">happy=</span>1L<span class="sc">:</span>8L, <span class="at">sad=</span>9L<span class="sc">:</span>10L, <span class="at">med=</span>11L)</span>
<span id="cb62-4"><a href="helper-functions.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-5"><a href="helper-functions.html#cb62-5" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">size=</span><span class="dv">6</span><span class="sc">*</span><span class="dv">11</span>, <span class="at">replace=</span><span class="cn">TRUE</span>), <span class="at">nrow=</span><span class="dv">6</span>, <span class="at">ncol=</span><span class="dv">11</span>)</span>
<span id="cb62-6"><a href="helper-functions.html#cb62-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-7"><a href="helper-functions.html#cb62-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, res))</span>
<span id="cb62-8"><a href="helper-functions.html#cb62-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-9"><a href="helper-functions.html#cb62-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">happy=</span>1L<span class="sc">:</span>8L,</span>
<span id="cb62-10"><a href="helper-functions.html#cb62-10" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">med=</span>11L), res),</span>
<span id="cb62-11"><a href="helper-functions.html#cb62-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb62-12"><a href="helper-functions.html#cb62-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-13"><a href="helper-functions.html#cb62-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-14"><a href="helper-functions.html#cb62-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb62-15"><a href="helper-functions.html#cb62-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.matrix(res) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-16"><a href="helper-functions.html#cb62-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-17"><a href="helper-functions.html#cb62-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, res <span class="sc">+</span> .<span class="dv">3</span>),</span>
<span id="cb62-18"><a href="helper-functions.html#cb62-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(res %in% c(0, 1)) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-19"><a href="helper-functions.html#cb62-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-20"><a href="helper-functions.html#cb62-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters,</span>
<span id="cb62-21"><a href="helper-functions.html#cb62-21" aria-hidden="true" tabindex="-1"></a>                                                       res[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]),</span>
<span id="cb62-22"><a href="helper-functions.html#cb62-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb62-23"><a href="helper-functions.html#cb62-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-24"><a href="helper-functions.html#cb62-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-25"><a href="helper-functions.html#cb62-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(1L<span class="sc">:</span>10L, res),</span>
<span id="cb62-26"><a href="helper-functions.html#cb62-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(clusters) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-27"><a href="helper-functions.html#cb62-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-28"><a href="helper-functions.html#cb62-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb62-29"><a href="helper-functions.html#cb62-29" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L,</span>
<span id="cb62-30"><a href="helper-functions.html#cb62-30" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c3=</span>9L,</span>
<span id="cb62-31"><a href="helper-functions.html#cb62-31" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c4=</span><span class="fu">integer</span>()), res),</span>
<span id="cb62-32"><a href="helper-functions.html#cb62-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(clusters) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb62-33"><a href="helper-functions.html#cb62-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-34"><a href="helper-functions.html#cb62-34" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb62-35"><a href="helper-functions.html#cb62-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb62-36"><a href="helper-functions.html#cb62-36" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb62-37"><a href="helper-functions.html#cb62-37" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>)), res),</span>
<span id="cb62-38"><a href="helper-functions.html#cb62-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb62-39"><a href="helper-functions.html#cb62-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-40"><a href="helper-functions.html#cb62-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-41"><a href="helper-functions.html#cb62-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb62-42"><a href="helper-functions.html#cb62-42" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb62-43"><a href="helper-functions.html#cb62-43" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L), res),</span>
<span id="cb62-44"><a href="helper-functions.html#cb62-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb62-45"><a href="helper-functions.html#cb62-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-46"><a href="helper-functions.html#cb62-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-47"><a href="helper-functions.html#cb62-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='helper-functions.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb62-48"><a href="helper-functions.html#cb62-48" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>14L), res),</span>
<span id="cb62-49"><a href="helper-functions.html#cb62-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb62-50"><a href="helper-functions.html#cb62-50" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-51"><a href="helper-functions.html#cb62-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-52"><a href="helper-functions.html#cb62-52" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="css.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
