<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 The core function: css | Creating the cssr R package</title>
  <meta name="description" content="3 The core function: css | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="3 The core function: css | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 The core function: css | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-02-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="overview.html"/>
<link rel="next" href="tests-for-main-functions-in-cssr.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="css.html"><a href="css.html#main-components-of-css"><i class="fa fa-check"></i><b>3.1</b> Main components of <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="css.html"><a href="css.html#generating-subsamples"><i class="fa fa-check"></i><b>3.1.1</b> Generating subsamples</a></li>
<li class="chapter" data-level="3.1.2" data-path="css.html"><a href="css.html#forming-selection-matrices"><i class="fa fa-check"></i><b>3.1.2</b> Forming selection matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="css.html"><a href="css.html#helper-functions"><i class="fa fa-check"></i><b>3.2</b> Helper functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tests-for-main-functions-in-cssr.html"><a href="tests-for-main-functions-in-cssr.html"><i class="fa fa-check"></i><b>4</b> Tests for main functions in <code>cssr</code></a></li>
<li class="chapter" data-level="5" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>5</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="6" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>6</b> Other useful functions</a></li>
<li class="chapter" data-level="7" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>7</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="8" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>8</b> Competitor Methods</a></li>
<li class="chapter" data-level="9" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><i class="fa fa-check"></i><b>9</b> Documenting the package and adding README and pkgdown website</a>
<ul>
<li class="chapter" data-level="9.1" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-readme"><i class="fa fa-check"></i><b>9.1</b> Add README</a></li>
<li class="chapter" data-level="9.2" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-pkdgown-site"><i class="fa fa-check"></i><b>9.2</b> Add pkdgown site</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="css" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> The core function: <code>css</code><a href="css.html#css" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The main inputs that <code><a href='css.html#css'>css</a>()</code> accepts are the following:</p>
<ul>
<li>a design matrix <code>X</code></li>
<li>a response <code>y</code></li>
<li>a selection method <code>fitfun</code> with specified tuning parameter <code>lambda</code>. This specifies <span class="math inline">\(\hat{S}^\lambda(A)\)</span>. In particular:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="css.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do"><span id='param-fitfun'>###&quot;param-fitfun&quot;###</span></span></span>
<span id="cb5-2"><a href="css.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function; the feature selection function used on each</span></span>
<span id="cb5-3"><a href="css.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample by cluster stability selection. This can be any feature selection</span></span>
<span id="cb5-4"><a href="css.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method; the only requirement is that it accepts the arguments (and only the</span></span>
<span id="cb5-5"><a href="css.html#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arguments) `X`, `y`, and `lambda` and returns an integer vector that is a </span></span>
<span id="cb5-6"><a href="css.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subset of `1:p`. For example, `fitfun` could be best subset selection or </span></span>
<span id="cb5-7"><a href="css.html#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; forward stepwise selection or LARS and `lambda` could be the desired model </span></span>
<span id="cb5-8"><a href="css.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; size; or `fitfun` could be the elastic net and `lambda` could be a length-two</span></span>
<span id="cb5-9"><a href="css.html#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector specifying lambda and alpha. Default is `cssLasso`, an implementation </span></span>
<span id="cb5-10"><a href="css.html#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of lasso (relying on the R package `glmnet`), where `lambda` must be a </span></span>
<span id="cb5-11"><a href="css.html#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; positive numeric specifying the L1 penalty for the `lasso`.</span></span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="css.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do"><span id='param-lambda'>###&quot;param-lambda&quot;###</span></span></span>
<span id="cb6-2"><a href="css.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb6-3"><a href="css.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method `fitfun`. In the default case when</span></span>
<span id="cb6-4"><a href="css.html#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `fitfun = cssLasso`, lambda should be a numeric: the penalty to use for each</span></span>
<span id="cb6-5"><a href="css.html#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lasso fit. (`<a href='css.html#css'>css</a>()` does not require lambda to be any particular object because</span></span>
<span id="cb6-6"><a href="css.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for a user-specified feature selection method `fitfun`, lambda can be an</span></span>
<span id="cb6-7"><a href="css.html#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arbitrary object. See the description of `fitfun` below.)</span></span></code></pre></div>
<ul>
<li>a specification of which features belong together in highly correlated clusters. This specifies the clusters <span class="math inline">\(C_1,\ldots, C_K\)</span>. In particular:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="css.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do"><span id='param-clusters'>###&quot;param-clusters&quot;###</span></span></span>
<span id="cb7-2"><a href="css.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list of integer vectors; each vector should contain the </span></span>
<span id="cb7-3"><a href="css.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of a cluster of features (a subset of `1:p`). (If there is only one</span></span>
<span id="cb7-4"><a href="css.html#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster, clusters can either be a list of length 1 or an integer vector.)</span></span>
<span id="cb7-5"><a href="css.html#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; All of the provided clusters must be non-overlapping. Every feature not</span></span>
<span id="cb7-6"><a href="css.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; appearing in any cluster will be assumed to be unclustered (that is, they</span></span>
<span id="cb7-7"><a href="css.html#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be treated as if they are in a &quot;cluster&quot; containing only themselves). If</span></span>
<span id="cb7-8"><a href="css.html#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters is a list of length 0 (or a list only containing clusters of length</span></span>
<span id="cb7-9"><a href="css.html#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1), then `<a href='css.html#css'>css</a>()` returns the same results as stability selection (so the</span></span>
<span id="cb7-10"><a href="css.html#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned `feat_sel_mat` will be identical to `clus_sel_mat`). Names for the</span></span>
<span id="cb7-11"><a href="css.html#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters will be needed later; any clusters that are not given names in the</span></span>
<span id="cb7-12"><a href="css.html#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided list will be given names automatically by `<a href='css.html#css'>css</a>()`. #&#39; </span><span class="al">CAUTION</span><span class="co">: if</span></span>
<span id="cb7-13"><a href="css.html#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the provided X is a data.frame that contains a categorical feature with more</span></span>
<span id="cb7-14"><a href="css.html#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than two levels, then the resulting matrix made from model.matrix will have a</span></span>
<span id="cb7-15"><a href="css.html#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different number of columns than the provided data.frame, some of the feature</span></span>
<span id="cb7-16"><a href="css.html#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numbers will change, and the clusters argument will not work properly (in the</span></span>
<span id="cb7-17"><a href="css.html#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; current version of the package). To get correct results in this case, please</span></span>
<span id="cb7-18"><a href="css.html#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use model.matrix to convert the data.frame to a numeric matrix on your own,</span></span>
<span id="cb7-19"><a href="css.html#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then provide this matrix and cluster assignments with respect to this matrix.</span></span>
<span id="cb7-20"><a href="css.html#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is `list()` (so no clusters are specified).</span></span></code></pre></div>
<ul>
<li>and a specification of the type of subsamples. For now we only consider the <a href="overview.html#cpss">complementary subsets sampling of Shah and Samworth</a>. However, we have included an option for Meinshausen-Buhlmann sampling which we may add later:</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="css.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do"><span id='param-sampling_type'>###&quot;param-sampling_type&quot;###</span></span></span>
<span id="cb8-2"><a href="css.html#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. For &quot;MB&quot;,</span></span>
<span id="cb8-3"><a href="css.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; all B subsamples are drawn randomly (as proposed by Meinshausen and Bühlmann</span></span>
<span id="cb8-4"><a href="css.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2010). For &quot;SS&quot;, in addition to these B subsamples, the B complementary pair</span></span>
<span id="cb8-5"><a href="css.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsamples will be drawn as well (see Faletto and Bien 2022 or Shah and</span></span>
<span id="cb8-6"><a href="css.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Samworth 2013 for details). Default is &quot;SS&quot;, and &quot;MB&quot; is not supported yet.</span></span></code></pre></div>
<p>The number of subsamples is also up to the user:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="css.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do"><span id='param-B'>###&quot;param-B&quot;###</span></span></span>
<span id="cb9-2"><a href="css.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb9-3"><a href="css.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `sampling_type==&quot;MB&quot;` the total number of subsamples will be `B`; for</span></span>
<span id="cb9-4"><a href="css.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `sampling_type=&quot;SS&quot;` the number of subsamples will be `2*B`. Default is 100</span></span>
<span id="cb9-5"><a href="css.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for `sampling_type=&quot;MB&quot;` and 50 for `sampling_type=&quot;SS&quot;`.</span></span></code></pre></div>
<p>In this section, we will build the function <code><a href='css.html#css'>css</a>()</code> step-by-step.</p>
<ul>
<li><p>First, <code><a href='css.html#css'>css</a>()</code> creates random subsamples of the data: <span class="math inline">\(A_1,\ldots, A_B\)</span> (and <span class="math inline">\(\bar A_1,\ldots, \bar A_B\)</span> for Shah-Samworth subsampling). This is implemented in the function <code><a href='css.html#createSubsamples'>createSubsamples</a>()</code>.</p></li>
<li><p>Next, <code><a href='css.html#css'>css</a>()</code> executes the specified feature selection method <span class="math inline">\(\hat S^\lambda(\cdot)\)</span> on each subsample. This generates a binary matrix, <code>feat_sel_mat</code>, with one row for each subsample and one column for each feature in <code>X</code>. In each row, the entry corresponding to each feature equals 1 if the feature was selected on that subsample and 0 otherwise. <code>feat_sel_mat</code> is one of the outputs of <code><a href='css.html#css'>css</a>()</code>; it is used to calculate the selection proportions for individual features. This is implemented in the function <code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code>.</p></li>
<li><p>So far this is the same as the original stability selection procedure. Now we take into account the clusters. The function <code><a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>()</code> takes in the formatted clusters as well as <code>feat_sel_mat</code> and generates the binary matrix <code>clus_sel_mat</code>, which contains selection indicators for each cluster. <code>clus_sel_mat</code> has the same number of rows as <code>feat_sel_mat</code> and one column for each cluster rather than one for each feature. This is used to calculate the cluster selection proportions.</p></li>
</ul>
<p>The function <code><a href='css.html#css'>css</a>()</code> is specified below. (There are some extra details that I omitted in the above description for brevity; you can read the full details below.)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="css.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Cluster Stability Selection</span></span>
<span id="cb10-2"><a href="css.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb10-3"><a href="css.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Executes cluster stability selection algorithm. Takes subsamples of data,</span></span>
<span id="cb10-4"><a href="css.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; executes feature selection algorithm on each subsample, and returns matrices</span></span>
<span id="cb10-5"><a href="css.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of feature selection indicators as well as cluster selection indicators.</span></span>
<span id="cb10-6"><a href="css.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb10-7"><a href="css.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb10-8"><a href="css.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb10-9"><a href="css.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; p &gt;= 2 features/predictors.</span></span>
<span id="cb10-10"><a href="css.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; can be anything that takes the form of an</span></span>
<span id="cb10-11"><a href="css.html#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n-dimensional vector, with the ith entry corresponding to the ith row of X.</span></span>
<span id="cb10-12"><a href="css.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Typically (and for default `fitfun = cssLasso`), `y` should be an n-dimensional</span></span>
<span id="cb10-13"><a href="css.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector.</span></span>
<span id="cb10-14"><a href="css.html#cb10-14" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-lambda'>&lt;&lt;param-lambda&gt;&gt;</a></span>
<span id="cb10-15"><a href="css.html#cb10-15" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-clusters'>&lt;&lt;param-clusters&gt;&gt;</a></span>
<span id="cb10-16"><a href="css.html#cb10-16" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-fitfun'>&lt;&lt;param-fitfun&gt;&gt;</a></span>
<span id="cb10-17"><a href="css.html#cb10-17" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-sampling_type'>&lt;&lt;param-sampling_type&gt;&gt;</a></span>
<span id="cb10-18"><a href="css.html#cb10-18" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-B'>&lt;&lt;param-B&gt;&gt;</a></span>
<span id="cb10-19"><a href="css.html#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; if `prop_feats_remove` is greater than 0,</span></span>
<span id="cb10-20"><a href="css.html#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then on each subsample, each feature is randomly dropped from the design</span></span>
<span id="cb10-21"><a href="css.html#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix that is provided to `fitfun` with probability `prop_feats_remove`</span></span>
<span id="cb10-22"><a href="css.html#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (independently across features). That is, in a typical subsample,</span></span>
<span id="cb10-23"><a href="css.html#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `prop_feats_remove*p` features will be dropped (though this number will vary).</span></span>
<span id="cb10-24"><a href="css.html#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is similar in spirit (but distinct from) extended stability selection</span></span>
<span id="cb10-25"><a href="css.html#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (Beinrucker et. al. 2016); see their paper for some of the benefits of</span></span>
<span id="cb10-26"><a href="css.html#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropping features (besides increasing computational speed and decreasing</span></span>
<span id="cb10-27"><a href="css.html#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; memory requirements). For `sampling_type=&quot;SS&quot;`, the features dropped in</span></span>
<span id="cb10-28"><a href="css.html#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each complementary pair of subsamples are identical in order to ensure that</span></span>
<span id="cb10-29"><a href="css.html#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the theoretical guarantees of Faletto and Bien (2022) are retained within</span></span>
<span id="cb10-30"><a href="css.html#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each individual pair of subsamples. (Note that this feature is not</span></span>
<span id="cb10-31"><a href="css.html#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; investigated either theoretically or in simulations by Faletto and Bien</span></span>
<span id="cb10-32"><a href="css.html#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2022). Must be between 0 and 1. Default is 0.</span></span>
<span id="cb10-33"><a href="css.html#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param train_inds Optional; an integer or numeric vector containing the</span></span>
<span id="cb10-34"><a href="css.html#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of observations in `X` and `y` to set aside for model training by the</span></span>
<span id="cb10-35"><a href="css.html#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function `<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()` after feature selection. (This will only work if `y` is</span></span>
<span id="cb10-36"><a href="css.html#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; real-valued, because `<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()` using ordinary least squares regression to</span></span>
<span id="cb10-37"><a href="css.html#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate predictions.) If `train_inds` is not provided, all of the observations</span></span>
<span id="cb10-38"><a href="css.html#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the provided data set will be used for feature selection.</span></span>
<span id="cb10-39"><a href="css.html#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb10-40"><a href="css.html#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (`num_cores` will be supplied</span></span>
<span id="cb10-41"><a href="css.html#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the `mc.cores` argument of `parallel::mclapply()`).</span></span>
<span id="cb10-42"><a href="css.html#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list containing the following items:</span></span>
<span id="cb10-43"><a href="css.html#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`feat_sel_mat`}{A `B` (or `2*B` for `sampling_type=&quot;SS&quot;`) x `p` numeric (binary) matrix. `feat_sel_mat[i, j] = 1` if feature `j` was selected by the base feature selection method on subsample `i`, and 0 otherwise.}</span></span>
<span id="cb10-44"><a href="css.html#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`clus_sel_mat`}{A `B` (or `2*B` for SS sampling) x `length(clusters)` numeric (binary) matrix. `clus_sel_mat[i, j] = 1` if at least one feature from cluster j was selected by the base feature selection method on subsample `i`, and 0 otherwise.}</span></span>
<span id="cb10-45"><a href="css.html#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`X`}{The `X` matrix provided to `<a href='css.html#css'>css</a>()`, coerced from a data.frame to a </span></span>
<span id="cb10-46"><a href="css.html#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix if needed.}</span></span>
<span id="cb10-47"><a href="css.html#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`y`}{The `y` vector provided to `<a href='css.html#css'>css</a>()`.}</span></span>
<span id="cb10-48"><a href="css.html#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`clusters`}{A named list of integer vectors containing all of the clusters provided to `<a href='css.html#css'>css</a>()`, as well as size 1 clusters of any features not listed in any</span></span>
<span id="cb10-49"><a href="css.html#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of the clusters provided to `<a href='css.html#css'>css</a>()`. All clusters will have names; any </span></span>
<span id="cb10-50"><a href="css.html#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters not provided with a name in the input to `<a href='css.html#css'>css</a>()` will be given names</span></span>
<span id="cb10-51"><a href="css.html#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; automatically by `<a href='css.html#css'>css</a>()` (of the form c1, etc.).}</span></span>
<span id="cb10-52"><a href="css.html#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{`train_inds`}{Identical to the `train_inds` provided to `<a href='css.html#css'>css</a>()`.}</span></span>
<span id="cb10-53"><a href="css.html#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb10-54"><a href="css.html#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb10-55"><a href="css.html#cb10-55" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb10-56"><a href="css.html#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb10-57"><a href="css.html#cb10-57" aria-hidden="true" tabindex="-1"></a><a href='overview.html#shah2013'>&lt;&lt;shah2013&gt;&gt;</a></span>
<span id="cb10-58"><a href="css.html#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb10-59"><a href="css.html#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Meinshausen, N., &amp; Bühlmann, P. (2010). Stability Selection. \emph{Journal of the Royal</span></span>
<span id="cb10-60"><a href="css.html#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Society. Series B: Statistical Methodology}, 72(4), 417–473.</span></span>
<span id="cb10-61"><a href="css.html#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://rss.onlinelibrary.wiley.com/doi/full/10.1111/j.1467-9868.2010.00740.x}.</span></span>
<span id="cb10-62"><a href="css.html#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb10-63"><a href="css.html#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Beinrucker, A., Dogan, Ü., &amp;</span></span>
<span id="cb10-64"><a href="css.html#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Blanchard, G. (2016). Extensions of stability selection using subsamples of</span></span>
<span id="cb10-65"><a href="css.html#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations and covariates. \emph{Statistics and Computing}, 26(5), 1059-</span></span>
<span id="cb10-66"><a href="css.html#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1077. \url{https://doi.org/10.1007/s11222-015-9589-y}.</span></span>
<span id="cb10-67"><a href="css.html#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb10-68"><a href="css.html#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Jerome Friedman, Trevor Hastie, Robert Tibshirani (2010). Regularization Paths for Generalized</span></span>
<span id="cb10-69"><a href="css.html#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Linear Models via Coordinate Descent. \emph{Journal of Statistical Software},</span></span>
<span id="cb10-70"><a href="css.html#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 33(1), 1-22. URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb10-71"><a href="css.html#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb10-72"><a href="css.html#cb10-72" aria-hidden="true" tabindex="-1"></a><span id='css'>css</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda, <span class="at">clusters =</span> <span class="fu">list</span>(), <span class="at">fitfun =</span> cssLasso,</span>
<span id="cb10-73"><a href="css.html#cb10-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="fu">ifelse</span>(sampling_type <span class="sc">==</span> <span class="st">&quot;MB&quot;</span>, 100L, 50L),</span>
<span id="cb10-74"><a href="css.html#cb10-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">prop_feats_remove =</span> <span class="dv">0</span>, <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L</span>
<span id="cb10-75"><a href="css.html#cb10-75" aria-hidden="true" tabindex="-1"></a>    ){</span>
<span id="cb10-76"><a href="css.html#cb10-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-77"><a href="css.html#cb10-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb10-78"><a href="css.html#cb10-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-79"><a href="css.html#cb10-79" aria-hidden="true" tabindex="-1"></a>    check_list <span class="ot">&lt;-</span> <a href='css.html#checkCssInputs'>checkCssInputs</a>(X, y, lambda, clusters, fitfun, sampling_type,</span>
<span id="cb10-80"><a href="css.html#cb10-80" aria-hidden="true" tabindex="-1"></a>        B, prop_feats_remove, train_inds, num_cores)</span>
<span id="cb10-81"><a href="css.html#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="css.html#cb10-82" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> check_list<span class="sc">$</span>feat_names</span>
<span id="cb10-83"><a href="css.html#cb10-83" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> check_list<span class="sc">$</span>X</span>
<span id="cb10-84"><a href="css.html#cb10-84" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> check_list<span class="sc">$</span>clusters</span>
<span id="cb10-85"><a href="css.html#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="css.html#cb10-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(check_list)</span>
<span id="cb10-87"><a href="css.html#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="css.html#cb10-88" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb10-89"><a href="css.html#cb10-89" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb10-90"><a href="css.html#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="css.html#cb10-91" aria-hidden="true" tabindex="-1"></a>    train_inds <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(train_inds)</span>
<span id="cb10-92"><a href="css.html#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="css.html#cb10-93" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Create subsamples</span></span>
<span id="cb10-94"><a href="css.html#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="css.html#cb10-95" aria-hidden="true" tabindex="-1"></a>    sel_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, train_inds)</span>
<span id="cb10-96"><a href="css.html#cb10-96" aria-hidden="true" tabindex="-1"></a>    n_sel <span class="ot">&lt;-</span> <span class="fu">length</span>(sel_inds)</span>
<span id="cb10-97"><a href="css.html#cb10-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_sel <span class="sc">&lt;</span> <span class="dv">4</span>){</span>
<span id="cb10-98"><a href="css.html#cb10-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Too many training indices provided (must be at least 4 observations left for feature selection, and ideally many more)&quot;</span>)</span>
<span id="cb10-99"><a href="css.html#cb10-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-100"><a href="css.html#cb10-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-101"><a href="css.html#cb10-101" aria-hidden="true" tabindex="-1"></a>    subsamps_object <span class="ot">&lt;-</span> <a href='css.html#createSubsamples'>createSubsamples</a>(n_sel, p, B, sampling_type,</span>
<span id="cb10-102"><a href="css.html#cb10-102" aria-hidden="true" tabindex="-1"></a>        prop_feats_remove)</span>
<span id="cb10-103"><a href="css.html#cb10-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-104"><a href="css.html#cb10-104" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Get matrix of selected feature sets from subsamples</span></span>
<span id="cb10-105"><a href="css.html#cb10-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-106"><a href="css.html#cb10-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb10-107"><a href="css.html#cb10-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-108"><a href="css.html#cb10-108" aria-hidden="true" tabindex="-1"></a>    feat_sel_mat <span class="ot">&lt;-</span> <a href='css.html#getSelMatrix'>getSelMatrix</a>(X[sel_inds, ], y[sel_inds], lambda, B,</span>
<span id="cb10-109"><a href="css.html#cb10-109" aria-hidden="true" tabindex="-1"></a>        sampling_type, subsamps_object, num_cores, fitfun)</span>
<span id="cb10-110"><a href="css.html#cb10-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="css.html#cb10-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(feat_names))){</span>
<span id="cb10-112"><a href="css.html#cb10-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(feat_sel_mat) <span class="ot">&lt;-</span> feat_names</span>
<span id="cb10-113"><a href="css.html#cb10-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> feat_names</span>
<span id="cb10-114"><a href="css.html#cb10-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-115"><a href="css.html#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="css.html#cb10-116" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Get selection proportions for clusters corresponding to each feature</span></span>
<span id="cb10-117"><a href="css.html#cb10-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-118"><a href="css.html#cb10-118" aria-hidden="true" tabindex="-1"></a>    clus_sel_mat <span class="ot">&lt;-</span> <a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>(clusters, feat_sel_mat)</span>
<span id="cb10-119"><a href="css.html#cb10-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-120"><a href="css.html#cb10-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check outputs</span></span>
<span id="cb10-121"><a href="css.html#cb10-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(clus_sel_mat)))</span>
<span id="cb10-122"><a href="css.html#cb10-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(clus_sel_mat) <span class="sc">==</span> <span class="fu">names</span>(clusters)))</span>
<span id="cb10-123"><a href="css.html#cb10-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-124"><a href="css.html#cb10-124" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">feat_sel_mat =</span> feat_sel_mat,</span>
<span id="cb10-125"><a href="css.html#cb10-125" aria-hidden="true" tabindex="-1"></a>        <span class="at">clus_sel_mat =</span> clus_sel_mat,</span>
<span id="cb10-126"><a href="css.html#cb10-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">X =</span> X,</span>
<span id="cb10-127"><a href="css.html#cb10-127" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> y,</span>
<span id="cb10-128"><a href="css.html#cb10-128" aria-hidden="true" tabindex="-1"></a>        <span class="at">clusters =</span> clusters,</span>
<span id="cb10-129"><a href="css.html#cb10-129" aria-hidden="true" tabindex="-1"></a>        <span class="at">train_inds =</span> train_inds</span>
<span id="cb10-130"><a href="css.html#cb10-130" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-131"><a href="css.html#cb10-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-132"><a href="css.html#cb10-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">class</span>(ret) <span class="ot">&lt;-</span> <span class="st">&quot;cssr&quot;</span></span>
<span id="cb10-133"><a href="css.html#cb10-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-134"><a href="css.html#cb10-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb10-135"><a href="css.html#cb10-135" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#css'>css</a>()</code> and the other functions in this section are located at the end of this document. Next, we’ll build the individual functions one at a time. (The one function above that I didn’t mention at all is <code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code>, which confirms that the inputs to <code><a href='css.html#css'>css</a>()</code> are as expected and does some basic formatting on the inputs. To streamline presentation, this and other helper functions are specified later.)</p>
<div id="main-components-of-css" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Main components of <code>css</code><a href="css.html#main-components-of-css" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="generating-subsamples" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Generating subsamples<a href="css.html#generating-subsamples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code><a href='css.html#createSubsamples'>createSubsamples</a>()</code> is responsible for generating the subsamples <span class="math inline">\(A_b\)</span>, where <span class="math inline">\(b\)</span> ranges from 1 to <span class="math inline">\(B\)</span> or 1 to <span class="math inline">\(2B\)</span> depending on the type of subsampling:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="css.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Creates lists of subsamples for stability selection.</span></span>
<span id="cb11-2"><a href="css.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb11-3"><a href="css.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; sample size of the data set.</span></span>
<span id="cb11-4"><a href="css.html#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; number of features.</span></span>
<span id="cb11-5"><a href="css.html#cb11-5" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-B'>&lt;&lt;param-B&gt;&gt;</a></span>
<span id="cb11-6"><a href="css.html#cb11-6" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-sampling_type'>&lt;&lt;param-sampling_type&gt;&gt;</a></span>
<span id="cb11-7"><a href="css.html#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_feats_remove Integer; number of features select automatically on</span></span>
<span id="cb11-8"><a href="css.html#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; every iteration. Determined earlier from input prop_feats_remove to css.</span></span>
<span id="cb11-9"><a href="css.html#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of length `B` (or `2*B` for `sampling_type = &quot;SS&quot;`). If</span></span>
<span id="cb11-10"><a href="css.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `prop_feats_remove = 0`, each list element is an integer vector of length</span></span>
<span id="cb11-11"><a href="css.html#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `floor(n/2)` containing the indices of a subsample of `1:n`. (For</span></span>
<span id="cb11-12"><a href="css.html#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `sampling_type==&quot;SS&quot;`, the last `B` subsamples will be complementary pairs of</span></span>
<span id="cb11-13"><a href="css.html#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the first `B` subsamples; see Faletto and Bien 2022 or Shah and Samworth 2013</span></span>
<span id="cb11-14"><a href="css.html#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for details.) If `prop_feats_remove &gt; 0`, each element is a named list with</span></span>
<span id="cb11-15"><a href="css.html#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; members &quot;subsample&quot; (same as above) and &quot;feats_to_keep&quot;, a logical vector</span></span>
<span id="cb11-16"><a href="css.html#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of length `p`; `feats_to_keep[j] = TRUE` if feature `j` is chosen for this</span></span>
<span id="cb11-17"><a href="css.html#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample, and false otherwise.</span></span>
<span id="cb11-18"><a href="css.html#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb11-19"><a href="css.html#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb11-20"><a href="css.html#cb11-20" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb11-21"><a href="css.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb11-22"><a href="css.html#cb11-22" aria-hidden="true" tabindex="-1"></a><a href='overview.html#shah2013'>&lt;&lt;shah2013&gt;&gt;</a></span>
<span id="cb11-23"><a href="css.html#cb11-23" aria-hidden="true" tabindex="-1"></a><span id='createSubsamples'>createSubsamples</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, B, sampling_type, <span class="at">prop_feats_remove=</span><span class="dv">0</span>){</span>
<span id="cb11-24"><a href="css.html#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="css.html#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb11-26"><a href="css.html#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="css.html#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb11-28"><a href="css.html#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n) <span class="sc">|</span> <span class="fu">is.integer</span>(n))</span>
<span id="cb11-29"><a href="css.html#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">round</span>(n))</span>
<span id="cb11-30"><a href="css.html#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-31"><a href="css.html#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="css.html#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(p) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb11-33"><a href="css.html#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(p) <span class="sc">|</span> <span class="fu">is.integer</span>(p))</span>
<span id="cb11-34"><a href="css.html#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">==</span> <span class="fu">round</span>(p))</span>
<span id="cb11-35"><a href="css.html#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-36"><a href="css.html#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="css.html#cb11-37" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb11-38"><a href="css.html#cb11-38" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(prop_feats_remove, p)</span>
<span id="cb11-39"><a href="css.html#cb11-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-40"><a href="css.html#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(prop_feats_remove <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb11-41"><a href="css.html#cb11-41" aria-hidden="true" tabindex="-1"></a>        subsamples <span class="ot">&lt;-</span> <a href='css.html#getSubsamps'>getSubsamps</a>(n, B, sampling_type)</span>
<span id="cb11-42"><a href="css.html#cb11-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(subsamples)</span>
<span id="cb11-43"><a href="css.html#cb11-43" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb11-44"><a href="css.html#cb11-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In this case, we generate subsamples as well as logical vectors</span></span>
<span id="cb11-45"><a href="css.html#cb11-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># of features to keep</span></span>
<span id="cb11-46"><a href="css.html#cb11-46" aria-hidden="true" tabindex="-1"></a>        subsamps_and_feats <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-47"><a href="css.html#cb11-47" aria-hidden="true" tabindex="-1"></a>        subsamples <span class="ot">&lt;-</span> <a href='css.html#getSubsamps'>getSubsamps</a>(n, B, sampling_type)</span>
<span id="cb11-48"><a href="css.html#cb11-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb11-49"><a href="css.html#cb11-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Logical p-vector, where each entry is TRUE with probability</span></span>
<span id="cb11-50"><a href="css.html#cb11-50" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 1 - prop_feats_remove</span></span>
<span id="cb11-51"><a href="css.html#cb11-51" aria-hidden="true" tabindex="-1"></a>            feats_to_keep_i <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(stats<span class="sc">::</span><span class="fu">rbinom</span>(<span class="at">n=</span>p, <span class="at">size=</span><span class="dv">1</span>,</span>
<span id="cb11-52"><a href="css.html#cb11-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">prob=</span><span class="dv">1</span> <span class="sc">-</span> prop_feats_remove))</span>
<span id="cb11-53"><a href="css.html#cb11-53" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make sure at least two entries are equal to TRUE (so that at</span></span>
<span id="cb11-54"><a href="css.html#cb11-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># least two features are present for every subsample)--if not,</span></span>
<span id="cb11-55"><a href="css.html#cb11-55" aria-hidden="true" tabindex="-1"></a>            <span class="co"># randomly choose features to add</span></span>
<span id="cb11-56"><a href="css.html#cb11-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span>(<span class="fu">sum</span>(feats_to_keep_i) <span class="sc">&lt;</span> <span class="dv">2</span>){</span>
<span id="cb11-57"><a href="css.html#cb11-57" aria-hidden="true" tabindex="-1"></a>                false_inds <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span>feats_to_keep_i)</span>
<span id="cb11-58"><a href="css.html#cb11-58" aria-hidden="true" tabindex="-1"></a>                sel_feat <span class="ot">&lt;-</span> <span class="fu">sample</span>(false_inds, <span class="at">size=</span><span class="dv">1</span>)</span>
<span id="cb11-59"><a href="css.html#cb11-59" aria-hidden="true" tabindex="-1"></a>                feats_to_keep_i[sel_feat] <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb11-60"><a href="css.html#cb11-60" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-61"><a href="css.html#cb11-61" aria-hidden="true" tabindex="-1"></a>            subsamps_and_feats[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">subsample=</span>subsamples[[i]],</span>
<span id="cb11-62"><a href="css.html#cb11-62" aria-hidden="true" tabindex="-1"></a>                <span class="at">feats_to_keep=</span>feats_to_keep_i)</span>
<span id="cb11-63"><a href="css.html#cb11-63" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-64"><a href="css.html#cb11-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-65"><a href="css.html#cb11-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb11-66"><a href="css.html#cb11-66" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb11-67"><a href="css.html#cb11-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb11-68"><a href="css.html#cb11-68" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Keep the same features as in the other subsample (this</span></span>
<span id="cb11-69"><a href="css.html#cb11-69" aria-hidden="true" tabindex="-1"></a>                <span class="co"># ensures that the theoretical guarantee of Shah and Samworth</span></span>
<span id="cb11-70"><a href="css.html#cb11-70" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 2013 remains valid on every individual pair of subsamples)</span></span>
<span id="cb11-71"><a href="css.html#cb11-71" aria-hidden="true" tabindex="-1"></a>                subsamps_and_feats[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">subsample=</span>subsamples[[B <span class="sc">+</span> i]],</span>
<span id="cb11-72"><a href="css.html#cb11-72" aria-hidden="true" tabindex="-1"></a>                    <span class="at">feats_to_keep=</span>subsamps_and_feats[[i]]<span class="sc">$</span>feats_to_keep)</span>
<span id="cb11-73"><a href="css.html#cb11-73" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb11-74"><a href="css.html#cb11-74" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb11-75"><a href="css.html#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="css.html#cb11-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Check output</span></span>
<span id="cb11-77"><a href="css.html#cb11-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">names</span>(subsamps_and_feats) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;subsample&quot;</span>,</span>
<span id="cb11-78"><a href="css.html#cb11-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;feats_to_keep&quot;</span>)))</span>
<span id="cb11-79"><a href="css.html#cb11-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-80"><a href="css.html#cb11-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(subsamps_and_feats)</span>
<span id="cb11-81"><a href="css.html#cb11-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-82"><a href="css.html#cb11-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Shouldn&#39;t be possible to reach this part of function</span></span>
<span id="cb11-83"><a href="css.html#cb11-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;createSubsamples failed to return anything&quot;</span>)</span>
<span id="cb11-84"><a href="css.html#cb11-84" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that <code><a href='css.html#createSubsamples'>createSubsamples</a>()</code> calls some helper functions to check the inputs (again, these are specified later in the helper functions section). <code><a href='css.html#createSubsamples'>createSubsamples</a>()</code> also calls the workhorse function <code><a href='css.html#getSubsamps'>getSubsamps</a>()</code> to generate a list of subsamples.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="css.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate list of subsamples</span></span>
<span id="cb12-2"><a href="css.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb12-3"><a href="css.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#` Generate list of `B` (or `2*B` for sampling_type=&quot;SS&quot;) subsamples of size</span></span>
<span id="cb12-4"><a href="css.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#` `n/2`</span></span>
<span id="cb12-5"><a href="css.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; sample size of the data set.</span></span>
<span id="cb12-6"><a href="css.html#cb12-6" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-B'>&lt;&lt;param-B&gt;&gt;</a></span>
<span id="cb12-7"><a href="css.html#cb12-7" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-sampling_type'>&lt;&lt;param-sampling_type&gt;&gt;</a></span>
<span id="cb12-8"><a href="css.html#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of length `B` (or `2*B` for `sampling_type=&quot;SS&quot;`), where each</span></span>
<span id="cb12-9"><a href="css.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; element is an integer vector of length `floor(n/2)` containing the indices</span></span>
<span id="cb12-10"><a href="css.html#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of a subsample of `1:n`. For `sampling_type==&quot;SS&quot;`, the last `B` subsamples</span></span>
<span id="cb12-11"><a href="css.html#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be complementary pairs of the first `B` subsamples (see Faletto and</span></span>
<span id="cb12-12"><a href="css.html#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bien 2022 or Shah and Samworth 2013 for details).</span></span>
<span id="cb12-13"><a href="css.html#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb12-14"><a href="css.html#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb12-15"><a href="css.html#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb12-16"><a href="css.html#cb12-16" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb12-17"><a href="css.html#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb12-18"><a href="css.html#cb12-18" aria-hidden="true" tabindex="-1"></a><a href='overview.html#shah2013'>&lt;&lt;shah2013&gt;&gt;</a></span>
<span id="cb12-19"><a href="css.html#cb12-19" aria-hidden="true" tabindex="-1"></a><span id='getSubsamps'>getSubsamps</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, B, sampling_type){</span>
<span id="cb12-20"><a href="css.html#cb12-20" aria-hidden="true" tabindex="-1"></a>    subsamples <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb12-21"><a href="css.html#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb12-22"><a href="css.html#cb12-22" aria-hidden="true" tabindex="-1"></a>        subsamples[[i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample.int</span>(<span class="at">n=</span>n, <span class="at">size=</span><span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>), <span class="at">replace=</span><span class="cn">FALSE</span>))</span>
<span id="cb12-23"><a href="css.html#cb12-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-24"><a href="css.html#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> B)</span>
<span id="cb12-25"><a href="css.html#cb12-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): add support for sampling_type=&quot;MB&quot;</span></span>
<span id="cb12-26"><a href="css.html#cb12-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb12-27"><a href="css.html#cb12-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>B){</span>
<span id="cb12-28"><a href="css.html#cb12-28" aria-hidden="true" tabindex="-1"></a>            <span class="co"># For the ith entry, take a subsample of size floor(n/2) from the</span></span>
<span id="cb12-29"><a href="css.html#cb12-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># remaining n - floor(n/2) observations. (Only necessary to actually</span></span>
<span id="cb12-30"><a href="css.html#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="co"># take the subsample if n is odd; if not, the set we want is</span></span>
<span id="cb12-31"><a href="css.html#cb12-31" aria-hidden="true" tabindex="-1"></a>            <span class="co"># setdiff(1:n, subsamples[[i]]), so skip the sample function.)</span></span>
<span id="cb12-32"><a href="css.html#cb12-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(n<span class="sc">/</span><span class="dv">2</span> <span class="sc">==</span> <span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>)){</span>
<span id="cb12-33"><a href="css.html#cb12-33" aria-hidden="true" tabindex="-1"></a>                subsamples[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, subsamples[[i]]))</span>
<span id="cb12-34"><a href="css.html#cb12-34" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span>{</span>
<span id="cb12-35"><a href="css.html#cb12-35" aria-hidden="true" tabindex="-1"></a>                subsamples[[B <span class="sc">+</span> i]] <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(<span class="at">x=</span><span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb12-36"><a href="css.html#cb12-36" aria-hidden="true" tabindex="-1"></a>                    subsamples[[i]]), <span class="at">size=</span><span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>), <span class="at">replace=</span><span class="cn">FALSE</span>))</span>
<span id="cb12-37"><a href="css.html#cb12-37" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb12-38"><a href="css.html#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="css.html#cb12-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check output</span></span>
<span id="cb12-40"><a href="css.html#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="css.html#cb12-41" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(subsamples[[B <span class="sc">+</span> i]]))</span>
<span id="cb12-42"><a href="css.html#cb12-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(subsamples[[B <span class="sc">+</span> i]] <span class="sc">==</span></span>
<span id="cb12-43"><a href="css.html#cb12-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">round</span>(subsamples[[B <span class="sc">+</span> i]])))</span>
<span id="cb12-44"><a href="css.html#cb12-44" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>) <span class="sc">==</span> <span class="fu">length</span>(subsamples[[B <span class="sc">+</span> i]]))</span>
<span id="cb12-45"><a href="css.html#cb12-45" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples[[B <span class="sc">+</span> i]]) <span class="sc">==</span></span>
<span id="cb12-46"><a href="css.html#cb12-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">length</span>(<span class="fu">unique</span>(subsamples[[B <span class="sc">+</span> i]])))</span>
<span id="cb12-47"><a href="css.html#cb12-47" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb12-48"><a href="css.html#cb12-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsamples) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb12-49"><a href="css.html#cb12-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb12-50"><a href="css.html#cb12-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(subsamples)</span>
<span id="cb12-51"><a href="css.html#cb12-51" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="forming-selection-matrices" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Forming selection matrices<a href="css.html#forming-selection-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The next function called in the body of <code><a href='css.html#css'>css</a>()</code> is <code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code>, which records for each feature <span class="math inline">\(j\)</span> and subsample <span class="math inline">\(b\)</span> whether <span class="math inline">\(j\in \hat S^\lambda(A_b)\)</span>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="css.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generates matrix of selection indicators from stability selection.</span></span>
<span id="cb13-2"><a href="css.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb13-3"><a href="css.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x an n x p numeric matrix or a data.frame containing the predictors.</span></span>
<span id="cb13-4"><a href="css.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A response vector; can be any response that takes the form of a</span></span>
<span id="cb13-5"><a href="css.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n vector and is used (or not used) by fitfun. Typically (and for</span></span>
<span id="cb13-6"><a href="css.html#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; default fitfun = cssLasso), y should be an n-dimensional numeric vector</span></span>
<span id="cb13-7"><a href="css.html#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; containing the response.</span></span>
<span id="cb13-8"><a href="css.html#cb13-8" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-lambda'>&lt;&lt;param-lambda&gt;&gt;</a></span>
<span id="cb13-9"><a href="css.html#cb13-9" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-B'>&lt;&lt;param-B&gt;&gt;</a></span>
<span id="cb13-10"><a href="css.html#cb13-10" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-sampling_type'>&lt;&lt;param-sampling_type&gt;&gt;</a></span>
<span id="cb13-11"><a href="css.html#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param subsamps_object A list of length `B` (or `2*B` if `sampling_type=&quot;SS&quot;`),</span></span>
<span id="cb13-12"><a href="css.html#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; where each element is one of the following: \item{subsample}{An integer</span></span>
<span id="cb13-13"><a href="css.html#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of size `n/2` containing the indices of the observations in the</span></span>
<span id="cb13-14"><a href="css.html#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample.} \item{drop_var_input}{A named list containing two elements: one</span></span>
<span id="cb13-15"><a href="css.html#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;subsample&quot;, matching the previous description, and a logical vector</span></span>
<span id="cb13-16"><a href="css.html#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;feats_to_keep&quot; containing the indices of the features to be</span></span>
<span id="cb13-17"><a href="css.html#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; automatically selected.} (The first object is the output of the function</span></span>
<span id="cb13-18"><a href="css.html#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; createSubsamples when the provided prop_feats_remove is 0, the default, and</span></span>
<span id="cb13-19"><a href="css.html#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the second object is the output of createSubsamples when prop_feats_remove &gt;</span></span>
<span id="cb13-20"><a href="css.html#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0.)</span></span>
<span id="cb13-21"><a href="css.html#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb13-22"><a href="css.html#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (num_cores will be supplied</span></span>
<span id="cb13-23"><a href="css.html#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the mc.cores argument of parallel::mclapply).</span></span>
<span id="cb13-24"><a href="css.html#cb13-24" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-fitfun'>&lt;&lt;param-fitfun&gt;&gt;</a></span>
<span id="cb13-25"><a href="css.html#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A binary integer matrix of dimension `B` x `p` (if sampling_type ==</span></span>
<span id="cb13-26"><a href="css.html#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;MB&quot;) or `2*B` x `p` (if sampling_type == &quot;SS&quot;). res[i, j] = 1 if feature j</span></span>
<span id="cb13-27"><a href="css.html#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; was selected on subsample i and equals 0 otherwise. (That is, each row is a</span></span>
<span id="cb13-28"><a href="css.html#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected set.)</span></span>
<span id="cb13-29"><a href="css.html#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb13-30"><a href="css.html#cb13-30" aria-hidden="true" tabindex="-1"></a><span id='getSelMatrix'>getSelMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, lambda, B, sampling_type, subsamps_object,</span>
<span id="cb13-31"><a href="css.html#cb13-31" aria-hidden="true" tabindex="-1"></a>    num_cores, <span class="at">fitfun=</span>cssLasso){</span>
<span id="cb13-32"><a href="css.html#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="css.html#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb13-34"><a href="css.html#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="css.html#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb13-36"><a href="css.html#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb13-37"><a href="css.html#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="css.html#cb13-38" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb13-39"><a href="css.html#cb13-39" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb13-40"><a href="css.html#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="css.html#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb13-42"><a href="css.html#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb13-43"><a href="css.html#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb13-44"><a href="css.html#cb13-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb13-45"><a href="css.html#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="css.html#cb13-46" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb13-47"><a href="css.html#cb13-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-48"><a href="css.html#cb13-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get list of selected feature sets from subsamples</span></span>
<span id="cb13-49"><a href="css.html#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="css.html#cb13-50" aria-hidden="true" tabindex="-1"></a>    res_list <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(<span class="at">X=</span>subsamps_object, <span class="at">FUN=</span>cssLoop, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb13-51"><a href="css.html#cb13-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">lambda=</span>lambda, <span class="at">fitfun=</span>fitfun, <span class="at">mc.cores=</span>num_cores)</span>
<span id="cb13-52"><a href="css.html#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="css.html#cb13-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store selected sets in B x p (or `2*B` x p for &quot;SS&quot;) binary matrix</span></span>
<span id="cb13-54"><a href="css.html#cb13-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb13-55"><a href="css.html#cb13-55" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(0L, <span class="dv">2</span><span class="sc">*</span>B, p)</span>
<span id="cb13-56"><a href="css.html#cb13-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;MB&quot;</span>){</span>
<span id="cb13-57"><a href="css.html#cb13-57" aria-hidden="true" tabindex="-1"></a>        res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(0L, B, p)</span>
<span id="cb13-58"><a href="css.html#cb13-58" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb13-59"><a href="css.html#cb13-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;!(sampling_type %in% c(SS, MB)) (don&#39;t know how to set dimensions of res&quot;</span>)</span>
<span id="cb13-60"><a href="css.html#cb13-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-61"><a href="css.html#cb13-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-62"><a href="css.html#cb13-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list) <span class="sc">==</span> <span class="fu">nrow</span>(res))</span>
<span id="cb13-63"><a href="css.html#cb13-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-64"><a href="css.html#cb13-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selected sets into matrix res</span></span>
<span id="cb13-65"><a href="css.html#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="css.html#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(res)){</span>
<span id="cb13-67"><a href="css.html#cb13-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb13-68"><a href="css.html#cb13-68" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If no features are selected, don&#39;t fill in anything in this row</span></span>
<span id="cb13-69"><a href="css.html#cb13-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb13-70"><a href="css.html#cb13-70" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-71"><a href="css.html#cb13-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-72"><a href="css.html#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.integer</span>(res_list[[i]])){</span>
<span id="cb13-73"><a href="css.html#cb13-73" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;failed on iteration&quot;</span>, i))</span>
<span id="cb13-74"><a href="css.html#cb13-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(res_list[[i]])</span>
<span id="cb13-75"><a href="css.html#cb13-75" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Something seems to be wrong with the feature selection method (fitfun failed to return an integer vector)&quot;</span>)</span>
<span id="cb13-76"><a href="css.html#cb13-76" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-77"><a href="css.html#cb13-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">&lt;=</span> p <span class="sc">&amp;</span> <span class="fu">length</span>(res_list[[i]]) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb13-78"><a href="css.html#cb13-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_list[[i]])))</span>
<span id="cb13-79"><a href="css.html#cb13-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">max</span>(res_list[[i]]) <span class="sc">&lt;=</span> p)</span>
<span id="cb13-80"><a href="css.html#cb13-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">min</span>(res_list[[i]]) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb13-81"><a href="css.html#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(res_list[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(res_list[[i]])))</span>
<span id="cb13-82"><a href="css.html#cb13-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb13-83"><a href="css.html#cb13-83" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb13-84"><a href="css.html#cb13-84" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]]) <span class="sc">|</span></span>
<span id="cb13-85"><a href="css.html#cb13-85" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(res_list[[i]])))</span>
<span id="cb13-86"><a href="css.html#cb13-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-87"><a href="css.html#cb13-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Store selected variables in the ith row of res</span></span>
<span id="cb13-88"><a href="css.html#cb13-88" aria-hidden="true" tabindex="-1"></a>        res[i, res_list[[i]]] <span class="ot">&lt;-</span> 1L</span>
<span id="cb13-89"><a href="css.html#cb13-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-90"><a href="css.html#cb13-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-91"><a href="css.html#cb13-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb13-92"><a href="css.html#cb13-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-93"><a href="css.html#cb13-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb13-94"><a href="css.html#cb13-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type<span class="sc">==</span><span class="st">&quot;SS&quot;</span>){</span>
<span id="cb13-95"><a href="css.html#cb13-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">==</span> <span class="dv">2</span><span class="sc">*</span>B)</span>
<span id="cb13-96"><a href="css.html#cb13-96" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb13-97"><a href="css.html#cb13-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">==</span> B)</span>
<span id="cb13-98"><a href="css.html#cb13-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-99"><a href="css.html#cb13-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(res) <span class="sc">==</span> p)</span>
<span id="cb13-100"><a href="css.html#cb13-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb13-101"><a href="css.html#cb13-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-102"><a href="css.html#cb13-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb13-103"><a href="css.html#cb13-103" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Again, <code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code> uses some helper functions to check the inputs for safety. <code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code> leverages the function <code>parallel::mclapply()</code> package, in order to allow for parallel processing if the user has set this up. This requires a helper function <code><a href='css.html#cssLoop'>cssLoop</a>()</code>, which is also specified in the later section for helper functions.
We add the <code>parallel</code> package to the DESCRIPTION file:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="css.html#cb14-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">&quot;parallel&quot;</span>)</span></code></pre></div>
<pre><code>## ✔ Adding &#39;parallel&#39; to Imports field in DESCRIPTION
## • Refer to functions with `parallel::fun()`</code></pre>
<p><code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code> also uses a feature selection function <code>fitfun</code> as an input. <code>fitfun</code> can be provided by the user as an input to <code><a href='css.html#css'>css</a>()</code>. We provide one default <code>fitfun</code>, <code><a href='css.html#cssLasso'>cssLasso</a>()</code>, which works on a real-valued response y given a specified penalty parameter lambda &gt; 0. Both for its own importance and to show an example of a valid <code>fitfun</code>, we show <code><a href='css.html#cssLasso'>cssLasso</a>()</code> here.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="css.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Provided fitfun implementing the lasso</span></span>
<span id="cb16-2"><a href="css.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb16-3"><a href="css.html#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Function used to select features with the lasso on each subsample in cluster</span></span>
<span id="cb16-4"><a href="css.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stability selection. Uses glmnet implementation of the lasso.</span></span>
<span id="cb16-5"><a href="css.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X A design matrix containing the predictors. (In practice this will</span></span>
<span id="cb16-6"><a href="css.html#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be a subsample of the full design matrix provided to `<a href='css.html#css'>css</a>()`.)</span></span>
<span id="cb16-7"><a href="css.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric vector containing the response.</span></span>
<span id="cb16-8"><a href="css.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda Numeric; a nonnegative number for the lasso penalty to use</span></span>
<span id="cb16-9"><a href="css.html#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on each subsample. (For now, only one lambda value can be provided to</span></span>
<span id="cb16-10"><a href="css.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `<a href='css.html#cssLasso'>cssLasso</a>()`; in the future, we plan to allow for multiple lambda values to be</span></span>
<span id="cb16-11"><a href="css.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to `<a href='css.html#cssLasso'>cssLasso</a>()`, as described in Faletto and Bien 2022.)</span></span>
<span id="cb16-12"><a href="css.html#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector; the indices of the features selected by the lasso.</span></span>
<span id="cb16-13"><a href="css.html#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb16-14"><a href="css.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references </span></span>
<span id="cb16-15"><a href="css.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb16-16"><a href="css.html#cb16-16" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb16-17"><a href="css.html#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb16-18"><a href="css.html#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Jerome Friedman, Trevor Hastie,</span></span>
<span id="cb16-19"><a href="css.html#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Robert Tibshirani (2010). Regularization Paths for Generalized Linear Models</span></span>
<span id="cb16-20"><a href="css.html#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; via Coordinate Descent. \emph{Journal of Statistical Software}, 33(1), 1-22.</span></span>
<span id="cb16-21"><a href="css.html#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb16-22"><a href="css.html#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb16-23"><a href="css.html#cb16-23" aria-hidden="true" tabindex="-1"></a><span id='cssLasso'>cssLasso</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb16-24"><a href="css.html#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb16-25"><a href="css.html#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="css.html#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto) allow cssLasso to accept a vector of lambda values rather</span></span>
<span id="cb16-27"><a href="css.html#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># than just a single one.</span></span>
<span id="cb16-28"><a href="css.html#cb16-28" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(X, y, lambda)</span>
<span id="cb16-29"><a href="css.html#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="css.html#cb16-30" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb16-31"><a href="css.html#cb16-31" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb16-32"><a href="css.html#cb16-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-33"><a href="css.html#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit a lasso path (full path for speed, per glmnet documentation)</span></span>
<span id="cb16-34"><a href="css.html#cb16-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-35"><a href="css.html#cb16-35" aria-hidden="true" tabindex="-1"></a>    lasso_model <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">glmnet</span>(X, y, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb16-36"><a href="css.html#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all.equal</span>(<span class="fu">class</span>(lasso_model), <span class="fu">c</span>(<span class="st">&quot;elnet&quot;</span>, <span class="st">&quot;glmnet&quot;</span>)))</span>
<span id="cb16-37"><a href="css.html#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="css.html#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get coefficients at desired lambda</span></span>
<span id="cb16-39"><a href="css.html#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="css.html#cb16-40" aria-hidden="true" tabindex="-1"></a>    pred <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">predict.glmnet</span>(lasso_model, <span class="at">type=</span><span class="st">&quot;nonzero&quot;</span>,</span>
<span id="cb16-41"><a href="css.html#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">s=</span>lambda, <span class="at">exact=</span><span class="cn">TRUE</span>, <span class="at">newx=</span>X, <span class="at">x=</span>X, <span class="at">y=</span>y)</span>
<span id="cb16-42"><a href="css.html#cb16-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-43"><a href="css.html#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(pred[[<span class="dv">1</span>]])){<span class="fu">return</span>(<span class="fu">integer</span>())}</span>
<span id="cb16-44"><a href="css.html#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="css.html#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(pred))</span>
<span id="cb16-46"><a href="css.html#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span> <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span></span>
<span id="cb16-47"><a href="css.html#cb16-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred) <span class="sc">|</span> <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(pred)))</span>
<span id="cb16-48"><a href="css.html#cb16-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-49"><a href="css.html#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-50"><a href="css.html#cb16-50" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred[, <span class="dv">1</span>]</span>
<span id="cb16-51"><a href="css.html#cb16-51" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-52"><a href="css.html#cb16-52" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred[, <span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb16-53"><a href="css.html#cb16-53" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">dim</span>(pred)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-54"><a href="css.html#cb16-54" aria-hidden="true" tabindex="-1"></a>        selected_glmnet <span class="ot">&lt;-</span> pred</span>
<span id="cb16-55"><a href="css.html#cb16-55" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb16-56"><a href="css.html#cb16-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;length(dim(pred)) not 1, 2, or 3&quot;</span>)</span>
<span id="cb16-57"><a href="css.html#cb16-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-58"><a href="css.html#cb16-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-59"><a href="css.html#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb16-60"><a href="css.html#cb16-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">&lt;=</span> <span class="fu">ncol</span>(X))</span>
<span id="cb16-61"><a href="css.html#cb16-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(selected_glmnet <span class="sc">==</span> <span class="fu">round</span>(selected_glmnet)))</span>
<span id="cb16-62"><a href="css.html#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_glmnet) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(selected_glmnet)))</span>
<span id="cb16-63"><a href="css.html#cb16-63" aria-hidden="true" tabindex="-1"></a>    selected_glmnet <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(selected_glmnet)</span>
<span id="cb16-64"><a href="css.html#cb16-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-65"><a href="css.html#cb16-65" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sort</span>(selected_glmnet)</span>
<span id="cb16-66"><a href="css.html#cb16-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-67"><a href="css.html#cb16-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb16-68"><a href="css.html#cb16-68" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Notice that <code><a href='css.html#cssLasso'>cssLasso</a>()</code> depends on the package <code>glmnet</code>, and calls the function <code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code>, which verifies that the inputs to <code><a href='css.html#cssLasso'>cssLasso</a>()</code> are as needed. (In particular, the function <code><a href='css.html#css'>css</a>()</code> imposes very few requirements on <code>lambda</code> and <code>y</code> to allow the end user flexibility for any specified <code>fitfun</code>. <code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code> ensures that <code>y</code> is a real-valued response, <code>lambda</code> is a nonnegative real number, etc.) <code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code> is specified in the helper functions section later.</p>
<p>We add <code>glmnet</code> to the DESCRIPTION file as well:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="css.html#cb17-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">&quot;glmnet&quot;</span>)</span></code></pre></div>
<pre><code>## ✔ Adding &#39;glmnet&#39; to Imports field in DESCRIPTION
## • Refer to functions with `glmnet::fun()`</code></pre>
<p>Finally, <code><a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>()</code> is the last significant function called within <code><a href='css.html#css'>css</a>()</code>. It takes the information from <code><a href='css.html#getSelMatrix'>getSelMatrix</a>()</code>, i.e. whether feature <span class="math inline">\(j\in\hat S^\lambda(A_b)\)</span>, and outputs for every cluster <span class="math inline">\(C\)</span> whether <span class="math inline">\(C\cap S^\lambda(A_b)\neq\emptyset\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="css.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get cluster selection matrix</span></span>
<span id="cb19-2"><a href="css.html#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb19-3"><a href="css.html#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Given a matrix of feature selection indicator variables and a list of</span></span>
<span id="cb19-4"><a href="css.html#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters of features, returns a matrix of cluster indicator variables.</span></span>
<span id="cb19-5"><a href="css.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb19-6"><a href="css.html#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb19-7"><a href="css.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of formatClusters.</span></span>
<span id="cb19-8"><a href="css.html#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb19-9"><a href="css.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb19-10"><a href="css.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb19-11"><a href="css.html#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).</span></span>
<span id="cb19-12"><a href="css.html#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param res A binary integer matrix. es[i, j] = 1 if feature j was selected</span></span>
<span id="cb19-13"><a href="css.html#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on subsample i and equals 0 otherwise, as in the output of `<a href='css.html#getSelMatrix'>getSelMatrix</a>()`.</span></span>
<span id="cb19-14"><a href="css.html#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (That is, each row is a selected set.)</span></span>
<span id="cb19-15"><a href="css.html#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A binary integer matrix with the same number of rows</span></span>
<span id="cb19-16"><a href="css.html#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as res and length(clusters) columns. Entry i, j is 1 if at least</span></span>
<span id="cb19-17"><a href="css.html#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one member of cluster j was selected on subsample i, and 0 otherwise.</span></span>
<span id="cb19-18"><a href="css.html#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb19-19"><a href="css.html#cb19-19" aria-hidden="true" tabindex="-1"></a><span id='getClusterSelMatrix'>getClusterSelMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, res){</span>
<span id="cb19-20"><a href="css.html#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="css.html#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input</span></span>
<span id="cb19-22"><a href="css.html#cb19-22" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(clusters, res)</span>
<span id="cb19-23"><a href="css.html#cb19-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-24"><a href="css.html#cb19-24" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(res)</span>
<span id="cb19-25"><a href="css.html#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="css.html#cb19-26" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb19-27"><a href="css.html#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="css.html#cb19-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Matrix of cluster selection proportions (with n_clusters columns)</span></span>
<span id="cb19-29"><a href="css.html#cb19-29" aria-hidden="true" tabindex="-1"></a>    res_n_clusters <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(0L, <span class="fu">nrow</span>(res)<span class="sc">*</span>n_clusters), <span class="at">nrow=</span><span class="fu">nrow</span>(res),</span>
<span id="cb19-30"><a href="css.html#cb19-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">ncol=</span>n_clusters)</span>
<span id="cb19-31"><a href="css.html#cb19-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(res_n_clusters) <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb19-32"><a href="css.html#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="css.html#cb19-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb19-34"><a href="css.html#cb19-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Identify rows of res where at least one feature from this cluster</span></span>
<span id="cb19-35"><a href="css.html#cb19-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># was selected</span></span>
<span id="cb19-36"><a href="css.html#cb19-36" aria-hidden="true" tabindex="-1"></a>        rows_j_sel <span class="ot">&lt;-</span> <span class="fu">apply</span>(res, <span class="dv">1</span>, <span class="cf">function</span>(x){<span class="fu">any</span>(x[clusters[[j]]] <span class="sc">==</span> <span class="dv">1</span>)})</span>
<span id="cb19-37"><a href="css.html#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="css.html#cb19-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Put ones in these rows of res_n_clusters[, j]</span></span>
<span id="cb19-39"><a href="css.html#cb19-39" aria-hidden="true" tabindex="-1"></a>        res_n_clusters[rows_j_sel, j] <span class="ot">&lt;-</span> 1L</span>
<span id="cb19-40"><a href="css.html#cb19-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-41"><a href="css.html#cb19-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters[[j]]) <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb19-42"><a href="css.html#cb19-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">next</span></span>
<span id="cb19-43"><a href="css.html#cb19-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-44"><a href="css.html#cb19-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-45"><a href="css.html#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="css.html#cb19-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb19-47"><a href="css.html#cb19-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res_n_clusters))</span>
<span id="cb19-48"><a href="css.html#cb19-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(res_n_clusters), <span class="fu">names</span>(clusters)))</span>
<span id="cb19-49"><a href="css.html#cb19-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res_n_clusters <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb19-50"><a href="css.html#cb19-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(res_n_clusters) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb19-51"><a href="css.html#cb19-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-52"><a href="css.html#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res_n_clusters)</span>
<span id="cb19-53"><a href="css.html#cb19-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The helper function <code><a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>()</code> verifies the inputs to <code><a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>()</code>.</p>
<p>With the above and the helper functions below, the <code><a href='css.html#css'>css</a>()</code> function is complete!</p>
</div>
</div>
<div id="helper-functions" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Helper functions<a href="css.html#helper-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Below, we specify some of the helper functions for <code><a href='css.html#css'>css</a>()</code>, which are less important for understanding what <code><a href='css.html#css'>css</a>()</code> does.</p>
<ul>
<li>The function <code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code> is called at the beginning of the <code><a href='css.html#css'>css</a>()</code> function. It confirms that the inputs to <code><a href='css.html#css'>css</a>()</code> are as expected. Also, <code><a href='css.html#css'>css</a>()</code> allows some flexibility in how the inputs are formatted, and <code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code> converts the inputs into consistent formats for later use.
<ul>
<li>The function <code><a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>()</code> is called within <code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code>, and specifically checks the clusters input.</li>
<li><code><a href='css.html#formatClusters'>formatClusters</a>()</code> modifies clusters, ensuring every feature appears in exactly one cluster (any unclustered features are put in a “cluster” by themselves).
<ul>
<li><code><a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>()</code> verifies the input to <code><a href='css.html#formatClusters'>formatClusters</a>()</code> for safety (this might seem a little redundant here, but <code><a href='css.html#formatClusters'>formatClusters</a>()</code> is also called by different functions in this package).
<ul>
<li><code><a href='css.html#checkY'>checkY</a>()</code> ensures (here and elsewhere) that the provided <code>y</code> is as expected. (In particular, in general the inputted <code>y</code> can be a vector of any type as long as the specified <code>fitfun</code> can handle <code>y</code> appropriately. For some function inputs, <code>y</code> must be a numeric vector. <code><a href='css.html#checkY'>checkY</a>()</code> enforces this, among other things.)</li>
</ul></li>
<li><code><a href='css.html#checkClusters'>checkClusters</a>()</code> verifies that the output of <code><a href='css.html#formatClusters'>formatClusters</a>()</code> is as expected.</li>
<li><code><a href='css.html#getPrototypes'>getPrototypes</a>()</code> identifies the prototypes of each cluster–the feature within each cluster that has the largest marginal sample correlation with <code>y</code>.
<ul>
<li><code><a href='css.html#identifyPrototype'>identifyPrototype</a>()</code> is the workhorse of <code><a href='css.html#getPrototypes'>getPrototypes</a>()</code>, identifying the prototype given a single cluster.
<ul>
<li><code><a href='css.html#corFunction'>corFunction</a>()</code> is a helper function called within <code><a href='css.html#identifyPrototype'>identifyPrototype</a>()</code> to calculate the absolute value of the correlation between two vectors.</li>
</ul></li>
</ul></li>
</ul></li>
<li><code><a href='css.html#checkSamplingType'>checkSamplingType</a>()</code> ensures that the input <code>sampling_type</code> is as expected.</li>
<li><code><a href='css.html#checkB'>checkB</a>()</code> ensures that the input <code>B</code> is as expected.</li>
<li><code><a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>()</code> ensures that the input <code>prop_feats_remove</code> is as expected.</li>
</ul></li>
<li>The function <code><a href='css.html#cssLoop'>cssLoop</a>()</code> is called within <code><a href='css.html#css'>css</a>()</code>. In particular, it is a helper function needed in order to allow for parallel processing of the feature selection method on each of the subsamples.
<ul>
<li><code><a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code> verifies that the output of <code><a href='css.html#cssLoop'>cssLoop</a>()</code> is as expected. This is particularly important because the user can specify their own feature selection method; <code><a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code> verifies that the output of the feature selection method is valid, and provides an informative error message if not.</li>
</ul></li>
<li><code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code> checks that the inputs to the provided <code>fitfun</code>, <code><a href='css.html#cssLasso'>cssLasso</a>()</code>, are as needed.</li>
<li><code><a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>()</code> verifies that the input to <code><a href='css.html#getClusterSelMatrix'>getClusterSelMatrix</a>()</code> is as expected.</li>
</ul>
<p>Tests are written for all of these functions and appear as early as possible after the function is defined. (For functions that don’t depend on any other functions, tests appear immediately after the function; for functions with dependencies, the tests appear after all dependencies have been defined.)</p>
<p><code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="css.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that inputs to the function `<a href='css.html#css'>css</a>()` are as expected,</span></span>
<span id="cb20-2"><a href="css.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and modify inputs if needed</span></span>
<span id="cb20-3"><a href="css.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb20-4"><a href="css.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb20-5"><a href="css.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb20-6"><a href="css.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; p &gt;= 2 features/predictors.</span></span>
<span id="cb20-7"><a href="css.html#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; can be anything that takes the form of an</span></span>
<span id="cb20-8"><a href="css.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n-dimensional vector, with the ith entry corresponding to the ith row of X.</span></span>
<span id="cb20-9"><a href="css.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Typically (and for default fitfun = cssLasso), y should be an n-dimensional</span></span>
<span id="cb20-10"><a href="css.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector.</span></span>
<span id="cb20-11"><a href="css.html#cb20-11" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-lambda'>&lt;&lt;param-lambda&gt;&gt;</a></span>
<span id="cb20-12"><a href="css.html#cb20-12" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-clusters'>&lt;&lt;param-clusters&gt;&gt;</a></span>
<span id="cb20-13"><a href="css.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function; the feature selection function used on each</span></span>
<span id="cb20-14"><a href="css.html#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsample by cluster stability selection. This can be any feature selection</span></span>
<span id="cb20-15"><a href="css.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method; the only requirement is that it accepts the arguments (and only the</span></span>
<span id="cb20-16"><a href="css.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; arguments) X, y, and lambda and returns an integer vector that is a subset of</span></span>
<span id="cb20-17"><a href="css.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 1:p. For example, fitfun could be best subset selection or forward stepwise</span></span>
<span id="cb20-18"><a href="css.html#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection or LARS and lambda could be the desired model size; or fitfun could be the</span></span>
<span id="cb20-19"><a href="css.html#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; elastic net and lambda could be a length-two vector specifying lambda and</span></span>
<span id="cb20-20"><a href="css.html#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; alpha. Default is cssLasso, an implementation of lasso (relying on the R</span></span>
<span id="cb20-21"><a href="css.html#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; package glmnet), where lambda must be a positive numeric specifying the L1</span></span>
<span id="cb20-22"><a href="css.html#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; penalty for the lasso.</span></span>
<span id="cb20-23"><a href="css.html#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. For &quot;MB&quot;,</span></span>
<span id="cb20-24"><a href="css.html#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; all B subsamples are drawn randomly (as proposed by Meinshausen and Bühlmann</span></span>
<span id="cb20-25"><a href="css.html#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2010). For &quot;SS&quot;, in addition to these B subsamples, the B complementary pair</span></span>
<span id="cb20-26"><a href="css.html#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; subsamples will be drawn as well (see Faletto and Bien 2022 or Shah and</span></span>
<span id="cb20-27"><a href="css.html#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Samworth 2013 for details). Default is &quot;SS&quot;, and &quot;MB&quot; is not supported yet.</span></span>
<span id="cb20-28"><a href="css.html#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb20-29"><a href="css.html#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the total number of subsamples will be `B`; for</span></span>
<span id="cb20-30"><a href="css.html#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of subsamples will be `2*B`. Default is 100</span></span>
<span id="cb20-31"><a href="css.html#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for sampling_type=&quot;MB&quot; and 50 for sampling_type=&quot;SS&quot;.</span></span>
<span id="cb20-32"><a href="css.html#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; if prop_feats_remove is greater than 0,</span></span>
<span id="cb20-33"><a href="css.html#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then on each subsample, each feature is randomly dropped from the design</span></span>
<span id="cb20-34"><a href="css.html#cb20-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix that is provided to fitfun with probability prop_feats_remove</span></span>
<span id="cb20-35"><a href="css.html#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (independently across features). That is, in a typical subsample,</span></span>
<span id="cb20-36"><a href="css.html#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prop_feats_remove*p features will be dropped (though this number will vary).</span></span>
<span id="cb20-37"><a href="css.html#cb20-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is similar in spirit (but distinct from) extended stability selection</span></span>
<span id="cb20-38"><a href="css.html#cb20-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (Beinrucker et. al. 2016); see their paper for some of the benefits of</span></span>
<span id="cb20-39"><a href="css.html#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropping features (besides increasing computational speed and decreasing</span></span>
<span id="cb20-40"><a href="css.html#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; memory requirements). For sampling_type=&quot;SS&quot;, the features dropped in</span></span>
<span id="cb20-41"><a href="css.html#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each complementary pair of subsamples are identical in order to ensure that</span></span>
<span id="cb20-42"><a href="css.html#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the theoretical guarantees of Faletto and Bien (2022) are retained within</span></span>
<span id="cb20-43"><a href="css.html#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each individual pair of subsamples. (Note that this feature is not</span></span>
<span id="cb20-44"><a href="css.html#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; investigated either theoretically or in simulations by Faletto and Bien</span></span>
<span id="cb20-45"><a href="css.html#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 2022). Must be between 0 and 1. Default is 0.</span></span>
<span id="cb20-46"><a href="css.html#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param train_inds Optional; an integer or numeric vector containing the</span></span>
<span id="cb20-47"><a href="css.html#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of observations in X and y to set aside for model training by the</span></span>
<span id="cb20-48"><a href="css.html#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function getCssPreds after feature selection. (This will only work if y is</span></span>
<span id="cb20-49"><a href="css.html#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; real-valued, because getCssPreds using ordinary least squares regression to</span></span>
<span id="cb20-50"><a href="css.html#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate predictions.) If train_inds is not provided, all of the observations</span></span>
<span id="cb20-51"><a href="css.html#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the provided data set will be used for feature selection.</span></span>
<span id="cb20-52"><a href="css.html#cb20-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param num_cores Optional; an integer. If using parallel processing, the</span></span>
<span id="cb20-53"><a href="css.html#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of cores to use for parallel processing (num_cores will be supplied</span></span>
<span id="cb20-54"><a href="css.html#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; internally as the mc.cores argument of parallel::mclapply).</span></span>
<span id="cb20-55"><a href="css.html#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{feat_names}{A </span></span>
<span id="cb20-56"><a href="css.html#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; character vector containing the column names of X (if the provided X</span></span>
<span id="cb20-57"><a href="css.html#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; had column names). If the provided X did not have column names, feat_names</span></span>
<span id="cb20-58"><a href="css.html#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be NA.} \item{X}{The provided X, converted to a matrix if it was</span></span>
<span id="cb20-59"><a href="css.html#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; originally provided as a data.frame, and with feature names removed if they</span></span>
<span id="cb20-60"><a href="css.html#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; had been provided.}\item{clusters}{A list of integer vectors; each vector</span></span>
<span id="cb20-61"><a href="css.html#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will contain the indices of a cluster of features. Any duplicated clusters</span></span>
<span id="cb20-62"><a href="css.html#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided in the input will be removed.}</span></span>
<span id="cb20-63"><a href="css.html#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb20-64"><a href="css.html#cb20-64" aria-hidden="true" tabindex="-1"></a><span id='checkCssInputs'>checkCssInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda, clusters, fitfun, sampling_type, B,</span>
<span id="cb20-65"><a href="css.html#cb20-65" aria-hidden="true" tabindex="-1"></a>    prop_feats_remove, train_inds, num_cores){</span>
<span id="cb20-66"><a href="css.html#cb20-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-67"><a href="css.html#cb20-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X) <span class="sc">|</span> <span class="fu">is.data.frame</span>(X))</span>
<span id="cb20-68"><a href="css.html#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="css.html#cb20-69" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb20-70"><a href="css.html#cb20-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">is.list</span>(clusters)){</span>
<span id="cb20-71"><a href="css.html#cb20-71" aria-hidden="true" tabindex="-1"></a>        clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb20-72"><a href="css.html#cb20-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-73"><a href="css.html#cb20-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-74"><a href="css.html#cb20-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb20-75"><a href="css.html#cb20-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(X)){</span>
<span id="cb20-76"><a href="css.html#cb20-76" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb20-77"><a href="css.html#cb20-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-78"><a href="css.html#cb20-78" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X)</span>
<span id="cb20-79"><a href="css.html#cb20-79" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> X[, <span class="fu">colnames</span>(X) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb20-80"><a href="css.html#cb20-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-81"><a href="css.html#cb20-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> (p <span class="sc">!=</span> <span class="fu">ncol</span>(X))){</span>
<span id="cb20-82"><a href="css.html#cb20-82" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;When stats::model.matrix converted the provided data.frame X to a matrix, the number of columns changed (probably because the provided data.frame contained a factor variable with at least three levels). Please convert X to a matrix yourself using model.matrix and provide cluster assignments according to the columns of the new matrix.&quot;</span>)</span>
<span id="cb20-83"><a href="css.html#cb20-83" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb20-84"><a href="css.html#cb20-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-85"><a href="css.html#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="css.html#cb20-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb20-87"><a href="css.html#cb20-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X)))</span>
<span id="cb20-88"><a href="css.html#cb20-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-89"><a href="css.html#cb20-89" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb20-90"><a href="css.html#cb20-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(X))){</span>
<span id="cb20-91"><a href="css.html#cb20-91" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb20-92"><a href="css.html#cb20-92" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-93"><a href="css.html#cb20-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-94"><a href="css.html#cb20-94" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb20-95"><a href="css.html#cb20-95" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb20-96"><a href="css.html#cb20-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-97"><a href="css.html#cb20-97" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(X))){</span>
<span id="cb20-98"><a href="css.html#cb20-98" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(X)</span>
<span id="cb20-99"><a href="css.html#cb20-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-100"><a href="css.html#cb20-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-101"><a href="css.html#cb20-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb20-102"><a href="css.html#cb20-102" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(feat_names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb20-103"><a href="css.html#cb20-103" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(feat_names) <span class="sc">==</span> p)</span>
<span id="cb20-104"><a href="css.html#cb20-104" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb20-105"><a href="css.html#cb20-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.na</span>(feat_names))</span>
<span id="cb20-106"><a href="css.html#cb20-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-107"><a href="css.html#cb20-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-108"><a href="css.html#cb20-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb20-109"><a href="css.html#cb20-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-110"><a href="css.html#cb20-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb20-111"><a href="css.html#cb20-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb20-112"><a href="css.html#cb20-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb20-113"><a href="css.html#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="css.html#cb20-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check clusters argument</span></span>
<span id="cb20-115"><a href="css.html#cb20-115" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(clusters)</span>
<span id="cb20-116"><a href="css.html#cb20-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-117"><a href="css.html#cb20-117" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Format clusters into a list where all features are in exactly one</span></span>
<span id="cb20-118"><a href="css.html#cb20-118" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster (any unclustered features are put in their own &quot;cluster&quot; of size</span></span>
<span id="cb20-119"><a href="css.html#cb20-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1).</span></span>
<span id="cb20-120"><a href="css.html#cb20-120" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(clusters, <span class="at">p=</span>p, <span class="at">clust_names=</span>clust_names)<span class="sc">$</span>clusters</span>
<span id="cb20-121"><a href="css.html#cb20-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-122"><a href="css.html#cb20-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(fitfun) <span class="sc">==</span> <span class="st">&quot;function&quot;</span>)</span>
<span id="cb20-123"><a href="css.html#cb20-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(fitfun) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb20-124"><a href="css.html#cb20-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">identical</span>(<span class="fu">formals</span>(fitfun), <span class="fu">formals</span>(cssLasso))){</span>
<span id="cb20-125"><a href="css.html#cb20-125" aria-hidden="true" tabindex="-1"></a>        err_mess <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;fitfun must accept arguments named X, y, and lambda. Detected arguments to fitfun:&quot;</span>,</span>
<span id="cb20-126"><a href="css.html#cb20-126" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="fu">names</span>(<span class="fu">formals</span>(fitfun)), <span class="at">collapse=</span><span class="st">&quot;, &quot;</span>))</span>
<span id="cb20-127"><a href="css.html#cb20-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(err_mess)</span>
<span id="cb20-128"><a href="css.html#cb20-128" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-129"><a href="css.html#cb20-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-130"><a href="css.html#cb20-130" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkSamplingType'>checkSamplingType</a>(sampling_type)</span>
<span id="cb20-131"><a href="css.html#cb20-131" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkB'>checkB</a>(B)</span>
<span id="cb20-132"><a href="css.html#cb20-132" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(prop_feats_remove, p)</span>
<span id="cb20-133"><a href="css.html#cb20-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-134"><a href="css.html#cb20-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(train_inds) <span class="sc">|</span> <span class="fu">is.integer</span>(train_inds))</span>
<span id="cb20-135"><a href="css.html#cb20-135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(train_inds) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb20-136"><a href="css.html#cb20-136" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(train_inds)))</span>
<span id="cb20-137"><a href="css.html#cb20-137" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">round</span>(train_inds) <span class="sc">==</span> train_inds))</span>
<span id="cb20-138"><a href="css.html#cb20-138" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(train_inds)))</span>
<span id="cb20-139"><a href="css.html#cb20-139" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(train_inds <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb20-140"><a href="css.html#cb20-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(train_inds) <span class="sc">&lt;=</span> n)</span>
<span id="cb20-141"><a href="css.html#cb20-141" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">&lt;=</span> n <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb20-142"><a href="css.html#cb20-142" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(train_inds) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb20-143"><a href="css.html#cb20-143" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-144"><a href="css.html#cb20-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-145"><a href="css.html#cb20-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(num_cores) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb20-146"><a href="css.html#cb20-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(num_cores) <span class="sc">|</span> <span class="fu">is.numeric</span>(num_cores))</span>
<span id="cb20-147"><a href="css.html#cb20-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(num_cores))</span>
<span id="cb20-148"><a href="css.html#cb20-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">==</span> <span class="fu">round</span>(num_cores))</span>
<span id="cb20-149"><a href="css.html#cb20-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb20-150"><a href="css.html#cb20-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(num_cores <span class="sc">&lt;=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb20-151"><a href="css.html#cb20-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-152"><a href="css.html#cb20-152" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">feat_names=</span>feat_names, <span class="at">X=</span>X, <span class="at">clusters=</span>clusters))</span>
<span id="cb20-153"><a href="css.html#cb20-153" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkCssClustersInput:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="css.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that clusters input to css is as expected</span></span>
<span id="cb21-2"><a href="css.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb21-3"><a href="css.html#cb21-3" aria-hidden="true" tabindex="-1"></a><a href='css.html#param-clusters'>&lt;&lt;param-clusters&gt;&gt;</a></span>
<span id="cb21-4"><a href="css.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Same as the input, but all of the clusters will be coerced to</span></span>
<span id="cb21-5"><a href="css.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; integers.</span></span>
<span id="cb21-6"><a href="css.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb21-7"><a href="css.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span id='checkCssClustersInput'>checkCssClustersInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters){</span>
<span id="cb21-8"><a href="css.html#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters))</span>
<span id="cb21-9"><a href="css.html#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb21-10"><a href="css.html#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb21-11"><a href="css.html#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb21-12"><a href="css.html#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="css.html#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb21-14"><a href="css.html#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb21-15"><a href="css.html#cb21-15" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb21-16"><a href="css.html#cb21-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb21-17"><a href="css.html#cb21-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]) <span class="sc">|</span> <span class="fu">is.numeric</span>(clusters[[i]]))</span>
<span id="cb21-18"><a href="css.html#cb21-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">==</span> <span class="fu">round</span>(clusters[[i]])))</span>
<span id="cb21-19"><a href="css.html#cb21-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb21-20"><a href="css.html#cb21-20" aria-hidden="true" tabindex="-1"></a>                clusters[[i]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(clusters[[i]])</span>
<span id="cb21-21"><a href="css.html#cb21-21" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-22"><a href="css.html#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="css.html#cb21-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb21-24"><a href="css.html#cb21-24" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb21-25"><a href="css.html#cb21-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb21-26"><a href="css.html#cb21-26" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb21-27"><a href="css.html#cb21-27" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]], clusters[[j]])) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb21-28"><a href="css.html#cb21-28" aria-hidden="true" tabindex="-1"></a>                            error_mes <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: &quot;</span>,</span>
<span id="cb21-29"><a href="css.html#cb21-29" aria-hidden="true" tabindex="-1"></a>                                i, <span class="st">&quot;, &quot;</span>, j, <span class="st">&quot;.&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb21-30"><a href="css.html#cb21-30" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">stop</span>(error_mes)</span>
<span id="cb21-31"><a href="css.html#cb21-31" aria-hidden="true" tabindex="-1"></a>                        }</span>
<span id="cb21-32"><a href="css.html#cb21-32" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb21-33"><a href="css.html#cb21-33" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb21-34"><a href="css.html#cb21-34" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb21-35"><a href="css.html#cb21-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb21-36"><a href="css.html#cb21-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb21-37"><a href="css.html#cb21-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If clusters is not a list, it should be a vector of indices of</span></span>
<span id="cb21-38"><a href="css.html#cb21-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># features that are in the (one) cluster</span></span>
<span id="cb21-39"><a href="css.html#cb21-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(clusters))</span>
<span id="cb21-40"><a href="css.html#cb21-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb21-41"><a href="css.html#cb21-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb21-42"><a href="css.html#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters) <span class="sc">|</span> <span class="fu">is.numeric</span>(clusters))</span>
<span id="cb21-43"><a href="css.html#cb21-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters <span class="sc">==</span> <span class="fu">round</span>(clusters)))</span>
<span id="cb21-44"><a href="css.html#cb21-44" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb21-45"><a href="css.html#cb21-45" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(clusters)</span>
<span id="cb21-46"><a href="css.html#cb21-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb21-47"><a href="css.html#cb21-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clusters)</span>
<span id="cb21-48"><a href="css.html#cb21-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>tests for checkCssClustersInput:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="css.html#cb22-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssClustersInput works&quot;</span>, {</span>
<span id="cb22-2"><a href="css.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-3"><a href="css.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb22-4"><a href="css.html#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb22-5"><a href="css.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>4L, <span class="at">green_cluster=</span>5L<span class="sc">:</span>8L)</span>
<span id="cb22-6"><a href="css.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-7"><a href="css.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(good_clusters)</span>
<span id="cb22-8"><a href="css.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-9"><a href="css.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb22-10"><a href="css.html#cb22-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb22-11"><a href="css.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="fu">length</span>(<span class="fu">names</span>(res)))</span>
<span id="cb22-12"><a href="css.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res))))</span>
<span id="cb22-13"><a href="css.html#cb22-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res))))</span>
<span id="cb22-14"><a href="css.html#cb22-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res))))</span>
<span id="cb22-15"><a href="css.html#cb22-15" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb22-16"><a href="css.html#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb22-17"><a href="css.html#cb22-17" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb22-18"><a href="css.html#cb22-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-19"><a href="css.html#cb22-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb22-20"><a href="css.html#cb22-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb22-21"><a href="css.html#cb22-21" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb22-22"><a href="css.html#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="css.html#cb22-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb22-24"><a href="css.html#cb22-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-25"><a href="css.html#cb22-25" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb22-26"><a href="css.html#cb22-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-27"><a href="css.html#cb22-27" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(unnamed_clusters)</span>
<span id="cb22-28"><a href="css.html#cb22-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-29"><a href="css.html#cb22-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb22-30"><a href="css.html#cb22-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb22-31"><a href="css.html#cb22-31" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb22-32"><a href="css.html#cb22-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb22-33"><a href="css.html#cb22-33" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb22-34"><a href="css.html#cb22-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-35"><a href="css.html#cb22-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb22-36"><a href="css.html#cb22-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb22-37"><a href="css.html#cb22-37" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb22-38"><a href="css.html#cb22-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-39"><a href="css.html#cb22-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)),</span>
<span id="cb22-40"><a href="css.html#cb22-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: 1, 2.&quot;</span>,</span>
<span id="cb22-41"><a href="css.html#cb22-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-42"><a href="css.html#cb22-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-43"><a href="css.html#cb22-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)),</span>
<span id="cb22-44"><a href="css.html#cb22-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb22-45"><a href="css.html#cb22-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-46"><a href="css.html#cb22-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-47"><a href="css.html#cb22-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>))),</span>
<span id="cb22-48"><a href="css.html#cb22-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(clusters) are not all TRUE&quot;</span>,</span>
<span id="cb22-49"><a href="css.html#cb22-49" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-50"><a href="css.html#cb22-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-51"><a href="css.html#cb22-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))),</span>
<span id="cb22-52"><a href="css.html#cb22-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb22-53"><a href="css.html#cb22-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-54"><a href="css.html#cb22-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-55"><a href="css.html#cb22-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb22-56"><a href="css.html#cb22-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb22-57"><a href="css.html#cb22-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-58"><a href="css.html#cb22-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-59"><a href="css.html#cb22-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.6</span>)),</span>
<span id="cb22-60"><a href="css.html#cb22-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters == round(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb22-61"><a href="css.html#cb22-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb22-62"><a href="css.html#cb22-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-63"><a href="css.html#cb22-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb22-64"><a href="css.html#cb22-64" aria-hidden="true" tabindex="-1"></a>  res_sing_clust <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb22-65"><a href="css.html#cb22-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_sing_clust), <span class="dv">4</span>)</span>
<span id="cb22-66"><a href="css.html#cb22-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-67"><a href="css.html#cb22-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-68"><a href="css.html#cb22-68" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p><code><a href='css.html#formatClusters'>formatClusters</a>()</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="css.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Formats clusters in standardized way, optionally estimating cluster</span></span>
<span id="cb24-2"><a href="css.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototypes</span></span>
<span id="cb24-3"><a href="css.html#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb24-4"><a href="css.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters Either an integer vector of a list of integer vectors; each</span></span>
<span id="cb24-5"><a href="css.html#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector should contain the indices of a cluster of features. (If there is only</span></span>
<span id="cb24-6"><a href="css.html#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster, clusters can either be a list of length 1 or simply an integer</span></span>
<span id="cb24-7"><a href="css.html#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector.) If clusters is specified then R is ignored.</span></span>
<span id="cb24-8"><a href="css.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p integer or numeric; the numbe of features in x (should match </span></span>
<span id="cb24-9"><a href="css.html#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ncol(x), if x is provided)</span></span>
<span id="cb24-10"><a href="css.html#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clust_names A character vector of the names of the clusters in</span></span>
<span id="cb24-11"><a href="css.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.</span></span>
<span id="cb24-12"><a href="css.html#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param get_prototypes Logical: if TRUE, will identify prototype from each</span></span>
<span id="cb24-13"><a href="css.html#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster (the feature from each cluster that is most correlated with the</span></span>
<span id="cb24-14"><a href="css.html#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response) for the protolasso. In this case, x and y must be provided.</span></span>
<span id="cb24-15"><a href="css.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix. Only needs to be provided if</span></span>
<span id="cb24-16"><a href="css.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; get_prototypes is TRUE.</span></span>
<span id="cb24-17"><a href="css.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector; only needs to be provided if get_prototypes</span></span>
<span id="cb24-18"><a href="css.html#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is TRUE. Note: in general, the css function does not require y to be a</span></span>
<span id="cb24-19"><a href="css.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector, because the provided fitfun could use a different form of y</span></span>
<span id="cb24-20"><a href="css.html#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (for example, a categorical response variable). However, y must be numeric in</span></span>
<span id="cb24-21"><a href="css.html#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order to provide prototypes because the prototypes are determined using the</span></span>
<span id="cb24-22"><a href="css.html#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between cluster members (columns of x) and y.</span></span>
<span id="cb24-23"><a href="css.html#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param R Numeric p x p matrix; not currently used. Entry ij contains the </span></span>
<span id="cb24-24"><a href="css.html#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;substitutive value&quot; of feature i for feature j (diagonal must consist of</span></span>
<span id="cb24-25"><a href="css.html#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ones, all entries must be between 0 and 1, and matrix must be symmetric)</span></span>
<span id="cb24-26"><a href="css.html#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{clusters}{A named</span></span>
<span id="cb24-27"><a href="css.html#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; list where each entry is an integer vector of indices of features that are in</span></span>
<span id="cb24-28"><a href="css.html#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a common cluster. (The length of list clusters is equal to the number of</span></span>
<span id="cb24-29"><a href="css.html#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.) All identified clusters are non-overlapping. All features appear</span></span>
<span id="cb24-30"><a href="css.html#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in exactly one cluster (any unclustered features will be put in their own</span></span>
<span id="cb24-31"><a href="css.html#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).} \item{multiple}{Logical; TRUE if there is more than</span></span>
<span id="cb24-32"><a href="css.html#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster of size greater than 1, FALSE otherwise.} \item{prototypes}{only</span></span>
<span id="cb24-33"><a href="css.html#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; returned if get_prototypes=TRUE. An integer vector whose length is equal to</span></span>
<span id="cb24-34"><a href="css.html#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the number of clusters. Entry i is the index of the feature belonging to</span></span>
<span id="cb24-35"><a href="css.html#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster i that is most highly correlated with y (that is, the prototype for</span></span>
<span id="cb24-36"><a href="css.html#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cluster, as in the protolasso; see Reid and Tibshirani 2016).}</span></span>
<span id="cb24-37"><a href="css.html#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb24-38"><a href="css.html#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Reid, S., &amp; Tibshirani, R. (2016). Sparse regression and marginal</span></span>
<span id="cb24-39"><a href="css.html#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testing using cluster prototypes. \emph{Biostatistics}, 17(2), 364–376.</span></span>
<span id="cb24-40"><a href="css.html#cb24-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1093/biostatistics/kxv049}.</span></span>
<span id="cb24-41"><a href="css.html#cb24-41" aria-hidden="true" tabindex="-1"></a><span id='formatClusters'>formatClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">clusters=</span><span class="cn">NA</span>, <span class="at">p=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">clust_names=</span><span class="cn">NA</span>, </span>
<span id="cb24-42"><a href="css.html#cb24-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>){</span>
<span id="cb24-43"><a href="css.html#cb24-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-44"><a href="css.html#cb24-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb24-45"><a href="css.html#cb24-45" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(clusters, p, clust_names,</span>
<span id="cb24-46"><a href="css.html#cb24-46" aria-hidden="true" tabindex="-1"></a>        get_prototypes, x, y, R)</span>
<span id="cb24-47"><a href="css.html#cb24-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-48"><a href="css.html#cb24-48" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb24-49"><a href="css.html#cb24-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-50"><a href="css.html#cb24-50" aria-hidden="true" tabindex="-1"></a>    multiple <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb24-51"><a href="css.html#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="css.html#cb24-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;</span> <span class="dv">1</span>)){ <span class="co"># &amp; length(clusters) &gt; 1</span></span>
<span id="cb24-53"><a href="css.html#cb24-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Only care about clusters with more than one element (only ones that</span></span>
<span id="cb24-54"><a href="css.html#cb24-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># need to be treated differently)</span></span>
<span id="cb24-55"><a href="css.html#cb24-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># keep track of whether there&#39;s more than one cluster or not</span></span>
<span id="cb24-56"><a href="css.html#cb24-56" aria-hidden="true" tabindex="-1"></a>        multiple <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">&gt;</span> <span class="dv">1</span></span>
<span id="cb24-57"><a href="css.html#cb24-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-58"><a href="css.html#cb24-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-59"><a href="css.html#cb24-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For any features not already in a cluster, add a cluster containing only</span></span>
<span id="cb24-60"><a href="css.html#cb24-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># that feature</span></span>
<span id="cb24-61"><a href="css.html#cb24-61" aria-hidden="true" tabindex="-1"></a>    orig_length_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb24-62"><a href="css.html#cb24-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-63"><a href="css.html#cb24-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb24-64"><a href="css.html#cb24-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb24-65"><a href="css.html#cb24-65" aria-hidden="true" tabindex="-1"></a>        feat_i_found <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb24-66"><a href="css.html#cb24-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(orig_length_clusters <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb24-67"><a href="css.html#cb24-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>orig_length_clusters){</span>
<span id="cb24-68"><a href="css.html#cb24-68" aria-hidden="true" tabindex="-1"></a>                <span class="co"># If i is in cluster j, break out of this loop and consider the</span></span>
<span id="cb24-69"><a href="css.html#cb24-69" aria-hidden="true" tabindex="-1"></a>                <span class="co"># next i</span></span>
<span id="cb24-70"><a href="css.html#cb24-70" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(i <span class="sc">%in%</span> clusters[[j]]){</span>
<span id="cb24-71"><a href="css.html#cb24-71" aria-hidden="true" tabindex="-1"></a>                    feat_i_found <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb24-72"><a href="css.html#cb24-72" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb24-73"><a href="css.html#cb24-73" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb24-74"><a href="css.html#cb24-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-75"><a href="css.html#cb24-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-76"><a href="css.html#cb24-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-77"><a href="css.html#cb24-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If feature i wasn&#39;t found in any cluster, add a cluster containing</span></span>
<span id="cb24-78"><a href="css.html#cb24-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># just feature i</span></span>
<span id="cb24-79"><a href="css.html#cb24-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span>feat_i_found){</span>
<span id="cb24-80"><a href="css.html#cb24-80" aria-hidden="true" tabindex="-1"></a>            clusters[[<span class="fu">length</span>(clusters) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> i</span>
<span id="cb24-81"><a href="css.html#cb24-81" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-82"><a href="css.html#cb24-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-83"><a href="css.html#cb24-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-84"><a href="css.html#cb24-84" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb24-85"><a href="css.html#cb24-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-86"><a href="css.html#cb24-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add names to clusters</span></span>
<span id="cb24-87"><a href="css.html#cb24-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(<span class="fu">names</span>(clusters))){</span>
<span id="cb24-88"><a href="css.html#cb24-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(clusters) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">1</span><span class="sc">:</span>n_clusters, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb24-89"><a href="css.html#cb24-89" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb24-90"><a href="css.html#cb24-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># What clusters need names?</span></span>
<span id="cb24-91"><a href="css.html#cb24-91" aria-hidden="true" tabindex="-1"></a>        unnamed_clusts <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(<span class="fu">names</span>(clusters)) <span class="sc">|</span> <span class="fu">names</span>(clusters) <span class="sc">==</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb24-92"><a href="css.html#cb24-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(unnamed_clusts) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb24-93"><a href="css.html#cb24-93" aria-hidden="true" tabindex="-1"></a>            proposed_clust_names <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>, unnamed_clusts, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb24-94"><a href="css.html#cb24-94" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Replace any proposed cluster names that are already in use</span></span>
<span id="cb24-95"><a href="css.html#cb24-95" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters))){</span>
<span id="cb24-96"><a href="css.html#cb24-96" aria-hidden="true" tabindex="-1"></a>                proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c&quot;</span>,</span>
<span id="cb24-97"><a href="css.html#cb24-97" aria-hidden="true" tabindex="-1"></a>                    unnamed_clusts[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="sc">+</span> p,</span>
<span id="cb24-98"><a href="css.html#cb24-98" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb24-99"><a href="css.html#cb24-99" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-100"><a href="css.html#cb24-100" aria-hidden="true" tabindex="-1"></a>            while_counter <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb24-101"><a href="css.html#cb24-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span>(<span class="fu">any</span>(proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters))){</span>
<span id="cb24-102"><a href="css.html#cb24-102" aria-hidden="true" tabindex="-1"></a>                proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)] <span class="ot">&lt;-</span> <span class="fu">paste</span>(proposed_clust_names[proposed_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)],</span>
<span id="cb24-103"><a href="css.html#cb24-103" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;_1&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb24-104"><a href="css.html#cb24-104" aria-hidden="true" tabindex="-1"></a>                while_counter <span class="ot">&lt;-</span> while_counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-105"><a href="css.html#cb24-105" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span>(while_counter <span class="sc">&gt;=</span> <span class="dv">100</span>){</span>
<span id="cb24-106"><a href="css.html#cb24-106" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">stop</span>(<span class="st">&quot;Function formatClusters stuck in an infinite while loop&quot;</span>)</span>
<span id="cb24-107"><a href="css.html#cb24-107" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb24-108"><a href="css.html#cb24-108" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb24-109"><a href="css.html#cb24-109" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(unnamed_clusts) <span class="sc">==</span> <span class="fu">length</span>(proposed_clust_names))</span>
<span id="cb24-110"><a href="css.html#cb24-110" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(clusters)[unnamed_clusts] <span class="ot">&lt;-</span> proposed_clust_names</span>
<span id="cb24-111"><a href="css.html#cb24-111" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb24-112"><a href="css.html#cb24-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-113"><a href="css.html#cb24-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-114"><a href="css.html#cb24-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb24-115"><a href="css.html#cb24-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-116"><a href="css.html#cb24-116" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkClusters'>checkClusters</a>(clusters, p)</span>
<span id="cb24-117"><a href="css.html#cb24-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(multiple))</span>
<span id="cb24-118"><a href="css.html#cb24-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(multiple) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb24-119"><a href="css.html#cb24-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(multiple))</span>
<span id="cb24-120"><a href="css.html#cb24-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-121"><a href="css.html#cb24-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(get_prototypes){</span>
<span id="cb24-122"><a href="css.html#cb24-122" aria-hidden="true" tabindex="-1"></a>        prototypes <span class="ot">&lt;-</span> <a href='css.html#getPrototypes'>getPrototypes</a>(clusters, x, y)</span>
<span id="cb24-123"><a href="css.html#cb24-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-124"><a href="css.html#cb24-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">clusters=</span>clusters, <span class="at">multiple=</span>multiple,</span>
<span id="cb24-125"><a href="css.html#cb24-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">prototypes=</span>prototypes))</span>
<span id="cb24-126"><a href="css.html#cb24-126" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb24-127"><a href="css.html#cb24-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">clusters=</span>clusters, <span class="at">multiple=</span>multiple))</span>
<span id="cb24-128"><a href="css.html#cb24-128" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-129"><a href="css.html#cb24-129" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>()</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="css.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to ensure that the inputs to formatClusters are as expected</span></span>
<span id="cb25-2"><a href="css.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb25-3"><a href="css.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters Either an integer vector of a list of integer vectors; each</span></span>
<span id="cb25-4"><a href="css.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector should contain the indices of a cluster of features. (If there is only</span></span>
<span id="cb25-5"><a href="css.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; one cluster, clusters can either be a list of length 1 or simply an integer</span></span>
<span id="cb25-6"><a href="css.html#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector.) If clusters is specified then R is ignored.</span></span>
<span id="cb25-7"><a href="css.html#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p integer or numeric; the numbe of features in x (should match </span></span>
<span id="cb25-8"><a href="css.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ncol(x), if x is provided)</span></span>
<span id="cb25-9"><a href="css.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clust_names A character vector of the names of the clusters in clusters.</span></span>
<span id="cb25-10"><a href="css.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param get_prototypes Logical: if TRUE, will identify prototype from each</span></span>
<span id="cb25-11"><a href="css.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster (the feature from each cluster that is most correlated with the</span></span>
<span id="cb25-12"><a href="css.html#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response) for the protolasso. In this case, x and y must be provided.</span></span>
<span id="cb25-13"><a href="css.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix. Only needs to be provided if</span></span>
<span id="cb25-14"><a href="css.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; get_prototypes is TRUE.</span></span>
<span id="cb25-15"><a href="css.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector; only needs to be provided if get_prototypes</span></span>
<span id="cb25-16"><a href="css.html#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is TRUE. Note: in general, the css function does not require y to be a</span></span>
<span id="cb25-17"><a href="css.html#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector, because the provided fitfun could use a different form of y</span></span>
<span id="cb25-18"><a href="css.html#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (for example, a categorical response variable). However, y must be numeric in</span></span>
<span id="cb25-19"><a href="css.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order to provide prototypes because the prototypes are determined using the</span></span>
<span id="cb25-20"><a href="css.html#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between cluster members (columns of x) and y.</span></span>
<span id="cb25-21"><a href="css.html#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param R Numeric p x p matrix; not currently used. Entry ij contains the </span></span>
<span id="cb25-22"><a href="css.html#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;substitutive value&quot; of feature i for feature j (diagonal must consist of</span></span>
<span id="cb25-23"><a href="css.html#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ones, all entries must be between 0 and 1, and matrix must be symmetric)</span></span>
<span id="cb25-24"><a href="css.html#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of integer vectors; each vector will contain the indices of a</span></span>
<span id="cb25-25"><a href="css.html#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster of features. Any duplicated clusters provided in the input will be</span></span>
<span id="cb25-26"><a href="css.html#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; removed.</span></span>
<span id="cb25-27"><a href="css.html#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb25-28"><a href="css.html#cb25-28" aria-hidden="true" tabindex="-1"></a><span id='checkFormatClustersInput'>checkFormatClustersInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, p, clust_names, </span>
<span id="cb25-29"><a href="css.html#cb25-29" aria-hidden="true" tabindex="-1"></a>    get_prototypes, x, y, R){</span>
<span id="cb25-30"><a href="css.html#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="css.html#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">any</span>(<span class="fu">is.na</span>(R))){</span>
<span id="cb25-32"><a href="css.html#cb25-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>)</span>
<span id="cb25-33"><a href="css.html#cb25-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-34"><a href="css.html#cb25-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-35"><a href="css.html#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(p) <span class="sc">|</span> <span class="fu">is.numeric</span>(p))</span>
<span id="cb25-36"><a href="css.html#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(p) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb25-37"><a href="css.html#cb25-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">==</span> <span class="fu">round</span>(p))</span>
<span id="cb25-38"><a href="css.html#cb25-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(p))</span>
<span id="cb25-39"><a href="css.html#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb25-40"><a href="css.html#cb25-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb25-41"><a href="css.html#cb25-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-42"><a href="css.html#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="css.html#cb25-43" aria-hidden="true" tabindex="-1"></a>    use_R <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb25-44"><a href="css.html#cb25-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(clusters)) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb25-45"><a href="css.html#cb25-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(R))){</span>
<span id="cb25-46"><a href="css.html#cb25-46" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(R))</span>
<span id="cb25-47"><a href="css.html#cb25-47" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">dim</span>(R) <span class="sc">==</span> p))</span>
<span id="cb25-48"><a href="css.html#cb25-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">diag</span>(R) <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb25-49"><a href="css.html#cb25-49" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">identical</span>(R, <span class="fu">t</span>(R)))</span>
<span id="cb25-50"><a href="css.html#cb25-50" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(R)))</span>
<span id="cb25-51"><a href="css.html#cb25-51" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(R <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb25-52"><a href="css.html#cb25-52" aria-hidden="true" tabindex="-1"></a>            use_R <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb25-53"><a href="css.html#cb25-53" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-54"><a href="css.html#cb25-54" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb25-55"><a href="css.html#cb25-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb25-56"><a href="css.html#cb25-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb25-57"><a href="css.html#cb25-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb25-58"><a href="css.html#cb25-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-59"><a href="css.html#cb25-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters) <span class="sc">&amp;</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb25-60"><a href="css.html#cb25-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb25-61"><a href="css.html#cb25-61" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb25-62"><a href="css.html#cb25-62" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb25-63"><a href="css.html#cb25-63" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">all</span>(clusters[[i]] <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb25-64"><a href="css.html#cb25-64" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb25-65"><a href="css.html#cb25-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-66"><a href="css.html#cb25-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-67"><a href="css.html#cb25-67" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb25-68"><a href="css.html#cb25-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-69"><a href="css.html#cb25-69" aria-hidden="true" tabindex="-1"></a>            clusters <span class="ot">&lt;-</span> clusters[<span class="sc">!</span><span class="fu">duplicated</span>(clusters)]</span>
<span id="cb25-70"><a href="css.html#cb25-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-71"><a href="css.html#cb25-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb25-72"><a href="css.html#cb25-72" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb25-73"><a href="css.html#cb25-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb25-74"><a href="css.html#cb25-74" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb25-75"><a href="css.html#cb25-75" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]],</span>
<span id="cb25-76"><a href="css.html#cb25-76" aria-hidden="true" tabindex="-1"></a>                            clusters[[j]])) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb25-77"><a href="css.html#cb25-77" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb25-78"><a href="css.html#cb25-78" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb25-79"><a href="css.html#cb25-79" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-80"><a href="css.html#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="css.html#cb25-81" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(clust_names))){</span>
<span id="cb25-82"><a href="css.html#cb25-82" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stopifnot</span>(<span class="fu">length</span>(clust_names) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb25-83"><a href="css.html#cb25-83" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-84"><a href="css.html#cb25-84" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters)){</span>
<span id="cb25-85"><a href="css.html#cb25-85" aria-hidden="true" tabindex="-1"></a>            clusters_temp <span class="ot">&lt;-</span> clusters</span>
<span id="cb25-86"><a href="css.html#cb25-86" aria-hidden="true" tabindex="-1"></a>            clusters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-87"><a href="css.html#cb25-87" aria-hidden="true" tabindex="-1"></a>            clusters[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> clusters_temp</span>
<span id="cb25-88"><a href="css.html#cb25-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rm</span>(clusters_temp)</span>
<span id="cb25-89"><a href="css.html#cb25-89" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-90"><a href="css.html#cb25-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-91"><a href="css.html#cb25-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-92"><a href="css.html#cb25-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(get_prototypes) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb25-93"><a href="css.html#cb25-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(get_prototypes))</span>
<span id="cb25-94"><a href="css.html#cb25-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-95"><a href="css.html#cb25-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(clust_names))){</span>
<span id="cb25-96"><a href="css.html#cb25-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(clust_names))</span>
<span id="cb25-97"><a href="css.html#cb25-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-98"><a href="css.html#cb25-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-99"><a href="css.html#cb25-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(get_prototypes){</span>
<span id="cb25-100"><a href="css.html#cb25-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb25-101"><a href="css.html#cb25-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb25-102"><a href="css.html#cb25-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-103"><a href="css.html#cb25-103" aria-hidden="true" tabindex="-1"></a>        n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb25-104"><a href="css.html#cb25-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-105"><a href="css.html#cb25-105" aria-hidden="true" tabindex="-1"></a>        <a href='css.html#checkY'>checkY</a>(y, n)</span>
<span id="cb25-106"><a href="css.html#cb25-106" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-107"><a href="css.html#cb25-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-108"><a href="css.html#cb25-108" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(use_R){</span>
<span id="cb25-109"><a href="css.html#cb25-109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine clusters from R</span></span>
<span id="cb25-110"><a href="css.html#cb25-110" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-111"><a href="css.html#cb25-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-112"><a href="css.html#cb25-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(R)){</span>
<span id="cb25-113"><a href="css.html#cb25-113" aria-hidden="true" tabindex="-1"></a>            clusters[[i]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">which</span>(R[i, ] <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb25-114"><a href="css.html#cb25-114" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[i]]) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters[[i]])))</span>
<span id="cb25-115"><a href="css.html#cb25-115" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters[[i]])))</span>
<span id="cb25-116"><a href="css.html#cb25-116" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb25-117"><a href="css.html#cb25-117" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-118"><a href="css.html#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="css.html#cb25-119" aria-hidden="true" tabindex="-1"></a>        clusters <span class="ot">&lt;-</span> <span class="fu">unique</span>(clusters)</span>
<span id="cb25-120"><a href="css.html#cb25-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb25-121"><a href="css.html#cb25-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-122"><a href="css.html#cb25-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb25-123"><a href="css.html#cb25-123" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check that clusters are non-overlapping</span></span>
<span id="cb25-124"><a href="css.html#cb25-124" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(clusters) <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb25-125"><a href="css.html#cb25-125" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span>(j <span class="cf">in</span> (i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb25-126"><a href="css.html#cb25-126" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clusters[[i]], clusters[[j]])) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb25-127"><a href="css.html#cb25-127" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">stop</span>(<span class="st">&quot;Invalid R matrix with overlapping clusters (clusters must not be overlapping)&quot;</span>)</span>
<span id="cb25-128"><a href="css.html#cb25-128" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb25-129"><a href="css.html#cb25-129" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb25-130"><a href="css.html#cb25-130" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-131"><a href="css.html#cb25-131" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-132"><a href="css.html#cb25-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-133"><a href="css.html#cb25-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-134"><a href="css.html#cb25-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb25-135"><a href="css.html#cb25-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-136"><a href="css.html#cb25-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(clusters)</span>
<span id="cb25-137"><a href="css.html#cb25-137" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='css.html#checkY'>checkY</a>()</code>:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="css.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument y to several functions is</span></span>
<span id="cb26-2"><a href="css.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as expected</span></span>
<span id="cb26-3"><a href="css.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb26-4"><a href="css.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector.</span></span>
<span id="cb26-5"><a href="css.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Number of observations of covariates; should match length of y.</span></span>
<span id="cb26-6"><a href="css.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb26-7"><a href="css.html#cb26-7" aria-hidden="true" tabindex="-1"></a><span id='checkY'>checkY</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(y, n){</span>
<span id="cb26-8"><a href="css.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(y)))</span>
<span id="cb26-9"><a href="css.html#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb26-10"><a href="css.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb26-11"><a href="css.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb26-12"><a href="css.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(n))</span>
<span id="cb26-13"><a href="css.html#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n) <span class="sc">|</span> <span class="fu">is.integer</span>(n))</span>
<span id="cb26-14"><a href="css.html#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">round</span>(n))</span>
<span id="cb26-15"><a href="css.html#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb26-16"><a href="css.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb26-17"><a href="css.html#cb26-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkY'>checkY</a>()</code>:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="css.html#cb27-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkY works&quot;</span>, {</span>
<span id="cb27-2"><a href="css.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkY'>checkY</a>(<span class="fu">as.numeric</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)<span class="sc">*</span>.<span class="dv">1</span>, <span class="dv">20</span>))</span>
<span id="cb27-3"><a href="css.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkY'>checkY</a>(1L<span class="sc">:</span>15L, <span class="dv">15</span>))</span>
<span id="cb27-4"><a href="css.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkY'>checkY</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">8</span>), <span class="st">&quot;n == length(y) is not TRUE&quot;</span>,</span>
<span id="cb27-5"><a href="css.html#cb27-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-6"><a href="css.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkY'>checkY</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="sc">-</span><span class="dv">7</span>), <span class="st">&quot;n &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-7"><a href="css.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkY'>checkY</a>(<span class="fu">rep</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="dv">13</span>), <span class="dv">13</span>),</span>
<span id="cb27-8"><a href="css.html#cb27-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(y)) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-9"><a href="css.html#cb27-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkY'>checkY</a>(<span class="fu">rep</span>(<span class="fl">5.2</span>, <span class="dv">9</span>), <span class="dv">9</span>),</span>
<span id="cb27-10"><a href="css.html#cb27-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(unique(y)) &gt; 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-11"><a href="css.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkY'>checkY</a>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>), <span class="dv">3</span>),</span>
<span id="cb27-12"><a href="css.html#cb27-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb27-13"><a href="css.html#cb27-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb27-14"><a href="css.html#cb27-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>Tests for <code><a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>()</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="css.html#cb29-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkFormatClustersInput works&quot;</span>, {</span>
<span id="cb29-2"><a href="css.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-3"><a href="css.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb29-4"><a href="css.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb29-5"><a href="css.html#cb29-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>4L, <span class="at">green_cluster=</span>5L<span class="sc">:</span>8L)</span>
<span id="cb29-6"><a href="css.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="css.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(good_clusters, <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-8"><a href="css.html#cb29-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">clust_names=</span><span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>),</span>
<span id="cb29-9"><a href="css.html#cb29-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)</span>
<span id="cb29-10"><a href="css.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-11"><a href="css.html#cb29-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb29-12"><a href="css.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb29-13"><a href="css.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb29-14"><a href="css.html#cb29-14" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb29-15"><a href="css.html#cb29-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-16"><a href="css.html#cb29-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb29-17"><a href="css.html#cb29-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb29-18"><a href="css.html#cb29-18" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb29-19"><a href="css.html#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="css.html#cb29-20" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb29-21"><a href="css.html#cb29-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-22"><a href="css.html#cb29-22" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb29-23"><a href="css.html#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="css.html#cb29-24" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(unnamed_clusters, <span class="at">p=</span><span class="dv">10</span>, <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-25"><a href="css.html#cb29-25" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)</span>
<span id="cb29-26"><a href="css.html#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="css.html#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb29-28"><a href="css.html#cb29-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb29-29"><a href="css.html#cb29-29" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb29-30"><a href="css.html#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res)){</span>
<span id="cb29-31"><a href="css.html#cb29-31" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res[[i]])</span>
<span id="cb29-32"><a href="css.html#cb29-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-33"><a href="css.html#cb29-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb29-34"><a href="css.html#cb29-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb29-35"><a href="css.html#cb29-35" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)))</span>
<span id="cb29-36"><a href="css.html#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="css.html#cb29-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-38"><a href="css.html#cb29-38" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-39"><a href="css.html#cb29-39" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-40"><a href="css.html#cb29-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-41"><a href="css.html#cb29-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(intersect(clusters[[i]], clusters[[j]])) == 0 is not TRUE&quot;</span>,</span>
<span id="cb29-42"><a href="css.html#cb29-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-43"><a href="css.html#cb29-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-44"><a href="css.html#cb29-44" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">clust_names=</span><span class="cn">NA</span>, <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-45"><a href="css.html#cb29-45" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-46"><a href="css.html#cb29-46" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb29-47"><a href="css.html#cb29-47" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-48"><a href="css.html#cb29-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-49"><a href="css.html#cb29-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>)),</span>
<span id="cb29-50"><a href="css.html#cb29-50" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-51"><a href="css.html#cb29-51" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-52"><a href="css.html#cb29-52" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-53"><a href="css.html#cb29-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-54"><a href="css.html#cb29-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>,</span>
<span id="cb29-55"><a href="css.html#cb29-55" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-56"><a href="css.html#cb29-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-57"><a href="css.html#cb29-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>)),</span>
<span id="cb29-58"><a href="css.html#cb29-58" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-59"><a href="css.html#cb29-59" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-60"><a href="css.html#cb29-60" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-61"><a href="css.html#cb29-61" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-62"><a href="css.html#cb29-62" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb29-63"><a href="css.html#cb29-63" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-64"><a href="css.html#cb29-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-65"><a href="css.html#cb29-65" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb29-66"><a href="css.html#cb29-66" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-67"><a href="css.html#cb29-67" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-68"><a href="css.html#cb29-68" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-69"><a href="css.html#cb29-69" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-70"><a href="css.html#cb29-70" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb29-71"><a href="css.html#cb29-71" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-72"><a href="css.html#cb29-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb29-73"><a href="css.html#cb29-73" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>)),</span>
<span id="cb29-74"><a href="css.html#cb29-74" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-75"><a href="css.html#cb29-75" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-76"><a href="css.html#cb29-76" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">get_prototypes=</span><span class="cn">FALSE</span>, <span class="at">x=</span><span class="cn">NA</span>,</span>
<span id="cb29-77"><a href="css.html#cb29-77" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>),</span>
<span id="cb29-78"><a href="css.html#cb29-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.integer(clusters[[i]]) is not TRUE&quot;</span>,</span>
<span id="cb29-79"><a href="css.html#cb29-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb29-80"><a href="css.html#cb29-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-81"><a href="css.html#cb29-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb29-82"><a href="css.html#cb29-82" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='css.html#checkFormatClustersInput'>checkFormatClustersInput</a>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span><span class="dv">10</span>,</span>
<span id="cb29-83"><a href="css.html#cb29-83" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">clust_names=</span><span class="cn">NA</span>,</span>
<span id="cb29-84"><a href="css.html#cb29-84" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">get_prototypes=</span><span class="cn">FALSE</span>,</span>
<span id="cb29-85"><a href="css.html#cb29-85" aria-hidden="true" tabindex="-1"></a>                                                          <span class="at">x=</span><span class="cn">NA</span>, <span class="at">y=</span><span class="cn">NA</span>, <span class="at">R=</span><span class="cn">NA</span>)))</span>
<span id="cb29-86"><a href="css.html#cb29-86" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🌈</code></pre>
<p><code><a href='css.html#checkClusters'>checkClusters</a>()</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="css.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument clusters to several functions is</span></span>
<span id="cb31-2"><a href="css.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as expected</span></span>
<span id="cb31-3"><a href="css.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb31-4"><a href="css.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb31-5"><a href="css.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of css or</span></span>
<span id="cb31-6"><a href="css.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formatClusters. (The length of list clusters is equal to the number of</span></span>
<span id="cb31-7"><a href="css.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.) All identified clusters must be non-overlapping, and all features</span></span>
<span id="cb31-8"><a href="css.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; must appear in exactly one cluster (any unclustered features should be in</span></span>
<span id="cb31-9"><a href="css.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; their own &quot;cluster&quot; of size 1).</span></span>
<span id="cb31-10"><a href="css.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; must be at least as large as the number of</span></span>
<span id="cb31-11"><a href="css.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.</span></span>
<span id="cb31-12"><a href="css.html#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb31-13"><a href="css.html#cb31-13" aria-hidden="true" tabindex="-1"></a><span id='checkClusters'>checkClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, p){</span>
<span id="cb31-14"><a href="css.html#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters))</span>
<span id="cb31-15"><a href="css.html#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb31-16"><a href="css.html#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(clusters)))</span>
<span id="cb31-17"><a href="css.html#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="css.html#cb31-18" aria-hidden="true" tabindex="-1"></a>    n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(clusters)</span>
<span id="cb31-19"><a href="css.html#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="css.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(clusters)))</span>
<span id="cb31-21"><a href="css.html#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&lt;=</span> p)</span>
<span id="cb31-22"><a href="css.html#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)))</span>
<span id="cb31-23"><a href="css.html#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(<span class="fu">names</span>(clusters)))</span>
<span id="cb31-24"><a href="css.html#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">names</span>(clusters) <span class="sc">!=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb31-25"><a href="css.html#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(clusters))) <span class="sc">==</span> n_clusters)</span>
<span id="cb31-26"><a href="css.html#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="css.html#cb31-27" aria-hidden="true" tabindex="-1"></a>    all_clustered_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb31-28"><a href="css.html#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb31-29"><a href="css.html#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(clusters[[i]]))</span>
<span id="cb31-30"><a href="css.html#cb31-30" aria-hidden="true" tabindex="-1"></a>        all_clustered_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(all_clustered_feats, clusters[[i]])</span>
<span id="cb31-31"><a href="css.html#cb31-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-32"><a href="css.html#cb31-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-33"><a href="css.html#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(all_clustered_feats) <span class="sc">==</span> p)</span>
<span id="cb31-34"><a href="css.html#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(all_clustered_feats)) <span class="sc">==</span> p)</span>
<span id="cb31-35"><a href="css.html#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(all_clustered_feats <span class="sc">&lt;=</span> p))</span>
<span id="cb31-36"><a href="css.html#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(all_clustered_feats <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb31-37"><a href="css.html#cb31-37" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkClusters'>checkClusters</a>()</code>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="css.html#cb32-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkClusters works&quot;</span>, {</span>
<span id="cb32-2"><a href="css.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L)</span>
<span id="cb32-3"><a href="css.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-4"><a href="css.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkClusters'>checkClusters</a>(good_clusters, <span class="dv">9</span>))</span>
<span id="cb32-5"><a href="css.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(good_clusters, <span class="dv">10</span>),</span>
<span id="cb32-6"><a href="css.html#cb32-6" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb32-7"><a href="css.html#cb32-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-8"><a href="css.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(1L<span class="sc">:</span>10L, <span class="dv">10</span>),</span>
<span id="cb32-9"><a href="css.html#cb32-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(clusters) is not TRUE&quot;</span>,</span>
<span id="cb32-10"><a href="css.html#cb32-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-11"><a href="css.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb32-12"><a href="css.html#cb32-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">integer</span>()), <span class="dv">9</span>),</span>
<span id="cb32-13"><a href="css.html#cb32-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(clusters) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb32-14"><a href="css.html#cb32-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-15"><a href="css.html#cb32-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb32-16"><a href="css.html#cb32-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="dv">9</span>),</span>
<span id="cb32-17"><a href="css.html#cb32-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb32-18"><a href="css.html#cb32-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-19"><a href="css.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb32-20"><a href="css.html#cb32-20" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L), <span class="dv">9</span>),</span>
<span id="cb32-21"><a href="css.html#cb32-21" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb32-22"><a href="css.html#cb32-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-23"><a href="css.html#cb32-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkClusters'>checkClusters</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L, <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>10L), <span class="dv">9</span>),</span>
<span id="cb32-24"><a href="css.html#cb32-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(all_clustered_feats &lt;= p) is not TRUE&quot;</span>,</span>
<span id="cb32-25"><a href="css.html#cb32-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb32-26"><a href="css.html#cb32-26" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p><code><a href='css.html#getPrototypes'>getPrototypes</a>()</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="css.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Estimate prototypes from a list of clusters</span></span>
<span id="cb34-2"><a href="css.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb34-3"><a href="css.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in list of clusters, x, and y and returns an integer vector (of length</span></span>
<span id="cb34-4"><a href="css.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; equal to the number of clusters) of the indices of the feature prototypes</span></span>
<span id="cb34-5"><a href="css.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (the features from each cluster most correlated with the response).</span></span>
<span id="cb34-6"><a href="css.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb34-7"><a href="css.html#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A list where each entry is an integer vector of indices of</span></span>
<span id="cb34-8"><a href="css.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that are in a common cluster. (The length of list clusters must be</span></span>
<span id="cb34-9"><a href="css.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; equal to the number of clusters.) All identified clusters must be</span></span>
<span id="cb34-10"><a href="css.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; non-overlapping. Must only include clusters of size 2 or larger.</span></span>
<span id="cb34-11"><a href="css.html#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix.</span></span>
<span id="cb34-12"><a href="css.html#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector. Note: in general, the css function does not</span></span>
<span id="cb34-13"><a href="css.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; require y to be a numeric vector, because the provided fitfun could use a</span></span>
<span id="cb34-14"><a href="css.html#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different form of y (for example, a categorical response variable). However,</span></span>
<span id="cb34-15"><a href="css.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y must be numeric in order to provide prototypes because the prototypes are</span></span>
<span id="cb34-16"><a href="css.html#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; determined using the correlation between cluster members (columns of x) and</span></span>
<span id="cb34-17"><a href="css.html#cb34-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y.</span></span>
<span id="cb34-18"><a href="css.html#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector of the same length as clusters. Entry j is the</span></span>
<span id="cb34-19"><a href="css.html#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; index of the feature identified as the prototype for cluster j.</span></span>
<span id="cb34-20"><a href="css.html#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb34-21"><a href="css.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span id='getPrototypes'>getPrototypes</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, x, y){</span>
<span id="cb34-22"><a href="css.html#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb34-23"><a href="css.html#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="css.html#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">all</span>(<span class="fu">lengths</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb34-25"><a href="css.html#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(clusters) <span class="sc">|</span> <span class="fu">length</span>(clusters) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb34-26"><a href="css.html#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="css.html#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb34-28"><a href="css.html#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb34-29"><a href="css.html#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="css.html#cb34-30" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb34-31"><a href="css.html#cb34-31" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb34-32"><a href="css.html#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="css.html#cb34-33" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkY'>checkY</a>(y, n)</span>
<span id="cb34-34"><a href="css.html#cb34-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-35"><a href="css.html#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify prototypes</span></span>
<span id="cb34-36"><a href="css.html#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb34-37"><a href="css.html#cb34-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb34-38"><a href="css.html#cb34-38" aria-hidden="true" tabindex="-1"></a>            prototypes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.integer</span>(<span class="cn">NA</span>), <span class="fu">length</span>(clusters))</span>
<span id="cb34-39"><a href="css.html#cb34-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb34-40"><a href="css.html#cb34-40" aria-hidden="true" tabindex="-1"></a>                prototypes[i] <span class="ot">&lt;-</span> <a href='css.html#identifyPrototype'>identifyPrototype</a>(clusters[[i]], x, y)</span>
<span id="cb34-41"><a href="css.html#cb34-41" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb34-42"><a href="css.html#cb34-42" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb34-43"><a href="css.html#cb34-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># If clusters is not a list, then there is only one cluster.</span></span>
<span id="cb34-44"><a href="css.html#cb34-44" aria-hidden="true" tabindex="-1"></a>            prototypes <span class="ot">&lt;-</span> <a href='css.html#identifyPrototype'>identifyPrototype</a>(clusters, x, y)</span>
<span id="cb34-45"><a href="css.html#cb34-45" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-46"><a href="css.html#cb34-46" aria-hidden="true" tabindex="-1"></a>    }  <span class="cf">else</span>{</span>
<span id="cb34-47"><a href="css.html#cb34-47" aria-hidden="true" tabindex="-1"></a>        prototypes <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb34-48"><a href="css.html#cb34-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-49"><a href="css.html#cb34-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-50"><a href="css.html#cb34-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb34-51"><a href="css.html#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="css.html#cb34-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(prototypes))</span>
<span id="cb34-53"><a href="css.html#cb34-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb34-54"><a href="css.html#cb34-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.list</span>(clusters)){</span>
<span id="cb34-55"><a href="css.html#cb34-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(clusters))</span>
<span id="cb34-56"><a href="css.html#cb34-56" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb34-57"><a href="css.html#cb34-57" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb34-58"><a href="css.html#cb34-58" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb34-59"><a href="css.html#cb34-59" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb34-60"><a href="css.html#cb34-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb34-61"><a href="css.html#cb34-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-62"><a href="css.html#cb34-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-63"><a href="css.html#cb34-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(prototypes)))</span>
<span id="cb34-64"><a href="css.html#cb34-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(prototypes)))</span>
<span id="cb34-65"><a href="css.html#cb34-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-66"><a href="css.html#cb34-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(prototypes)</span>
<span id="cb34-67"><a href="css.html#cb34-67" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='css.html#identifyPrototype'>identifyPrototype</a>()</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="css.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Estimate prototypes from a single cluster</span></span>
<span id="cb35-2"><a href="css.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb35-3"><a href="css.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in a single cluster, x, and y and returns an integer of the index of</span></span>
<span id="cb35-4"><a href="css.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the feature prototype (the feature from the cluster most correlated with the</span></span>
<span id="cb35-5"><a href="css.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response).</span></span>
<span id="cb35-6"><a href="css.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb35-7"><a href="css.html#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_members_i An integer vector of indices of features that are in</span></span>
<span id="cb35-8"><a href="css.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a common cluster. Must have length at least 2.</span></span>
<span id="cb35-9"><a href="css.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x n x p numeric matrix; design matrix.</span></span>
<span id="cb35-10"><a href="css.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y Numeric response vector. Note: in general, the css function does not</span></span>
<span id="cb35-11"><a href="css.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; require y to be a numeric vector, because the provided fitfun could use a</span></span>
<span id="cb35-12"><a href="css.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; different form of y (for example, a categorical response variable). However,</span></span>
<span id="cb35-13"><a href="css.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y must be numeric in order to provide prototypes because the prototypes are</span></span>
<span id="cb35-14"><a href="css.html#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; determined using the correlation between cluster members (columns of x) and</span></span>
<span id="cb35-15"><a href="css.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y.</span></span>
<span id="cb35-16"><a href="css.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return integer; the index of the feature identified as the prototype for</span></span>
<span id="cb35-17"><a href="css.html#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cluster.</span></span>
<span id="cb35-18"><a href="css.html#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb35-19"><a href="css.html#cb35-19" aria-hidden="true" tabindex="-1"></a><span id='identifyPrototype'>identifyPrototype</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(cluster_members_i, x, y){</span>
<span id="cb35-20"><a href="css.html#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input</span></span>
<span id="cb35-21"><a href="css.html#cb35-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(cluster_members_i))</span>
<span id="cb35-22"><a href="css.html#cb35-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If cluster only has one member, that member is the prototype</span></span>
<span id="cb35-23"><a href="css.html#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(cluster_members_i) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb35-24"><a href="css.html#cb35-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(cluster_members_i)</span>
<span id="cb35-25"><a href="css.html#cb35-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-26"><a href="css.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="css.html#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose which cluster member to represent cluster for stability</span></span>
<span id="cb35-28"><a href="css.html#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># metric purposes by choosing the one most highly correlated</span></span>
<span id="cb35-29"><a href="css.html#cb35-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># with y</span></span>
<span id="cb35-30"><a href="css.html#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="css.html#cb35-31" aria-hidden="true" tabindex="-1"></a>    cors_i <span class="ot">&lt;-</span> <span class="fu">apply</span>(x[, cluster_members_i], <span class="dv">2</span>, corFunction, <span class="at">y=</span>y)</span>
<span id="cb35-32"><a href="css.html#cb35-32" aria-hidden="true" tabindex="-1"></a>    max_index_i <span class="ot">&lt;-</span> <span class="fu">which.max</span>(cors_i)[<span class="dv">1</span>]</span>
<span id="cb35-33"><a href="css.html#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="css.html#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(max_index_i) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb35-35"><a href="css.html#cb35-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(max_index_i <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cluster_members_i))</span>
<span id="cb35-36"><a href="css.html#cb35-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-37"><a href="css.html#cb35-37" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> cluster_members_i[max_index_i]</span>
<span id="cb35-38"><a href="css.html#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="css.html#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb35-40"><a href="css.html#cb35-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-41"><a href="css.html#cb35-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb35-42"><a href="css.html#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(ret) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb35-43"><a href="css.html#cb35-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(ret <span class="sc">%in%</span> cluster_members_i)</span>
<span id="cb35-44"><a href="css.html#cb35-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">identical</span>(x[, cluster_members_i][, max_index_i],</span>
<span id="cb35-45"><a href="css.html#cb35-45" aria-hidden="true" tabindex="-1"></a>        x[, ret]))</span>
<span id="cb35-46"><a href="css.html#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="css.html#cb35-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(ret)</span>
<span id="cb35-48"><a href="css.html#cb35-48" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='css.html#corFunction'>corFunction</a>()</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="css.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Absolute value of sample correlation between two vectors</span></span>
<span id="cb36-2"><a href="css.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb36-3"><a href="css.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculates the absolute value of correlation of t and y. If either input has</span></span>
<span id="cb36-4"><a href="css.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; only one unique value, returns 0 by definition.</span></span>
<span id="cb36-5"><a href="css.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param t A numeric or integer vector.</span></span>
<span id="cb36-6"><a href="css.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric or integer vector; must have the same length as t.</span></span>
<span id="cb36-7"><a href="css.html#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric vector of the same length as cluster_i containing the</span></span>
<span id="cb36-8"><a href="css.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; weights corresponding to each of the features in cluster_i. The weights</span></span>
<span id="cb36-9"><a href="css.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will all be nonnegative and sum to 1.</span></span>
<span id="cb36-10"><a href="css.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb36-11"><a href="css.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span id='corFunction'>corFunction</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(t, y){</span>
<span id="cb36-12"><a href="css.html#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb36-13"><a href="css.html#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(t) <span class="sc">|</span> <span class="fu">is.integer</span>(t))</span>
<span id="cb36-14"><a href="css.html#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb36-15"><a href="css.html#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(t) <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb36-16"><a href="css.html#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(t)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb36-17"><a href="css.html#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb36-18"><a href="css.html#cb36-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-19"><a href="css.html#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb36-20"><a href="css.html#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;The second argument to corFunction only had one unique entry&quot;</span>)</span>
<span id="cb36-21"><a href="css.html#cb36-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb36-22"><a href="css.html#cb36-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-23"><a href="css.html#cb36-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">abs</span>(stats<span class="sc">::</span><span class="fu">cor</span>(t, y)))</span>
<span id="cb36-24"><a href="css.html#cb36-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#corFunction'>corFunction</a>()</code></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="css.html#cb37-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;corFunction works&quot;</span>, {</span>
<span id="cb37-2"><a href="css.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="dv">0</span>)</span>
<span id="cb37-3"><a href="css.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">5</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="dv">0</span>)</span>
<span id="cb37-4"><a href="css.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-5"><a href="css.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23451</span>)</span>
<span id="cb37-6"><a href="css.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-7"><a href="css.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb37-8"><a href="css.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb37-9"><a href="css.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#corFunction'>corFunction</a>(x, y), <span class="fu">abs</span>(stats<span class="sc">::</span><span class="fu">cor</span>(x, y)))</span>
<span id="cb37-10"><a href="css.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">5</span>)),</span>
<span id="cb37-11"><a href="css.html#cb37-11" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;The second argument to corFunction only had one unique entry&quot;</span>,</span>
<span id="cb37-12"><a href="css.html#cb37-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-13"><a href="css.html#cb37-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>),</span>
<span id="cb37-14"><a href="css.html#cb37-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(t) | is.integer(t) is not TRUE&quot;</span>,</span>
<span id="cb37-15"><a href="css.html#cb37-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-16"><a href="css.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="st">&quot;2&quot;</span>),</span>
<span id="cb37-17"><a href="css.html#cb37-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb37-18"><a href="css.html#cb37-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-19"><a href="css.html#cb37-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#corFunction'>corFunction</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb37-20"><a href="css.html#cb37-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(t) == length(y) is not TRUE&quot;</span>,</span>
<span id="cb37-21"><a href="css.html#cb37-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb37-22"><a href="css.html#cb37-22" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>Tests for <code><a href='css.html#identifyPrototype'>identifyPrototype</a>()</code> (requires <code><a href='css.html#corFunction'>corFunction</a>()</code>):</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="css.html#cb39-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;identifyPrototype works&quot;</span>, {</span>
<span id="cb39-2"><a href="css.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#identifyPrototype'>identifyPrototype</a>(10L, <span class="st">&quot;a&quot;</span>, <span class="dv">5</span>), 10L)</span>
<span id="cb39-3"><a href="css.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb39-4"><a href="css.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb39-5"><a href="css.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-6"><a href="css.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">9834</span>)</span>
<span id="cb39-7"><a href="css.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-8"><a href="css.html#cb39-8" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb39-9"><a href="css.html#cb39-9" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb39-10"><a href="css.html#cb39-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='css.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(p), X, y), p)</span>
<span id="cb39-11"><a href="css.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='css.html#identifyPrototype'>identifyPrototype</a>(2L, X, y), <span class="dv">2</span>)</span>
<span id="cb39-12"><a href="css.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='css.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(<span class="dv">2</span><span class="sc">:</span>p), X, y), p)</span>
<span id="cb39-13"><a href="css.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">as.integer</span>(<span class="dv">2</span><span class="sc">:</span>p), y, X),</span>
<span id="cb39-14"><a href="css.html#cb39-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;incorrect number of dimensions&quot;</span>,</span>
<span id="cb39-15"><a href="css.html#cb39-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb39-16"><a href="css.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-17"><a href="css.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb39-18"><a href="css.html#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="css.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#identifyPrototype'>identifyPrototype</a>(<span class="fu">c</span>(2L, 3L), X, y2)</span>
<span id="cb39-20"><a href="css.html#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="css.html#cb39-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb39-22"><a href="css.html#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="css.html#cb39-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">1</span>)</span>
<span id="cb39-24"><a href="css.html#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="css.html#cb39-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb39-26"><a href="css.html#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="css.html#cb39-27" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>Tests for <code><a href='css.html#getPrototypes'>getPrototypes</a>()</code></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="css.html#cb41-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getPrototypes works&quot;</span>, {</span>
<span id="cb41-2"><a href="css.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb41-3"><a href="css.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb41-4"><a href="css.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-5"><a href="css.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">902689</span>)</span>
<span id="cb41-6"><a href="css.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-7"><a href="css.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb41-8"><a href="css.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb41-9"><a href="css.html#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="css.html#cb41-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), X, y), <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb41-11"><a href="css.html#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="css.html#cb41-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L<span class="sc">:</span>5L), X, y), 5L)</span>
<span id="cb41-13"><a href="css.html#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="css.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L<span class="sc">:</span>5L), X, y), <span class="fu">c</span>(1L, 5L))</span>
<span id="cb41-15"><a href="css.html#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="css.html#cb41-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(3L<span class="sc">:</span>5L), X, y), 5L)</span>
<span id="cb41-17"><a href="css.html#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="css.html#cb41-18" aria-hidden="true" tabindex="-1"></a>  y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb41-19"><a href="css.html#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="css.html#cb41-20" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, <span class="fu">c</span>(2L, 3L), <span class="fu">c</span>(4L, 5L)), X, y2)</span>
<span id="cb41-21"><a href="css.html#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="css.html#cb41-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb41-23"><a href="css.html#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="css.html#cb41-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb41-25"><a href="css.html#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="css.html#cb41-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res[<span class="dv">1</span>], 1L)</span>
<span id="cb41-27"><a href="css.html#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="css.html#cb41-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">2</span>] <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb41-29"><a href="css.html#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="css.html#cb41-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">3</span>] <span class="sc">%in%</span> <span class="fu">c</span>(4L, 5L))</span>
<span id="cb41-31"><a href="css.html#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="css.html#cb41-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), y, X),</span>
<span id="cb41-33"><a href="css.html#cb41-33" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;is.matrix(x) is not TRUE&quot;</span>,</span>
<span id="cb41-34"><a href="css.html#cb41-34" aria-hidden="true" tabindex="-1"></a>                          <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-35"><a href="css.html#cb41-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-36"><a href="css.html#cb41-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#getPrototypes'>getPrototypes</a>(<span class="fu">list</span>(1L, 2L, 3L, 4L, 5L), X, y[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]),</span>
<span id="cb41-37"><a href="css.html#cb41-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n == length(y) is not TRUE&quot;</span>,</span>
<span id="cb41-38"><a href="css.html#cb41-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-39"><a href="css.html#cb41-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-40"><a href="css.html#cb41-40" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p>Finally, tests for <code><a href='css.html#formatClusters'>formatClusters</a>()</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="css.html#cb43-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;formatClusters works&quot;</span>, {</span>
<span id="cb43-2"><a href="css.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-3"><a href="css.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb43-4"><a href="css.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb43-5"><a href="css.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb43-6"><a href="css.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-7"><a href="css.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(good_clusters, <span class="at">p=</span><span class="dv">10</span>)</span>
<span id="cb43-8"><a href="css.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-9"><a href="css.html#cb43-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb43-10"><a href="css.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;clusters&quot;</span>, <span class="st">&quot;multiple&quot;</span>))</span>
<span id="cb43-11"><a href="css.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-12"><a href="css.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clusters</span></span>
<span id="cb43-13"><a href="css.html#cb43-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb43-14"><a href="css.html#cb43-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters), <span class="dv">5</span>)</span>
<span id="cb43-15"><a href="css.html#cb43-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">5</span>, <span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters)))</span>
<span id="cb43-16"><a href="css.html#cb43-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">5</span>, <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb43-17"><a href="css.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb43-18"><a href="css.html#cb43-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb43-19"><a href="css.html#cb43-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb43-20"><a href="css.html#cb43-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters) <span class="sc">!=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb43-21"><a href="css.html#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="css.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb43-23"><a href="css.html#cb43-23" aria-hidden="true" tabindex="-1"></a>  true_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">9</span>, <span class="dv">10</span>)</span>
<span id="cb43-24"><a href="css.html#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>clusters)){</span>
<span id="cb43-25"><a href="css.html#cb43-25" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>clusters[[i]]))</span>
<span id="cb43-26"><a href="css.html#cb43-26" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])), <span class="dv">0</span>)</span>
<span id="cb43-27"><a href="css.html#cb43-27" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>clusters[[i]] <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb43-28"><a href="css.html#cb43-28" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters[[i]]),</span>
<span id="cb43-29"><a href="css.html#cb43-29" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(<span class="fu">unique</span>(res<span class="sc">$</span>clusters[[i]])))</span>
<span id="cb43-30"><a href="css.html#cb43-30" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>clusters[[i]] <span class="sc">==</span> true_list[[i]]))</span>
<span id="cb43-31"><a href="css.html#cb43-31" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])</span>
<span id="cb43-32"><a href="css.html#cb43-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-33"><a href="css.html#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="css.html#cb43-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="dv">10</span>)</span>
<span id="cb43-35"><a href="css.html#cb43-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">10</span>, <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb43-36"><a href="css.html#cb43-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="dv">10</span>, <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)))</span>
<span id="cb43-37"><a href="css.html#cb43-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-38"><a href="css.html#cb43-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multiple</span></span>
<span id="cb43-39"><a href="css.html#cb43-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>multiple)</span>
<span id="cb43-40"><a href="css.html#cb43-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_false</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">10</span>)<span class="sc">$</span>multiple)</span>
<span id="cb43-41"><a href="css.html#cb43-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-42"><a href="css.html#cb43-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb43-43"><a href="css.html#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-44"><a href="css.html#cb43-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>), <span class="at">p=</span><span class="dv">15</span>),</span>
<span id="cb43-45"><a href="css.html#cb43-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(intersect(clusters[[i]], clusters[[j]])) == 0 is not TRUE&quot;</span>,</span>
<span id="cb43-46"><a href="css.html#cb43-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-47"><a href="css.html#cb43-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">p=</span><span class="dv">9</span>),</span>
<span id="cb43-48"><a href="css.html#cb43-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb43-49"><a href="css.html#cb43-49" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-50"><a href="css.html#cb43-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-51"><a href="css.html#cb43-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>), <span class="at">p=</span><span class="dv">7</span>),</span>
<span id="cb43-52"><a href="css.html#cb43-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb43-53"><a href="css.html#cb43-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-54"><a href="css.html#cb43-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-55"><a href="css.html#cb43-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="at">p=</span><span class="dv">10</span>),</span>
<span id="cb43-56"><a href="css.html#cb43-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of clusters or R (or does one of these provided inputs contain NA?)&quot;</span>,</span>
<span id="cb43-57"><a href="css.html#cb43-57" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-58"><a href="css.html#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="css.html#cb43-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>)), <span class="at">p=</span><span class="dv">8</span>),</span>
<span id="cb43-60"><a href="css.html#cb43-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb43-61"><a href="css.html#cb43-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-62"><a href="css.html#cb43-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-63"><a href="css.html#cb43-63" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>), <span class="at">p=</span><span class="dv">10</span>),</span>
<span id="cb43-64"><a href="css.html#cb43-64" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb43-65"><a href="css.html#cb43-65" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-66"><a href="css.html#cb43-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-67"><a href="css.html#cb43-67" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>))),</span>
<span id="cb43-68"><a href="css.html#cb43-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.integer(clusters[[i]]) is not TRUE&quot;</span>,</span>
<span id="cb43-69"><a href="css.html#cb43-69" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-70"><a href="css.html#cb43-70" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-71"><a href="css.html#cb43-71" aria-hidden="true" tabindex="-1"></a>   <span class="do">### Test prototypes feature</span></span>
<span id="cb43-72"><a href="css.html#cb43-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-73"><a href="css.html#cb43-73" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb43-74"><a href="css.html#cb43-74" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb43-75"><a href="css.html#cb43-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-76"><a href="css.html#cb43-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">690289</span>)</span>
<span id="cb43-77"><a href="css.html#cb43-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-78"><a href="css.html#cb43-78" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p), <span class="at">nrow=</span>n, <span class="at">ncol=</span>p)</span>
<span id="cb43-79"><a href="css.html#cb43-79" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> X[, p]</span>
<span id="cb43-80"><a href="css.html#cb43-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-81"><a href="css.html#cb43-81" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(), <span class="at">p=</span>p, <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X, <span class="at">y=</span>y)</span>
<span id="cb43-82"><a href="css.html#cb43-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-83"><a href="css.html#cb43-83" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb43-84"><a href="css.html#cb43-84" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;clusters&quot;</span>, <span class="st">&quot;multiple&quot;</span>,</span>
<span id="cb43-85"><a href="css.html#cb43-85" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;prototypes&quot;</span>))</span>
<span id="cb43-86"><a href="css.html#cb43-86" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>prototypes))</span>
<span id="cb43-87"><a href="css.html#cb43-87" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res<span class="sc">$</span>prototypes, <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb43-88"><a href="css.html#cb43-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-89"><a href="css.html#cb43-89" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span>p, <span class="at">p=</span>p,</span>
<span id="cb43-90"><a href="css.html#cb43-90" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb43-91"><a href="css.html#cb43-91" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes, p)</span>
<span id="cb43-92"><a href="css.html#cb43-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-93"><a href="css.html#cb43-93" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(1L, 2L<span class="sc">:</span>p), <span class="at">p=</span>p,</span>
<span id="cb43-94"><a href="css.html#cb43-94" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb43-95"><a href="css.html#cb43-95" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes,</span>
<span id="cb43-96"><a href="css.html#cb43-96" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.integer</span>(<span class="fu">c</span>(<span class="dv">1</span>, p)))</span>
<span id="cb43-97"><a href="css.html#cb43-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-98"><a href="css.html#cb43-98" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span>3L<span class="sc">:</span>p, <span class="at">p=</span>p,</span>
<span id="cb43-99"><a href="css.html#cb43-99" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb43-100"><a href="css.html#cb43-100" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y=</span>y)<span class="sc">$</span>prototypes,</span>
<span id="cb43-101"><a href="css.html#cb43-101" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.integer</span>(<span class="fu">c</span>(p, <span class="dv">1</span>, <span class="dv">2</span>)))</span>
<span id="cb43-102"><a href="css.html#cb43-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-103"><a href="css.html#cb43-103" aria-hidden="true" tabindex="-1"></a>    y2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb43-104"><a href="css.html#cb43-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-105"><a href="css.html#cb43-105" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p, <span class="at">get_prototypes=</span><span class="cn">TRUE</span>,</span>
<span id="cb43-106"><a href="css.html#cb43-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">x=</span>X, <span class="at">y=</span>y2)<span class="sc">$</span>prototypes</span>
<span id="cb43-107"><a href="css.html#cb43-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-108"><a href="css.html#cb43-108" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res))</span>
<span id="cb43-109"><a href="css.html#cb43-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-110"><a href="css.html#cb43-110" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">4</span>)</span>
<span id="cb43-111"><a href="css.html#cb43-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-112"><a href="css.html#cb43-112" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">1</span>] <span class="sc">%in%</span> <span class="fu">c</span>(2L, 3L))</span>
<span id="cb43-113"><a href="css.html#cb43-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-114"><a href="css.html#cb43-114" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(res[<span class="dv">2</span>] <span class="sc">%in%</span> <span class="fu">c</span>(4L, 5L))</span>
<span id="cb43-115"><a href="css.html#cb43-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-116"><a href="css.html#cb43-116" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(res[<span class="dv">3</span>], 1L)</span>
<span id="cb43-117"><a href="css.html#cb43-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-118"><a href="css.html#cb43-118" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(res[<span class="dv">4</span>], p)</span>
<span id="cb43-119"><a href="css.html#cb43-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-120"><a href="css.html#cb43-120" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p,</span>
<span id="cb43-121"><a href="css.html#cb43-121" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>y2, <span class="at">y=</span>X),</span>
<span id="cb43-122"><a href="css.html#cb43-122" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;is.matrix(x) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-123"><a href="css.html#cb43-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-124"><a href="css.html#cb43-124" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#formatClusters'>formatClusters</a>(<span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>), <span class="at">p=</span>p,</span>
<span id="cb43-125"><a href="css.html#cb43-125" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">get_prototypes=</span><span class="cn">TRUE</span>, <span class="at">x=</span>X,</span>
<span id="cb43-126"><a href="css.html#cb43-126" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">y=</span>y2[<span class="dv">1</span><span class="sc">:</span>(n<span class="dv">-1</span>)]),</span>
<span id="cb43-127"><a href="css.html#cb43-127" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;n == length(y) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-128"><a href="css.html#cb43-128" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='css.html#checkSamplingType'>checkSamplingType</a>()</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="css.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument sampling_type to several </span></span>
<span id="cb45-2"><a href="css.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb45-3"><a href="css.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-4"><a href="css.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sampling_type A character vector; either &quot;SS&quot; or &quot;MB&quot;. &quot;MB&quot; is not</span></span>
<span id="cb45-5"><a href="css.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; supported yet.</span></span>
<span id="cb45-6"><a href="css.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb45-7"><a href="css.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span id='checkSamplingType'>checkSamplingType</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(sampling_type){</span>
<span id="cb45-8"><a href="css.html#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(sampling_type))</span>
<span id="cb45-9"><a href="css.html#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sampling_type) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb45-10"><a href="css.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(sampling_type))</span>
<span id="cb45-11"><a href="css.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sampling_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;SS&quot;</span>, <span class="st">&quot;MB&quot;</span>))</span>
<span id="cb45-12"><a href="css.html#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(sampling_type <span class="sc">==</span> <span class="st">&quot;MB&quot;</span>){</span>
<span id="cb45-13"><a href="css.html#cb45-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>)</span>
<span id="cb45-14"><a href="css.html#cb45-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-15"><a href="css.html#cb45-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkSamplingType'>checkSamplingType</a>()</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="css.html#cb46-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkSamplingType works&quot;</span>, {</span>
<span id="cb46-2"><a href="css.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkSamplingType'>checkSamplingType</a>(<span class="st">&quot;SS&quot;</span>))</span>
<span id="cb46-3"><a href="css.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkSamplingType'>checkSamplingType</a>(<span class="st">&quot;MB&quot;</span>),</span>
<span id="cb46-4"><a href="css.html#cb46-4" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>,</span>
<span id="cb46-5"><a href="css.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-6"><a href="css.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkSamplingType'>checkSamplingType</a>(<span class="fu">c</span>(<span class="st">&quot;SS&quot;</span>, <span class="st">&quot;SS&quot;</span>)),</span>
<span id="cb46-7"><a href="css.html#cb46-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(sampling_type) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-8"><a href="css.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkSamplingType'>checkSamplingType</a>(<span class="dv">1</span>),</span>
<span id="cb46-9"><a href="css.html#cb46-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(sampling_type) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-10"><a href="css.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkSamplingType'>checkSamplingType</a>(<span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb46-11"><a href="css.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(sampling_type) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-12"><a href="css.html#cb46-12" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥇</code></pre>
<p><code><a href='css.html#checkB'>checkB</a>()</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="css.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument B to several functions is as</span></span>
<span id="cb48-2"><a href="css.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; expected</span></span>
<span id="cb48-3"><a href="css.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb48-4"><a href="css.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param B Integer or numeric; the number of subsamples. Note: For</span></span>
<span id="cb48-5"><a href="css.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling.type==&quot;MB&quot; the total number of subsamples will be `B`; for</span></span>
<span id="cb48-6"><a href="css.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type=&quot;SS&quot; the number of subsamples will be `2*B`.</span></span>
<span id="cb48-7"><a href="css.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb48-8"><a href="css.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span id='checkB'>checkB</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(B){</span>
<span id="cb48-9"><a href="css.html#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(B) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb48-10"><a href="css.html#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(B) <span class="sc">|</span> <span class="fu">is.integer</span>(B))</span>
<span id="cb48-11"><a href="css.html#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(B))</span>
<span id="cb48-12"><a href="css.html#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(B <span class="sc">==</span> <span class="fu">round</span>(B))</span>
<span id="cb48-13"><a href="css.html#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(B <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb48-14"><a href="css.html#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(B <span class="sc">&lt;</span> <span class="dv">10</span>){</span>
<span id="cb48-15"><a href="css.html#cb48-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Small values of B may lead to poor results.&quot;</span>)</span>
<span id="cb48-16"><a href="css.html#cb48-16" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (B <span class="sc">&gt;</span> <span class="dv">2000</span>){</span>
<span id="cb48-17"><a href="css.html#cb48-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Large values of B may require long computation times.&quot;</span>)</span>
<span id="cb48-18"><a href="css.html#cb48-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-19"><a href="css.html#cb48-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkB'>checkB</a>()</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="css.html#cb49-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkB works&quot;</span>, {</span>
<span id="cb49-2"><a href="css.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkB'>checkB</a>(<span class="dv">1500</span>))</span>
<span id="cb49-3"><a href="css.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkB'>checkB</a>(<span class="dv">15</span>))</span>
<span id="cb49-4"><a href="css.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkB'>checkB</a>(<span class="st">&quot;B&quot;</span>),</span>
<span id="cb49-5"><a href="css.html#cb49-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(B) | is.integer(B) is not TRUE&quot;</span>,</span>
<span id="cb49-6"><a href="css.html#cb49-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-7"><a href="css.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkB'>checkB</a>(<span class="dv">20</span><span class="sc">:</span><span class="dv">25</span>), <span class="st">&quot;length(B) == 1 is not TRUE&quot;</span>,</span>
<span id="cb49-8"><a href="css.html#cb49-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-9"><a href="css.html#cb49-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkB'>checkB</a>(<span class="fu">as.integer</span>(<span class="cn">NA</span>)), <span class="st">&quot;!is.na(B) is not TRUE&quot;</span>,</span>
<span id="cb49-10"><a href="css.html#cb49-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-11"><a href="css.html#cb49-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkB'>checkB</a>(<span class="fl">1.2</span>), <span class="st">&quot;B == round(B) is not TRUE&quot;</span>,</span>
<span id="cb49-12"><a href="css.html#cb49-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-13"><a href="css.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkB'>checkB</a>(<span class="sc">-</span><span class="dv">100</span>), <span class="st">&quot;B &gt; 0 is not TRUE&quot;</span>,</span>
<span id="cb49-14"><a href="css.html#cb49-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-15"><a href="css.html#cb49-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='css.html#checkB'>checkB</a>(<span class="dv">5</span>),</span>
<span id="cb49-16"><a href="css.html#cb49-16" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Small values of B may lead to poor results.&quot;</span>,</span>
<span id="cb49-17"><a href="css.html#cb49-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-18"><a href="css.html#cb49-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='css.html#checkB'>checkB</a>(<span class="dv">2200</span>),</span>
<span id="cb49-19"><a href="css.html#cb49-19" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Large values of B may require long computation times.&quot;</span>,</span>
<span id="cb49-20"><a href="css.html#cb49-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-21"><a href="css.html#cb49-21" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p><code><a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>()</code>:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="css.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument prop_feats_remove to several </span></span>
<span id="cb51-2"><a href="css.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb51-3"><a href="css.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb51-4"><a href="css.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param prop_feats_remove Numeric; proportion of features that are dropped on</span></span>
<span id="cb51-5"><a href="css.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each subsample. Must be between 0 and 1.</span></span>
<span id="cb51-6"><a href="css.html#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; must be greater than 2 if prop_feats_remove</span></span>
<span id="cb51-7"><a href="css.html#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is greater than 0.</span></span>
<span id="cb51-8"><a href="css.html#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb51-9"><a href="css.html#cb51-9" aria-hidden="true" tabindex="-1"></a><span id='checkPropFeatsRemove'>checkPropFeatsRemove</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(prop_feats_remove, p){</span>
<span id="cb51-10"><a href="css.html#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prop_feats_remove) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb51-11"><a href="css.html#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(prop_feats_remove) <span class="sc">|</span> <span class="fu">is.integer</span>(prop_feats_remove))</span>
<span id="cb51-12"><a href="css.html#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(prop_feats_remove))</span>
<span id="cb51-13"><a href="css.html#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(prop_feats_remove <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> prop_feats_remove <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb51-14"><a href="css.html#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(prop_feats_remove <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb51-15"><a href="css.html#cb51-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Make sure p is at least 2 or else this doesn&#39;t make sense</span></span>
<span id="cb51-16"><a href="css.html#cb51-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb51-17"><a href="css.html#cb51-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-18"><a href="css.html#cb51-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>()</code>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="css.html#cb52-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkPropFeatsRemove works&quot;</span>, {</span>
<span id="cb52-2"><a href="css.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb52-3"><a href="css.html#cb52-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(.<span class="dv">3</span>, <span class="dv">10</span>))</span>
<span id="cb52-4"><a href="css.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb52-5"><a href="css.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;prop_feats_remove &gt;= 0 &amp; prop_feats_remove &lt; 1 is not TRUE&quot;</span>,</span>
<span id="cb52-6"><a href="css.html#cb52-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-7"><a href="css.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">6</span>), <span class="dv">17</span>),</span>
<span id="cb52-8"><a href="css.html#cb52-8" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(prop_feats_remove) == 1 is not TRUE&quot;</span>,</span>
<span id="cb52-9"><a href="css.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-10"><a href="css.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="st">&quot;.3&quot;</span>, <span class="dv">99</span>),</span>
<span id="cb52-11"><a href="css.html#cb52-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(prop_feats_remove) | is.integer(prop_feats_remove) is not TRUE&quot;</span>,</span>
<span id="cb52-12"><a href="css.html#cb52-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-13"><a href="css.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="dv">172</span>),</span>
<span id="cb52-14"><a href="css.html#cb52-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(prop_feats_remove) is not TRUE&quot;</span>,</span>
<span id="cb52-15"><a href="css.html#cb52-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-16"><a href="css.html#cb52-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkPropFeatsRemove'>checkPropFeatsRemove</a>(.<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb52-17"><a href="css.html#cb52-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= 2 is not TRUE&quot;</span>,</span>
<span id="cb52-18"><a href="css.html#cb52-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb52-19"><a href="css.html#cb52-19" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p>Finally, tests for <code><a href='css.html#checkCssInputs'>checkCssInputs</a>()</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="css.html#cb54-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssInputs works&quot;</span>, {</span>
<span id="cb54-2"><a href="css.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">80526</span>)</span>
<span id="cb54-3"><a href="css.html#cb54-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-4"><a href="css.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span><span class="sc">*</span><span class="dv">11</span>), <span class="at">nrow=</span><span class="dv">15</span>, <span class="at">ncol=</span><span class="dv">11</span>)</span>
<span id="cb54-5"><a href="css.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span>)</span>
<span id="cb54-6"><a href="css.html#cb54-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-7"><a href="css.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb54-8"><a href="css.html#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb54-9"><a href="css.html#cb54-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb54-10"><a href="css.html#cb54-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">green_cluster=</span>6L<span class="sc">:</span>8L</span>
<span id="cb54-11"><a href="css.html#cb54-11" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># , c4=10:11</span></span>
<span id="cb54-12"><a href="css.html#cb54-12" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb54-13"><a href="css.html#cb54-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-14"><a href="css.html#cb54-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb54-15"><a href="css.html#cb54-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fitfun =</span> cssLasso, <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb54-16"><a href="css.html#cb54-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>, <span class="at">train_inds =</span> <span class="fu">integer</span>(),</span>
<span id="cb54-17"><a href="css.html#cb54-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">num_cores =</span> 1L)</span>
<span id="cb54-18"><a href="css.html#cb54-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-19"><a href="css.html#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Basic output</span></span>
<span id="cb54-20"><a href="css.html#cb54-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb54-21"><a href="css.html#cb54-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;clusters&quot;</span>))</span>
<span id="cb54-22"><a href="css.html#cb54-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-23"><a href="css.html#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># feat_names</span></span>
<span id="cb54-24"><a href="css.html#cb54-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb54-25"><a href="css.html#cb54-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb54-26"><a href="css.html#cb54-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>feat_names), <span class="dv">1</span>)</span>
<span id="cb54-27"><a href="css.html#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="css.html#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X</span></span>
<span id="cb54-29"><a href="css.html#cb54-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>X))</span>
<span id="cb54-30"><a href="css.html#cb54-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>X)))</span>
<span id="cb54-31"><a href="css.html#cb54-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>X))</span>
<span id="cb54-32"><a href="css.html#cb54-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>X), <span class="dv">11</span>)</span>
<span id="cb54-33"><a href="css.html#cb54-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>X), <span class="dv">15</span>)</span>
<span id="cb54-34"><a href="css.html#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="css.html#cb54-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># clusters</span></span>
<span id="cb54-36"><a href="css.html#cb54-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res<span class="sc">$</span>clusters))</span>
<span id="cb54-37"><a href="css.html#cb54-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters), <span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters)))</span>
<span id="cb54-38"><a href="css.html#cb54-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>clusters),</span>
<span id="cb54-39"><a href="css.html#cb54-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb54-40"><a href="css.html#cb54-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb54-41"><a href="css.html#cb54-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res<span class="sc">$</span>clusters))))</span>
<span id="cb54-42"><a href="css.html#cb54-42" aria-hidden="true" tabindex="-1"></a>  clust_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb54-43"><a href="css.html#cb54-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>clusters)){</span>
<span id="cb54-44"><a href="css.html#cb54-44" aria-hidden="true" tabindex="-1"></a>    clust_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(clust_feats, res<span class="sc">$</span>clusters[[i]])</span>
<span id="cb54-45"><a href="css.html#cb54-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-46"><a href="css.html#cb54-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">unique</span>(clust_feats)))</span>
<span id="cb54-47"><a href="css.html#cb54-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(clust_feats), <span class="fu">length</span>(<span class="fu">intersect</span>(clust_feats,</span>
<span id="cb54-48"><a href="css.html#cb54-48" aria-hidden="true" tabindex="-1"></a>                                                               <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)))</span>
<span id="cb54-49"><a href="css.html#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="css.html#cb54-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb54-51"><a href="css.html#cb54-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-52"><a href="css.html#cb54-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom fitfun with nonsense lambda (which will be ignored by fitfun, and</span></span>
<span id="cb54-53"><a href="css.html#cb54-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># shouldn&#39;t throw any error, because the acceptable input for lambda should be</span></span>
<span id="cb54-54"><a href="css.html#cb54-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># enforced only by fitfun)</span></span>
<span id="cb54-55"><a href="css.html#cb54-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-56"><a href="css.html#cb54-56" aria-hidden="true" tabindex="-1"></a>  <span id='testFitfun'>testFitfun</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb54-57"><a href="css.html#cb54-57" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb54-58"><a href="css.html#cb54-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb54-59"><a href="css.html#cb54-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose p/2 features randomly</span></span>
<span id="cb54-60"><a href="css.html#cb54-60" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(p, <span class="at">size=</span><span class="fu">floor</span>(p<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb54-61"><a href="css.html#cb54-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb54-62"><a href="css.html#cb54-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-63"><a href="css.html#cb54-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-64"><a href="css.html#cb54-64" aria-hidden="true" tabindex="-1"></a>  res_fitfun <span class="ot">&lt;-</span> <a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span>x, <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb54-65"><a href="css.html#cb54-65" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fitfun =</span> testFitfun, <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>,</span>
<span id="cb54-66"><a href="css.html#cb54-66" aria-hidden="true" tabindex="-1"></a>                               <span class="at">B =</span> <span class="dv">13</span>, <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-67"><a href="css.html#cb54-67" aria-hidden="true" tabindex="-1"></a>                               <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L)</span>
<span id="cb54-68"><a href="css.html#cb54-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_fitfun))</span>
<span id="cb54-69"><a href="css.html#cb54-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-70"><a href="css.html#cb54-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb54-71"><a href="css.html#cb54-71" aria-hidden="true" tabindex="-1"></a>  res_sing_clust <span class="ot">&lt;-</span> <a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb54-72"><a href="css.html#cb54-72" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="fu">as.character</span>(<span class="cn">NA</span>), <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb54-73"><a href="css.html#cb54-73" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-74"><a href="css.html#cb54-74" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb54-75"><a href="css.html#cb54-75" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-76"><a href="css.html#cb54-76" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L)</span>
<span id="cb54-77"><a href="css.html#cb54-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_sing_clust))</span>
<span id="cb54-78"><a href="css.html#cb54-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_sing_clust<span class="sc">$</span>clusters), <span class="dv">11</span> <span class="sc">-</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb54-79"><a href="css.html#cb54-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))) <span class="sc">==</span> <span class="dv">11</span> <span class="sc">-</span></span>
<span id="cb54-80"><a href="css.html#cb54-80" aria-hidden="true" tabindex="-1"></a>                          <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb54-81"><a href="css.html#cb54-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))))</span>
<span id="cb54-82"><a href="css.html#cb54-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(res_sing_clust<span class="sc">$</span>clusters))))</span>
<span id="cb54-83"><a href="css.html#cb54-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-84"><a href="css.html#cb54-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other sampling types</span></span>
<span id="cb54-85"><a href="css.html#cb54-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>,</span>
<span id="cb54-86"><a href="css.html#cb54-86" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb54-87"><a href="css.html#cb54-87" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;bar&quot;</span>), <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb54-88"><a href="css.html#cb54-88" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-89"><a href="css.html#cb54-89" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;MB&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb54-90"><a href="css.html#cb54-90" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-91"><a href="css.html#cb54-91" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb54-92"><a href="css.html#cb54-92" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sampling_type MB is not yet supported (and isn&#39;t recommended anyway)&quot;</span>,</span>
<span id="cb54-93"><a href="css.html#cb54-93" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-94"><a href="css.html#cb54-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-95"><a href="css.html#cb54-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb54-96"><a href="css.html#cb54-96" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>,</span>
<span id="cb54-97"><a href="css.html#cb54-97" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>),</span>
<span id="cb54-98"><a href="css.html#cb54-98" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&quot;bar&quot;</span>), <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb54-99"><a href="css.html#cb54-99" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-100"><a href="css.html#cb54-100" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;S&quot;</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb54-101"><a href="css.html#cb54-101" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-102"><a href="css.html#cb54-102" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L))</span>
<span id="cb54-103"><a href="css.html#cb54-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-104"><a href="css.html#cb54-104" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb54-105"><a href="css.html#cb54-105" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb54-106"><a href="css.html#cb54-106" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-107"><a href="css.html#cb54-107" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="dv">2</span>, <span class="at">B =</span> <span class="dv">13</span>,</span>
<span id="cb54-108"><a href="css.html#cb54-108" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-109"><a href="css.html#cb54-109" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb54-110"><a href="css.html#cb54-110" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(sampling_type) is not TRUE&quot;</span>,</span>
<span id="cb54-111"><a href="css.html#cb54-111" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-112"><a href="css.html#cb54-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-113"><a href="css.html#cb54-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># B</span></span>
<span id="cb54-114"><a href="css.html#cb54-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb54-115"><a href="css.html#cb54-115" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb54-116"><a href="css.html#cb54-116" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-117"><a href="css.html#cb54-117" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">5</span>,</span>
<span id="cb54-118"><a href="css.html#cb54-118" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-119"><a href="css.html#cb54-119" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb54-120"><a href="css.html#cb54-120" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Small values of B may lead to poor results.&quot;</span>,</span>
<span id="cb54-121"><a href="css.html#cb54-121" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-122"><a href="css.html#cb54-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-123"><a href="css.html#cb54-123" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb54-124"><a href="css.html#cb54-124" aria-hidden="true" tabindex="-1"></a>                                                           <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb54-125"><a href="css.html#cb54-125" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun =</span> testFitfun,</span>
<span id="cb54-126"><a href="css.html#cb54-126" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="st">&quot;foo&quot;</span>,</span>
<span id="cb54-127"><a href="css.html#cb54-127" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prop_feats_remove =</span> <span class="dv">0</span>,</span>
<span id="cb54-128"><a href="css.html#cb54-128" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">train_inds =</span> <span class="fu">integer</span>(), <span class="at">num_cores =</span> 1L),</span>
<span id="cb54-129"><a href="css.html#cb54-129" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;is.numeric(B) | is.integer(B) is not TRUE&quot;</span>,</span>
<span id="cb54-130"><a href="css.html#cb54-130" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-131"><a href="css.html#cb54-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-132"><a href="css.html#cb54-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prop_feats_remove</span></span>
<span id="cb54-133"><a href="css.html#cb54-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb54-134"><a href="css.html#cb54-134" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb54-135"><a href="css.html#cb54-135" aria-hidden="true" tabindex="-1"></a>                                                        <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb54-136"><a href="css.html#cb54-136" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun=</span>testFitfun,</span>
<span id="cb54-137"><a href="css.html#cb54-137" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">12</span>,</span>
<span id="cb54-138"><a href="css.html#cb54-138" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">prop_feats_remove =</span> <span class="fl">0.3</span>,</span>
<span id="cb54-139"><a href="css.html#cb54-139" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">train_inds =</span> <span class="fu">integer</span>(),</span>
<span id="cb54-140"><a href="css.html#cb54-140" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">num_cores =</span> 1L)))</span>
<span id="cb54-141"><a href="css.html#cb54-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-142"><a href="css.html#cb54-142" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use train_inds argument</span></span>
<span id="cb54-143"><a href="css.html#cb54-143" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(<a href='css.html#checkCssInputs'>checkCssInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb54-144"><a href="css.html#cb54-144" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">lambda=</span><span class="fu">c</span>(<span class="st">&quot;foo&quot;</span>, <span class="st">&quot;bar&quot;</span>,</span>
<span id="cb54-145"><a href="css.html#cb54-145" aria-hidden="true" tabindex="-1"></a>                                                        <span class="fu">as.character</span>(<span class="cn">NA</span>)),</span>
<span id="cb54-146"><a href="css.html#cb54-146" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">clusters=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">fitfun=</span>testFitfun,</span>
<span id="cb54-147"><a href="css.html#cb54-147" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">12</span>,</span>
<span id="cb54-148"><a href="css.html#cb54-148" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">prop_feats_remove =</span> <span class="fl">0.3</span>,</span>
<span id="cb54-149"><a href="css.html#cb54-149" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">train_inds =</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>,</span>
<span id="cb54-150"><a href="css.html#cb54-150" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">num_cores =</span> 1L)))</span>
<span id="cb54-151"><a href="css.html#cb54-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-152"><a href="css.html#cb54-152" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p><code><a href='css.html#cssLoop'>cssLoop</a>()</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="css.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function run on each subsample</span></span>
<span id="cb56-2"><a href="css.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb56-3"><a href="css.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Runs provided feature selection method `fitfun` on each subsample for cluster</span></span>
<span id="cb56-4"><a href="css.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; stability selection (this function is called within `mclapply`).</span></span>
<span id="cb56-5"><a href="css.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param input Could be one of two things: \item{subsample}{An integer vector</span></span>
<span id="cb56-6"><a href="css.html#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of size `n/2` containing the indices of the observations in the subsample.}</span></span>
<span id="cb56-7"><a href="css.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{drop_var_input}{A named list containing two elements: one named</span></span>
<span id="cb56-8"><a href="css.html#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;subsample&quot; and the same as the previous description, and a logical vector</span></span>
<span id="cb56-9"><a href="css.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named &quot;feats_to_keep&quot; containing the indices of the features to be</span></span>
<span id="cb56-10"><a href="css.html#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; automatically selected.} (The first object is the output of the function</span></span>
<span id="cb56-11"><a href="css.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `<a href='css.html#createSubsamples'>createSubsamples</a>()` when the provided `prop_feats_remove` is 0, the default, and</span></span>
<span id="cb56-12"><a href="css.html#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the second object is the output of `<a href='css.html#createSubsamples'>createSubsamples</a>()` when `prop_feats_remove &gt;</span></span>
<span id="cb56-13"><a href="css.html#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0`.)</span></span>
<span id="cb56-14"><a href="css.html#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x an n x p numeric matrix containing the predictors. (This should be</span></span>
<span id="cb56-15"><a href="css.html#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the full design matrix provided to css.)</span></span>
<span id="cb56-16"><a href="css.html#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A response; can be any response that takes the form of a length n</span></span>
<span id="cb56-17"><a href="css.html#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector and is used (or not used) by `fitfun`. Typically (and for default</span></span>
<span id="cb56-18"><a href="css.html#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `fitfun = cssLasso`), `y` should be an n-dimensional numeric vector containing the</span></span>
<span id="cb56-19"><a href="css.html#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response. This should be the full response provided to css.</span></span>
<span id="cb56-20"><a href="css.html#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda A tuning parameter or set of tuning parameters that may be used</span></span>
<span id="cb56-21"><a href="css.html#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by the feature selection method. For example, in the default case when</span></span>
<span id="cb56-22"><a href="css.html#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `fitfun = cssLasso`, `lambda` is a numeric: the penalty to use for each lasso</span></span>
<span id="cb56-23"><a href="css.html#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; fit.</span></span>
<span id="cb56-24"><a href="css.html#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param fitfun A function that takes in arguments X, y, and lambda and returns</span></span>
<span id="cb56-25"><a href="css.html#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a vector of indices of the columns of X (selected features).</span></span>
<span id="cb56-26"><a href="css.html#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector; the indices of the features selected by `fitfun`.</span></span>
<span id="cb56-27"><a href="css.html#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb56-28"><a href="css.html#cb56-28" aria-hidden="true" tabindex="-1"></a><span id='cssLoop'>cssLoop</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(input, x, y, lambda, fitfun){</span>
<span id="cb56-29"><a href="css.html#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb56-30"><a href="css.html#cb56-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(x))</span>
<span id="cb56-31"><a href="css.html#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)))</span>
<span id="cb56-32"><a href="css.html#cb56-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-33"><a href="css.html#cb56-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb56-34"><a href="css.html#cb56-34" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(x)</span>
<span id="cb56-35"><a href="css.html#cb56-35" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(x)</span>
<span id="cb56-36"><a href="css.html#cb56-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-37"><a href="css.html#cb56-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb56-38"><a href="css.html#cb56-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.matrix</span>(y))</span>
<span id="cb56-39"><a href="css.html#cb56-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Intentionally don&#39;t check y or lambda further to allow for flexibility--these</span></span>
<span id="cb56-40"><a href="css.html#cb56-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># inputs should be checked within fitfun.</span></span>
<span id="cb56-41"><a href="css.html#cb56-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-42"><a href="css.html#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.list</span>(input)){</span>
<span id="cb56-43"><a href="css.html#cb56-43" aria-hidden="true" tabindex="-1"></a>        subsample <span class="ot">&lt;-</span> input</span>
<span id="cb56-44"><a href="css.html#cb56-44" aria-hidden="true" tabindex="-1"></a>        feats_to_keep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">TRUE</span>, p)</span>
<span id="cb56-45"><a href="css.html#cb56-45" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb56-46"><a href="css.html#cb56-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">names</span>(input) <span class="sc">==</span> <span class="fu">c</span>(<span class="st">&quot;subsample&quot;</span>, <span class="st">&quot;feats_to_keep&quot;</span>)))</span>
<span id="cb56-47"><a href="css.html#cb56-47" aria-hidden="true" tabindex="-1"></a>        subsample <span class="ot">&lt;-</span> input<span class="sc">$</span>subsample</span>
<span id="cb56-48"><a href="css.html#cb56-48" aria-hidden="true" tabindex="-1"></a>        feats_to_keep <span class="ot">&lt;-</span> input<span class="sc">$</span>feats_to_keep</span>
<span id="cb56-49"><a href="css.html#cb56-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-50"><a href="css.html#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="css.html#cb56-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(subsample))</span>
<span id="cb56-52"><a href="css.html#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(subsample <span class="sc">==</span> <span class="fu">round</span>(subsample)))</span>
<span id="cb56-53"><a href="css.html#cb56-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">floor</span>(n<span class="sc">/</span><span class="dv">2</span>) <span class="sc">==</span> <span class="fu">length</span>(subsample))</span>
<span id="cb56-54"><a href="css.html#cb56-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(subsample) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(subsample)))</span>
<span id="cb56-55"><a href="css.html#cb56-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-56"><a href="css.html#cb56-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.logical</span>(feats_to_keep))</span>
<span id="cb56-57"><a href="css.html#cb56-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(feats_to_keep) <span class="sc">==</span> p)</span>
<span id="cb56-58"><a href="css.html#cb56-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-59"><a href="css.html#cb56-59" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">do.call</span>(fitfun, <span class="fu">list</span>(<span class="at">X=</span>x[subsample, feats_to_keep],</span>
<span id="cb56-60"><a href="css.html#cb56-60" aria-hidden="true" tabindex="-1"></a>        <span class="at">y=</span>y[subsample], <span class="at">lambda=</span>lambda))</span>
<span id="cb56-61"><a href="css.html#cb56-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-62"><a href="css.html#cb56-62" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">which</span>(feats_to_keep)[selected]</span>
<span id="cb56-63"><a href="css.html#cb56-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-64"><a href="css.html#cb56-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb56-65"><a href="css.html#cb56-65" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(selected, p, <span class="fu">as.integer</span>(<span class="fu">which</span>(feats_to_keep)))</span>
<span id="cb56-66"><a href="css.html#cb56-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-67"><a href="css.html#cb56-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.integer</span>(selected))</span>
<span id="cb56-68"><a href="css.html#cb56-68" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code>:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="css.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the outputs of the provided feature selection</span></span>
<span id="cb57-2"><a href="css.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; method are as required. </span></span>
<span id="cb57-3"><a href="css.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb57-4"><a href="css.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected An integer vector; the indices of the features selected by</span></span>
<span id="cb57-5"><a href="css.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the lasso.</span></span>
<span id="cb57-6"><a href="css.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The total number of observed features; all selected features must be</span></span>
<span id="cb57-7"><a href="css.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in 1:p.</span></span>
<span id="cb57-8"><a href="css.html#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param feats_on_subsamp Integer; the indices of the features considered by</span></span>
<span id="cb57-9"><a href="css.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the feature selection method. All selected features must be among these</span></span>
<span id="cb57-10"><a href="css.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features.</span></span>
<span id="cb57-11"><a href="css.html#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb57-12"><a href="css.html#cb57-12" aria-hidden="true" tabindex="-1"></a><span id='checkCssLoopOutput'>checkCssLoopOutput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(selected, p, feats_on_subsamp){</span>
<span id="cb57-13"><a href="css.html#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">exists</span>(<span class="st">&quot;selected&quot;</span>)){</span>
<span id="cb57-14"><a href="css.html#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return anything on (at least) one subsample&quot;</span>)</span>
<span id="cb57-15"><a href="css.html#cb57-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-16"><a href="css.html#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.integer</span>(selected) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.numeric</span>(selected)){</span>
<span id="cb57-17"><a href="css.html#cb57-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return an integer or numeric vector on (at least) one subsample&quot;</span>)</span>
<span id="cb57-18"><a href="css.html#cb57-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-19"><a href="css.html#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(selected))){</span>
<span id="cb57-20"><a href="css.html#cb57-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector containing NA values on (at least) one subsample&quot;</span>)</span>
<span id="cb57-21"><a href="css.html#cb57-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-22"><a href="css.html#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(selected <span class="sc">==</span> <span class="fu">round</span>(selected))){</span>
<span id="cb57-23"><a href="css.html#cb57-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun failed to return a vector of valid (integer) indices on (at least) one subsample&quot;</span>)</span>
<span id="cb57-24"><a href="css.html#cb57-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-25"><a href="css.html#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">!=</span> <span class="fu">length</span>(<span class="fu">unique</span>(selected))){</span>
<span id="cb57-26"><a href="css.html#cb57-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing repeated indices on (at least) one subsample&quot;</span>)</span>
<span id="cb57-27"><a href="css.html#cb57-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-28"><a href="css.html#cb57-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">&gt;</span> p){</span>
<span id="cb57-29"><a href="css.html#cb57-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features longer than p on (at least) one subsample&quot;</span>)</span>
<span id="cb57-30"><a href="css.html#cb57-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-31"><a href="css.html#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(selected) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb57-32"><a href="css.html#cb57-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">max</span>(selected) <span class="sc">&gt;</span> p){</span>
<span id="cb57-33"><a href="css.html#cb57-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing an index greater than ncol(X) on (at least) one subsample&quot;</span>)</span>
<span id="cb57-34"><a href="css.html#cb57-34" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-35"><a href="css.html#cb57-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">min</span>(selected) <span class="sc">&lt;=</span> <span class="dv">0</span>){</span>
<span id="cb57-36"><a href="css.html#cb57-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>)</span>
<span id="cb57-37"><a href="css.html#cb57-37" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb57-38"><a href="css.html#cb57-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-39"><a href="css.html#cb57-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;try-error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span></span>
<span id="cb57-40"><a href="css.html#cb57-40" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;error&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span> <span class="st">&quot;simpleError&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected) <span class="sc">|</span></span>
<span id="cb57-41"><a href="css.html#cb57-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;condition&quot;</span> <span class="sc">%in%</span> <span class="fu">class</span>(selected)){</span>
<span id="cb57-42"><a href="css.html#cb57-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method fitfun returned an error on (at least) one subsample&quot;</span>)</span>
<span id="cb57-43"><a href="css.html#cb57-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-44"><a href="css.html#cb57-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(selected <span class="sc">%in%</span> feats_on_subsamp)){</span>
<span id="cb57-45"><a href="css.html#cb57-45" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;The provided feature selection method somehow selected features that were not provided for it to consider.&quot;</span>)</span>
<span id="cb57-46"><a href="css.html#cb57-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb57-47"><a href="css.html#cb57-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>()</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="css.html#cb58-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssLoopOutput works&quot;</span>, {</span>
<span id="cb58-2"><a href="css.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">6</span>,</span>
<span id="cb58-3"><a href="css.html#cb58-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb58-4"><a href="css.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-5"><a href="css.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">4</span>,</span>
<span id="cb58-6"><a href="css.html#cb58-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb58-7"><a href="css.html#cb58-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features longer than p on (at least) one subsample&quot;</span>,</span>
<span id="cb58-8"><a href="css.html#cb58-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-9"><a href="css.html#cb58-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-10"><a href="css.html#cb58-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-11"><a href="css.html#cb58-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb58-12"><a href="css.html#cb58-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method somehow selected features that were not provided for it to consider.&quot;</span>,</span>
<span id="cb58-13"><a href="css.html#cb58-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-14"><a href="css.html#cb58-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-15"><a href="css.html#cb58-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="fl">4.4</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-16"><a href="css.html#cb58-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-17"><a href="css.html#cb58-17" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun failed to return a vector of valid (integer) indices on (at least) one subsample&quot;</span>,</span>
<span id="cb58-18"><a href="css.html#cb58-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-19"><a href="css.html#cb58-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-20"><a href="css.html#cb58-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-21"><a href="css.html#cb58-21" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-22"><a href="css.html#cb58-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing repeated indices on (at least) one subsample&quot;</span>,</span>
<span id="cb58-23"><a href="css.html#cb58-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-24"><a href="css.html#cb58-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-25"><a href="css.html#cb58-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-26"><a href="css.html#cb58-26" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-27"><a href="css.html#cb58-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>,</span>
<span id="cb58-28"><a href="css.html#cb58-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-29"><a href="css.html#cb58-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-30"><a href="css.html#cb58-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-31"><a href="css.html#cb58-31" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-32"><a href="css.html#cb58-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector of selected features containing a non-positive index on (at least) one subsample&quot;</span>,</span>
<span id="cb58-33"><a href="css.html#cb58-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-34"><a href="css.html#cb58-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-35"><a href="css.html#cb58-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-36"><a href="css.html#cb58-36" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-37"><a href="css.html#cb58-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun returned a vector containing NA values on (at least) one subsample&quot;</span>,</span>
<span id="cb58-38"><a href="css.html#cb58-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-39"><a href="css.html#cb58-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-40"><a href="css.html#cb58-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLoopOutput'>checkCssLoopOutput</a>(<span class="at">selected=</span><span class="fu">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>), <span class="at">p=</span><span class="dv">7</span>,</span>
<span id="cb58-41"><a href="css.html#cb58-41" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">feats_on_subsamp=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>),</span>
<span id="cb58-42"><a href="css.html#cb58-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;The provided feature selection method fitfun failed to return an integer or numeric vector on (at least) one subsample&quot;</span>,</span>
<span id="cb58-43"><a href="css.html#cb58-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb58-44"><a href="css.html#cb58-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-45"><a href="css.html#cb58-45" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🌈</code></pre>
<p><code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="css.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the inputs to `<a href='css.html#cssLasso'>cssLasso</a>()` are as expected. </span></span>
<span id="cb60-2"><a href="css.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb60-3"><a href="css.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X A design matrix containing the predictors. (Note that we don&#39;t need</span></span>
<span id="cb60-4"><a href="css.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to check X very much, because X will have already been checked by the</span></span>
<span id="cb60-5"><a href="css.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function `<a href='css.html#checkCssInputs'>checkCssInputs</a>()` when it was provided to `<a href='css.html#css'>css</a>()`.)</span></span>
<span id="cb60-6"><a href="css.html#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A numeric vector containing the response.</span></span>
<span id="cb60-7"><a href="css.html#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda Numeric; a nonnegative number for the lasso penalty to use</span></span>
<span id="cb60-8"><a href="css.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on each subsample. (For now, only one lambda value can be provided to</span></span>
<span id="cb60-9"><a href="css.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; `<a href='css.html#cssLasso'>cssLasso</a>()`; in the future, we plan to allow for multiple lambda values to be</span></span>
<span id="cb60-10"><a href="css.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to `<a href='css.html#cssLasso'>cssLasso</a>()`, as described in Faletto and Bien 2022.)</span></span>
<span id="cb60-11"><a href="css.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb60-12"><a href="css.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span id='checkCssLassoInputs'>checkCssLassoInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb60-13"><a href="css.html#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="css.html#cb60-14" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb60-15"><a href="css.html#cb60-15" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb60-16"><a href="css.html#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="css.html#cb60-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y)){</span>
<span id="cb60-18"><a href="css.html#cb60-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>)</span>
<span id="cb60-19"><a href="css.html#cb60-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-20"><a href="css.html#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.matrix</span>(y)){</span>
<span id="cb60-21"><a href="css.html#cb60-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a numeric vector (inputted y was a matrix).&quot;</span>)</span>
<span id="cb60-22"><a href="css.html#cb60-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-23"><a href="css.html#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n <span class="sc">!=</span> <span class="fu">length</span>(y)){</span>
<span id="cb60-24"><a href="css.html#cb60-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, y must be a vector of length equal to nrow(X).&quot;</span>)</span>
<span id="cb60-25"><a href="css.html#cb60-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-26"><a href="css.html#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unique</span>(y)) <span class="sc">&lt;=</span> <span class="dv">1</span>){</span>
<span id="cb60-27"><a href="css.html#cb60-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Subsample with only one unique value of y detected--for method cssLasso, all subsamples of y of size floor(n/2) must have more than one unique value.&quot;</span>)</span>
<span id="cb60-28"><a href="css.html#cb60-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-29"><a href="css.html#cb60-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(lambda) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(lambda)){</span>
<span id="cb60-30"><a href="css.html#cb60-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be a numeric.&quot;</span>)</span>
<span id="cb60-31"><a href="css.html#cb60-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-32"><a href="css.html#cb60-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(lambda))){</span>
<span id="cb60-33"><a href="css.html#cb60-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;NA detected in provided lambda input to cssLasso&quot;</span>)</span>
<span id="cb60-34"><a href="css.html#cb60-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-35"><a href="css.html#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(lambda) <span class="sc">!=</span> <span class="dv">1</span>){</span>
<span id="cb60-36"><a href="css.html#cb60-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>)</span>
<span id="cb60-37"><a href="css.html#cb60-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-38"><a href="css.html#cb60-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(lambda <span class="sc">&lt;</span> <span class="dv">0</span>){</span>
<span id="cb60-39"><a href="css.html#cb60-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>)</span>
<span id="cb60-40"><a href="css.html#cb60-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-41"><a href="css.html#cb60-41" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="css.html#cb61-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCssLassoInputs works&quot;</span>, {</span>
<span id="cb61-2"><a href="css.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">761</span>)</span>
<span id="cb61-3"><a href="css.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-4"><a href="css.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span><span class="sc">*</span><span class="dv">4</span>), <span class="at">nrow=</span><span class="dv">15</span>, <span class="at">ncol=</span><span class="dv">4</span>)</span>
<span id="cb61-5"><a href="css.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">15</span>)</span>
<span id="cb61-6"><a href="css.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-7"><a href="css.html#cb61-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>))</span>
<span id="cb61-8"><a href="css.html#cb61-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-9"><a href="css.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="fu">logical</span>(<span class="dv">15</span>), <span class="at">lambda=</span><span class="fl">0.05</span>),</span>
<span id="cb61-10"><a href="css.html#cb61-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>,</span>
<span id="cb61-11"><a href="css.html#cb61-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-12"><a href="css.html#cb61-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-13"><a href="css.html#cb61-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>, ], <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>),</span>
<span id="cb61-14"><a href="css.html#cb61-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a vector of length equal to nrow(X).&quot;</span>,</span>
<span id="cb61-15"><a href="css.html#cb61-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-16"><a href="css.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-17"><a href="css.html#cb61-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="fu">rep</span>(<span class="fl">1.2</span>, <span class="dv">15</span>), <span class="at">lambda=</span><span class="fl">0.05</span>),</span>
<span id="cb61-18"><a href="css.html#cb61-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Subsample with only one unique value of y detected--for method cssLasso, all subsamples of y of size floor(n/2) must have more than one unique value.&quot;</span>,</span>
<span id="cb61-19"><a href="css.html#cb61-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-20"><a href="css.html#cb61-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-21"><a href="css.html#cb61-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="cn">TRUE</span>),</span>
<span id="cb61-22"><a href="css.html#cb61-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric.&quot;</span>,</span>
<span id="cb61-23"><a href="css.html#cb61-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-24"><a href="css.html#cb61-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-25"><a href="css.html#cb61-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)),</span>
<span id="cb61-26"><a href="css.html#cb61-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;NA detected in provided lambda input to cssLasso&quot;</span>,</span>
<span id="cb61-27"><a href="css.html#cb61-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-28"><a href="css.html#cb61-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-29"><a href="css.html#cb61-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="sc">-</span><span class="fl">0.01</span>),</span>
<span id="cb61-30"><a href="css.html#cb61-30" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>,</span>
<span id="cb61-31"><a href="css.html#cb61-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-32"><a href="css.html#cb61-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-33"><a href="css.html#cb61-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span>x),</span>
<span id="cb61-34"><a href="css.html#cb61-34" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb61-35"><a href="css.html#cb61-35" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-36"><a href="css.html#cb61-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-37"><a href="css.html#cb61-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fu">numeric</span>()),</span>
<span id="cb61-38"><a href="css.html#cb61-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb61-39"><a href="css.html#cb61-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-40"><a href="css.html#cb61-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-41"><a href="css.html#cb61-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="sc">-</span><span class="fl">0.01</span>),</span>
<span id="cb61-42"><a href="css.html#cb61-42" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be nonnegative.&quot;</span>,</span>
<span id="cb61-43"><a href="css.html#cb61-43" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-44"><a href="css.html#cb61-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-45"><a href="css.html#cb61-45" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🌈</code></pre>
<p>Tests for <code><a href='css.html#cssLoop'>cssLoop</a>()</code> (had to define <code><a href='css.html#checkCssLassoInputs'>checkCssLassoInputs</a>()</code> first):</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="css.html#cb63-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;cssLoop works&quot;</span>, {</span>
<span id="cb63-2"><a href="css.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">89134</span>)</span>
<span id="cb63-3"><a href="css.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="css.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">9</span><span class="sc">*</span><span class="dv">8</span>), <span class="at">nrow=</span><span class="dv">9</span>, <span class="at">ncol=</span><span class="dv">8</span>)</span>
<span id="cb63-5"><a href="css.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">9</span>)</span>
<span id="cb63-6"><a href="css.html#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="css.html#cb63-7" aria-hidden="true" tabindex="-1"></a>  output <span class="ot">&lt;-</span> <a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.05</span>,</span>
<span id="cb63-8"><a href="css.html#cb63-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fitfun=</span>cssLasso)</span>
<span id="cb63-9"><a href="css.html#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="css.html#cb63-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(output))</span>
<span id="cb63-11"><a href="css.html#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="css.html#cb63-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(output), <span class="fu">length</span>(<span class="fu">unique</span>(output)))</span>
<span id="cb63-13"><a href="css.html#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="css.html#cb63-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(output) <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb63-15"><a href="css.html#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="css.html#cb63-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb63-17"><a href="css.html#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="css.html#cb63-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output <span class="sc">&lt;=</span> <span class="dv">8</span>))</span>
<span id="cb63-19"><a href="css.html#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="css.html#cb63-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>6L, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.05</span>,</span>
<span id="cb63-21"><a href="css.html#cb63-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb63-22"><a href="css.html#cb63-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;floor(n/2) == length(subsample) is not TRUE&quot;</span>,</span>
<span id="cb63-23"><a href="css.html#cb63-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb63-24"><a href="css.html#cb63-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-25"><a href="css.html#cb63-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>],</span>
<span id="cb63-26"><a href="css.html#cb63-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span><span class="fl">0.05</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb63-27"><a href="css.html#cb63-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(y) == n is not TRUE&quot;</span>,</span>
<span id="cb63-28"><a href="css.html#cb63-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb63-29"><a href="css.html#cb63-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-30"><a href="css.html#cb63-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span><span class="fu">logical</span>(<span class="dv">9</span>),</span>
<span id="cb63-31"><a href="css.html#cb63-31" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span><span class="fl">0.05</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb63-32"><a href="css.html#cb63-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, y must be a numeric vector.&quot;</span>,</span>
<span id="cb63-33"><a href="css.html#cb63-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb63-34"><a href="css.html#cb63-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-35"><a href="css.html#cb63-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb63-36"><a href="css.html#cb63-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">lambda=</span>x, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb63-37"><a href="css.html#cb63-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;For method cssLasso, lambda must be a numeric of length 1.&quot;</span>,</span>
<span id="cb63-38"><a href="css.html#cb63-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb63-39"><a href="css.html#cb63-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-40"><a href="css.html#cb63-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test other input format</span></span>
<span id="cb63-41"><a href="css.html#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="css.html#cb63-42" aria-hidden="true" tabindex="-1"></a>  alt_input <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;subsample&quot;</span><span class="ot">=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;feats_to_keep&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="dv">4</span>),</span>
<span id="cb63-43"><a href="css.html#cb63-43" aria-hidden="true" tabindex="-1"></a>                                                       <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">2</span>), <span class="cn">TRUE</span>))</span>
<span id="cb63-44"><a href="css.html#cb63-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-45"><a href="css.html#cb63-45" aria-hidden="true" tabindex="-1"></a>  output2 <span class="ot">&lt;-</span> <a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>alt_input, <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.08</span>, <span class="at">fitfun=</span>cssLasso)</span>
<span id="cb63-46"><a href="css.html#cb63-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-47"><a href="css.html#cb63-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(output2))</span>
<span id="cb63-48"><a href="css.html#cb63-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-49"><a href="css.html#cb63-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(output2), <span class="fu">length</span>(<span class="fu">unique</span>(output2)))</span>
<span id="cb63-50"><a href="css.html#cb63-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-51"><a href="css.html#cb63-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(output2) <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb63-52"><a href="css.html#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="css.html#cb63-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(output2 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">8</span>)))</span>
<span id="cb63-54"><a href="css.html#cb63-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-55"><a href="css.html#cb63-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span> <span class="fu">list</span>(<span class="st">&quot;subsample&quot;</span><span class="ot">=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb63-56"><a href="css.html#cb63-56" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;feats_to_keep&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="cn">FALSE</span>,</span>
<span id="cb63-57"><a href="css.html#cb63-57" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="dv">4</span>),</span>
<span id="cb63-58"><a href="css.html#cb63-58" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="dv">2</span>))),</span>
<span id="cb63-59"><a href="css.html#cb63-59" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.08</span>, <span class="at">fitfun=</span>cssLasso),</span>
<span id="cb63-60"><a href="css.html#cb63-60" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(feats_to_keep) == p is not TRUE&quot;</span>,</span>
<span id="cb63-61"><a href="css.html#cb63-61" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb63-62"><a href="css.html#cb63-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-63"><a href="css.html#cb63-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Custom fitfun with nonsense lambda (which will be ignored by fitfun, and</span></span>
<span id="cb63-64"><a href="css.html#cb63-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># shouldn&#39;t throw any error, because the acceptable input for lambda should be</span></span>
<span id="cb63-65"><a href="css.html#cb63-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># enforced only by fitfun) and nonsense y</span></span>
<span id="cb63-66"><a href="css.html#cb63-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-67"><a href="css.html#cb63-67" aria-hidden="true" tabindex="-1"></a>  <span id='testFitfun'>testFitfun</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, lambda){</span>
<span id="cb63-68"><a href="css.html#cb63-68" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb63-69"><a href="css.html#cb63-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb63-70"><a href="css.html#cb63-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Choose p/2 features randomly</span></span>
<span id="cb63-71"><a href="css.html#cb63-71" aria-hidden="true" tabindex="-1"></a>    selected <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(p, <span class="at">size=</span><span class="fu">floor</span>(p<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb63-72"><a href="css.html#cb63-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(selected)</span>
<span id="cb63-73"><a href="css.html#cb63-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-74"><a href="css.html#cb63-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-75"><a href="css.html#cb63-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x, <span class="at">y=</span>y,</span>
<span id="cb63-76"><a href="css.html#cb63-76" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">lambda=</span><span class="cn">TRUE</span>, <span class="at">fitfun=</span>testFitfun)))</span>
<span id="cb63-77"><a href="css.html#cb63-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-78"><a href="css.html#cb63-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(<a href='css.html#cssLoop'>cssLoop</a>(<span class="at">input=</span>1L<span class="sc">:</span>4L, <span class="at">x=</span>x,</span>
<span id="cb63-79"><a href="css.html#cb63-79" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">y=</span><span class="fu">character</span>(<span class="dv">9</span>), <span class="at">lambda=</span>.<span class="dv">05</span>,</span>
<span id="cb63-80"><a href="css.html#cb63-80" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">fitfun=</span>testFitfun)))</span>
<span id="cb63-81"><a href="css.html#cb63-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-82"><a href="css.html#cb63-82" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎊</code></pre>
<p><code><a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>()</code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="css.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to check inputs to getClusterSelMatrix function</span></span>
<span id="cb65-2"><a href="css.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb65-3"><a href="css.html#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb65-4"><a href="css.html#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of formatClusters.</span></span>
<span id="cb65-5"><a href="css.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb65-6"><a href="css.html#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb65-7"><a href="css.html#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb65-8"><a href="css.html#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).</span></span>
<span id="cb65-9"><a href="css.html#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param res A binary integer matrix. res[i, j] = 1 if feature j was selected</span></span>
<span id="cb65-10"><a href="css.html#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on subsample i and equals 0 otherwise, as in the output of getSelMatrix.</span></span>
<span id="cb65-11"><a href="css.html#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (That is, each row is a selected set.)</span></span>
<span id="cb65-12"><a href="css.html#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The parameter B, corresponding to half of the subsamples for </span></span>
<span id="cb65-13"><a href="css.html#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sampling_type &quot;SS&quot;.</span></span>
<span id="cb65-14"><a href="css.html#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb65-15"><a href="css.html#cb65-15" aria-hidden="true" tabindex="-1"></a><span id='checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(clusters, res){</span>
<span id="cb65-16"><a href="css.html#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb65-17"><a href="css.html#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(res <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb65-18"><a href="css.html#cb65-18" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(res)</span>
<span id="cb65-19"><a href="css.html#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(res) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb65-20"><a href="css.html#cb65-20" aria-hidden="true" tabindex="-1"></a>    <a href='css.html#checkClusters'>checkClusters</a>(clusters, p)</span>
<span id="cb65-21"><a href="css.html#cb65-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>()</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="css.html#cb66-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGetClusterSelMatrixInput works&quot;</span>, {</span>
<span id="cb66-2"><a href="css.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-3"><a href="css.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">happy=</span>1L<span class="sc">:</span>8L, <span class="at">sad=</span>9L<span class="sc">:</span>10L, <span class="at">med=</span>11L)</span>
<span id="cb66-4"><a href="css.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-5"><a href="css.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">size=</span><span class="dv">6</span><span class="sc">*</span><span class="dv">11</span>, <span class="at">replace=</span><span class="cn">TRUE</span>), <span class="at">nrow=</span><span class="dv">6</span>, <span class="at">ncol=</span><span class="dv">11</span>)</span>
<span id="cb66-6"><a href="css.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-7"><a href="css.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, res))</span>
<span id="cb66-8"><a href="css.html#cb66-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-9"><a href="css.html#cb66-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">happy=</span>1L<span class="sc">:</span>8L,</span>
<span id="cb66-10"><a href="css.html#cb66-10" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">med=</span>11L), res),</span>
<span id="cb66-11"><a href="css.html#cb66-11" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb66-12"><a href="css.html#cb66-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-13"><a href="css.html#cb66-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-14"><a href="css.html#cb66-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>),</span>
<span id="cb66-15"><a href="css.html#cb66-15" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.matrix(res) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-16"><a href="css.html#cb66-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-17"><a href="css.html#cb66-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters, res <span class="sc">+</span> .<span class="dv">3</span>),</span>
<span id="cb66-18"><a href="css.html#cb66-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(res %in% c(0, 1)) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-19"><a href="css.html#cb66-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-20"><a href="css.html#cb66-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(good_clusters,</span>
<span id="cb66-21"><a href="css.html#cb66-21" aria-hidden="true" tabindex="-1"></a>                                                       res[, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]),</span>
<span id="cb66-22"><a href="css.html#cb66-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb66-23"><a href="css.html#cb66-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-24"><a href="css.html#cb66-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-25"><a href="css.html#cb66-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(1L<span class="sc">:</span>10L, res),</span>
<span id="cb66-26"><a href="css.html#cb66-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(clusters) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-27"><a href="css.html#cb66-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-28"><a href="css.html#cb66-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb66-29"><a href="css.html#cb66-29" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L,</span>
<span id="cb66-30"><a href="css.html#cb66-30" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c3=</span>9L,</span>
<span id="cb66-31"><a href="css.html#cb66-31" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">c4=</span><span class="fu">integer</span>()), res),</span>
<span id="cb66-32"><a href="css.html#cb66-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(clusters) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb66-33"><a href="css.html#cb66-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-34"><a href="css.html#cb66-34" aria-hidden="true" tabindex="-1"></a>                         </span>
<span id="cb66-35"><a href="css.html#cb66-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb66-36"><a href="css.html#cb66-36" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb66-37"><a href="css.html#cb66-37" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c4=</span><span class="fu">as.integer</span>(<span class="cn">NA</span>)), res),</span>
<span id="cb66-38"><a href="css.html#cb66-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb66-39"><a href="css.html#cb66-39" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-40"><a href="css.html#cb66-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-41"><a href="css.html#cb66-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb66-42"><a href="css.html#cb66-42" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>9L,</span>
<span id="cb66-43"><a href="css.html#cb66-43" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L), res),</span>
<span id="cb66-44"><a href="css.html#cb66-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb66-45"><a href="css.html#cb66-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-46"><a href="css.html#cb66-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-47"><a href="css.html#cb66-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='css.html#checkGetClusterSelMatrixInput'>checkGetClusterSelMatrixInput</a>(<span class="fu">list</span>(<span class="at">c1=</span>1L<span class="sc">:</span>5L,</span>
<span id="cb66-48"><a href="css.html#cb66-48" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">c2=</span>6L<span class="sc">:</span>8L, <span class="at">c3=</span>14L), res),</span>
<span id="cb66-49"><a href="css.html#cb66-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb66-50"><a href="css.html#cb66-50" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb66-51"><a href="css.html#cb66-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-52"><a href="css.html#cb66-52" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="overview.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tests-for-main-functions-in-cssr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
