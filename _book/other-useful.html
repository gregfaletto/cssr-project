<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Other useful functions | Creating the cssr R package</title>
  <meta name="description" content="6 Other useful functions | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Other useful functions | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Other useful functions | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-02-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sel-and-pred.html"/>
<link rel="next" href="wrapper-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="css.html"><a href="css.html#main-components-of-css"><i class="fa fa-check"></i><b>3.1</b> Main components of <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="css.html"><a href="css.html#generating-subsamples"><i class="fa fa-check"></i><b>3.1.1</b> Generating subsamples</a></li>
<li class="chapter" data-level="3.1.2" data-path="css.html"><a href="css.html#forming-selection-matrices"><i class="fa fa-check"></i><b>3.1.2</b> Forming selection matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="css.html"><a href="css.html#helper-functions"><i class="fa fa-check"></i><b>3.2</b> Helper functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tests-for-main-functions-in-cssr.html"><a href="tests-for-main-functions-in-cssr.html"><i class="fa fa-check"></i><b>4</b> Tests for main functions in <code>cssr</code></a></li>
<li class="chapter" data-level="5" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>5</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="6" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>6</b> Other useful functions</a></li>
<li class="chapter" data-level="7" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>7</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="8" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>8</b> Competitor Methods</a></li>
<li class="chapter" data-level="9" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><i class="fa fa-check"></i><b>9</b> Documenting the package and adding README and pkgdown website</a>
<ul>
<li class="chapter" data-level="9.1" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-readme"><i class="fa fa-check"></i><b>9.1</b> Add README</a></li>
<li class="chapter" data-level="9.2" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-pkdgown-site"><i class="fa fa-check"></i><b>9.2</b> Add pkdgown site</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="other-useful" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Other useful functions<a href="other-useful.html#other-useful" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following are some other functions that are useful for specific tasks.</p>
<ul>
<li><p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code> generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature (the latent features themselves are also provided), as in the simulation in Example 1, Section 5.1, and Section 5.2 of Faletto and Bien (2022).</p></li>
<li><p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code> generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature with unequal correlations (the latent features themselves are also provided), as in the simulation Section 5.3 of Faletto and Bien (2022).</p></li>
<li><p><code><a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>()</code> generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature with unequal correlations (the latent features themselves are also provided) that are determined at random.</p></li>
<li><p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code> uses a data set to choose a good value of lambda for subsamples of size n/2 (as in cluster stability selection) by cross-validation.</p></li>
<li><p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code> estimates the best size for a lasso model on a provided data set.</p></li>
<li><p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code> converts the output of the <code><a href='css.html#css'>css</a>()</code> function (an object of class cssr) to a data.frame that is ready to be printed. We provide end-user access to <code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code> because this data.frame itself may be useful as an object that summarizes the output from <code><a href='css.html#css'>css</a>()</code>.</p></li>
<li><p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code> is the print function for objects of class cssr.</p></li>
<li><p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code> checks that the inputs to <code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code> are as expected.</li>
<li><code><a href='other-useful.html#genZmuY'>genZmuY</a>()</code> generates the latent Z, the weak signal and noise features in X, the latent mu, and the observed y from the specified parameters.</li>
<li><code><a href='other-useful.html#getNoiseVar'>getNoiseVar</a>()</code> calculates the variance of the noise to add to Z so that the proxies have the specified correlation with each other.</li>
</ul></li>
<li><p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>()</code> verifies the inputs to <code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code>.</li>
</ul></li>
<li><p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code></p></li>
<li><p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code></p></li>
<li><p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code> identifies the prototypes from selected clusters (the feature in each cluster that is most correlated with the response)</li>
</ul></li>
<li><p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code></p></li>
</ul>
<p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="other-useful.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb131-2"><a href="other-useful.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables</span></span>
<span id="cb131-3"><a href="other-useful.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb131-4"><a href="other-useful.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb131-5"><a href="other-useful.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb131-6"><a href="other-useful.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb131-7"><a href="other-useful.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb131-8"><a href="other-useful.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb131-9"><a href="other-useful.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Faletto and Bien (2022).</span></span>
<span id="cb131-10"><a href="other-useful.html#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb131-11"><a href="other-useful.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb131-12"><a href="other-useful.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb131-13"><a href="other-useful.html#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb131-14"><a href="other-useful.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb131-15"><a href="other-useful.html#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb131-16"><a href="other-useful.html#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb131-17"><a href="other-useful.html#cb131-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb131-18"><a href="other-useful.html#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb131-19"><a href="other-useful.html#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered. Must be at least 1.</span></span>
<span id="cb131-20"><a href="other-useful.html#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb131-21"><a href="other-useful.html#cb131-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb131-22"><a href="other-useful.html#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable. Must be at least 2.</span></span>
<span id="cb131-23"><a href="other-useful.html#cb131-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb131-24"><a href="other-useful.html#cb131-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb131-25"><a href="other-useful.html#cb131-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb131-26"><a href="other-useful.html#cb131-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb131-27"><a href="other-useful.html#cb131-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb131-28"><a href="other-useful.html#cb131-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb131-29"><a href="other-useful.html#cb131-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb131-30"><a href="other-useful.html#cb131-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the correlation of the proxies in each cluster</span></span>
<span id="cb131-31"><a href="other-useful.html#cb131-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable. Must be greater than 0. Default is 0.9.</span></span>
<span id="cb131-32"><a href="other-useful.html#cb131-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb131-33"><a href="other-useful.html#cb131-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb131-34"><a href="other-useful.html#cb131-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb131-35"><a href="other-useful.html#cb131-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb131-36"><a href="other-useful.html#cb131-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb131-37"><a href="other-useful.html#cb131-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb131-38"><a href="other-useful.html#cb131-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb131-39"><a href="other-useful.html#cb131-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb131-40"><a href="other-useful.html#cb131-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb131-41"><a href="other-useful.html#cb131-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb131-42"><a href="other-useful.html#cb131-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb131-43"><a href="other-useful.html#cb131-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb131-44"><a href="other-useful.html#cb131-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb131-45"><a href="other-useful.html#cb131-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb131-46"><a href="other-useful.html#cb131-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb131-47"><a href="other-useful.html#cb131-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb131-48"><a href="other-useful.html#cb131-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb131-49"><a href="other-useful.html#cb131-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb131-50"><a href="other-useful.html#cb131-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb131-51"><a href="other-useful.html#cb131-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb131-52"><a href="other-useful.html#cb131-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb131-53"><a href="other-useful.html#cb131-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb131-54"><a href="other-useful.html#cb131-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb131-55"><a href="other-useful.html#cb131-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb131-56"><a href="other-useful.html#cb131-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb131-57"><a href="other-useful.html#cb131-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb131-58"><a href="other-useful.html#cb131-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb131-59"><a href="other-useful.html#cb131-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb131-60"><a href="other-useful.html#cb131-60" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb131-61"><a href="other-useful.html#cb131-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb131-62"><a href="other-useful.html#cb131-62" aria-hidden="true" tabindex="-1"></a><span id='genClusteredData'>genClusteredData</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb131-63"><a href="other-useful.html#cb131-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span><span class="fl">0.9</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="dv">1</span>,</span>
<span id="cb131-64"><a href="other-useful.html#cb131-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb131-65"><a href="other-useful.html#cb131-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-66"><a href="other-useful.html#cb131-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb131-67"><a href="other-useful.html#cb131-67" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(p, k_unclustered, cluster_size, n_clusters,</span>
<span id="cb131-68"><a href="other-useful.html#cb131-68" aria-hidden="true" tabindex="-1"></a>        sig_clusters, rho, beta_latent, beta_unclustered, snr,</span>
<span id="cb131-69"><a href="other-useful.html#cb131-69" aria-hidden="true" tabindex="-1"></a>        sigma_eps_sq)</span>
<span id="cb131-70"><a href="other-useful.html#cb131-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-71"><a href="other-useful.html#cb131-71" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <a href='other-useful.html#genZmuY'>genZmuY</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">k_unclustered=</span>k_unclustered,</span>
<span id="cb131-72"><a href="other-useful.html#cb131-72" aria-hidden="true" tabindex="-1"></a>        <span class="at">cluster_size=</span>cluster_size, <span class="at">n_clusters=</span>n_clusters,</span>
<span id="cb131-73"><a href="other-useful.html#cb131-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_clusters=</span>sig_clusters, <span class="at">beta_latent=</span>beta_latent,</span>
<span id="cb131-74"><a href="other-useful.html#cb131-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_unclustered=</span>beta_unclustered, <span class="at">snr=</span>snr, <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb131-75"><a href="other-useful.html#cb131-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-76"><a href="other-useful.html#cb131-76" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> ret<span class="sc">$</span>Z</span>
<span id="cb131-77"><a href="other-useful.html#cb131-77" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> ret<span class="sc">$</span>y</span>
<span id="cb131-78"><a href="other-useful.html#cb131-78" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> ret<span class="sc">$</span>mu</span>
<span id="cb131-79"><a href="other-useful.html#cb131-79" aria-hidden="true" tabindex="-1"></a>    other_X <span class="ot">&lt;-</span> ret<span class="sc">$</span>other_X</span>
<span id="cb131-80"><a href="other-useful.html#cb131-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-81"><a href="other-useful.html#cb131-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Finally, generate clusters of proxies to complete X. First, get needed</span></span>
<span id="cb131-82"><a href="other-useful.html#cb131-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># variances of noise to add</span></span>
<span id="cb131-83"><a href="other-useful.html#cb131-83" aria-hidden="true" tabindex="-1"></a>    noise_var <span class="ot">&lt;-</span> <a href='other-useful.html#getNoiseVar'>getNoiseVar</a>(rho)</span>
<span id="cb131-84"><a href="other-useful.html#cb131-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-85"><a href="other-useful.html#cb131-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate these noise features</span></span>
<span id="cb131-86"><a href="other-useful.html#cb131-86" aria-hidden="true" tabindex="-1"></a>    noise_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>n_clusters<span class="sc">*</span>cluster_size, <span class="at">mean=</span><span class="dv">0</span>,</span>
<span id="cb131-87"><a href="other-useful.html#cb131-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd=</span><span class="fu">sqrt</span>(noise_var)), n, n_clusters<span class="sc">*</span>cluster_size)</span>
<span id="cb131-88"><a href="other-useful.html#cb131-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-89"><a href="other-useful.html#cb131-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create matrix of proxies</span></span>
<span id="cb131-90"><a href="other-useful.html#cb131-90" aria-hidden="true" tabindex="-1"></a>    proxy_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), n, n_clusters<span class="sc">*</span>cluster_size)</span>
<span id="cb131-91"><a href="other-useful.html#cb131-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_clusters <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb131-92"><a href="other-useful.html#cb131-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb131-93"><a href="other-useful.html#cb131-93" aria-hidden="true" tabindex="-1"></a>            first_ind <span class="ot">&lt;-</span> (i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>cluster_size <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb131-94"><a href="other-useful.html#cb131-94" aria-hidden="true" tabindex="-1"></a>            last_ind <span class="ot">&lt;-</span> i<span class="sc">*</span>cluster_size</span>
<span id="cb131-95"><a href="other-useful.html#cb131-95" aria-hidden="true" tabindex="-1"></a>            proxy_mat[, first_ind<span class="sc">:</span>last_ind] <span class="ot">&lt;-</span> Z[, i] <span class="sc">+</span></span>
<span id="cb131-96"><a href="other-useful.html#cb131-96" aria-hidden="true" tabindex="-1"></a>                noise_mat[, first_ind<span class="sc">:</span>last_ind]</span>
<span id="cb131-97"><a href="other-useful.html#cb131-97" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb131-98"><a href="other-useful.html#cb131-98" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb131-99"><a href="other-useful.html#cb131-99" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(noise_mat) <span class="sc">==</span> cluster_size)</span>
<span id="cb131-100"><a href="other-useful.html#cb131-100" aria-hidden="true" tabindex="-1"></a>        proxy_mat[, <span class="dv">1</span><span class="sc">:</span>cluster_size] <span class="ot">&lt;-</span> Z <span class="sc">+</span> noise_mat</span>
<span id="cb131-101"><a href="other-useful.html#cb131-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb131-102"><a href="other-useful.html#cb131-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-103"><a href="other-useful.html#cb131-103" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(proxy_mat, other_X)</span>
<span id="cb131-104"><a href="other-useful.html#cb131-104" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Z)</span>
<span id="cb131-105"><a href="other-useful.html#cb131-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-106"><a href="other-useful.html#cb131-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb131-107"><a href="other-useful.html#cb131-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(mu) <span class="sc">==</span> n)</span>
<span id="cb131-108"><a href="other-useful.html#cb131-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-109"><a href="other-useful.html#cb131-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(X) <span class="sc">==</span> n)</span>
<span id="cb131-110"><a href="other-useful.html#cb131-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(X) <span class="sc">==</span> p)</span>
<span id="cb131-111"><a href="other-useful.html#cb131-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-112"><a href="other-useful.html#cb131-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(Z))){</span>
<span id="cb131-113"><a href="other-useful.html#cb131-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Z) <span class="sc">==</span> n)</span>
<span id="cb131-114"><a href="other-useful.html#cb131-114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(Z) <span class="sc">==</span> n_clusters)</span>
<span id="cb131-115"><a href="other-useful.html#cb131-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb131-116"><a href="other-useful.html#cb131-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-117"><a href="other-useful.html#cb131-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>Z, <span class="at">mu=</span>mu))</span>
<span id="cb131-118"><a href="other-useful.html#cb131-118" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="other-useful.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredData</span></span>
<span id="cb132-2"><a href="other-useful.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb132-3"><a href="other-useful.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb132-4"><a href="other-useful.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb132-5"><a href="other-useful.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb132-6"><a href="other-useful.html#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb132-7"><a href="other-useful.html#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb132-8"><a href="other-useful.html#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb132-9"><a href="other-useful.html#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb132-10"><a href="other-useful.html#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb132-11"><a href="other-useful.html#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb132-12"><a href="other-useful.html#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb132-13"><a href="other-useful.html#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb132-14"><a href="other-useful.html#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb132-15"><a href="other-useful.html#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb132-16"><a href="other-useful.html#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb132-17"><a href="other-useful.html#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb132-18"><a href="other-useful.html#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb132-19"><a href="other-useful.html#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb132-20"><a href="other-useful.html#cb132-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb132-21"><a href="other-useful.html#cb132-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb132-22"><a href="other-useful.html#cb132-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. Can&#39;t equal 0. Default is 0.9.</span></span>
<span id="cb132-23"><a href="other-useful.html#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb132-24"><a href="other-useful.html#cb132-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb132-25"><a href="other-useful.html#cb132-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb132-26"><a href="other-useful.html#cb132-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb132-27"><a href="other-useful.html#cb132-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb132-28"><a href="other-useful.html#cb132-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb132-29"><a href="other-useful.html#cb132-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb132-30"><a href="other-useful.html#cb132-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb132-31"><a href="other-useful.html#cb132-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb132-32"><a href="other-useful.html#cb132-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb132-33"><a href="other-useful.html#cb132-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb132-34"><a href="other-useful.html#cb132-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb132-35"><a href="other-useful.html#cb132-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb132-36"><a href="other-useful.html#cb132-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb132-37"><a href="other-useful.html#cb132-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb132-38"><a href="other-useful.html#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb132-39"><a href="other-useful.html#cb132-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb132-40"><a href="other-useful.html#cb132-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb132-41"><a href="other-useful.html#cb132-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb132-42"><a href="other-useful.html#cb132-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb132-43"><a href="other-useful.html#cb132-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb132-44"><a href="other-useful.html#cb132-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb132-45"><a href="other-useful.html#cb132-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb132-46"><a href="other-useful.html#cb132-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb132-47"><a href="other-useful.html#cb132-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb132-48"><a href="other-useful.html#cb132-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb132-49"><a href="other-useful.html#cb132-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb132-50"><a href="other-useful.html#cb132-50" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataInputs'>checkGenClusteredDataInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered, cluster_size,</span>
<span id="cb132-51"><a href="other-useful.html#cb132-51" aria-hidden="true" tabindex="-1"></a>    n_clusters, sig_clusters, rho, beta_latent, beta_unclustered, snr,</span>
<span id="cb132-52"><a href="other-useful.html#cb132-52" aria-hidden="true" tabindex="-1"></a>    sigma_eps_sq){</span>
<span id="cb132-53"><a href="other-useful.html#cb132-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-54"><a href="other-useful.html#cb132-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb132-55"><a href="other-useful.html#cb132-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb132-56"><a href="other-useful.html#cb132-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb132-57"><a href="other-useful.html#cb132-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb132-58"><a href="other-useful.html#cb132-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-59"><a href="other-useful.html#cb132-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb132-60"><a href="other-useful.html#cb132-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb132-61"><a href="other-useful.html#cb132-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb132-62"><a href="other-useful.html#cb132-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb132-63"><a href="other-useful.html#cb132-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb132-64"><a href="other-useful.html#cb132-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb132-65"><a href="other-useful.html#cb132-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb132-66"><a href="other-useful.html#cb132-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb132-67"><a href="other-useful.html#cb132-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-68"><a href="other-useful.html#cb132-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb132-69"><a href="other-useful.html#cb132-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-70"><a href="other-useful.html#cb132-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb132-71"><a href="other-useful.html#cb132-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-72"><a href="other-useful.html#cb132-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb132-73"><a href="other-useful.html#cb132-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb132-74"><a href="other-useful.html#cb132-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-75"><a href="other-useful.html#cb132-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb132-76"><a href="other-useful.html#cb132-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb132-77"><a href="other-useful.html#cb132-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb132-78"><a href="other-useful.html#cb132-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-79"><a href="other-useful.html#cb132-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb132-80"><a href="other-useful.html#cb132-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-81"><a href="other-useful.html#cb132-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb132-82"><a href="other-useful.html#cb132-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb132-83"><a href="other-useful.html#cb132-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb132-84"><a href="other-useful.html#cb132-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb132-85"><a href="other-useful.html#cb132-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb132-86"><a href="other-useful.html#cb132-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-87"><a href="other-useful.html#cb132-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-88"><a href="other-useful.html#cb132-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr)){</span>
<span id="cb132-89"><a href="other-useful.html#cb132-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)))</span>
<span id="cb132-90"><a href="other-useful.html#cb132-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sigma_eps_sq) <span class="sc">|</span> <span class="fu">is.integer</span>(sigma_eps_sq))</span>
<span id="cb132-91"><a href="other-useful.html#cb132-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(sigma_eps_sq) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb132-92"><a href="other-useful.html#cb132-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb132-93"><a href="other-useful.html#cb132-93" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb132-94"><a href="other-useful.html#cb132-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(snr) <span class="sc">|</span> <span class="fu">is.integer</span>(snr))</span>
<span id="cb132-95"><a href="other-useful.html#cb132-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(snr) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb132-96"><a href="other-useful.html#cb132-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb132-97"><a href="other-useful.html#cb132-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-98"><a href="other-useful.html#cb132-98" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="other-useful.html#cb133-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGenClusteredDataInputs works&quot;</span>, {</span>
<span id="cb133-2"><a href="other-useful.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb133-3"><a href="other-useful.html#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="other-useful.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Should get no error</span></span>
<span id="cb133-5"><a href="other-useful.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-6"><a href="other-useful.html#cb133-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-7"><a href="other-useful.html#cb133-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb133-8"><a href="other-useful.html#cb133-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-9"><a href="other-useful.html#cb133-9" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-10"><a href="other-useful.html#cb133-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-11"><a href="other-useful.html#cb133-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb133-12"><a href="other-useful.html#cb133-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-13"><a href="other-useful.html#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sig_clusters</span></span>
<span id="cb133-14"><a href="other-useful.html#cb133-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-15"><a href="other-useful.html#cb133-15" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-16"><a href="other-useful.html#cb133-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-17"><a href="other-useful.html#cb133-17" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-18"><a href="other-useful.html#cb133-18" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-19"><a href="other-useful.html#cb133-19" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-20"><a href="other-useful.html#cb133-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-21"><a href="other-useful.html#cb133-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-22"><a href="other-useful.html#cb133-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-23"><a href="other-useful.html#cb133-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-24"><a href="other-useful.html#cb133-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-25"><a href="other-useful.html#cb133-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-26"><a href="other-useful.html#cb133-26" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-27"><a href="other-useful.html#cb133-27" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-28"><a href="other-useful.html#cb133-28" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-29"><a href="other-useful.html#cb133-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-30"><a href="other-useful.html#cb133-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-31"><a href="other-useful.html#cb133-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-32"><a href="other-useful.html#cb133-32" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-33"><a href="other-useful.html#cb133-33" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-34"><a href="other-useful.html#cb133-34" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-35"><a href="other-useful.html#cb133-35" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-36"><a href="other-useful.html#cb133-36" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-37"><a href="other-useful.html#cb133-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-38"><a href="other-useful.html#cb133-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-39"><a href="other-useful.html#cb133-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-40"><a href="other-useful.html#cb133-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-41"><a href="other-useful.html#cb133-41" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-42"><a href="other-useful.html#cb133-42" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-43"><a href="other-useful.html#cb133-43" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-44"><a href="other-useful.html#cb133-44" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-45"><a href="other-useful.html#cb133-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-46"><a href="other-useful.html#cb133-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-47"><a href="other-useful.html#cb133-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-48"><a href="other-useful.html#cb133-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-49"><a href="other-useful.html#cb133-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb133-50"><a href="other-useful.html#cb133-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-51"><a href="other-useful.html#cb133-51" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb133-52"><a href="other-useful.html#cb133-52" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb133-53"><a href="other-useful.html#cb133-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-54"><a href="other-useful.html#cb133-54" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-55"><a href="other-useful.html#cb133-55" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-56"><a href="other-useful.html#cb133-56" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-57"><a href="other-useful.html#cb133-57" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-58"><a href="other-useful.html#cb133-58" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-59"><a href="other-useful.html#cb133-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-60"><a href="other-useful.html#cb133-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-61"><a href="other-useful.html#cb133-61" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb133-62"><a href="other-useful.html#cb133-62" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-63"><a href="other-useful.html#cb133-63" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-64"><a href="other-useful.html#cb133-64" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-65"><a href="other-useful.html#cb133-65" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-66"><a href="other-useful.html#cb133-66" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-67"><a href="other-useful.html#cb133-67" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-68"><a href="other-useful.html#cb133-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-69"><a href="other-useful.html#cb133-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-70"><a href="other-useful.html#cb133-70" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb133-71"><a href="other-useful.html#cb133-71" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-72"><a href="other-useful.html#cb133-72" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-73"><a href="other-useful.html#cb133-73" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-74"><a href="other-useful.html#cb133-74" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-75"><a href="other-useful.html#cb133-75" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-76"><a href="other-useful.html#cb133-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-77"><a href="other-useful.html#cb133-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-78"><a href="other-useful.html#cb133-78" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-79"><a href="other-useful.html#cb133-79" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-80"><a href="other-useful.html#cb133-80" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-81"><a href="other-useful.html#cb133-81" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-82"><a href="other-useful.html#cb133-82" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-83"><a href="other-useful.html#cb133-83" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 2 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-84"><a href="other-useful.html#cb133-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-85"><a href="other-useful.html#cb133-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-86"><a href="other-useful.html#cb133-86" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-87"><a href="other-useful.html#cb133-87" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-88"><a href="other-useful.html#cb133-88" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-89"><a href="other-useful.html#cb133-89" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-90"><a href="other-useful.html#cb133-90" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-91"><a href="other-useful.html#cb133-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb133-92"><a href="other-useful.html#cb133-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-93"><a href="other-useful.html#cb133-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-94"><a href="other-useful.html#cb133-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-95"><a href="other-useful.html#cb133-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-96"><a href="other-useful.html#cb133-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb133-97"><a href="other-useful.html#cb133-97" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-98"><a href="other-useful.html#cb133-98" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-99"><a href="other-useful.html#cb133-99" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-100"><a href="other-useful.html#cb133-100" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-101"><a href="other-useful.html#cb133-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-102"><a href="other-useful.html#cb133-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-103"><a href="other-useful.html#cb133-103" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-104"><a href="other-useful.html#cb133-104" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-105"><a href="other-useful.html#cb133-105" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb133-106"><a href="other-useful.html#cb133-106" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-107"><a href="other-useful.html#cb133-107" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-108"><a href="other-useful.html#cb133-108" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-109"><a href="other-useful.html#cb133-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-110"><a href="other-useful.html#cb133-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-111"><a href="other-useful.html#cb133-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-112"><a href="other-useful.html#cb133-112" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-113"><a href="other-useful.html#cb133-113" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-114"><a href="other-useful.html#cb133-114" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-115"><a href="other-useful.html#cb133-115" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-116"><a href="other-useful.html#cb133-116" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-117"><a href="other-useful.html#cb133-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-118"><a href="other-useful.html#cb133-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb133-119"><a href="other-useful.html#cb133-119" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb133-120"><a href="other-useful.html#cb133-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-121"><a href="other-useful.html#cb133-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-122"><a href="other-useful.html#cb133-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-123"><a href="other-useful.html#cb133-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-124"><a href="other-useful.html#cb133-124" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-125"><a href="other-useful.html#cb133-125" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb133-126"><a href="other-useful.html#cb133-126" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-127"><a href="other-useful.html#cb133-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-128"><a href="other-useful.html#cb133-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb133-129"><a href="other-useful.html#cb133-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-130"><a href="other-useful.html#cb133-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-131"><a href="other-useful.html#cb133-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-132"><a href="other-useful.html#cb133-132" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-133"><a href="other-useful.html#cb133-133" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-134"><a href="other-useful.html#cb133-134" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 2 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-135"><a href="other-useful.html#cb133-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-136"><a href="other-useful.html#cb133-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="fl">2.2</span>,</span>
<span id="cb133-137"><a href="other-useful.html#cb133-137" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-138"><a href="other-useful.html#cb133-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-139"><a href="other-useful.html#cb133-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-140"><a href="other-useful.html#cb133-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-141"><a href="other-useful.html#cb133-141" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-142"><a href="other-useful.html#cb133-142" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb133-143"><a href="other-useful.html#cb133-143" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-144"><a href="other-useful.html#cb133-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-145"><a href="other-useful.html#cb133-145" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-146"><a href="other-useful.html#cb133-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-147"><a href="other-useful.html#cb133-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-148"><a href="other-useful.html#cb133-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-149"><a href="other-useful.html#cb133-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb133-150"><a href="other-useful.html#cb133-150" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-151"><a href="other-useful.html#cb133-151" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-152"><a href="other-useful.html#cb133-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-153"><a href="other-useful.html#cb133-153" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-154"><a href="other-useful.html#cb133-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-155"><a href="other-useful.html#cb133-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-156"><a href="other-useful.html#cb133-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-157"><a href="other-useful.html#cb133-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb133-158"><a href="other-useful.html#cb133-158" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-159"><a href="other-useful.html#cb133-159" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-160"><a href="other-useful.html#cb133-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-161"><a href="other-useful.html#cb133-161" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-162"><a href="other-useful.html#cb133-162" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-163"><a href="other-useful.html#cb133-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-164"><a href="other-useful.html#cb133-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-165"><a href="other-useful.html#cb133-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb133-166"><a href="other-useful.html#cb133-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb133-167"><a href="other-useful.html#cb133-167" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-168"><a href="other-useful.html#cb133-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-169"><a href="other-useful.html#cb133-169" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='other-useful.html#genZmuY'>genZmuY</a>()</code></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="other-useful.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generates Z, weak signal features in X, noise features in X, mu, and y</span></span>
<span id="cb135-2"><a href="other-useful.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from provided parameters</span></span>
<span id="cb135-3"><a href="other-useful.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb135-4"><a href="other-useful.html#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb135-5"><a href="other-useful.html#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb135-6"><a href="other-useful.html#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb135-7"><a href="other-useful.html#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb135-8"><a href="other-useful.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb135-9"><a href="other-useful.html#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb135-10"><a href="other-useful.html#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb135-11"><a href="other-useful.html#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb135-12"><a href="other-useful.html#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb135-13"><a href="other-useful.html#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered. Must be at least 1.</span></span>
<span id="cb135-14"><a href="other-useful.html#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb135-15"><a href="other-useful.html#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb135-16"><a href="other-useful.html#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable. Must be at least 2.</span></span>
<span id="cb135-17"><a href="other-useful.html#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb135-18"><a href="other-useful.html#cb135-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb135-19"><a href="other-useful.html#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb135-20"><a href="other-useful.html#cb135-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb135-21"><a href="other-useful.html#cb135-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb135-22"><a href="other-useful.html#cb135-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb135-23"><a href="other-useful.html#cb135-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb135-24"><a href="other-useful.html#cb135-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb135-25"><a href="other-useful.html#cb135-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb135-26"><a href="other-useful.html#cb135-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb135-27"><a href="other-useful.html#cb135-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb135-28"><a href="other-useful.html#cb135-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb135-29"><a href="other-useful.html#cb135-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb135-30"><a href="other-useful.html#cb135-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb135-31"><a href="other-useful.html#cb135-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb135-32"><a href="other-useful.html#cb135-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb135-33"><a href="other-useful.html#cb135-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb135-34"><a href="other-useful.html#cb135-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb135-35"><a href="other-useful.html#cb135-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb135-36"><a href="other-useful.html#cb135-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb135-37"><a href="other-useful.html#cb135-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{Z}{The</span></span>
<span id="cb135-38"><a href="other-useful.html#cb135-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb135-39"><a href="other-useful.html#cb135-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb135-40"><a href="other-useful.html#cb135-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb135-41"><a href="other-useful.html#cb135-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).} \item{y}{A</span></span>
<span id="cb135-42"><a href="other-useful.html#cb135-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb135-43"><a href="other-useful.html#cb135-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} </span></span>
<span id="cb135-44"><a href="other-useful.html#cb135-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{other_X}{A numeric matrix of n observations from a multivariate normal</span></span>
<span id="cb135-45"><a href="other-useful.html#cb135-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; distribution generated using the specified parameters, containing the weak</span></span>
<span id="cb135-46"><a href="other-useful.html#cb135-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; signal features and the noise features that will eventually be in X. (The</span></span>
<span id="cb135-47"><a href="other-useful.html#cb135-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; only missing features are the proxies for the latent features Z.)</span></span>
<span id="cb135-48"><a href="other-useful.html#cb135-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb135-49"><a href="other-useful.html#cb135-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb135-50"><a href="other-useful.html#cb135-50" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb135-51"><a href="other-useful.html#cb135-51" aria-hidden="true" tabindex="-1"></a><span id='genZmuY'>genZmuY</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size, n_clusters, sig_clusters,</span>
<span id="cb135-52"><a href="other-useful.html#cb135-52" aria-hidden="true" tabindex="-1"></a>    beta_latent, beta_unclustered, snr, sigma_eps_sq){</span>
<span id="cb135-53"><a href="other-useful.html#cb135-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate Z, weak signal features, and noise features (total of</span></span>
<span id="cb135-54"><a href="other-useful.html#cb135-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># p - n_clusters*(cluster_size - 1)) features)</span></span>
<span id="cb135-55"><a href="other-useful.html#cb135-55" aria-hidden="true" tabindex="-1"></a>    p_orig_feat_mat <span class="ot">&lt;-</span> p <span class="sc">-</span> n_clusters<span class="sc">*</span>(cluster_size <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb135-56"><a href="other-useful.html#cb135-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p_orig_feat_mat <span class="sc">&gt;=</span> k_unclustered <span class="sc">+</span> n_clusters)</span>
<span id="cb135-57"><a href="other-useful.html#cb135-57" aria-hidden="true" tabindex="-1"></a>    orig_feat_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(n<span class="sc">*</span>p_orig_feat_mat), n, p_orig_feat_mat)</span>
<span id="cb135-58"><a href="other-useful.html#cb135-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First n_clusters features are Z. Next k_unclustered features are weak</span></span>
<span id="cb135-59"><a href="other-useful.html#cb135-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># signal features. Any remaining features are noise features.</span></span>
<span id="cb135-60"><a href="other-useful.html#cb135-60" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> orig_feat_mat[, <span class="dv">1</span><span class="sc">:</span>n_clusters]</span>
<span id="cb135-61"><a href="other-useful.html#cb135-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-62"><a href="other-useful.html#cb135-62" aria-hidden="true" tabindex="-1"></a>    other_X <span class="ot">&lt;-</span> orig_feat_mat[, (n_clusters <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>p_orig_feat_mat]</span>
<span id="cb135-63"><a href="other-useful.html#cb135-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-64"><a href="other-useful.html#cb135-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ready to create mu and y</span></span>
<span id="cb135-65"><a href="other-useful.html#cb135-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_clusters <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb135-66"><a href="other-useful.html#cb135-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(sig_clusters <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb135-67"><a href="other-useful.html#cb135-67" aria-hidden="true" tabindex="-1"></a>            mu <span class="ot">&lt;-</span> Z[, <span class="dv">1</span><span class="sc">:</span>sig_clusters] <span class="sc">%*%</span> <span class="fu">rep</span>(beta_latent, sig_clusters)</span>
<span id="cb135-68"><a href="other-useful.html#cb135-68" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb135-69"><a href="other-useful.html#cb135-69" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb135-70"><a href="other-useful.html#cb135-70" aria-hidden="true" tabindex="-1"></a>            mu <span class="ot">&lt;-</span> Z[, <span class="dv">1</span><span class="sc">:</span>sig_clusters] <span class="sc">*</span> beta_latent</span>
<span id="cb135-71"><a href="other-useful.html#cb135-71" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-72"><a href="other-useful.html#cb135-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb135-73"><a href="other-useful.html#cb135-73" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> Z<span class="sc">*</span>beta_latent</span>
<span id="cb135-74"><a href="other-useful.html#cb135-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-75"><a href="other-useful.html#cb135-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k_unclustered){</span>
<span id="cb135-76"><a href="other-useful.html#cb135-76" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> mu <span class="sc">+</span> beta_unclustered<span class="sc">/</span><span class="fu">sqrt</span>(j)<span class="sc">*</span>other_X[, j]</span>
<span id="cb135-77"><a href="other-useful.html#cb135-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-78"><a href="other-useful.html#cb135-78" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(mu)</span>
<span id="cb135-79"><a href="other-useful.html#cb135-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-80"><a href="other-useful.html#cb135-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If SNR is null, use sigma_eps_sq</span></span>
<span id="cb135-81"><a href="other-useful.html#cb135-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb135-82"><a href="other-useful.html#cb135-82" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma_eps_sq)</span>
<span id="cb135-83"><a href="other-useful.html#cb135-83" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb135-84"><a href="other-useful.html#cb135-84" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(mu<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">*</span> snr)) <span class="co"># taking snr = ||mu||^2 /(n * sigma^2)</span></span>
<span id="cb135-85"><a href="other-useful.html#cb135-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-86"><a href="other-useful.html#cb135-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-87"><a href="other-useful.html#cb135-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sd) <span class="sc">|</span> <span class="fu">is.integer</span>(sd))</span>
<span id="cb135-88"><a href="other-useful.html#cb135-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sd) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb135-89"><a href="other-useful.html#cb135-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(sd))</span>
<span id="cb135-90"><a href="other-useful.html#cb135-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sd <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb135-91"><a href="other-useful.html#cb135-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-92"><a href="other-useful.html#cb135-92" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(mu <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span>sd))</span>
<span id="cb135-93"><a href="other-useful.html#cb135-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-94"><a href="other-useful.html#cb135-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">Z=</span>Z, <span class="at">mu=</span>mu, <span class="at">y=</span>y, <span class="at">other_X=</span>other_X))</span>
<span id="cb135-95"><a href="other-useful.html#cb135-95" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No tests for <code><a href='other-useful.html#genZmuY'>genZmuY</a>()</code>.</p>
<p><code><a href='other-useful.html#getNoiseVar'>getNoiseVar</a>()</code>:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="other-useful.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get variance of noise to add to Z in order to yield proxies X with desired</span></span>
<span id="cb136-2"><a href="other-useful.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlations with Z</span></span>
<span id="cb136-3"><a href="other-useful.html#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb136-4"><a href="other-useful.html#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cor A numeric vector of desired correlations for each proxy to have</span></span>
<span id="cb136-5"><a href="other-useful.html#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with Z. Note: correlations must be positive.</span></span>
<span id="cb136-6"><a href="other-useful.html#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A vector of variances of independent Gaussian random variables to add</span></span>
<span id="cb136-7"><a href="other-useful.html#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to Z in order to yield proxies with the desired correlations with Z.</span></span>
<span id="cb136-8"><a href="other-useful.html#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb136-9"><a href="other-useful.html#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb136-10"><a href="other-useful.html#cb136-10" aria-hidden="true" tabindex="-1"></a><span id='getNoiseVar'>getNoiseVar</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(cor){</span>
<span id="cb136-11"><a href="other-useful.html#cb136-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Correlation between standard normal Z and X = Z + epsilon where epsilon</span></span>
<span id="cb136-12"><a href="other-useful.html#cb136-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># is normal, independent of Z, and has mean 0 and variance sig_eps_sq:</span></span>
<span id="cb136-13"><a href="other-useful.html#cb136-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb136-14"><a href="other-useful.html#cb136-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   E[Z X]/sqrt{Var(Z) Var(X)}</span></span>
<span id="cb136-15"><a href="other-useful.html#cb136-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># = (E[Z^2] + E[Z*epsilon])/sqrt{1*(1 + sig_eps_sq)}</span></span>
<span id="cb136-16"><a href="other-useful.html#cb136-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># = (1 + 0)/sqrt{1 + sig_eps_sq}</span></span>
<span id="cb136-17"><a href="other-useful.html#cb136-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#</span></span>
<span id="cb136-18"><a href="other-useful.html#cb136-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># So we have</span></span>
<span id="cb136-19"><a href="other-useful.html#cb136-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                 cor = 1/sqrt{1 + sig_eps_sq}</span></span>
<span id="cb136-20"><a href="other-useful.html#cb136-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># \iff 1 + sig_eps_sq = 1/cor^2</span></span>
<span id="cb136-21"><a href="other-useful.html#cb136-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># \iff     sig_eps_sq = 1/cor^2 - 1</span></span>
<span id="cb136-22"><a href="other-useful.html#cb136-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(cor) <span class="sc">|</span> <span class="fu">is.integer</span>(cor))</span>
<span id="cb136-23"><a href="other-useful.html#cb136-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(cor)))</span>
<span id="cb136-24"><a href="other-useful.html#cb136-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(cor) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb136-25"><a href="other-useful.html#cb136-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(cor <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb136-26"><a href="other-useful.html#cb136-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(cor <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb136-27"><a href="other-useful.html#cb136-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span><span class="sc">/</span>cor<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb136-28"><a href="other-useful.html#cb136-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No tests for <code><a href='other-useful.html#getNoiseVar'>getNoiseVar</a>()</code>.</p>
<p>Finally, tests for <code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="other-useful.html#cb137-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredData works&quot;</span>, {</span>
<span id="cb137-2"><a href="other-useful.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb137-3"><a href="other-useful.html#cb137-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-4"><a href="other-useful.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb137-5"><a href="other-useful.html#cb137-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_clusters=</span><span class="dv">3</span>, <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">99</span>,</span>
<span id="cb137-6"><a href="other-useful.html#cb137-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb137-7"><a href="other-useful.html#cb137-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb137-8"><a href="other-useful.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-9"><a href="other-useful.html#cb137-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb137-10"><a href="other-useful.html#cb137-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb137-11"><a href="other-useful.html#cb137-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-12"><a href="other-useful.html#cb137-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb137-13"><a href="other-useful.html#cb137-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb137-14"><a href="other-useful.html#cb137-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb137-15"><a href="other-useful.html#cb137-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb137-16"><a href="other-useful.html#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb137-17"><a href="other-useful.html#cb137-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb137-18"><a href="other-useful.html#cb137-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb137-19"><a href="other-useful.html#cb137-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb137-20"><a href="other-useful.html#cb137-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb137-21"><a href="other-useful.html#cb137-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb137-22"><a href="other-useful.html#cb137-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb137-23"><a href="other-useful.html#cb137-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-24"><a href="other-useful.html#cb137-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb137-25"><a href="other-useful.html#cb137-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb137-26"><a href="other-useful.html#cb137-26" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb137-27"><a href="other-useful.html#cb137-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-28"><a href="other-useful.html#cb137-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb137-29"><a href="other-useful.html#cb137-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb137-30"><a href="other-useful.html#cb137-30" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb137-31"><a href="other-useful.html#cb137-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-32"><a href="other-useful.html#cb137-32" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb137-33"><a href="other-useful.html#cb137-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb137-34"><a href="other-useful.html#cb137-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-35"><a href="other-useful.html#cb137-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb137-36"><a href="other-useful.html#cb137-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb137-37"><a href="other-useful.html#cb137-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-38"><a href="other-useful.html#cb137-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb137-39"><a href="other-useful.html#cb137-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb137-40"><a href="other-useful.html#cb137-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb137-41"><a href="other-useful.html#cb137-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb137-42"><a href="other-useful.html#cb137-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-43"><a href="other-useful.html#cb137-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb137-44"><a href="other-useful.html#cb137-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb137-45"><a href="other-useful.html#cb137-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb137-46"><a href="other-useful.html#cb137-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb137-47"><a href="other-useful.html#cb137-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb137-48"><a href="other-useful.html#cb137-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-49"><a href="other-useful.html#cb137-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb137-50"><a href="other-useful.html#cb137-50" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb137-51"><a href="other-useful.html#cb137-51" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_clusters=</span><span class="dv">3</span>, <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-52"><a href="other-useful.html#cb137-52" aria-hidden="true" tabindex="-1"></a>                          <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb137-53"><a href="other-useful.html#cb137-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-54"><a href="other-useful.html#cb137-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb137-55"><a href="other-useful.html#cb137-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb137-56"><a href="other-useful.html#cb137-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-57"><a href="other-useful.html#cb137-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb137-58"><a href="other-useful.html#cb137-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb137-59"><a href="other-useful.html#cb137-59" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-60"><a href="other-useful.html#cb137-60" aria-hidden="true" tabindex="-1"></a>                          <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-61"><a href="other-useful.html#cb137-61" aria-hidden="true" tabindex="-1"></a>                          <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb137-62"><a href="other-useful.html#cb137-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-63"><a href="other-useful.html#cb137-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb137-64"><a href="other-useful.html#cb137-64" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb137-65"><a href="other-useful.html#cb137-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-66"><a href="other-useful.html#cb137-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb137-67"><a href="other-useful.html#cb137-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb137-68"><a href="other-useful.html#cb137-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">25</span>))</span>
<span id="cb137-69"><a href="other-useful.html#cb137-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-70"><a href="other-useful.html#cb137-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb137-71"><a href="other-useful.html#cb137-71" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb137-72"><a href="other-useful.html#cb137-72" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_clusters=</span><span class="dv">1</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-73"><a href="other-useful.html#cb137-73" aria-hidden="true" tabindex="-1"></a>                          <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb137-74"><a href="other-useful.html#cb137-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-75"><a href="other-useful.html#cb137-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb137-76"><a href="other-useful.html#cb137-76" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb137-77"><a href="other-useful.html#cb137-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-78"><a href="other-useful.html#cb137-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb137-79"><a href="other-useful.html#cb137-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb137-80"><a href="other-useful.html#cb137-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">5</span>)</span>
<span id="cb137-81"><a href="other-useful.html#cb137-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb137-82"><a href="other-useful.html#cb137-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-83"><a href="other-useful.html#cb137-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb137-84"><a href="other-useful.html#cb137-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-85"><a href="other-useful.html#cb137-85" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-86"><a href="other-useful.html#cb137-86" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-87"><a href="other-useful.html#cb137-87" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb137-88"><a href="other-useful.html#cb137-88" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-89"><a href="other-useful.html#cb137-89" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb137-90"><a href="other-useful.html#cb137-90" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-91"><a href="other-useful.html#cb137-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb137-92"><a href="other-useful.html#cb137-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-93"><a href="other-useful.html#cb137-93" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-94"><a href="other-useful.html#cb137-94" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-95"><a href="other-useful.html#cb137-95" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb137-96"><a href="other-useful.html#cb137-96" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-97"><a href="other-useful.html#cb137-97" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-98"><a href="other-useful.html#cb137-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-99"><a href="other-useful.html#cb137-99" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-100"><a href="other-useful.html#cb137-100" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-101"><a href="other-useful.html#cb137-101" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-102"><a href="other-useful.html#cb137-102" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb137-103"><a href="other-useful.html#cb137-103" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-104"><a href="other-useful.html#cb137-104" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-105"><a href="other-useful.html#cb137-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-106"><a href="other-useful.html#cb137-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-107"><a href="other-useful.html#cb137-107" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-108"><a href="other-useful.html#cb137-108" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-109"><a href="other-useful.html#cb137-109" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-110"><a href="other-useful.html#cb137-110" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-111"><a href="other-useful.html#cb137-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-112"><a href="other-useful.html#cb137-112" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb137-113"><a href="other-useful.html#cb137-113" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-114"><a href="other-useful.html#cb137-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-115"><a href="other-useful.html#cb137-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-116"><a href="other-useful.html#cb137-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb137-117"><a href="other-useful.html#cb137-117" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-118"><a href="other-useful.html#cb137-118" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb137-119"><a href="other-useful.html#cb137-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb137-120"><a href="other-useful.html#cb137-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-121"><a href="other-useful.html#cb137-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-122"><a href="other-useful.html#cb137-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-123"><a href="other-useful.html#cb137-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-124"><a href="other-useful.html#cb137-124" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb137-125"><a href="other-useful.html#cb137-125" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-126"><a href="other-useful.html#cb137-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-127"><a href="other-useful.html#cb137-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-128"><a href="other-useful.html#cb137-128" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb137-129"><a href="other-useful.html#cb137-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-130"><a href="other-useful.html#cb137-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-131"><a href="other-useful.html#cb137-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-132"><a href="other-useful.html#cb137-132" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-133"><a href="other-useful.html#cb137-133" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb137-134"><a href="other-useful.html#cb137-134" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-135"><a href="other-useful.html#cb137-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-136"><a href="other-useful.html#cb137-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-137"><a href="other-useful.html#cb137-137" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb137-138"><a href="other-useful.html#cb137-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-139"><a href="other-useful.html#cb137-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-140"><a href="other-useful.html#cb137-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-141"><a href="other-useful.html#cb137-141" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-142"><a href="other-useful.html#cb137-142" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-143"><a href="other-useful.html#cb137-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-144"><a href="other-useful.html#cb137-144" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-145"><a href="other-useful.html#cb137-145" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-146"><a href="other-useful.html#cb137-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-147"><a href="other-useful.html#cb137-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-148"><a href="other-useful.html#cb137-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-149"><a href="other-useful.html#cb137-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-150"><a href="other-useful.html#cb137-150" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 2 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-151"><a href="other-useful.html#cb137-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-152"><a href="other-useful.html#cb137-152" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-153"><a href="other-useful.html#cb137-153" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-154"><a href="other-useful.html#cb137-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb137-155"><a href="other-useful.html#cb137-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-156"><a href="other-useful.html#cb137-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-157"><a href="other-useful.html#cb137-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-158"><a href="other-useful.html#cb137-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb137-159"><a href="other-useful.html#cb137-159" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-160"><a href="other-useful.html#cb137-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-161"><a href="other-useful.html#cb137-161" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-162"><a href="other-useful.html#cb137-162" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-163"><a href="other-useful.html#cb137-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb137-164"><a href="other-useful.html#cb137-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-165"><a href="other-useful.html#cb137-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-166"><a href="other-useful.html#cb137-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-167"><a href="other-useful.html#cb137-167" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-168"><a href="other-useful.html#cb137-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-169"><a href="other-useful.html#cb137-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-170"><a href="other-useful.html#cb137-170" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-171"><a href="other-useful.html#cb137-171" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-172"><a href="other-useful.html#cb137-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb137-173"><a href="other-useful.html#cb137-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-174"><a href="other-useful.html#cb137-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-175"><a href="other-useful.html#cb137-175" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-176"><a href="other-useful.html#cb137-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-177"><a href="other-useful.html#cb137-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-178"><a href="other-useful.html#cb137-178" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-179"><a href="other-useful.html#cb137-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-180"><a href="other-useful.html#cb137-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-181"><a href="other-useful.html#cb137-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-182"><a href="other-useful.html#cb137-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-183"><a href="other-useful.html#cb137-183" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-184"><a href="other-useful.html#cb137-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-185"><a href="other-useful.html#cb137-185" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb137-186"><a href="other-useful.html#cb137-186" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb137-187"><a href="other-useful.html#cb137-187" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-188"><a href="other-useful.html#cb137-188" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-189"><a href="other-useful.html#cb137-189" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-190"><a href="other-useful.html#cb137-190" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-191"><a href="other-useful.html#cb137-191" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-192"><a href="other-useful.html#cb137-192" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb137-193"><a href="other-useful.html#cb137-193" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-194"><a href="other-useful.html#cb137-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-195"><a href="other-useful.html#cb137-195" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb137-196"><a href="other-useful.html#cb137-196" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-197"><a href="other-useful.html#cb137-197" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-198"><a href="other-useful.html#cb137-198" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-199"><a href="other-useful.html#cb137-199" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-200"><a href="other-useful.html#cb137-200" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-201"><a href="other-useful.html#cb137-201" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 2 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-202"><a href="other-useful.html#cb137-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-203"><a href="other-useful.html#cb137-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="fl">2.2</span>,</span>
<span id="cb137-204"><a href="other-useful.html#cb137-204" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-205"><a href="other-useful.html#cb137-205" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-206"><a href="other-useful.html#cb137-206" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-207"><a href="other-useful.html#cb137-207" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb137-208"><a href="other-useful.html#cb137-208" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-209"><a href="other-useful.html#cb137-209" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb137-210"><a href="other-useful.html#cb137-210" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-211"><a href="other-useful.html#cb137-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-212"><a href="other-useful.html#cb137-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-213"><a href="other-useful.html#cb137-213" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-214"><a href="other-useful.html#cb137-214" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-215"><a href="other-useful.html#cb137-215" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-216"><a href="other-useful.html#cb137-216" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb137-217"><a href="other-useful.html#cb137-217" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-218"><a href="other-useful.html#cb137-218" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-219"><a href="other-useful.html#cb137-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-220"><a href="other-useful.html#cb137-220" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-221"><a href="other-useful.html#cb137-221" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-222"><a href="other-useful.html#cb137-222" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-223"><a href="other-useful.html#cb137-223" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-224"><a href="other-useful.html#cb137-224" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb137-225"><a href="other-useful.html#cb137-225" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb137-226"><a href="other-useful.html#cb137-226" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-227"><a href="other-useful.html#cb137-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-228"><a href="other-useful.html#cb137-228" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb137-229"><a href="other-useful.html#cb137-229" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb137-230"><a href="other-useful.html#cb137-230" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb137-231"><a href="other-useful.html#cb137-231" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb137-232"><a href="other-useful.html#cb137-232" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb137-233"><a href="other-useful.html#cb137-233" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb137-234"><a href="other-useful.html#cb137-234" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb137-235"><a href="other-useful.html#cb137-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-236"><a href="other-useful.html#cb137-236" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="other-useful.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb139-2"><a href="other-useful.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, where proxies differ in their relevance (noise level)</span></span>
<span id="cb139-3"><a href="other-useful.html#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb139-4"><a href="other-useful.html#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb139-5"><a href="other-useful.html#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb139-6"><a href="other-useful.html#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb139-7"><a href="other-useful.html#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb139-8"><a href="other-useful.html#cb139-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb139-9"><a href="other-useful.html#cb139-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Section 5.3 of Faletto and Bien (2022).</span></span>
<span id="cb139-10"><a href="other-useful.html#cb139-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb139-11"><a href="other-useful.html#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb139-12"><a href="other-useful.html#cb139-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb139-13"><a href="other-useful.html#cb139-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb139-14"><a href="other-useful.html#cb139-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb139-15"><a href="other-useful.html#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb139-16"><a href="other-useful.html#cb139-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb139-17"><a href="other-useful.html#cb139-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb139-18"><a href="other-useful.html#cb139-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb139-19"><a href="other-useful.html#cb139-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb139-20"><a href="other-useful.html#cb139-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb139-21"><a href="other-useful.html#cb139-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb139-22"><a href="other-useful.html#cb139-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb139-23"><a href="other-useful.html#cb139-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_strong_cluster_vars Integer or numeric; among the cluster_size</span></span>
<span id="cb139-24"><a href="other-useful.html#cb139-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies in each cluster, n_strong_cluster_vars will have a high covariance</span></span>
<span id="cb139-25"><a href="other-useful.html#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (rho_high) with the latent variable and cluster_size - n_strong_cluster_vars</span></span>
<span id="cb139-26"><a href="other-useful.html#cb139-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have a low covariance (rho_low) with the latent variable.</span></span>
<span id="cb139-27"><a href="other-useful.html#cb139-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb139-28"><a href="other-useful.html#cb139-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb139-29"><a href="other-useful.html#cb139-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb139-30"><a href="other-useful.html#cb139-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb139-31"><a href="other-useful.html#cb139-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb139-32"><a href="other-useful.html#cb139-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb139-33"><a href="other-useful.html#cb139-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb139-34"><a href="other-useful.html#cb139-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the covariance of the &quot;strong proxies&quot; in</span></span>
<span id="cb139-35"><a href="other-useful.html#cb139-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb139-36"><a href="other-useful.html#cb139-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;strong proxy&quot; features in the cluster will be</span></span>
<span id="cb139-37"><a href="other-useful.html#cb139-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_high/var. rho_high cannot equal 0 and must be at least as large as</span></span>
<span id="cb139-38"><a href="other-useful.html#cb139-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low. Default is 0.9.</span></span>
<span id="cb139-39"><a href="other-useful.html#cb139-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the covariance of the &quot;weak proxies&quot; in</span></span>
<span id="cb139-40"><a href="other-useful.html#cb139-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb139-41"><a href="other-useful.html#cb139-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;weak proxy&quot; features in the cluster will be</span></span>
<span id="cb139-42"><a href="other-useful.html#cb139-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low/var. rho_low cannot equal 0 and must be no larger than rho_high.</span></span>
<span id="cb139-43"><a href="other-useful.html#cb139-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0.5.</span></span>
<span id="cb139-44"><a href="other-useful.html#cb139-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb139-45"><a href="other-useful.html#cb139-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb139-46"><a href="other-useful.html#cb139-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb139-47"><a href="other-useful.html#cb139-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb139-48"><a href="other-useful.html#cb139-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb139-49"><a href="other-useful.html#cb139-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb139-50"><a href="other-useful.html#cb139-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb139-51"><a href="other-useful.html#cb139-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb139-52"><a href="other-useful.html#cb139-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb139-53"><a href="other-useful.html#cb139-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb139-54"><a href="other-useful.html#cb139-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb139-55"><a href="other-useful.html#cb139-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb139-56"><a href="other-useful.html#cb139-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb139-57"><a href="other-useful.html#cb139-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb139-58"><a href="other-useful.html#cb139-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb139-59"><a href="other-useful.html#cb139-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb139-60"><a href="other-useful.html#cb139-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb139-61"><a href="other-useful.html#cb139-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb139-62"><a href="other-useful.html#cb139-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb139-63"><a href="other-useful.html#cb139-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb139-64"><a href="other-useful.html#cb139-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb139-65"><a href="other-useful.html#cb139-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb139-66"><a href="other-useful.html#cb139-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb139-67"><a href="other-useful.html#cb139-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb139-68"><a href="other-useful.html#cb139-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb139-69"><a href="other-useful.html#cb139-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb139-70"><a href="other-useful.html#cb139-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb139-71"><a href="other-useful.html#cb139-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb139-72"><a href="other-useful.html#cb139-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb139-73"><a href="other-useful.html#cb139-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb139-74"><a href="other-useful.html#cb139-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb139-75"><a href="other-useful.html#cb139-75" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb139-76"><a href="other-useful.html#cb139-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb139-77"><a href="other-useful.html#cb139-77" aria-hidden="true" tabindex="-1"></a><span id='genClusteredDataWeighted'>genClusteredDataWeighted</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size,</span>
<span id="cb139-78"><a href="other-useful.html#cb139-78" aria-hidden="true" tabindex="-1"></a>    n_strong_cluster_vars, <span class="at">n_clusters=</span><span class="dv">1</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span><span class="fl">0.9</span>,</span>
<span id="cb139-79"><a href="other-useful.html#cb139-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">rho_low=</span><span class="fl">0.5</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="dv">1</span>, <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb139-80"><a href="other-useful.html#cb139-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb139-81"><a href="other-useful.html#cb139-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-82"><a href="other-useful.html#cb139-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb139-83"><a href="other-useful.html#cb139-83" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>(p, k_unclustered, cluster_size,</span>
<span id="cb139-84"><a href="other-useful.html#cb139-84" aria-hidden="true" tabindex="-1"></a>        n_strong_cluster_vars, n_clusters,  sig_clusters, rho_high, rho_low,</span>
<span id="cb139-85"><a href="other-useful.html#cb139-85" aria-hidden="true" tabindex="-1"></a>        beta_latent, beta_unclustered, snr, sigma_eps_sq)</span>
<span id="cb139-86"><a href="other-useful.html#cb139-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-87"><a href="other-useful.html#cb139-87" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <a href='other-useful.html#genZmuY'>genZmuY</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">k_unclustered=</span>k_unclustered,</span>
<span id="cb139-88"><a href="other-useful.html#cb139-88" aria-hidden="true" tabindex="-1"></a>        <span class="at">cluster_size=</span>cluster_size, <span class="at">n_clusters=</span>n_clusters,</span>
<span id="cb139-89"><a href="other-useful.html#cb139-89" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_clusters=</span>sig_clusters, <span class="at">beta_latent=</span>beta_latent,</span>
<span id="cb139-90"><a href="other-useful.html#cb139-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_unclustered=</span>beta_unclustered, <span class="at">snr=</span>snr, <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb139-91"><a href="other-useful.html#cb139-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-92"><a href="other-useful.html#cb139-92" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> ret<span class="sc">$</span>Z</span>
<span id="cb139-93"><a href="other-useful.html#cb139-93" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> ret<span class="sc">$</span>y</span>
<span id="cb139-94"><a href="other-useful.html#cb139-94" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> ret<span class="sc">$</span>mu</span>
<span id="cb139-95"><a href="other-useful.html#cb139-95" aria-hidden="true" tabindex="-1"></a>    other_X <span class="ot">&lt;-</span> ret<span class="sc">$</span>other_X</span>
<span id="cb139-96"><a href="other-useful.html#cb139-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-97"><a href="other-useful.html#cb139-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Finally, generate clusters of proxies to complete X.</span></span>
<span id="cb139-98"><a href="other-useful.html#cb139-98" aria-hidden="true" tabindex="-1"></a>    noise_var_high <span class="ot">&lt;-</span> <a href='other-useful.html#getNoiseVar'>getNoiseVar</a>(rho_high)</span>
<span id="cb139-99"><a href="other-useful.html#cb139-99" aria-hidden="true" tabindex="-1"></a>    noise_var_low <span class="ot">&lt;-</span> <a href='other-useful.html#getNoiseVar'>getNoiseVar</a>(rho_low)</span>
<span id="cb139-100"><a href="other-useful.html#cb139-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-101"><a href="other-useful.html#cb139-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create matrix of proxies</span></span>
<span id="cb139-102"><a href="other-useful.html#cb139-102" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Z)</span>
<span id="cb139-103"><a href="other-useful.html#cb139-103" aria-hidden="true" tabindex="-1"></a>    proxy_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), n, n_clusters<span class="sc">*</span>cluster_size)</span>
<span id="cb139-104"><a href="other-useful.html#cb139-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb139-105"><a href="other-useful.html#cb139-105" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_strong_cluster_vars){</span>
<span id="cb139-106"><a href="other-useful.html#cb139-106" aria-hidden="true" tabindex="-1"></a>            proxy_mat[, (i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>cluster_size <span class="sc">+</span> j] <span class="ot">&lt;-</span> Z[, i] <span class="sc">+</span> <span class="fu">rnorm</span>(n,</span>
<span id="cb139-107"><a href="other-useful.html#cb139-107" aria-hidden="true" tabindex="-1"></a>                <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(noise_var_high))</span>
<span id="cb139-108"><a href="other-useful.html#cb139-108" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb139-109"><a href="other-useful.html#cb139-109" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> (n_strong_cluster_vars <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>cluster_size){</span>
<span id="cb139-110"><a href="other-useful.html#cb139-110" aria-hidden="true" tabindex="-1"></a>            proxy_mat[, (i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>cluster_size <span class="sc">+</span> j] <span class="ot">&lt;-</span> Z[, i] <span class="sc">+</span> <span class="fu">rnorm</span>(n,</span>
<span id="cb139-111"><a href="other-useful.html#cb139-111" aria-hidden="true" tabindex="-1"></a>                <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(noise_var_low))</span>
<span id="cb139-112"><a href="other-useful.html#cb139-112" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb139-113"><a href="other-useful.html#cb139-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-114"><a href="other-useful.html#cb139-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-115"><a href="other-useful.html#cb139-115" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(proxy_mat, other_X)</span>
<span id="cb139-116"><a href="other-useful.html#cb139-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb139-117"><a href="other-useful.html#cb139-117" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb139-118"><a href="other-useful.html#cb139-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(mu) <span class="sc">==</span> n)</span>
<span id="cb139-119"><a href="other-useful.html#cb139-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-120"><a href="other-useful.html#cb139-120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(X) <span class="sc">==</span> n)</span>
<span id="cb139-121"><a href="other-useful.html#cb139-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(X) <span class="sc">==</span> p)</span>
<span id="cb139-122"><a href="other-useful.html#cb139-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-123"><a href="other-useful.html#cb139-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(Z))){</span>
<span id="cb139-124"><a href="other-useful.html#cb139-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Z) <span class="sc">==</span> n)</span>
<span id="cb139-125"><a href="other-useful.html#cb139-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(Z) <span class="sc">==</span> n_clusters)</span>
<span id="cb139-126"><a href="other-useful.html#cb139-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb139-127"><a href="other-useful.html#cb139-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-128"><a href="other-useful.html#cb139-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>Z, <span class="at">mu=</span>mu))</span>
<span id="cb139-129"><a href="other-useful.html#cb139-129" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>()</code></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="other-useful.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredDataWeighted</span></span>
<span id="cb140-2"><a href="other-useful.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb140-3"><a href="other-useful.html#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb140-4"><a href="other-useful.html#cb140-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb140-5"><a href="other-useful.html#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb140-6"><a href="other-useful.html#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb140-7"><a href="other-useful.html#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb140-8"><a href="other-useful.html#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb140-9"><a href="other-useful.html#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb140-10"><a href="other-useful.html#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb140-11"><a href="other-useful.html#cb140-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb140-12"><a href="other-useful.html#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb140-13"><a href="other-useful.html#cb140-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb140-14"><a href="other-useful.html#cb140-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb140-15"><a href="other-useful.html#cb140-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb140-16"><a href="other-useful.html#cb140-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_strong_cluster_vars Integer or numeric; among the cluster_size</span></span>
<span id="cb140-17"><a href="other-useful.html#cb140-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies in each cluster, n_strong_cluster_vars will have a high covariance</span></span>
<span id="cb140-18"><a href="other-useful.html#cb140-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (rho_high) with the latent variable and cluster_size - n_strong_cluster_vars</span></span>
<span id="cb140-19"><a href="other-useful.html#cb140-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have a low covariance (rho_low) with the latent variable.</span></span>
<span id="cb140-20"><a href="other-useful.html#cb140-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb140-21"><a href="other-useful.html#cb140-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb140-22"><a href="other-useful.html#cb140-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb140-23"><a href="other-useful.html#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb140-24"><a href="other-useful.html#cb140-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb140-25"><a href="other-useful.html#cb140-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb140-26"><a href="other-useful.html#cb140-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb140-27"><a href="other-useful.html#cb140-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the covariance of the &quot;strong proxies&quot; in</span></span>
<span id="cb140-28"><a href="other-useful.html#cb140-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb140-29"><a href="other-useful.html#cb140-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;strong proxy&quot; features in the cluster will be</span></span>
<span id="cb140-30"><a href="other-useful.html#cb140-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_high/var. rho_high cannot equal 0 and must be at least as large as</span></span>
<span id="cb140-31"><a href="other-useful.html#cb140-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low. Default is 0.9.</span></span>
<span id="cb140-32"><a href="other-useful.html#cb140-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the covariance of the &quot;weak proxies&quot; in</span></span>
<span id="cb140-33"><a href="other-useful.html#cb140-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb140-34"><a href="other-useful.html#cb140-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;weak proxy&quot; features in the cluster will be</span></span>
<span id="cb140-35"><a href="other-useful.html#cb140-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low/var. rho_low cannot equal 0 and must be no larger than rho_high.</span></span>
<span id="cb140-36"><a href="other-useful.html#cb140-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0.5.</span></span>
<span id="cb140-37"><a href="other-useful.html#cb140-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb140-38"><a href="other-useful.html#cb140-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb140-39"><a href="other-useful.html#cb140-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb140-40"><a href="other-useful.html#cb140-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb140-41"><a href="other-useful.html#cb140-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb140-42"><a href="other-useful.html#cb140-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb140-43"><a href="other-useful.html#cb140-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb140-44"><a href="other-useful.html#cb140-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb140-45"><a href="other-useful.html#cb140-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb140-46"><a href="other-useful.html#cb140-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb140-47"><a href="other-useful.html#cb140-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb140-48"><a href="other-useful.html#cb140-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb140-49"><a href="other-useful.html#cb140-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb140-50"><a href="other-useful.html#cb140-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb140-51"><a href="other-useful.html#cb140-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb140-52"><a href="other-useful.html#cb140-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb140-53"><a href="other-useful.html#cb140-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb140-54"><a href="other-useful.html#cb140-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb140-55"><a href="other-useful.html#cb140-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb140-56"><a href="other-useful.html#cb140-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb140-57"><a href="other-useful.html#cb140-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb140-58"><a href="other-useful.html#cb140-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb140-59"><a href="other-useful.html#cb140-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb140-60"><a href="other-useful.html#cb140-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb140-61"><a href="other-useful.html#cb140-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb140-62"><a href="other-useful.html#cb140-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb140-63"><a href="other-useful.html#cb140-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb140-64"><a href="other-useful.html#cb140-64" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered, cluster_size,</span>
<span id="cb140-65"><a href="other-useful.html#cb140-65" aria-hidden="true" tabindex="-1"></a>        n_strong_cluster_vars, n_clusters, sig_clusters, rho_high, rho_low,</span>
<span id="cb140-66"><a href="other-useful.html#cb140-66" aria-hidden="true" tabindex="-1"></a>        beta_latent, beta_unclustered, snr, sigma_eps_sq){</span>
<span id="cb140-67"><a href="other-useful.html#cb140-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-68"><a href="other-useful.html#cb140-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb140-69"><a href="other-useful.html#cb140-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb140-70"><a href="other-useful.html#cb140-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb140-71"><a href="other-useful.html#cb140-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb140-72"><a href="other-useful.html#cb140-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-73"><a href="other-useful.html#cb140-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb140-74"><a href="other-useful.html#cb140-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb140-75"><a href="other-useful.html#cb140-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb140-76"><a href="other-useful.html#cb140-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb140-77"><a href="other-useful.html#cb140-77" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb140-78"><a href="other-useful.html#cb140-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb140-79"><a href="other-useful.html#cb140-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb140-80"><a href="other-useful.html#cb140-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb140-81"><a href="other-useful.html#cb140-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-82"><a href="other-useful.html#cb140-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb140-83"><a href="other-useful.html#cb140-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-84"><a href="other-useful.html#cb140-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(n_strong_cluster_vars) <span class="sc">|</span></span>
<span id="cb140-85"><a href="other-useful.html#cb140-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.numeric</span>(n_strong_cluster_vars))</span>
<span id="cb140-86"><a href="other-useful.html#cb140-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(n_strong_cluster_vars))</span>
<span id="cb140-87"><a href="other-useful.html#cb140-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n_strong_cluster_vars) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb140-88"><a href="other-useful.html#cb140-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">==</span> <span class="fu">round</span>(n_strong_cluster_vars))</span>
<span id="cb140-89"><a href="other-useful.html#cb140-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb140-90"><a href="other-useful.html#cb140-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">&lt;</span> cluster_size)</span>
<span id="cb140-91"><a href="other-useful.html#cb140-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-92"><a href="other-useful.html#cb140-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb140-93"><a href="other-useful.html#cb140-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb140-94"><a href="other-useful.html#cb140-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_low <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb140-95"><a href="other-useful.html#cb140-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&gt;=</span> rho_low)</span>
<span id="cb140-96"><a href="other-useful.html#cb140-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-97"><a href="other-useful.html#cb140-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb140-98"><a href="other-useful.html#cb140-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb140-99"><a href="other-useful.html#cb140-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-100"><a href="other-useful.html#cb140-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb140-101"><a href="other-useful.html#cb140-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb140-102"><a href="other-useful.html#cb140-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb140-103"><a href="other-useful.html#cb140-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-104"><a href="other-useful.html#cb140-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb140-105"><a href="other-useful.html#cb140-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-106"><a href="other-useful.html#cb140-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb140-107"><a href="other-useful.html#cb140-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb140-108"><a href="other-useful.html#cb140-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb140-109"><a href="other-useful.html#cb140-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb140-110"><a href="other-useful.html#cb140-110" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb140-111"><a href="other-useful.html#cb140-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-112"><a href="other-useful.html#cb140-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb140-113"><a href="other-useful.html#cb140-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(snr)){</span>
<span id="cb140-114"><a href="other-useful.html#cb140-114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb140-115"><a href="other-useful.html#cb140-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-116"><a href="other-useful.html#cb140-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb140-117"><a href="other-useful.html#cb140-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb140-118"><a href="other-useful.html#cb140-118" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb140-119"><a href="other-useful.html#cb140-119" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No tests for <code><a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>()</code></p>
<p>Tests for <code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="other-useful.html#cb141-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredDataWeighted works&quot;</span>, {</span>
<span id="cb141-2"><a href="other-useful.html#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb141-3"><a href="other-useful.html#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="other-useful.html#cb141-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb141-5"><a href="other-useful.html#cb141-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb141-6"><a href="other-useful.html#cb141-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span>.<span class="dv">99</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb141-7"><a href="other-useful.html#cb141-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb141-8"><a href="other-useful.html#cb141-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb141-9"><a href="other-useful.html#cb141-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-10"><a href="other-useful.html#cb141-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb141-11"><a href="other-useful.html#cb141-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb141-12"><a href="other-useful.html#cb141-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-13"><a href="other-useful.html#cb141-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb141-14"><a href="other-useful.html#cb141-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb141-15"><a href="other-useful.html#cb141-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb141-16"><a href="other-useful.html#cb141-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb141-17"><a href="other-useful.html#cb141-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb141-18"><a href="other-useful.html#cb141-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb141-19"><a href="other-useful.html#cb141-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb141-20"><a href="other-useful.html#cb141-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb141-21"><a href="other-useful.html#cb141-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb141-22"><a href="other-useful.html#cb141-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb141-23"><a href="other-useful.html#cb141-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb141-24"><a href="other-useful.html#cb141-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-25"><a href="other-useful.html#cb141-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb141-26"><a href="other-useful.html#cb141-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb141-27"><a href="other-useful.html#cb141-27" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb141-28"><a href="other-useful.html#cb141-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-29"><a href="other-useful.html#cb141-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb141-30"><a href="other-useful.html#cb141-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb141-31"><a href="other-useful.html#cb141-31" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">7</span>)</span>
<span id="cb141-32"><a href="other-useful.html#cb141-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-33"><a href="other-useful.html#cb141-33" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb141-34"><a href="other-useful.html#cb141-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb141-35"><a href="other-useful.html#cb141-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-36"><a href="other-useful.html#cb141-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb141-37"><a href="other-useful.html#cb141-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb141-38"><a href="other-useful.html#cb141-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-39"><a href="other-useful.html#cb141-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb141-40"><a href="other-useful.html#cb141-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb141-41"><a href="other-useful.html#cb141-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb141-42"><a href="other-useful.html#cb141-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb141-43"><a href="other-useful.html#cb141-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-44"><a href="other-useful.html#cb141-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb141-45"><a href="other-useful.html#cb141-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb141-46"><a href="other-useful.html#cb141-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb141-47"><a href="other-useful.html#cb141-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb141-48"><a href="other-useful.html#cb141-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb141-49"><a href="other-useful.html#cb141-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-50"><a href="other-useful.html#cb141-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb141-51"><a href="other-useful.html#cb141-51" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb141-52"><a href="other-useful.html#cb141-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb141-53"><a href="other-useful.html#cb141-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span>.<span class="dv">99</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb141-54"><a href="other-useful.html#cb141-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb141-55"><a href="other-useful.html#cb141-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb141-56"><a href="other-useful.html#cb141-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-57"><a href="other-useful.html#cb141-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb141-58"><a href="other-useful.html#cb141-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb141-59"><a href="other-useful.html#cb141-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-60"><a href="other-useful.html#cb141-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb141-61"><a href="other-useful.html#cb141-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb141-62"><a href="other-useful.html#cb141-62" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb141-63"><a href="other-useful.html#cb141-63" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb141-64"><a href="other-useful.html#cb141-64" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span>.<span class="dv">99</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb141-65"><a href="other-useful.html#cb141-65" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb141-66"><a href="other-useful.html#cb141-66" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb141-67"><a href="other-useful.html#cb141-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-68"><a href="other-useful.html#cb141-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb141-69"><a href="other-useful.html#cb141-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb141-70"><a href="other-useful.html#cb141-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-71"><a href="other-useful.html#cb141-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb141-72"><a href="other-useful.html#cb141-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb141-73"><a href="other-useful.html#cb141-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="fu">sqrt</span>(.<span class="dv">25</span>)))</span>
<span id="cb141-74"><a href="other-useful.html#cb141-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-75"><a href="other-useful.html#cb141-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb141-76"><a href="other-useful.html#cb141-76" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb141-77"><a href="other-useful.html#cb141-77" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb141-78"><a href="other-useful.html#cb141-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span>.<span class="dv">99</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb141-79"><a href="other-useful.html#cb141-79" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb141-80"><a href="other-useful.html#cb141-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb141-81"><a href="other-useful.html#cb141-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-82"><a href="other-useful.html#cb141-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb141-83"><a href="other-useful.html#cb141-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb141-84"><a href="other-useful.html#cb141-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-85"><a href="other-useful.html#cb141-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb141-86"><a href="other-useful.html#cb141-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb141-87"><a href="other-useful.html#cb141-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb141-88"><a href="other-useful.html#cb141-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb141-89"><a href="other-useful.html#cb141-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-90"><a href="other-useful.html#cb141-90" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p><code><a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>()</code></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="other-useful.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb143-2"><a href="other-useful.html#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, where proxies differ in their relevance (noise level)</span></span>
<span id="cb143-3"><a href="other-useful.html#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb143-4"><a href="other-useful.html#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb143-5"><a href="other-useful.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb143-6"><a href="other-useful.html#cb143-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb143-7"><a href="other-useful.html#cb143-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb143-8"><a href="other-useful.html#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise).</span></span>
<span id="cb143-9"><a href="other-useful.html#cb143-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb143-10"><a href="other-useful.html#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb143-11"><a href="other-useful.html#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb143-12"><a href="other-useful.html#cb143-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb143-13"><a href="other-useful.html#cb143-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb143-14"><a href="other-useful.html#cb143-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb143-15"><a href="other-useful.html#cb143-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb143-16"><a href="other-useful.html#cb143-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb143-17"><a href="other-useful.html#cb143-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb143-18"><a href="other-useful.html#cb143-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb143-19"><a href="other-useful.html#cb143-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb143-20"><a href="other-useful.html#cb143-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb143-21"><a href="other-useful.html#cb143-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb143-22"><a href="other-useful.html#cb143-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb143-23"><a href="other-useful.html#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb143-24"><a href="other-useful.html#cb143-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb143-25"><a href="other-useful.html#cb143-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb143-26"><a href="other-useful.html#cb143-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb143-27"><a href="other-useful.html#cb143-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb143-28"><a href="other-useful.html#cb143-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb143-29"><a href="other-useful.html#cb143-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the maximum correlation of the proxies</span></span>
<span id="cb143-30"><a href="other-useful.html#cb143-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with each other. Default is 1.</span></span>
<span id="cb143-31"><a href="other-useful.html#cb143-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the minimum correlation of the proxies in</span></span>
<span id="cb143-32"><a href="other-useful.html#cb143-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with each other. rho_low cannot equal 0 and must be no larger</span></span>
<span id="cb143-33"><a href="other-useful.html#cb143-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than rho_high. Default is 0.5.</span></span>
<span id="cb143-34"><a href="other-useful.html#cb143-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb143-35"><a href="other-useful.html#cb143-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb143-36"><a href="other-useful.html#cb143-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb143-37"><a href="other-useful.html#cb143-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb143-38"><a href="other-useful.html#cb143-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb143-39"><a href="other-useful.html#cb143-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb143-40"><a href="other-useful.html#cb143-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb143-41"><a href="other-useful.html#cb143-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb143-42"><a href="other-useful.html#cb143-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb143-43"><a href="other-useful.html#cb143-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb143-44"><a href="other-useful.html#cb143-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb143-45"><a href="other-useful.html#cb143-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb143-46"><a href="other-useful.html#cb143-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb143-47"><a href="other-useful.html#cb143-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb143-48"><a href="other-useful.html#cb143-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb143-49"><a href="other-useful.html#cb143-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb143-50"><a href="other-useful.html#cb143-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb143-51"><a href="other-useful.html#cb143-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb143-52"><a href="other-useful.html#cb143-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb143-53"><a href="other-useful.html#cb143-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb143-54"><a href="other-useful.html#cb143-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb143-55"><a href="other-useful.html#cb143-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb143-56"><a href="other-useful.html#cb143-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb143-57"><a href="other-useful.html#cb143-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb143-58"><a href="other-useful.html#cb143-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb143-59"><a href="other-useful.html#cb143-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb143-60"><a href="other-useful.html#cb143-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb143-61"><a href="other-useful.html#cb143-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb143-62"><a href="other-useful.html#cb143-62" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb143-63"><a href="other-useful.html#cb143-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb143-64"><a href="other-useful.html#cb143-64" aria-hidden="true" tabindex="-1"></a><span id='genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size,</span>
<span id="cb143-65"><a href="other-useful.html#cb143-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_clusters=</span><span class="dv">1</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span><span class="dv">1</span>, <span class="at">rho_low=</span><span class="fl">0.5</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb143-66"><a href="other-useful.html#cb143-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta_unclustered=</span><span class="dv">1</span>, <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb143-67"><a href="other-useful.html#cb143-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-68"><a href="other-useful.html#cb143-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb143-69"><a href="other-useful.html#cb143-69" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataWeightedRandomInputs'>checkGenClusteredDataWeightedRandomInputs</a>(p, k_unclustered, cluster_size,</span>
<span id="cb143-70"><a href="other-useful.html#cb143-70" aria-hidden="true" tabindex="-1"></a>        n_clusters, sig_clusters, rho_high, rho_low,</span>
<span id="cb143-71"><a href="other-useful.html#cb143-71" aria-hidden="true" tabindex="-1"></a>        beta_latent, beta_unclustered, snr, sigma_eps_sq)</span>
<span id="cb143-72"><a href="other-useful.html#cb143-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-73"><a href="other-useful.html#cb143-73" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <a href='other-useful.html#genZmuY'>genZmuY</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">k_unclustered=</span>k_unclustered,</span>
<span id="cb143-74"><a href="other-useful.html#cb143-74" aria-hidden="true" tabindex="-1"></a>        <span class="at">cluster_size=</span>cluster_size, <span class="at">n_clusters=</span>n_clusters,</span>
<span id="cb143-75"><a href="other-useful.html#cb143-75" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_clusters=</span>sig_clusters, <span class="at">beta_latent=</span>beta_latent,</span>
<span id="cb143-76"><a href="other-useful.html#cb143-76" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_unclustered=</span>beta_unclustered, <span class="at">snr=</span>snr, <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb143-77"><a href="other-useful.html#cb143-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-78"><a href="other-useful.html#cb143-78" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> ret<span class="sc">$</span>Z</span>
<span id="cb143-79"><a href="other-useful.html#cb143-79" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> ret<span class="sc">$</span>y</span>
<span id="cb143-80"><a href="other-useful.html#cb143-80" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> ret<span class="sc">$</span>mu</span>
<span id="cb143-81"><a href="other-useful.html#cb143-81" aria-hidden="true" tabindex="-1"></a>    other_X <span class="ot">&lt;-</span> ret<span class="sc">$</span>other_X</span>
<span id="cb143-82"><a href="other-useful.html#cb143-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-83"><a href="other-useful.html#cb143-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Finally, generate clusters of proxies to complete X.</span></span>
<span id="cb143-84"><a href="other-useful.html#cb143-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create matrix of proxies</span></span>
<span id="cb143-85"><a href="other-useful.html#cb143-85" aria-hidden="true" tabindex="-1"></a>    Z <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(Z)</span>
<span id="cb143-86"><a href="other-useful.html#cb143-86" aria-hidden="true" tabindex="-1"></a>    proxy_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), n, n_clusters<span class="sc">*</span>cluster_size)</span>
<span id="cb143-87"><a href="other-useful.html#cb143-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_clusters){</span>
<span id="cb143-88"><a href="other-useful.html#cb143-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>cluster_size){</span>
<span id="cb143-89"><a href="other-useful.html#cb143-89" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Choose correlation at random</span></span>
<span id="cb143-90"><a href="other-useful.html#cb143-90" aria-hidden="true" tabindex="-1"></a>            rho_ij <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">min=</span>rho_low, <span class="at">max=</span>rho_high)</span>
<span id="cb143-91"><a href="other-useful.html#cb143-91" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Get noise variance</span></span>
<span id="cb143-92"><a href="other-useful.html#cb143-92" aria-hidden="true" tabindex="-1"></a>            noise_var_ij <span class="ot">&lt;-</span> <a href='other-useful.html#getNoiseVar'>getNoiseVar</a>(rho_ij)</span>
<span id="cb143-93"><a href="other-useful.html#cb143-93" aria-hidden="true" tabindex="-1"></a>            proxy_mat[, (i <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span>cluster_size <span class="sc">+</span> j] <span class="ot">&lt;-</span> Z[, i] <span class="sc">+</span> <span class="fu">rnorm</span>(n,</span>
<span id="cb143-94"><a href="other-useful.html#cb143-94" aria-hidden="true" tabindex="-1"></a>                <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="fu">sqrt</span>(noise_var_ij))</span>
<span id="cb143-95"><a href="other-useful.html#cb143-95" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb143-96"><a href="other-useful.html#cb143-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-97"><a href="other-useful.html#cb143-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-98"><a href="other-useful.html#cb143-98" aria-hidden="true" tabindex="-1"></a>    X <span class="ot">&lt;-</span> <span class="fu">cbind</span>(proxy_mat, other_X)</span>
<span id="cb143-99"><a href="other-useful.html#cb143-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb143-100"><a href="other-useful.html#cb143-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb143-101"><a href="other-useful.html#cb143-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(mu) <span class="sc">==</span> n)</span>
<span id="cb143-102"><a href="other-useful.html#cb143-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-103"><a href="other-useful.html#cb143-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(X) <span class="sc">==</span> n)</span>
<span id="cb143-104"><a href="other-useful.html#cb143-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(X) <span class="sc">==</span> p)</span>
<span id="cb143-105"><a href="other-useful.html#cb143-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-106"><a href="other-useful.html#cb143-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(Z))){</span>
<span id="cb143-107"><a href="other-useful.html#cb143-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Z) <span class="sc">==</span> n)</span>
<span id="cb143-108"><a href="other-useful.html#cb143-108" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(Z) <span class="sc">==</span> n_clusters)</span>
<span id="cb143-109"><a href="other-useful.html#cb143-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-110"><a href="other-useful.html#cb143-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-111"><a href="other-useful.html#cb143-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>Z, <span class="at">mu=</span>mu))</span>
<span id="cb143-112"><a href="other-useful.html#cb143-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#checkGenClusteredDataWeightedRandomInputs'>checkGenClusteredDataWeightedRandomInputs</a>()</code></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="other-useful.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredDataWeightedRandom</span></span>
<span id="cb144-2"><a href="other-useful.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb144-3"><a href="other-useful.html#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb144-4"><a href="other-useful.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb144-5"><a href="other-useful.html#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb144-6"><a href="other-useful.html#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb144-7"><a href="other-useful.html#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb144-8"><a href="other-useful.html#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb144-9"><a href="other-useful.html#cb144-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb144-10"><a href="other-useful.html#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb144-11"><a href="other-useful.html#cb144-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb144-12"><a href="other-useful.html#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb144-13"><a href="other-useful.html#cb144-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb144-14"><a href="other-useful.html#cb144-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb144-15"><a href="other-useful.html#cb144-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb144-16"><a href="other-useful.html#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb144-17"><a href="other-useful.html#cb144-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb144-18"><a href="other-useful.html#cb144-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb144-19"><a href="other-useful.html#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb144-20"><a href="other-useful.html#cb144-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb144-21"><a href="other-useful.html#cb144-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb144-22"><a href="other-useful.html#cb144-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb144-23"><a href="other-useful.html#cb144-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the maximum correlation of the proxies</span></span>
<span id="cb144-24"><a href="other-useful.html#cb144-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with each other. Default is 1.</span></span>
<span id="cb144-25"><a href="other-useful.html#cb144-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the minimum correlation of the proxies in</span></span>
<span id="cb144-26"><a href="other-useful.html#cb144-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with each other. rho_low cannot equal 0 and must be no larger</span></span>
<span id="cb144-27"><a href="other-useful.html#cb144-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than rho_high. Default is 0.5.</span></span>
<span id="cb144-28"><a href="other-useful.html#cb144-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb144-29"><a href="other-useful.html#cb144-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb144-30"><a href="other-useful.html#cb144-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb144-31"><a href="other-useful.html#cb144-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb144-32"><a href="other-useful.html#cb144-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb144-33"><a href="other-useful.html#cb144-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb144-34"><a href="other-useful.html#cb144-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb144-35"><a href="other-useful.html#cb144-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb144-36"><a href="other-useful.html#cb144-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb144-37"><a href="other-useful.html#cb144-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb144-38"><a href="other-useful.html#cb144-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb144-39"><a href="other-useful.html#cb144-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb144-40"><a href="other-useful.html#cb144-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb144-41"><a href="other-useful.html#cb144-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb144-42"><a href="other-useful.html#cb144-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb144-43"><a href="other-useful.html#cb144-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb144-44"><a href="other-useful.html#cb144-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb144-45"><a href="other-useful.html#cb144-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb144-46"><a href="other-useful.html#cb144-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb144-47"><a href="other-useful.html#cb144-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb144-48"><a href="other-useful.html#cb144-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb144-49"><a href="other-useful.html#cb144-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb144-50"><a href="other-useful.html#cb144-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb144-51"><a href="other-useful.html#cb144-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb144-52"><a href="other-useful.html#cb144-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb144-53"><a href="other-useful.html#cb144-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb144-54"><a href="other-useful.html#cb144-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb144-55"><a href="other-useful.html#cb144-55" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataWeightedRandomInputs'>checkGenClusteredDataWeightedRandomInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered,</span>
<span id="cb144-56"><a href="other-useful.html#cb144-56" aria-hidden="true" tabindex="-1"></a>    cluster_size, n_clusters, sig_clusters, rho_high, rho_low, beta_latent,</span>
<span id="cb144-57"><a href="other-useful.html#cb144-57" aria-hidden="true" tabindex="-1"></a>    beta_unclustered, snr, sigma_eps_sq){</span>
<span id="cb144-58"><a href="other-useful.html#cb144-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-59"><a href="other-useful.html#cb144-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb144-60"><a href="other-useful.html#cb144-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb144-61"><a href="other-useful.html#cb144-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb144-62"><a href="other-useful.html#cb144-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb144-63"><a href="other-useful.html#cb144-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb144-64"><a href="other-useful.html#cb144-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb144-65"><a href="other-useful.html#cb144-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb144-66"><a href="other-useful.html#cb144-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb144-67"><a href="other-useful.html#cb144-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb144-68"><a href="other-useful.html#cb144-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb144-69"><a href="other-useful.html#cb144-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb144-70"><a href="other-useful.html#cb144-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb144-71"><a href="other-useful.html#cb144-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb144-72"><a href="other-useful.html#cb144-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-73"><a href="other-useful.html#cb144-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb144-74"><a href="other-useful.html#cb144-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-75"><a href="other-useful.html#cb144-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb144-76"><a href="other-useful.html#cb144-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb144-77"><a href="other-useful.html#cb144-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_low <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb144-78"><a href="other-useful.html#cb144-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">&gt;=</span> rho_low)</span>
<span id="cb144-79"><a href="other-useful.html#cb144-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-80"><a href="other-useful.html#cb144-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb144-81"><a href="other-useful.html#cb144-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb144-82"><a href="other-useful.html#cb144-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-83"><a href="other-useful.html#cb144-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb144-84"><a href="other-useful.html#cb144-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb144-85"><a href="other-useful.html#cb144-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb144-86"><a href="other-useful.html#cb144-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb144-87"><a href="other-useful.html#cb144-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb144-88"><a href="other-useful.html#cb144-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-89"><a href="other-useful.html#cb144-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb144-90"><a href="other-useful.html#cb144-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb144-91"><a href="other-useful.html#cb144-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb144-92"><a href="other-useful.html#cb144-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb144-93"><a href="other-useful.html#cb144-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb144-94"><a href="other-useful.html#cb144-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb144-95"><a href="other-useful.html#cb144-95" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb144-96"><a href="other-useful.html#cb144-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(snr)){</span>
<span id="cb144-97"><a href="other-useful.html#cb144-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb144-98"><a href="other-useful.html#cb144-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb144-99"><a href="other-useful.html#cb144-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb144-100"><a href="other-useful.html#cb144-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb144-101"><a href="other-useful.html#cb144-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb144-102"><a href="other-useful.html#cb144-102" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No tests for <code><a href='other-useful.html#checkGenClusteredDataWeightedRandomInputs'>checkGenClusteredDataWeightedRandomInputs</a>()</code></p>
<p>Tests for <code><a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>()</code></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="other-useful.html#cb145-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredDataWeightedRandom works&quot;</span>, {</span>
<span id="cb145-2"><a href="other-useful.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb145-3"><a href="other-useful.html#cb145-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-4"><a href="other-useful.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb145-5"><a href="other-useful.html#cb145-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb145-6"><a href="other-useful.html#cb145-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="dv">1</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb145-7"><a href="other-useful.html#cb145-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb145-8"><a href="other-useful.html#cb145-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb145-9"><a href="other-useful.html#cb145-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-10"><a href="other-useful.html#cb145-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb145-11"><a href="other-useful.html#cb145-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb145-12"><a href="other-useful.html#cb145-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-13"><a href="other-useful.html#cb145-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb145-14"><a href="other-useful.html#cb145-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb145-15"><a href="other-useful.html#cb145-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb145-16"><a href="other-useful.html#cb145-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb145-17"><a href="other-useful.html#cb145-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb145-18"><a href="other-useful.html#cb145-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb145-19"><a href="other-useful.html#cb145-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb145-20"><a href="other-useful.html#cb145-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb145-21"><a href="other-useful.html#cb145-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb145-22"><a href="other-useful.html#cb145-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])) <span class="sc">&gt;</span> .<span class="dv">2</span>)</span>
<span id="cb145-23"><a href="other-useful.html#cb145-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb145-24"><a href="other-useful.html#cb145-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-25"><a href="other-useful.html#cb145-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>])) <span class="sc">&gt;</span> .<span class="dv">2</span>)</span>
<span id="cb145-26"><a href="other-useful.html#cb145-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb145-27"><a href="other-useful.html#cb145-27" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb145-28"><a href="other-useful.html#cb145-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-29"><a href="other-useful.html#cb145-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>])) <span class="sc">&gt;</span> .<span class="dv">2</span>)</span>
<span id="cb145-30"><a href="other-useful.html#cb145-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb145-31"><a href="other-useful.html#cb145-31" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">7</span>)</span>
<span id="cb145-32"><a href="other-useful.html#cb145-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-33"><a href="other-useful.html#cb145-33" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb145-34"><a href="other-useful.html#cb145-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb145-35"><a href="other-useful.html#cb145-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-36"><a href="other-useful.html#cb145-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb145-37"><a href="other-useful.html#cb145-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb145-38"><a href="other-useful.html#cb145-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-39"><a href="other-useful.html#cb145-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb145-40"><a href="other-useful.html#cb145-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb145-41"><a href="other-useful.html#cb145-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb145-42"><a href="other-useful.html#cb145-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb145-43"><a href="other-useful.html#cb145-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-44"><a href="other-useful.html#cb145-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb145-45"><a href="other-useful.html#cb145-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb145-46"><a href="other-useful.html#cb145-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb145-47"><a href="other-useful.html#cb145-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb145-48"><a href="other-useful.html#cb145-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb145-49"><a href="other-useful.html#cb145-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-50"><a href="other-useful.html#cb145-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb145-51"><a href="other-useful.html#cb145-51" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb145-52"><a href="other-useful.html#cb145-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb145-53"><a href="other-useful.html#cb145-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="dv">1</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb145-54"><a href="other-useful.html#cb145-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb145-55"><a href="other-useful.html#cb145-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb145-56"><a href="other-useful.html#cb145-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-57"><a href="other-useful.html#cb145-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb145-58"><a href="other-useful.html#cb145-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb145-59"><a href="other-useful.html#cb145-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-60"><a href="other-useful.html#cb145-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb145-61"><a href="other-useful.html#cb145-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb145-62"><a href="other-useful.html#cb145-62" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb145-63"><a href="other-useful.html#cb145-63" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb145-64"><a href="other-useful.html#cb145-64" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span>.<span class="dv">99</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb145-65"><a href="other-useful.html#cb145-65" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb145-66"><a href="other-useful.html#cb145-66" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb145-67"><a href="other-useful.html#cb145-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-68"><a href="other-useful.html#cb145-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb145-69"><a href="other-useful.html#cb145-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb145-70"><a href="other-useful.html#cb145-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-71"><a href="other-useful.html#cb145-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb145-72"><a href="other-useful.html#cb145-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb145-73"><a href="other-useful.html#cb145-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="fu">sqrt</span>(.<span class="dv">25</span>)))</span>
<span id="cb145-74"><a href="other-useful.html#cb145-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-75"><a href="other-useful.html#cb145-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb145-76"><a href="other-useful.html#cb145-76" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeightedRandom'>genClusteredDataWeightedRandom</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb145-77"><a href="other-useful.html#cb145-77" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb145-78"><a href="other-useful.html#cb145-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span><span class="dv">1</span>, <span class="at">rho_low=</span>.<span class="dv">5</span>,</span>
<span id="cb145-79"><a href="other-useful.html#cb145-79" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb145-80"><a href="other-useful.html#cb145-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb145-81"><a href="other-useful.html#cb145-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-82"><a href="other-useful.html#cb145-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb145-83"><a href="other-useful.html#cb145-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb145-84"><a href="other-useful.html#cb145-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-85"><a href="other-useful.html#cb145-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb145-86"><a href="other-useful.html#cb145-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb145-87"><a href="other-useful.html#cb145-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb145-88"><a href="other-useful.html#cb145-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb145-89"><a href="other-useful.html#cb145-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-90"><a href="other-useful.html#cb145-90" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code>:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="other-useful.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get lambda value for lasso</span></span>
<span id="cb147-2"><a href="other-useful.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb147-3"><a href="other-useful.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Chooses a lambda value for the lasso used on a subsample of size n/2 (as in</span></span>
<span id="cb147-4"><a href="other-useful.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster stability selection) by cross-validation.</span></span>
<span id="cb147-5"><a href="other-useful.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb147-6"><a href="other-useful.html#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb147-7"><a href="other-useful.html#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors that will be used by cluster stability</span></span>
<span id="cb147-8"><a href="other-useful.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection.</span></span>
<span id="cb147-9"><a href="other-useful.html#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; an n-dimensional numeric or integer vector. (Unlike</span></span>
<span id="cb147-10"><a href="other-useful.html#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the more general css setup, this response must be real-valued since</span></span>
<span id="cb147-11"><a href="other-useful.html#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lambda will be determined using the lasso with cross-validation.)</span></span>
<span id="cb147-12"><a href="other-useful.html#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda_choice Character; either &quot;min&quot; or &quot;1se&quot;. If &quot;min&quot;, chooses</span></span>
<span id="cb147-13"><a href="other-useful.html#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the lambda that minimizes the cross-validated error; if &quot;1se&quot;, chooses the</span></span>
<span id="cb147-14"><a href="other-useful.html#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; largest lambda within one standard error of the minimum error lambda</span></span>
<span id="cb147-15"><a href="other-useful.html#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (resulting in a smaller selected set, which may be desirable because the</span></span>
<span id="cb147-16"><a href="other-useful.html#cb147-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size corresponding to the minimum error lambda tends to be larger</span></span>
<span id="cb147-17"><a href="other-useful.html#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than optimal. See, for example, Bühlmann and Meinshausen 2006, Prop. 1 and</span></span>
<span id="cb147-18"><a href="other-useful.html#cb147-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bühlmann and van de Geer 2011, Section 2.5.1.). Default is &quot;1se&quot;.</span></span>
<span id="cb147-19"><a href="other-useful.html#cb147-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nfolds Numeric or integer; the number of folds for cross-validation.</span></span>
<span id="cb147-20"><a href="other-useful.html#cb147-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 4 (as specified by cv.glmnet). Default is 10.</span></span>
<span id="cb147-21"><a href="other-useful.html#cb147-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric; the selected value of lambda.</span></span>
<span id="cb147-22"><a href="other-useful.html#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb147-23"><a href="other-useful.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Bühlmann, P., &amp; Meinshausen, N. (2006). High-Dimensional Graphs</span></span>
<span id="cb147-24"><a href="other-useful.html#cb147-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and Variable Selection With the Lasso. \emph{The Annals of Statistics},</span></span>
<span id="cb147-25"><a href="other-useful.html#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 34(3), 1436–1462. \url{https://doi.org/10.1214/009053606000000281}.</span></span>
<span id="cb147-26"><a href="other-useful.html#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \cr Peter Bühlmann and Sara van de Geer. Statistics for High-Dimensional</span></span>
<span id="cb147-27"><a href="other-useful.html#cb147-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Data. \emph{Springer Series in Statistics}. Springer, Heidelberg, 2011. ISBN</span></span>
<span id="cb147-28"><a href="other-useful.html#cb147-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 978-3-642-20191-2. \url{http://dx.doi.org/10.1007/978-3-642-20192-9}. \cr</span></span>
<span id="cb147-29"><a href="other-useful.html#cb147-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Jerome Friedman, Trevor Hastie, Robert Tibshirani (2010). Regularization</span></span>
<span id="cb147-30"><a href="other-useful.html#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Paths for Generalized Linear Models via Coordinate Descent. \emph{Journal of</span></span>
<span id="cb147-31"><a href="other-useful.html#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Software}, 33(1), 1-22. URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb147-32"><a href="other-useful.html#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb147-33"><a href="other-useful.html#cb147-33" aria-hidden="true" tabindex="-1"></a><span id='getLassoLambda'>getLassoLambda</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">10</span>){</span>
<span id="cb147-34"><a href="other-useful.html#cb147-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(lambda_choice))</span>
<span id="cb147-35"><a href="other-useful.html#cb147-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_choice) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-36"><a href="other-useful.html#cb147-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(lambda_choice))</span>
<span id="cb147-37"><a href="other-useful.html#cb147-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_choice <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>))</span>
<span id="cb147-38"><a href="other-useful.html#cb147-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-39"><a href="other-useful.html#cb147-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb147-40"><a href="other-useful.html#cb147-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb147-41"><a href="other-useful.html#cb147-41" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb147-42"><a href="other-useful.html#cb147-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-43"><a href="other-useful.html#cb147-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(nfolds) <span class="sc">|</span> <span class="fu">is.integer</span>(nfolds))</span>
<span id="cb147-44"><a href="other-useful.html#cb147-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(nfolds) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-45"><a href="other-useful.html#cb147-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">==</span> <span class="fu">round</span>(nfolds))</span>
<span id="cb147-46"><a href="other-useful.html#cb147-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb147-47"><a href="other-useful.html#cb147-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-48"><a href="other-useful.html#cb147-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since we are using the lasso, we require y to be a real-valued response</span></span>
<span id="cb147-49"><a href="other-useful.html#cb147-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (unlike for the general cluster stability selection procedure, where y</span></span>
<span id="cb147-50"><a href="other-useful.html#cb147-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># can have a more general format as long as a suitable feature selection</span></span>
<span id="cb147-51"><a href="other-useful.html#cb147-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function is provided by the user)</span></span>
<span id="cb147-52"><a href="other-useful.html#cb147-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb147-53"><a href="other-useful.html#cb147-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb147-54"><a href="other-useful.html#cb147-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-55"><a href="other-useful.html#cb147-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample size to use: inflate n/2 by a factor of nfolds/(nfolds - 1),</span></span>
<span id="cb147-56"><a href="other-useful.html#cb147-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># so that each individual lasso fit is of size floor(n/2)</span></span>
<span id="cb147-57"><a href="other-useful.html#cb147-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-58"><a href="other-useful.html#cb147-58" aria-hidden="true" tabindex="-1"></a>    n_sample <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>nfolds<span class="sc">/</span>(nfolds <span class="sc">-</span> <span class="dv">1</span>)), n)</span>
<span id="cb147-59"><a href="other-useful.html#cb147-59" aria-hidden="true" tabindex="-1"></a>    nfolds <span class="ot">&lt;-</span> <span class="fu">min</span>(nfolds, n_sample)</span>
<span id="cb147-60"><a href="other-useful.html#cb147-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-61"><a href="other-useful.html#cb147-61" aria-hidden="true" tabindex="-1"></a>    inds_size <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, n_sample)</span>
<span id="cb147-62"><a href="other-useful.html#cb147-62" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X[inds_size, ], <span class="at">y=</span>y[inds_size],</span>
<span id="cb147-63"><a href="other-useful.html#cb147-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="at">nfolds=</span>nfolds)</span>
<span id="cb147-64"><a href="other-useful.html#cb147-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-65"><a href="other-useful.html#cb147-65" aria-hidden="true" tabindex="-1"></a>    lambda_ret <span class="ot">&lt;-</span> size_results[[<span class="fu">paste</span>(<span class="st">&quot;lambda.&quot;</span>, lambda_choice, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)]]</span>
<span id="cb147-66"><a href="other-useful.html#cb147-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-67"><a href="other-useful.html#cb147-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb147-68"><a href="other-useful.html#cb147-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_ret) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-69"><a href="other-useful.html#cb147-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(lambda_ret) <span class="sc">|</span> <span class="fu">is.integer</span>(lambda_ret))</span>
<span id="cb147-70"><a href="other-useful.html#cb147-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb147-71"><a href="other-useful.html#cb147-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-72"><a href="other-useful.html#cb147-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(lambda_ret)</span>
<span id="cb147-73"><a href="other-useful.html#cb147-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code>:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="other-useful.html#cb148-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getLassoLambda works&quot;</span>, {</span>
<span id="cb148-2"><a href="other-useful.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7252</span>)</span>
<span id="cb148-3"><a href="other-useful.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-4"><a href="other-useful.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb148-5"><a href="other-useful.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb148-6"><a href="other-useful.html#cb148-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-7"><a href="other-useful.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">4</span>)</span>
<span id="cb148-8"><a href="other-useful.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-9"><a href="other-useful.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb148-10"><a href="other-useful.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb148-11"><a href="other-useful.html#cb148-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb148-12"><a href="other-useful.html#cb148-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb148-13"><a href="other-useful.html#cb148-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-14"><a href="other-useful.html#cb148-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;min&quot;</span>, <span class="at">nfolds=</span><span class="dv">5</span>)</span>
<span id="cb148-15"><a href="other-useful.html#cb148-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-16"><a href="other-useful.html#cb148-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb148-17"><a href="other-useful.html#cb148-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb148-18"><a href="other-useful.html#cb148-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb148-19"><a href="other-useful.html#cb148-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb148-20"><a href="other-useful.html#cb148-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-21"><a href="other-useful.html#cb148-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb148-22"><a href="other-useful.html#cb148-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y), <span class="st">&quot;is.matrix(X) is not TRUE&quot;</span>,</span>
<span id="cb148-23"><a href="other-useful.html#cb148-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-24"><a href="other-useful.html#cb148-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-25"><a href="other-useful.html#cb148-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, ], <span class="at">y=</span>y),</span>
<span id="cb148-26"><a href="other-useful.html#cb148-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n == length(y) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-27"><a href="other-useful.html#cb148-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-28"><a href="other-useful.html#cb148-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">TRUE</span>),</span>
<span id="cb148-29"><a href="other-useful.html#cb148-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb148-30"><a href="other-useful.html#cb148-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-31"><a href="other-useful.html#cb148-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-32"><a href="other-useful.html#cb148-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb148-33"><a href="other-useful.html#cb148-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;mni&quot;</span>))</span>
<span id="cb148-34"><a href="other-useful.html#cb148-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-35"><a href="other-useful.html#cb148-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb148-36"><a href="other-useful.html#cb148-36" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">lambda_choice=</span><span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>)),</span>
<span id="cb148-37"><a href="other-useful.html#cb148-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(lambda_choice) == 1 is not TRUE&quot;</span>,</span>
<span id="cb148-38"><a href="other-useful.html#cb148-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-39"><a href="other-useful.html#cb148-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-40"><a href="other-useful.html#cb148-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="dv">1</span>),</span>
<span id="cb148-41"><a href="other-useful.html#cb148-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(lambda_choice) is not TRUE&quot;</span>,</span>
<span id="cb148-42"><a href="other-useful.html#cb148-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-43"><a href="other-useful.html#cb148-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-44"><a href="other-useful.html#cb148-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb148-45"><a href="other-useful.html#cb148-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(nfolds) | is.integer(nfolds) is not TRUE&quot;</span>,</span>
<span id="cb148-46"><a href="other-useful.html#cb148-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-47"><a href="other-useful.html#cb148-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-48"><a href="other-useful.html#cb148-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb148-49"><a href="other-useful.html#cb148-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(nfolds) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-50"><a href="other-useful.html#cb148-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-51"><a href="other-useful.html#cb148-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="fl">3.2</span>),</span>
<span id="cb148-52"><a href="other-useful.html#cb148-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds == round(nfolds) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-53"><a href="other-useful.html#cb148-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-54"><a href="other-useful.html#cb148-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">3</span>),</span>
<span id="cb148-55"><a href="other-useful.html#cb148-55" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds &gt; 3 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-56"><a href="other-useful.html#cb148-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-57"><a href="other-useful.html#cb148-57" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:7&#39;): getLassoLambda works ──────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;1se&quot;, nfolds = 4)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:14&#39;): getLassoLambda works ─────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;min&quot;, nfolds = 5)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code>:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="other-useful.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Automated estimation of model size</span></span>
<span id="cb150-2"><a href="other-useful.html#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb150-3"><a href="other-useful.html#cb150-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This function is uses the lasso with cross-validation to estimate the</span></span>
<span id="cb150-4"><a href="other-useful.html#cb150-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size. Before using the lasso, in each cluster all features will be</span></span>
<span id="cb150-5"><a href="other-useful.html#cb150-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropped from X except the one feature with the highest marginal correlation</span></span>
<span id="cb150-6"><a href="other-useful.html#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with y, as in the protolasso (Reid and Tibshirani 2016).</span></span>
<span id="cb150-7"><a href="other-useful.html#cb150-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb150-8"><a href="other-useful.html#cb150-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb150-9"><a href="other-useful.html#cb150-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb150-10"><a href="other-useful.html#cb150-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors.</span></span>
<span id="cb150-11"><a href="other-useful.html#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A length-n numeric vector containing the responses; `y[i]` is the</span></span>
<span id="cb150-12"><a href="other-useful.html#cb150-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response corresponding to observation `X[i, ]`. (Note that for the css</span></span>
<span id="cb150-13"><a href="other-useful.html#cb150-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function, y does not have to be a numeric response, but for this function,</span></span>
<span id="cb150-14"><a href="other-useful.html#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the underlying selection procedure is the lasso, so y must be a real-valued</span></span>
<span id="cb150-15"><a href="other-useful.html#cb150-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response.)</span></span>
<span id="cb150-16"><a href="other-useful.html#cb150-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb150-17"><a href="other-useful.html#cb150-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of css.</span></span>
<span id="cb150-18"><a href="other-useful.html#cb150-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb150-19"><a href="other-useful.html#cb150-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb150-20"><a href="other-useful.html#cb150-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb150-21"><a href="other-useful.html#cb150-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1). </span><span class="al">CAUTION</span><span class="co">: if the provided X is a data.frame that</span></span>
<span id="cb150-22"><a href="other-useful.html#cb150-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; contains a categorical feature with more than two levels, then the resulting</span></span>
<span id="cb150-23"><a href="other-useful.html#cb150-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix made from model.matrix will have a different number of columns than</span></span>
<span id="cb150-24"><a href="other-useful.html#cb150-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the provided data.frame, some of the feature numbers will change, and the</span></span>
<span id="cb150-25"><a href="other-useful.html#cb150-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters argument will not work properly (in the current version of the</span></span>
<span id="cb150-26"><a href="other-useful.html#cb150-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; package). To get correct results in this case, please use model.matrix to</span></span>
<span id="cb150-27"><a href="other-useful.html#cb150-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; convert the data.frame to a numeric matrix on your own, then provide this</span></span>
<span id="cb150-28"><a href="other-useful.html#cb150-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix and cluster assignments with respect to this matrix.</span></span>
<span id="cb150-29"><a href="other-useful.html#cb150-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer; the estimated size of the model. The minimum returned</span></span>
<span id="cb150-30"><a href="other-useful.html#cb150-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; value is 1, even if the lasso with cross-validation chose no features.</span></span>
<span id="cb150-31"><a href="other-useful.html#cb150-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb150-32"><a href="other-useful.html#cb150-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Reid, S., &amp; Tibshirani, R. (2016). Sparse regression and marginal</span></span>
<span id="cb150-33"><a href="other-useful.html#cb150-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testing using cluster prototypes. \emph{Biostatistics}, 17(2), 364–376.</span></span>
<span id="cb150-34"><a href="other-useful.html#cb150-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1093/biostatistics/kxv049}.</span></span>
<span id="cb150-35"><a href="other-useful.html#cb150-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb150-36"><a href="other-useful.html#cb150-36" aria-hidden="true" tabindex="-1"></a><span id='getModelSize'>getModelSize</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, clusters){</span>
<span id="cb150-37"><a href="other-useful.html#cb150-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-38"><a href="other-useful.html#cb150-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X) <span class="sc">|</span> <span class="fu">is.data.frame</span>(X))</span>
<span id="cb150-39"><a href="other-useful.html#cb150-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-40"><a href="other-useful.html#cb150-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb150-41"><a href="other-useful.html#cb150-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(X)){</span>
<span id="cb150-42"><a href="other-useful.html#cb150-42" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb150-43"><a href="other-useful.html#cb150-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-44"><a href="other-useful.html#cb150-44" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X)</span>
<span id="cb150-45"><a href="other-useful.html#cb150-45" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> X[, <span class="fu">colnames</span>(X) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb150-46"><a href="other-useful.html#cb150-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-47"><a href="other-useful.html#cb150-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> (p <span class="sc">!=</span> <span class="fu">ncol</span>(X))){</span>
<span id="cb150-48"><a href="other-useful.html#cb150-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;When stats::model.matrix converted the provided data.frame X to a matrix, the number of columns changed (probably because the provided data.frame contained a factor variable with at least three levels). Please convert X to a matrix yourself using model.matrix and provide cluster assignments according to the columns of the new matrix.&quot;</span>)</span>
<span id="cb150-49"><a href="other-useful.html#cb150-49" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb150-50"><a href="other-useful.html#cb150-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb150-51"><a href="other-useful.html#cb150-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-52"><a href="other-useful.html#cb150-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb150-53"><a href="other-useful.html#cb150-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X)))</span>
<span id="cb150-54"><a href="other-useful.html#cb150-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb150-55"><a href="other-useful.html#cb150-55" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb150-56"><a href="other-useful.html#cb150-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-57"><a href="other-useful.html#cb150-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since the model size will be determined by cross-validation, the provided</span></span>
<span id="cb150-58"><a href="other-useful.html#cb150-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y must be real-valued (this should be checked internally in other</span></span>
<span id="cb150-59"><a href="other-useful.html#cb150-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># functions before getModelSize is called, but this check is here just in</span></span>
<span id="cb150-60"><a href="other-useful.html#cb150-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case).</span></span>
<span id="cb150-61"><a href="other-useful.html#cb150-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(y)){</span>
<span id="cb150-62"><a href="other-useful.html#cb150-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>)</span>
<span id="cb150-63"><a href="other-useful.html#cb150-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb150-64"><a href="other-useful.html#cb150-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb150-65"><a href="other-useful.html#cb150-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-66"><a href="other-useful.html#cb150-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check clusters argument</span></span>
<span id="cb150-67"><a href="other-useful.html#cb150-67" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(clusters)</span>
<span id="cb150-68"><a href="other-useful.html#cb150-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-69"><a href="other-useful.html#cb150-69" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Format clusters into a list where all features are in exactly one</span></span>
<span id="cb150-70"><a href="other-useful.html#cb150-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster (any unclustered features are put in their own &quot;cluster&quot; of size</span></span>
<span id="cb150-71"><a href="other-useful.html#cb150-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1).</span></span>
<span id="cb150-72"><a href="other-useful.html#cb150-72" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb150-73"><a href="other-useful.html#cb150-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">is.list</span>(clusters)){</span>
<span id="cb150-74"><a href="other-useful.html#cb150-74" aria-hidden="true" tabindex="-1"></a>        clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb150-75"><a href="other-useful.html#cb150-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb150-76"><a href="other-useful.html#cb150-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-77"><a href="other-useful.html#cb150-77" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(clusters, <span class="at">p=</span><span class="fu">ncol</span>(X),</span>
<span id="cb150-78"><a href="other-useful.html#cb150-78" aria-hidden="true" tabindex="-1"></a>        <span class="at">clust_names=</span>clust_names)<span class="sc">$</span>clusters</span>
<span id="cb150-79"><a href="other-useful.html#cb150-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-80"><a href="other-useful.html#cb150-80" aria-hidden="true" tabindex="-1"></a>    X_size <span class="ot">&lt;-</span> X</span>
<span id="cb150-81"><a href="other-useful.html#cb150-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-82"><a href="other-useful.html#cb150-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb150-83"><a href="other-useful.html#cb150-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create modified design matrix by dropping all but one feature from</span></span>
<span id="cb150-84"><a href="other-useful.html#cb150-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># each cluster</span></span>
<span id="cb150-85"><a href="other-useful.html#cb150-85" aria-hidden="true" tabindex="-1"></a>        feats_to_drop <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb150-86"><a href="other-useful.html#cb150-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb150-87"><a href="other-useful.html#cb150-87" aria-hidden="true" tabindex="-1"></a>            cluster_i <span class="ot">&lt;-</span> clusters[[i]]</span>
<span id="cb150-88"><a href="other-useful.html#cb150-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(cluster_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb150-89"><a href="other-useful.html#cb150-89" aria-hidden="true" tabindex="-1"></a>                feat_to_keep <span class="ot">&lt;-</span> <a href='css.html#identifyPrototype'>identifyPrototype</a>(cluster_i, X, y)</span>
<span id="cb150-90"><a href="other-useful.html#cb150-90" aria-hidden="true" tabindex="-1"></a>                feats_to_drop <span class="ot">&lt;-</span> <span class="fu">c</span>(feats_to_drop, <span class="fu">setdiff</span>(cluster_i,</span>
<span id="cb150-91"><a href="other-useful.html#cb150-91" aria-hidden="true" tabindex="-1"></a>                    feat_to_keep))</span>
<span id="cb150-92"><a href="other-useful.html#cb150-92" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb150-93"><a href="other-useful.html#cb150-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb150-94"><a href="other-useful.html#cb150-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(feats_to_drop) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb150-95"><a href="other-useful.html#cb150-95" aria-hidden="true" tabindex="-1"></a>            X_size <span class="ot">&lt;-</span> X_size[, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>feats_to_drop]</span>
<span id="cb150-96"><a href="other-useful.html#cb150-96" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb150-97"><a href="other-useful.html#cb150-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb150-98"><a href="other-useful.html#cb150-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-99"><a href="other-useful.html#cb150-99" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X_size, <span class="at">y=</span>y, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb150-100"><a href="other-useful.html#cb150-100" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(glmnet<span class="sc">::</span><span class="fu">coef.glmnet</span>(size_results, <span class="at">s=</span><span class="st">&quot;lambda.1se&quot;</span>))</span>
<span id="cb150-101"><a href="other-useful.html#cb150-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-102"><a href="other-useful.html#cb150-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of nonzero coefficients (subtract one in order to ignore intercept)</span></span>
<span id="cb150-103"><a href="other-useful.html#cb150-103" aria-hidden="true" tabindex="-1"></a>    size <span class="ot">&lt;-</span> <span class="fu">length</span>(coefs[coefs <span class="sc">!=</span> <span class="dv">0</span>]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb150-104"><a href="other-useful.html#cb150-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-105"><a href="other-useful.html#cb150-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb150-106"><a href="other-useful.html#cb150-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(size) <span class="sc">|</span> <span class="fu">is.integer</span>(size))</span>
<span id="cb150-107"><a href="other-useful.html#cb150-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(size))</span>
<span id="cb150-108"><a href="other-useful.html#cb150-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(size) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb150-109"><a href="other-useful.html#cb150-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(size <span class="sc">==</span> <span class="fu">round</span>(size))</span>
<span id="cb150-110"><a href="other-useful.html#cb150-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-111"><a href="other-useful.html#cb150-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.integer</span>(<span class="fu">max</span>(size, <span class="dv">1</span>)))</span>
<span id="cb150-112"><a href="other-useful.html#cb150-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code>:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="other-useful.html#cb151-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getModelSize works&quot;</span>, {</span>
<span id="cb151-2"><a href="other-useful.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1723</span>)</span>
<span id="cb151-3"><a href="other-useful.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-4"><a href="other-useful.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb151-5"><a href="other-useful.html#cb151-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb151-6"><a href="other-useful.html#cb151-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-7"><a href="other-useful.html#cb151-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb151-8"><a href="other-useful.html#cb151-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb151-9"><a href="other-useful.html#cb151-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-10"><a href="other-useful.html#cb151-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb151-11"><a href="other-useful.html#cb151-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-12"><a href="other-useful.html#cb151-12" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb151-13"><a href="other-useful.html#cb151-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-14"><a href="other-useful.html#cb151-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb151-15"><a href="other-useful.html#cb151-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb151-16"><a href="other-useful.html#cb151-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb151-17"><a href="other-useful.html#cb151-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb151-18"><a href="other-useful.html#cb151-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb151-19"><a href="other-useful.html#cb151-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but two clusters of size 3, so maximum size should</span></span>
<span id="cb151-20"><a href="other-useful.html#cb151-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 2 = 7</span></span>
<span id="cb151-21"><a href="other-useful.html#cb151-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb151-22"><a href="other-useful.html#cb151-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-23"><a href="other-useful.html#cb151-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb151-24"><a href="other-useful.html#cb151-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-25"><a href="other-useful.html#cb151-25" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb151-26"><a href="other-useful.html#cb151-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-27"><a href="other-useful.html#cb151-27" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>unnamed_clusters)</span>
<span id="cb151-28"><a href="other-useful.html#cb151-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-29"><a href="other-useful.html#cb151-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb151-30"><a href="other-useful.html#cb151-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb151-31"><a href="other-useful.html#cb151-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb151-32"><a href="other-useful.html#cb151-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb151-33"><a href="other-useful.html#cb151-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb151-34"><a href="other-useful.html#cb151-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb151-35"><a href="other-useful.html#cb151-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb151-36"><a href="other-useful.html#cb151-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb151-37"><a href="other-useful.html#cb151-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-38"><a href="other-useful.html#cb151-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb151-39"><a href="other-useful.html#cb151-39" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb151-40"><a href="other-useful.html#cb151-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-41"><a href="other-useful.html#cb151-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb151-42"><a href="other-useful.html#cb151-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb151-43"><a href="other-useful.html#cb151-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb151-44"><a href="other-useful.html#cb151-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb151-45"><a href="other-useful.html#cb151-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb151-46"><a href="other-useful.html#cb151-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 4 in one cluster, so maximum size should be 11 - 3 = 8</span></span>
<span id="cb151-47"><a href="other-useful.html#cb151-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb151-48"><a href="other-useful.html#cb151-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-49"><a href="other-useful.html#cb151-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-50"><a href="other-useful.html#cb151-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb151-51"><a href="other-useful.html#cb151-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb151-52"><a href="other-useful.html#cb151-52" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb151-53"><a href="other-useful.html#cb151-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-54"><a href="other-useful.html#cb151-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb151-55"><a href="other-useful.html#cb151-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-56"><a href="other-useful.html#cb151-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb151-57"><a href="other-useful.html#cb151-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb151-58"><a href="other-useful.html#cb151-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb151-59"><a href="other-useful.html#cb151-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb151-60"><a href="other-useful.html#cb151-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb151-61"><a href="other-useful.html#cb151-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb151-62"><a href="other-useful.html#cb151-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb151-63"><a href="other-useful.html#cb151-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb151-64"><a href="other-useful.html#cb151-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-65"><a href="other-useful.html#cb151-65" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb151-66"><a href="other-useful.html#cb151-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-67"><a href="other-useful.html#cb151-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb151-68"><a href="other-useful.html#cb151-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.matrix(X) | is.data.frame(X) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-69"><a href="other-useful.html#cb151-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-70"><a href="other-useful.html#cb151-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ], <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb151-71"><a href="other-useful.html#cb151-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(y) == n is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-72"><a href="other-useful.html#cb151-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-73"><a href="other-useful.html#cb151-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">FALSE</span>, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb151-74"><a href="other-useful.html#cb151-74" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>,</span>
<span id="cb151-75"><a href="other-useful.html#cb151-75" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-76"><a href="other-useful.html#cb151-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-77"><a href="other-useful.html#cb151-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)),</span>
<span id="cb151-78"><a href="other-useful.html#cb151-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: 1, 2.&quot;</span>,</span>
<span id="cb151-79"><a href="other-useful.html#cb151-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-80"><a href="other-useful.html#cb151-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb151-81"><a href="other-useful.html#cb151-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)),</span>
<span id="cb151-82"><a href="other-useful.html#cb151-82" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb151-83"><a href="other-useful.html#cb151-83" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-84"><a href="other-useful.html#cb151-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-85"><a href="other-useful.html#cb151-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb151-86"><a href="other-useful.html#cb151-86" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb151-87"><a href="other-useful.html#cb151-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-88"><a href="other-useful.html#cb151-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-89"><a href="other-useful.html#cb151-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb151-90"><a href="other-useful.html#cb151-90" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>))),</span>
<span id="cb151-91"><a href="other-useful.html#cb151-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(clusters) are not all TRUE&quot;</span>,</span>
<span id="cb151-92"><a href="other-useful.html#cb151-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-93"><a href="other-useful.html#cb151-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-94"><a href="other-useful.html#cb151-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))),</span>
<span id="cb151-95"><a href="other-useful.html#cb151-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb151-96"><a href="other-useful.html#cb151-96" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-97"><a href="other-useful.html#cb151-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-98"><a href="other-useful.html#cb151-98" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb151-99"><a href="other-useful.html#cb151-99" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb151-100"><a href="other-useful.html#cb151-100" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-101"><a href="other-useful.html#cb151-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-102"><a href="other-useful.html#cb151-102" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb151-103"><a href="other-useful.html#cb151-103" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>))),</span>
<span id="cb151-104"><a href="other-useful.html#cb151-104" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] == round(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb151-105"><a href="other-useful.html#cb151-105" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb151-106"><a href="other-useful.html#cb151-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-107"><a href="other-useful.html#cb151-107" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:12&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:27&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = unnamed_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:39&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = 2:5)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:54&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="other-useful.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Prepares a data.frame summarazing cluster stability selection output to print</span></span>
<span id="cb153-2"><a href="other-useful.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb153-3"><a href="other-useful.html#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function.</span></span>
<span id="cb153-4"><a href="other-useful.html#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb153-5"><a href="other-useful.html#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb153-6"><a href="other-useful.html#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; the outputted data.frame will display only those</span></span>
<span id="cb153-7"><a href="other-useful.html#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb153-8"><a href="other-useful.html#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb153-9"><a href="other-useful.html#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb153-10"><a href="other-useful.html#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb153-11"><a href="other-useful.html#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb153-12"><a href="other-useful.html#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb153-13"><a href="other-useful.html#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb153-14"><a href="other-useful.html#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb153-15"><a href="other-useful.html#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb153-16"><a href="other-useful.html#cb153-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb153-17"><a href="other-useful.html#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb153-18"><a href="other-useful.html#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb153-19"><a href="other-useful.html#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb153-20"><a href="other-useful.html#cb153-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb153-21"><a href="other-useful.html#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb153-22"><a href="other-useful.html#cb153-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb153-23"><a href="other-useful.html#cb153-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb153-24"><a href="other-useful.html#cb153-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb153-25"><a href="other-useful.html#cb153-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb153-26"><a href="other-useful.html#cb153-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb153-27"><a href="other-useful.html#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb153-28"><a href="other-useful.html#cb153-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb153-29"><a href="other-useful.html#cb153-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb153-30"><a href="other-useful.html#cb153-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb153-31"><a href="other-useful.html#cb153-31" aria-hidden="true" tabindex="-1"></a><span id='printCssDf'>printCssDf</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb153-32"><a href="other-useful.html#cb153-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_num_clusts=</span><span class="cn">NA</span>){</span>
<span id="cb153-33"><a href="other-useful.html#cb153-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb153-34"><a href="other-useful.html#cb153-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb153-35"><a href="other-useful.html#cb153-35" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb153-36"><a href="other-useful.html#cb153-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-37"><a href="other-useful.html#cb153-37" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb153-38"><a href="other-useful.html#cb153-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-39"><a href="other-useful.html#cb153-39" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb153-40"><a href="other-useful.html#cb153-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-41"><a href="other-useful.html#cb153-41" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb153-42"><a href="other-useful.html#cb153-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb153-43"><a href="other-useful.html#cb153-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-44"><a href="other-useful.html#cb153-44" aria-hidden="true" tabindex="-1"></a>    sel_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_results, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb153-45"><a href="other-useful.html#cb153-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts,</span>
<span id="cb153-46"><a href="other-useful.html#cb153-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">max_num_clusts=</span>max_num_clusts)<span class="sc">$</span>selected_clusts</span>
<span id="cb153-47"><a href="other-useful.html#cb153-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-48"><a href="other-useful.html#cb153-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sel_clusts is guaranteed to have length at least 1 by</span></span>
<span id="cb153-49"><a href="other-useful.html#cb153-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getCssSelections </span></span>
<span id="cb153-50"><a href="other-useful.html#cb153-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-51"><a href="other-useful.html#cb153-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get prototypes (feature from each cluster with highest selection</span></span>
<span id="cb153-52"><a href="other-useful.html#cb153-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># proportion, breaking ties by using marginal correlations of features with</span></span>
<span id="cb153-53"><a href="other-useful.html#cb153-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y from data provided to css if y is real-valued)</span></span>
<span id="cb153-54"><a href="other-useful.html#cb153-54" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, sel_clusts)</span>
<span id="cb153-55"><a href="other-useful.html#cb153-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb153-56"><a href="other-useful.html#cb153-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cluster selection proportions</span></span>
<span id="cb153-57"><a href="other-useful.html#cb153-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(sel_clusts) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb153-58"><a href="other-useful.html#cb153-58" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb153-59"><a href="other-useful.html#cb153-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb153-60"><a href="other-useful.html#cb153-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb153-61"><a href="other-useful.html#cb153-61" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">mean</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb153-62"><a href="other-useful.html#cb153-62" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb153-63"><a href="other-useful.html#cb153-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb153-64"><a href="other-useful.html#cb153-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-65"><a href="other-useful.html#cb153-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data.frame: name of cluster, cluster prototype, selection proportion,</span></span>
<span id="cb153-66"><a href="other-useful.html#cb153-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster size</span></span>
<span id="cb153-67"><a href="other-useful.html#cb153-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-68"><a href="other-useful.html#cb153-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(prototypes))){</span>
<span id="cb153-69"><a href="other-useful.html#cb153-69" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb153-70"><a href="other-useful.html#cb153-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoName=</span><span class="fu">names</span>(prototypes), <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes),</span>
<span id="cb153-71"><a href="other-useful.html#cb153-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSelProp=</span>sel_clust_sel_props, <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb153-72"><a href="other-useful.html#cb153-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb153-73"><a href="other-useful.html#cb153-73" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb153-74"><a href="other-useful.html#cb153-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes), <span class="at">ClustSelProp=</span>sel_clust_sel_props,</span>
<span id="cb153-75"><a href="other-useful.html#cb153-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb153-76"><a href="other-useful.html#cb153-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb153-77"><a href="other-useful.html#cb153-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-78"><a href="other-useful.html#cb153-78" aria-hidden="true" tabindex="-1"></a>    print_df <span class="ot">&lt;-</span> print_df[<span class="fu">order</span>(print_df<span class="sc">$</span>ClustSelProp, <span class="at">decreasing=</span><span class="cn">TRUE</span>), ]</span>
<span id="cb153-79"><a href="other-useful.html#cb153-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-80"><a href="other-useful.html#cb153-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(print_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb153-81"><a href="other-useful.html#cb153-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb153-82"><a href="other-useful.html#cb153-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(print_df))</span>
<span id="cb153-83"><a href="other-useful.html#cb153-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(print_df) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb153-84"><a href="other-useful.html#cb153-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-85"><a href="other-useful.html#cb153-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(print_df)</span>
<span id="cb153-86"><a href="other-useful.html#cb153-86" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="other-useful.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Identify selection prototypes from selected clusters</span></span>
<span id="cb154-2"><a href="other-useful.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb154-3"><a href="other-useful.html#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in list of selected clusters and returns an integer vector of the</span></span>
<span id="cb154-4"><a href="other-useful.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features that were most frequently selected from each cluster</span></span>
<span id="cb154-5"><a href="other-useful.html#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb154-6"><a href="other-useful.html#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb154-7"><a href="other-useful.html#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb154-8"><a href="other-useful.html#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected_clusts A list of integer vectors; each vector must contain</span></span>
<span id="cb154-9"><a href="other-useful.html#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the indices of features in a cluster.</span></span>
<span id="cb154-10"><a href="other-useful.html#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector (of length equal to the number of clusters) of the</span></span>
<span id="cb154-11"><a href="other-useful.html#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the feature prototypes (the features from each cluster that were</span></span>
<span id="cb154-12"><a href="other-useful.html#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected the most often individually by the base method in cluster stability</span></span>
<span id="cb154-13"><a href="other-useful.html#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection). In the case of a tie, the tie is broken by choosing the feature</span></span>
<span id="cb154-14"><a href="other-useful.html#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; most correlated with the response in the full data set provided to css.</span></span>
<span id="cb154-15"><a href="other-useful.html#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb154-16"><a href="other-useful.html#cb154-16" aria-hidden="true" tabindex="-1"></a><span id='getSelectionPrototypes'>getSelectionPrototypes</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, selected_clusts){</span>
<span id="cb154-17"><a href="other-useful.html#cb154-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb154-18"><a href="other-useful.html#cb154-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb154-19"><a href="other-useful.html#cb154-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb154-20"><a href="other-useful.html#cb154-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-21"><a href="other-useful.html#cb154-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(selected_clusts))</span>
<span id="cb154-22"><a href="other-useful.html#cb154-22" aria-hidden="true" tabindex="-1"></a>    n_selected_clusts <span class="ot">&lt;-</span> <span class="fu">length</span>(selected_clusts)</span>
<span id="cb154-23"><a href="other-useful.html#cb154-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_selected_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb154-24"><a href="other-useful.html#cb154-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb154-25"><a href="other-useful.html#cb154-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-26"><a href="other-useful.html#cb154-26" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.integer</span>(<span class="cn">NA</span>), n_selected_clusts)</span>
<span id="cb154-27"><a href="other-useful.html#cb154-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_selected_clusts){</span>
<span id="cb154-28"><a href="other-useful.html#cb154-28" aria-hidden="true" tabindex="-1"></a>        clust_i <span class="ot">&lt;-</span> selected_clusts[[i]]</span>
<span id="cb154-29"><a href="other-useful.html#cb154-29" aria-hidden="true" tabindex="-1"></a>        sel_props_i <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[clust_i]</span>
<span id="cb154-30"><a href="other-useful.html#cb154-30" aria-hidden="true" tabindex="-1"></a>        proto_i <span class="ot">&lt;-</span> clust_i[sel_props_i <span class="sc">==</span> <span class="fu">max</span>(sel_props_i)]</span>
<span id="cb154-31"><a href="other-useful.html#cb154-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb154-32"><a href="other-useful.html#cb154-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb154-33"><a href="other-useful.html#cb154-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">is.numeric</span>(css_results<span class="sc">$</span>y) <span class="sc">|</span> <span class="fu">is.integer</span>(css_results<span class="sc">$</span>y)){</span>
<span id="cb154-34"><a href="other-useful.html#cb154-34" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Break tie by looking at marginal correlations</span></span>
<span id="cb154-35"><a href="other-useful.html#cb154-35" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">cor</span>(css_results<span class="sc">$</span>X[, proto_i], css_results<span class="sc">$</span>y)[, <span class="dv">1</span>]</span>
<span id="cb154-36"><a href="other-useful.html#cb154-36" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> <span class="fu">abs</span>(corrs_i)</span>
<span id="cb154-37"><a href="other-useful.html#cb154-37" aria-hidden="true" tabindex="-1"></a>                proto_i <span class="ot">&lt;-</span> proto_i[corrs_i <span class="sc">==</span> <span class="fu">max</span>(corrs_i)]</span>
<span id="cb154-38"><a href="other-useful.html#cb154-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb154-39"><a href="other-useful.html#cb154-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-40"><a href="other-useful.html#cb154-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If there is still a tie, break by choosing the first feature of those</span></span>
<span id="cb154-41"><a href="other-useful.html#cb154-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remaining</span></span>
<span id="cb154-42"><a href="other-useful.html#cb154-42" aria-hidden="true" tabindex="-1"></a>        prototypes[i] <span class="ot">&lt;-</span> proto_i[<span class="dv">1</span>]</span>
<span id="cb154-43"><a href="other-useful.html#cb154-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(prototypes)[i] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(css_results<span class="sc">$</span>X)[proto_i]</span>
<span id="cb154-44"><a href="other-useful.html#cb154-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-45"><a href="other-useful.html#cb154-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-46"><a href="other-useful.html#cb154-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb154-47"><a href="other-useful.html#cb154-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-48"><a href="other-useful.html#cb154-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(prototypes))</span>
<span id="cb154-49"><a href="other-useful.html#cb154-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(prototypes)))</span>
<span id="cb154-50"><a href="other-useful.html#cb154-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(prototypes)))</span>
<span id="cb154-51"><a href="other-useful.html#cb154-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-52"><a href="other-useful.html#cb154-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(prototypes)</span>
<span id="cb154-53"><a href="other-useful.html#cb154-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code>:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="other-useful.html#cb155-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getSelectionPrototypes works&quot;</span>, {</span>
<span id="cb155-2"><a href="other-useful.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb155-3"><a href="other-useful.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-4"><a href="other-useful.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb155-5"><a href="other-useful.html#cb155-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb155-6"><a href="other-useful.html#cb155-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-7"><a href="other-useful.html#cb155-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb155-8"><a href="other-useful.html#cb155-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb155-9"><a href="other-useful.html#cb155-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-10"><a href="other-useful.html#cb155-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb155-11"><a href="other-useful.html#cb155-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-12"><a href="other-useful.html#cb155-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb155-13"><a href="other-useful.html#cb155-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-14"><a href="other-useful.html#cb155-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="at">selected_clusts=</span>good_clusters)</span>
<span id="cb155-15"><a href="other-useful.html#cb155-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-16"><a href="other-useful.html#cb155-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb155-17"><a href="other-useful.html#cb155-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret)))</span>
<span id="cb155-18"><a href="other-useful.html#cb155-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(good_clusters))</span>
<span id="cb155-19"><a href="other-useful.html#cb155-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(<span class="fu">unique</span>(ret)))</span>
<span id="cb155-20"><a href="other-useful.html#cb155-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ret)){</span>
<span id="cb155-21"><a href="other-useful.html#cb155-21" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[i] <span class="sc">%in%</span> good_clusters[[i]])</span>
<span id="cb155-22"><a href="other-useful.html#cb155-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the largest selection proportion of any feature in cluster i</span></span>
<span id="cb155-23"><a href="other-useful.html#cb155-23" aria-hidden="true" tabindex="-1"></a>    max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, good_clusters[[i]]]))</span>
<span id="cb155-24"><a href="other-useful.html#cb155-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb155-25"><a href="other-useful.html#cb155-25" aria-hidden="true" tabindex="-1"></a>    proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret[i]]</span>
<span id="cb155-26"><a href="other-useful.html#cb155-26" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb155-27"><a href="other-useful.html#cb155-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb155-28"><a href="other-useful.html#cb155-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb155-29"><a href="other-useful.html#cb155-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try with only one selected cluster (still should be in a list)</span></span>
<span id="cb155-30"><a href="other-useful.html#cb155-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-31"><a href="other-useful.html#cb155-31" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb155-32"><a href="other-useful.html#cb155-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">selected_clusts=</span><span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L))</span>
<span id="cb155-33"><a href="other-useful.html#cb155-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-34"><a href="other-useful.html#cb155-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb155-35"><a href="other-useful.html#cb155-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb155-36"><a href="other-useful.html#cb155-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb155-37"><a href="other-useful.html#cb155-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb155-38"><a href="other-useful.html#cb155-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the largest selection proportion of any feature in the cluster</span></span>
<span id="cb155-39"><a href="other-useful.html#cb155-39" aria-hidden="true" tabindex="-1"></a>  max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, 1L<span class="sc">:</span>3L]))</span>
<span id="cb155-40"><a href="other-useful.html#cb155-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb155-41"><a href="other-useful.html#cb155-41" aria-hidden="true" tabindex="-1"></a>  proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret]</span>
<span id="cb155-42"><a href="other-useful.html#cb155-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb155-43"><a href="other-useful.html#cb155-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-44"><a href="other-useful.html#cb155-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb155-45"><a href="other-useful.html#cb155-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-46"><a href="other-useful.html#cb155-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error contains quotation marks</span></span>
<span id="cb155-47"><a href="other-useful.html#cb155-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(x, good_clusters))</span>
<span id="cb155-48"><a href="other-useful.html#cb155-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-49"><a href="other-useful.html#cb155-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, 1L<span class="sc">:</span>3L),</span>
<span id="cb155-50"><a href="other-useful.html#cb155-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(selected_clusts) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb155-51"><a href="other-useful.html#cb155-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-52"><a href="other-useful.html#cb155-52" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="fu">list</span>()),</span>
<span id="cb155-53"><a href="other-useful.html#cb155-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_selected_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb155-54"><a href="other-useful.html#cb155-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-55"><a href="other-useful.html#cb155-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb155-56"><a href="other-useful.html#cb155-56" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L,</span>
<span id="cb155-57"><a href="other-useful.html#cb155-57" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L,</span>
<span id="cb155-58"><a href="other-useful.html#cb155-58" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">bad_cluster=</span><span class="fu">integer</span>())),</span>
<span id="cb155-59"><a href="other-useful.html#cb155-59" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(selected_clusts) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb155-60"><a href="other-useful.html#cb155-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb155-61"><a href="other-useful.html#cb155-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-62"><a href="other-useful.html#cb155-62" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>Tests for <code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="other-useful.html#cb157-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;printCssDf works&quot;</span>, {</span>
<span id="cb157-2"><a href="other-useful.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb157-3"><a href="other-useful.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-4"><a href="other-useful.html#cb157-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb157-5"><a href="other-useful.html#cb157-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb157-6"><a href="other-useful.html#cb157-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-7"><a href="other-useful.html#cb157-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb157-8"><a href="other-useful.html#cb157-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb157-9"><a href="other-useful.html#cb157-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-10"><a href="other-useful.html#cb157-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb157-11"><a href="other-useful.html#cb157-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-12"><a href="other-useful.html#cb157-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb157-13"><a href="other-useful.html#cb157-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-14"><a href="other-useful.html#cb157-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results)</span>
<span id="cb157-15"><a href="other-useful.html#cb157-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-16"><a href="other-useful.html#cb157-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-17"><a href="other-useful.html#cb157-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb157-18"><a href="other-useful.html#cb157-18" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-19"><a href="other-useful.html#cb157-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-20"><a href="other-useful.html#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb157-21"><a href="other-useful.html#cb157-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb157-22"><a href="other-useful.html#cb157-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-23"><a href="other-useful.html#cb157-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-24"><a href="other-useful.html#cb157-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-25"><a href="other-useful.html#cb157-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-26"><a href="other-useful.html#cb157-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-27"><a href="other-useful.html#cb157-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-28"><a href="other-useful.html#cb157-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-29"><a href="other-useful.html#cb157-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb157-30"><a href="other-useful.html#cb157-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-31"><a href="other-useful.html#cb157-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb157-32"><a href="other-useful.html#cb157-32" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb157-33"><a href="other-useful.html#cb157-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb157-34"><a href="other-useful.html#cb157-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-35"><a href="other-useful.html#cb157-35" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb157-36"><a href="other-useful.html#cb157-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-37"><a href="other-useful.html#cb157-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-38"><a href="other-useful.html#cb157-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-39"><a href="other-useful.html#cb157-39" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-40"><a href="other-useful.html#cb157-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-41"><a href="other-useful.html#cb157-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-42"><a href="other-useful.html#cb157-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-43"><a href="other-useful.html#cb157-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-44"><a href="other-useful.html#cb157-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb157-45"><a href="other-useful.html#cb157-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-46"><a href="other-useful.html#cb157-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again naming features</span></span>
<span id="cb157-47"><a href="other-useful.html#cb157-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-48"><a href="other-useful.html#cb157-48" aria-hidden="true" tabindex="-1"></a>  x_named <span class="ot">&lt;-</span> x</span>
<span id="cb157-49"><a href="other-useful.html#cb157-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_named) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb157-50"><a href="other-useful.html#cb157-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-51"><a href="other-useful.html#cb157-51" aria-hidden="true" tabindex="-1"></a>  css_results_name_feats <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_named, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb157-52"><a href="other-useful.html#cb157-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb157-53"><a href="other-useful.html#cb157-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-54"><a href="other-useful.html#cb157-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_name_feats)</span>
<span id="cb157-55"><a href="other-useful.html#cb157-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-56"><a href="other-useful.html#cb157-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-57"><a href="other-useful.html#cb157-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoName&quot;</span>,</span>
<span id="cb157-58"><a href="other-useful.html#cb157-58" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustProtoNum&quot;</span>, <span class="st">&quot;ClustSelProp&quot;</span>,</span>
<span id="cb157-59"><a href="other-useful.html#cb157-59" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-60"><a href="other-useful.html#cb157-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-61"><a href="other-useful.html#cb157-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb157-62"><a href="other-useful.html#cb157-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb157-63"><a href="other-useful.html#cb157-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-64"><a href="other-useful.html#cb157-64" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-65"><a href="other-useful.html#cb157-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-66"><a href="other-useful.html#cb157-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-67"><a href="other-useful.html#cb157-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-68"><a href="other-useful.html#cb157-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustProtoName))</span>
<span id="cb157-69"><a href="other-useful.html#cb157-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-70"><a href="other-useful.html#cb157-70" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb157-71"><a href="other-useful.html#cb157-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-72"><a href="other-useful.html#cb157-72" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb157-73"><a href="other-useful.html#cb157-73" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb157-74"><a href="other-useful.html#cb157-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb157-75"><a href="other-useful.html#cb157-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-76"><a href="other-useful.html#cb157-76" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>])))</span>
<span id="cb157-77"><a href="other-useful.html#cb157-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-78"><a href="other-useful.html#cb157-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-79"><a href="other-useful.html#cb157-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-80"><a href="other-useful.html#cb157-80" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb157-81"><a href="other-useful.html#cb157-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-82"><a href="other-useful.html#cb157-82" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb157-83"><a href="other-useful.html#cb157-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb157-84"><a href="other-useful.html#cb157-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-85"><a href="other-useful.html#cb157-85" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb157-86"><a href="other-useful.html#cb157-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-87"><a href="other-useful.html#cb157-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-88"><a href="other-useful.html#cb157-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-89"><a href="other-useful.html#cb157-89" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-90"><a href="other-useful.html#cb157-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-91"><a href="other-useful.html#cb157-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-92"><a href="other-useful.html#cb157-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-93"><a href="other-useful.html#cb157-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-94"><a href="other-useful.html#cb157-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb157-95"><a href="other-useful.html#cb157-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-96"><a href="other-useful.html#cb157-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unnamed clusters</span></span>
<span id="cb157-97"><a href="other-useful.html#cb157-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-98"><a href="other-useful.html#cb157-98" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb157-99"><a href="other-useful.html#cb157-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-100"><a href="other-useful.html#cb157-100" aria-hidden="true" tabindex="-1"></a>  css_results_unnamed <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>unnamed_clusters,</span>
<span id="cb157-101"><a href="other-useful.html#cb157-101" aria-hidden="true" tabindex="-1"></a>                             <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb157-102"><a href="other-useful.html#cb157-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-103"><a href="other-useful.html#cb157-103" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_unnamed)</span>
<span id="cb157-104"><a href="other-useful.html#cb157-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-105"><a href="other-useful.html#cb157-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-106"><a href="other-useful.html#cb157-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb157-107"><a href="other-useful.html#cb157-107" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-108"><a href="other-useful.html#cb157-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-109"><a href="other-useful.html#cb157-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb157-110"><a href="other-useful.html#cb157-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb157-111"><a href="other-useful.html#cb157-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-112"><a href="other-useful.html#cb157-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-113"><a href="other-useful.html#cb157-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-114"><a href="other-useful.html#cb157-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-115"><a href="other-useful.html#cb157-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-116"><a href="other-useful.html#cb157-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-117"><a href="other-useful.html#cb157-117" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-118"><a href="other-useful.html#cb157-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-119"><a href="other-useful.html#cb157-119" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-120"><a href="other-useful.html#cb157-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-121"><a href="other-useful.html#cb157-121" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-122"><a href="other-useful.html#cb157-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-123"><a href="other-useful.html#cb157-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try other settings for cutoff, min_num_clusts, max_num_clusts, etc.</span></span>
<span id="cb157-124"><a href="other-useful.html#cb157-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-125"><a href="other-useful.html#cb157-125" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="dv">3</span>)</span>
<span id="cb157-126"><a href="other-useful.html#cb157-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-127"><a href="other-useful.html#cb157-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-128"><a href="other-useful.html#cb157-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb157-129"><a href="other-useful.html#cb157-129" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-130"><a href="other-useful.html#cb157-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-131"><a href="other-useful.html#cb157-131" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb157-132"><a href="other-useful.html#cb157-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-133"><a href="other-useful.html#cb157-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-134"><a href="other-useful.html#cb157-134" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-135"><a href="other-useful.html#cb157-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-136"><a href="other-useful.html#cb157-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-137"><a href="other-useful.html#cb157-137" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb157-138"><a href="other-useful.html#cb157-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb157-139"><a href="other-useful.html#cb157-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-140"><a href="other-useful.html#cb157-140" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb157-141"><a href="other-useful.html#cb157-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-142"><a href="other-useful.html#cb157-142" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-143"><a href="other-useful.html#cb157-143" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-144"><a href="other-useful.html#cb157-144" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-145"><a href="other-useful.html#cb157-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-146"><a href="other-useful.html#cb157-146" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-147"><a href="other-useful.html#cb157-147" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb157-148"><a href="other-useful.html#cb157-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-149"><a href="other-useful.html#cb157-149" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-150"><a href="other-useful.html#cb157-150" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-151"><a href="other-useful.html#cb157-151" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb157-152"><a href="other-useful.html#cb157-152" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-153"><a href="other-useful.html#cb157-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-154"><a href="other-useful.html#cb157-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-155"><a href="other-useful.html#cb157-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-156"><a href="other-useful.html#cb157-156" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-157"><a href="other-useful.html#cb157-157" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb157-158"><a href="other-useful.html#cb157-158" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-159"><a href="other-useful.html#cb157-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-160"><a href="other-useful.html#cb157-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-161"><a href="other-useful.html#cb157-161" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb157-162"><a href="other-useful.html#cb157-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-163"><a href="other-useful.html#cb157-163" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-164"><a href="other-useful.html#cb157-164" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb157-165"><a href="other-useful.html#cb157-165" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-166"><a href="other-useful.html#cb157-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-167"><a href="other-useful.html#cb157-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb157-168"><a href="other-useful.html#cb157-168" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb157-169"><a href="other-useful.html#cb157-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb157-170"><a href="other-useful.html#cb157-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-171"><a href="other-useful.html#cb157-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-172"><a href="other-useful.html#cb157-172" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-173"><a href="other-useful.html#cb157-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-174"><a href="other-useful.html#cb157-174" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-175"><a href="other-useful.html#cb157-175" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb157-176"><a href="other-useful.html#cb157-176" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb157-177"><a href="other-useful.html#cb157-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-178"><a href="other-useful.html#cb157-178" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb157-179"><a href="other-useful.html#cb157-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-180"><a href="other-useful.html#cb157-180" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-181"><a href="other-useful.html#cb157-181" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-182"><a href="other-useful.html#cb157-182" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-183"><a href="other-useful.html#cb157-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-184"><a href="other-useful.html#cb157-184" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-185"><a href="other-useful.html#cb157-185" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb157-186"><a href="other-useful.html#cb157-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-187"><a href="other-useful.html#cb157-187" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-188"><a href="other-useful.html#cb157-188" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-189"><a href="other-useful.html#cb157-189" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb157-190"><a href="other-useful.html#cb157-190" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-191"><a href="other-useful.html#cb157-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-192"><a href="other-useful.html#cb157-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-193"><a href="other-useful.html#cb157-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-194"><a href="other-useful.html#cb157-194" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-195"><a href="other-useful.html#cb157-195" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb157-196"><a href="other-useful.html#cb157-196" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-197"><a href="other-useful.html#cb157-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-198"><a href="other-useful.html#cb157-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-199"><a href="other-useful.html#cb157-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb157-200"><a href="other-useful.html#cb157-200" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb157-201"><a href="other-useful.html#cb157-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-202"><a href="other-useful.html#cb157-202" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb157-203"><a href="other-useful.html#cb157-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb157-204"><a href="other-useful.html#cb157-204" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb157-205"><a href="other-useful.html#cb157-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-206"><a href="other-useful.html#cb157-206" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb157-207"><a href="other-useful.html#cb157-207" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb157-208"><a href="other-useful.html#cb157-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-209"><a href="other-useful.html#cb157-209" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb157-210"><a href="other-useful.html#cb157-210" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb157-211"><a href="other-useful.html#cb157-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-212"><a href="other-useful.html#cb157-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb157-213"><a href="other-useful.html#cb157-213" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb157-214"><a href="other-useful.html#cb157-214" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb157-215"><a href="other-useful.html#cb157-215" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb157-216"><a href="other-useful.html#cb157-216" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb157-217"><a href="other-useful.html#cb157-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-218"><a href="other-useful.html#cb157-218" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb157-219"><a href="other-useful.html#cb157-219" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb157-220"><a href="other-useful.html#cb157-220" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb157-221"><a href="other-useful.html#cb157-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-222"><a href="other-useful.html#cb157-222" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb157-223"><a href="other-useful.html#cb157-223" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb157-224"><a href="other-useful.html#cb157-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-225"><a href="other-useful.html#cb157-225" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-226"><a href="other-useful.html#cb157-226" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb157-227"><a href="other-useful.html#cb157-227" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb157-228"><a href="other-useful.html#cb157-228" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-229"><a href="other-useful.html#cb157-229" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-230"><a href="other-useful.html#cb157-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-231"><a href="other-useful.html#cb157-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb157-232"><a href="other-useful.html#cb157-232" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb157-233"><a href="other-useful.html#cb157-233" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb157-234"><a href="other-useful.html#cb157-234" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb157-235"><a href="other-useful.html#cb157-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-236"><a href="other-useful.html#cb157-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-237"><a href="other-useful.html#cb157-237" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb157-238"><a href="other-useful.html#cb157-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-239"><a href="other-useful.html#cb157-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb157-240"><a href="other-useful.html#cb157-240" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="st">&quot;css_results&quot;</span>))</span>
<span id="cb157-241"><a href="other-useful.html#cb157-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-242"><a href="other-useful.html#cb157-242" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="sc">-</span>.<span class="dv">1</span>),</span>
<span id="cb157-243"><a href="other-useful.html#cb157-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-244"><a href="other-useful.html#cb157-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-245"><a href="other-useful.html#cb157-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="fl">3.2</span>),</span>
<span id="cb157-246"><a href="other-useful.html#cb157-246" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts == round(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb157-247"><a href="other-useful.html#cb157-247" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-248"><a href="other-useful.html#cb157-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-249"><a href="other-useful.html#cb157-249" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb157-250"><a href="other-useful.html#cb157-250" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb157-251"><a href="other-useful.html#cb157-251" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-252"><a href="other-useful.html#cb157-252" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code></p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="other-useful.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print cluster stability selection output</span></span>
<span id="cb159-2"><a href="other-useful.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb159-3"><a href="other-useful.html#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function (using output from</span></span>
<span id="cb159-4"><a href="other-useful.html#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; printCssDf function).</span></span>
<span id="cb159-5"><a href="other-useful.html#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x An object of class &quot;cssr&quot; (the output of the function css).</span></span>
<span id="cb159-6"><a href="other-useful.html#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; print.cssr will display only those</span></span>
<span id="cb159-7"><a href="other-useful.html#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb159-8"><a href="other-useful.html#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb159-9"><a href="other-useful.html#cb159-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb159-10"><a href="other-useful.html#cb159-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb159-11"><a href="other-useful.html#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb159-12"><a href="other-useful.html#cb159-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb159-13"><a href="other-useful.html#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb159-14"><a href="other-useful.html#cb159-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb159-15"><a href="other-useful.html#cb159-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb159-16"><a href="other-useful.html#cb159-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb159-17"><a href="other-useful.html#cb159-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb159-18"><a href="other-useful.html#cb159-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb159-19"><a href="other-useful.html#cb159-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Additional arguments to generic print.data.frame function</span></span>
<span id="cb159-20"><a href="other-useful.html#cb159-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb159-21"><a href="other-useful.html#cb159-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb159-22"><a href="other-useful.html#cb159-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb159-23"><a href="other-useful.html#cb159-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb159-24"><a href="other-useful.html#cb159-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb159-25"><a href="other-useful.html#cb159-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb159-26"><a href="other-useful.html#cb159-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb159-27"><a href="other-useful.html#cb159-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb159-28"><a href="other-useful.html#cb159-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb159-29"><a href="other-useful.html#cb159-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb159-30"><a href="other-useful.html#cb159-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb159-31"><a href="other-useful.html#cb159-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb159-32"><a href="other-useful.html#cb159-32" aria-hidden="true" tabindex="-1"></a><span id='print.cssr'>print.cssr</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>, ...){</span>
<span id="cb159-33"><a href="other-useful.html#cb159-33" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="at">css_results=</span>x, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb159-34"><a href="other-useful.html#cb159-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts, <span class="at">max_num_clusts=</span>max_num_clusts)</span>
<span id="cb159-35"><a href="other-useful.html#cb159-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print.data.frame</span>(df, ...)</span>
<span id="cb159-36"><a href="other-useful.html#cb159-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sel-and-pred.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrapper-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
