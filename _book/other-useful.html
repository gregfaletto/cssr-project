<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Other useful functions | Creating the cssr R package</title>
  <meta name="description" content="6 Other useful functions | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Other useful functions | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Other useful functions | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-02-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sel-and-pred.html"/>
<link rel="next" href="wrapper-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="css.html"><a href="css.html#main-components-of-css"><i class="fa fa-check"></i><b>3.1</b> Main components of <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="css.html"><a href="css.html#generating-subsamples"><i class="fa fa-check"></i><b>3.1.1</b> Generating subsamples</a></li>
<li class="chapter" data-level="3.1.2" data-path="css.html"><a href="css.html#forming-selection-matrices"><i class="fa fa-check"></i><b>3.1.2</b> Forming selection matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="css.html"><a href="css.html#helper-functions"><i class="fa fa-check"></i><b>3.2</b> Helper functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tests-for-main-functions-in-cssr.html"><a href="tests-for-main-functions-in-cssr.html"><i class="fa fa-check"></i><b>4</b> Tests for main functions in <code>cssr</code></a></li>
<li class="chapter" data-level="5" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>5</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="6" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>6</b> Other useful functions</a></li>
<li class="chapter" data-level="7" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>7</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="8" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>8</b> Competitor Methods</a></li>
<li class="chapter" data-level="9" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><i class="fa fa-check"></i><b>9</b> Documenting the package and adding README and pkgdown website</a>
<ul>
<li class="chapter" data-level="9.1" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-readme"><i class="fa fa-check"></i><b>9.1</b> Add README</a></li>
<li class="chapter" data-level="9.2" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-pkdgown-site"><i class="fa fa-check"></i><b>9.2</b> Add pkdgown site</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="other-useful" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Other useful functions<a href="other-useful.html#other-useful" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following are some other functions that are useful for specific tasks.</p>
<ul>
<li><p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code> generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature (the latent features themselves are also provided), as in the simulation in Example 1, Section 5.1, and Section 5.2 of Faletto and Bien (2022).</p></li>
<li><p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code> generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature with unequal correlations (the latent features themselves are also provided), as in the simulation Section 5.3 of Faletto and Bien (2022).</p></li>
<li><p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code> uses a data set to choose a good value of lambda for subsamples of size n/2 (as in cluster stability selection) by cross-validation.</p></li>
<li><p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code> estimates the best size for a lasso model on a provided data set.</p></li>
<li><p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code> converts the output of the <code><a href='css.html#css'>css</a>()</code> function (an object of class cssr) to a data.frame that is ready to be printed. We provide end-user access to <code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code> because this data.frame itself may be useful as an object that summarizes the output from <code><a href='css.html#css'>css</a>()</code>.</p></li>
<li><p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code> is the print function for objects of class cssr.</p></li>
<li><p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code> checks that the inputs to <code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code> are as expected.</li>
<li><code><a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>()</code> generates a covariance matrix for a jointly Gaussian random variable with distribution matching the provided inputs.</li>
<li><code><a href='other-useful.html#makeCoefficients'>makeCoefficients</a>()</code> generates a coefficient vector for the response according to the provided inputs.</li>
<li>Finally, <code><a href='other-useful.html#genMuXZSd'>genMuXZSd</a>()</code> draws a random Z (matrix of latent variables), X (observed matrix, containing, in general, features correlated with latent features, directly observed features that are associated with y, and noise features), conditional means mu, and observed responses y.</li>
</ul></li>
<li><p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</a>()</code> generates a covariance matrix where not all proxies have the same correlation with the latent feature.</li>
</ul></li>
<li><p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code></p></li>
<li><p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code></p></li>
<li><p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code></p>
<ul>
<li><code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code> identifies the prototypes from selected clusters (the feature in each cluster that is most correlated with the response)</li>
</ul></li>
<li><p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code></p></li>
</ul>
<p><code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="other-useful.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb131-2"><a href="other-useful.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables</span></span>
<span id="cb131-3"><a href="other-useful.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb131-4"><a href="other-useful.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class="al">TODO</span><span class="co">(gregfaletto) change cluster_size into a vector of sizes (maybe also</span></span>
<span id="cb131-5"><a href="other-useful.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; deprecate n_clusters as an input, since this would be inferred by the length</span></span>
<span id="cb131-6"><a href="other-useful.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of cluster_sizes?)</span></span>
<span id="cb131-7"><a href="other-useful.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb131-8"><a href="other-useful.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb131-9"><a href="other-useful.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb131-10"><a href="other-useful.html#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb131-11"><a href="other-useful.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb131-12"><a href="other-useful.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Example 1 and Sections 5.1 and 5.2 of Faletto and Bien (2022).</span></span>
<span id="cb131-13"><a href="other-useful.html#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb131-14"><a href="other-useful.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb131-15"><a href="other-useful.html#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb131-16"><a href="other-useful.html#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb131-17"><a href="other-useful.html#cb131-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb131-18"><a href="other-useful.html#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb131-19"><a href="other-useful.html#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb131-20"><a href="other-useful.html#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb131-21"><a href="other-useful.html#cb131-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb131-22"><a href="other-useful.html#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb131-23"><a href="other-useful.html#cb131-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb131-24"><a href="other-useful.html#cb131-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb131-25"><a href="other-useful.html#cb131-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb131-26"><a href="other-useful.html#cb131-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb131-27"><a href="other-useful.html#cb131-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb131-28"><a href="other-useful.html#cb131-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb131-29"><a href="other-useful.html#cb131-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb131-30"><a href="other-useful.html#cb131-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb131-31"><a href="other-useful.html#cb131-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb131-32"><a href="other-useful.html#cb131-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb131-33"><a href="other-useful.html#cb131-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb131-34"><a href="other-useful.html#cb131-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb131-35"><a href="other-useful.html#cb131-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. Can&#39;t equal 0. Default is 0.9.</span></span>
<span id="cb131-36"><a href="other-useful.html#cb131-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb131-37"><a href="other-useful.html#cb131-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb131-38"><a href="other-useful.html#cb131-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb131-39"><a href="other-useful.html#cb131-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb131-40"><a href="other-useful.html#cb131-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb131-41"><a href="other-useful.html#cb131-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb131-42"><a href="other-useful.html#cb131-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb131-43"><a href="other-useful.html#cb131-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb131-44"><a href="other-useful.html#cb131-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb131-45"><a href="other-useful.html#cb131-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb131-46"><a href="other-useful.html#cb131-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb131-47"><a href="other-useful.html#cb131-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb131-48"><a href="other-useful.html#cb131-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb131-49"><a href="other-useful.html#cb131-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb131-50"><a href="other-useful.html#cb131-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb131-51"><a href="other-useful.html#cb131-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb131-52"><a href="other-useful.html#cb131-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb131-53"><a href="other-useful.html#cb131-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb131-54"><a href="other-useful.html#cb131-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb131-55"><a href="other-useful.html#cb131-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb131-56"><a href="other-useful.html#cb131-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb131-57"><a href="other-useful.html#cb131-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb131-58"><a href="other-useful.html#cb131-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb131-59"><a href="other-useful.html#cb131-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb131-60"><a href="other-useful.html#cb131-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb131-61"><a href="other-useful.html#cb131-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb131-62"><a href="other-useful.html#cb131-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb131-63"><a href="other-useful.html#cb131-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb131-64"><a href="other-useful.html#cb131-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb131-65"><a href="other-useful.html#cb131-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb131-66"><a href="other-useful.html#cb131-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb131-67"><a href="other-useful.html#cb131-67" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb131-68"><a href="other-useful.html#cb131-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb131-69"><a href="other-useful.html#cb131-69" aria-hidden="true" tabindex="-1"></a><span id='genClusteredData'>genClusteredData</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb131-70"><a href="other-useful.html#cb131-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span><span class="fl">0.9</span>, <span class="at">var=</span><span class="dv">1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="dv">1</span>,</span>
<span id="cb131-71"><a href="other-useful.html#cb131-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb131-72"><a href="other-useful.html#cb131-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-73"><a href="other-useful.html#cb131-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb131-74"><a href="other-useful.html#cb131-74" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(p, k_unclustered, cluster_size, n_clusters,</span>
<span id="cb131-75"><a href="other-useful.html#cb131-75" aria-hidden="true" tabindex="-1"></a>        sig_clusters, rho, var, beta_latent, beta_unclustered, snr,</span>
<span id="cb131-76"><a href="other-useful.html#cb131-76" aria-hidden="true" tabindex="-1"></a>        sigma_eps_sq)</span>
<span id="cb131-77"><a href="other-useful.html#cb131-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-78"><a href="other-useful.html#cb131-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate covariance matrix (latent features are mixed in matrix, so each</span></span>
<span id="cb131-79"><a href="other-useful.html#cb131-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster will be of size cluster_size + 1)</span></span>
<span id="cb131-80"><a href="other-useful.html#cb131-80" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb131-81"><a href="other-useful.html#cb131-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>, <span class="at">rho=</span>rho, <span class="at">var=</span>var)</span>
<span id="cb131-82"><a href="other-useful.html#cb131-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-83"><a href="other-useful.html#cb131-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate coefficients</span></span>
<span id="cb131-84"><a href="other-useful.html#cb131-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note that beta has length p + sig_clusters</span></span>
<span id="cb131-85"><a href="other-useful.html#cb131-85" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">k_unblocked=</span>k_unclustered,</span>
<span id="cb131-86"><a href="other-useful.html#cb131-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_low=</span>beta_unclustered, <span class="at">beta_high=</span>beta_latent, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb131-87"><a href="other-useful.html#cb131-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_blocks=</span>sig_clusters, <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb131-88"><a href="other-useful.html#cb131-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-89"><a href="other-useful.html#cb131-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate mu, X, z, sd, y</span></span>
<span id="cb131-90"><a href="other-useful.html#cb131-90" aria-hidden="true" tabindex="-1"></a>    gen_mu_x_z_sd_res <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb131-91"><a href="other-useful.html#cb131-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars, <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, </span>
<span id="cb131-92"><a href="other-useful.html#cb131-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size, <span class="at">n_blocks=</span>n_clusters, <span class="at">snr=</span>snr,</span>
<span id="cb131-93"><a href="other-useful.html#cb131-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb131-94"><a href="other-useful.html#cb131-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-95"><a href="other-useful.html#cb131-95" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>mu</span>
<span id="cb131-96"><a href="other-useful.html#cb131-96" aria-hidden="true" tabindex="-1"></a>    sd <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>sd</span>
<span id="cb131-97"><a href="other-useful.html#cb131-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-98"><a href="other-useful.html#cb131-98" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> mu <span class="sc">+</span> sd <span class="sc">*</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb131-99"><a href="other-useful.html#cb131-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-100"><a href="other-useful.html#cb131-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>gen_mu_x_z_sd_res<span class="sc">$</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>gen_mu_x_z_sd_res<span class="sc">$</span>z, <span class="at">mu=</span>mu))</span>
<span id="cb131-101"><a href="other-useful.html#cb131-101" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code></p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="other-useful.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredData</span></span>
<span id="cb132-2"><a href="other-useful.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb132-3"><a href="other-useful.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb132-4"><a href="other-useful.html#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb132-5"><a href="other-useful.html#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb132-6"><a href="other-useful.html#cb132-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb132-7"><a href="other-useful.html#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb132-8"><a href="other-useful.html#cb132-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb132-9"><a href="other-useful.html#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb132-10"><a href="other-useful.html#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb132-11"><a href="other-useful.html#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb132-12"><a href="other-useful.html#cb132-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb132-13"><a href="other-useful.html#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb132-14"><a href="other-useful.html#cb132-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb132-15"><a href="other-useful.html#cb132-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb132-16"><a href="other-useful.html#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb132-17"><a href="other-useful.html#cb132-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb132-18"><a href="other-useful.html#cb132-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb132-19"><a href="other-useful.html#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb132-20"><a href="other-useful.html#cb132-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb132-21"><a href="other-useful.html#cb132-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb132-22"><a href="other-useful.html#cb132-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. Can&#39;t equal 0. Default is 0.9.</span></span>
<span id="cb132-23"><a href="other-useful.html#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb132-24"><a href="other-useful.html#cb132-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb132-25"><a href="other-useful.html#cb132-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb132-26"><a href="other-useful.html#cb132-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb132-27"><a href="other-useful.html#cb132-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb132-28"><a href="other-useful.html#cb132-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb132-29"><a href="other-useful.html#cb132-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb132-30"><a href="other-useful.html#cb132-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb132-31"><a href="other-useful.html#cb132-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb132-32"><a href="other-useful.html#cb132-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb132-33"><a href="other-useful.html#cb132-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb132-34"><a href="other-useful.html#cb132-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb132-35"><a href="other-useful.html#cb132-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb132-36"><a href="other-useful.html#cb132-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb132-37"><a href="other-useful.html#cb132-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb132-38"><a href="other-useful.html#cb132-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb132-39"><a href="other-useful.html#cb132-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb132-40"><a href="other-useful.html#cb132-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb132-41"><a href="other-useful.html#cb132-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb132-42"><a href="other-useful.html#cb132-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb132-43"><a href="other-useful.html#cb132-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb132-44"><a href="other-useful.html#cb132-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb132-45"><a href="other-useful.html#cb132-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb132-46"><a href="other-useful.html#cb132-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb132-47"><a href="other-useful.html#cb132-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb132-48"><a href="other-useful.html#cb132-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb132-49"><a href="other-useful.html#cb132-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb132-50"><a href="other-useful.html#cb132-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb132-51"><a href="other-useful.html#cb132-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb132-52"><a href="other-useful.html#cb132-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb132-53"><a href="other-useful.html#cb132-53" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataInputs'>checkGenClusteredDataInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered, cluster_size,</span>
<span id="cb132-54"><a href="other-useful.html#cb132-54" aria-hidden="true" tabindex="-1"></a>    n_clusters, sig_clusters, rho, var, beta_latent, beta_unclustered, snr,</span>
<span id="cb132-55"><a href="other-useful.html#cb132-55" aria-hidden="true" tabindex="-1"></a>    sigma_eps_sq){</span>
<span id="cb132-56"><a href="other-useful.html#cb132-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-57"><a href="other-useful.html#cb132-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb132-58"><a href="other-useful.html#cb132-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb132-59"><a href="other-useful.html#cb132-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb132-60"><a href="other-useful.html#cb132-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb132-61"><a href="other-useful.html#cb132-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-62"><a href="other-useful.html#cb132-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb132-63"><a href="other-useful.html#cb132-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb132-64"><a href="other-useful.html#cb132-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb132-65"><a href="other-useful.html#cb132-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb132-66"><a href="other-useful.html#cb132-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb132-67"><a href="other-useful.html#cb132-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb132-68"><a href="other-useful.html#cb132-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb132-69"><a href="other-useful.html#cb132-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb132-70"><a href="other-useful.html#cb132-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-71"><a href="other-useful.html#cb132-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb132-72"><a href="other-useful.html#cb132-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-73"><a href="other-useful.html#cb132-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb132-74"><a href="other-useful.html#cb132-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb132-75"><a href="other-useful.html#cb132-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb132-76"><a href="other-useful.html#cb132-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-77"><a href="other-useful.html#cb132-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb132-78"><a href="other-useful.html#cb132-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb132-79"><a href="other-useful.html#cb132-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-80"><a href="other-useful.html#cb132-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb132-81"><a href="other-useful.html#cb132-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb132-82"><a href="other-useful.html#cb132-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb132-83"><a href="other-useful.html#cb132-83" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-84"><a href="other-useful.html#cb132-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb132-85"><a href="other-useful.html#cb132-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-86"><a href="other-useful.html#cb132-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb132-87"><a href="other-useful.html#cb132-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb132-88"><a href="other-useful.html#cb132-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb132-89"><a href="other-useful.html#cb132-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb132-90"><a href="other-useful.html#cb132-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb132-91"><a href="other-useful.html#cb132-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-92"><a href="other-useful.html#cb132-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb132-93"><a href="other-useful.html#cb132-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(snr)){</span>
<span id="cb132-94"><a href="other-useful.html#cb132-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb132-95"><a href="other-useful.html#cb132-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-96"><a href="other-useful.html#cb132-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb132-97"><a href="other-useful.html#cb132-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb132-98"><a href="other-useful.html#cb132-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-99"><a href="other-useful.html#cb132-99" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>()</code></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="other-useful.html#cb133-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGenClusteredDataInputs works&quot;</span>, {</span>
<span id="cb133-2"><a href="other-useful.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb133-3"><a href="other-useful.html#cb133-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-4"><a href="other-useful.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Should get no error</span></span>
<span id="cb133-5"><a href="other-useful.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-6"><a href="other-useful.html#cb133-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-7"><a href="other-useful.html#cb133-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb133-8"><a href="other-useful.html#cb133-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-9"><a href="other-useful.html#cb133-9" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-10"><a href="other-useful.html#cb133-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-11"><a href="other-useful.html#cb133-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb133-12"><a href="other-useful.html#cb133-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-13"><a href="other-useful.html#cb133-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sig_clusters</span></span>
<span id="cb133-14"><a href="other-useful.html#cb133-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-15"><a href="other-useful.html#cb133-15" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-16"><a href="other-useful.html#cb133-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-17"><a href="other-useful.html#cb133-17" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-18"><a href="other-useful.html#cb133-18" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-19"><a href="other-useful.html#cb133-19" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-20"><a href="other-useful.html#cb133-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-21"><a href="other-useful.html#cb133-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-22"><a href="other-useful.html#cb133-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-23"><a href="other-useful.html#cb133-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-24"><a href="other-useful.html#cb133-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-25"><a href="other-useful.html#cb133-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-26"><a href="other-useful.html#cb133-26" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-27"><a href="other-useful.html#cb133-27" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-28"><a href="other-useful.html#cb133-28" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-29"><a href="other-useful.html#cb133-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-30"><a href="other-useful.html#cb133-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-31"><a href="other-useful.html#cb133-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-32"><a href="other-useful.html#cb133-32" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-33"><a href="other-useful.html#cb133-33" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-34"><a href="other-useful.html#cb133-34" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-35"><a href="other-useful.html#cb133-35" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-36"><a href="other-useful.html#cb133-36" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-37"><a href="other-useful.html#cb133-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-38"><a href="other-useful.html#cb133-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-39"><a href="other-useful.html#cb133-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-40"><a href="other-useful.html#cb133-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-41"><a href="other-useful.html#cb133-41" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-42"><a href="other-useful.html#cb133-42" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-43"><a href="other-useful.html#cb133-43" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-44"><a href="other-useful.html#cb133-44" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-45"><a href="other-useful.html#cb133-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-46"><a href="other-useful.html#cb133-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-47"><a href="other-useful.html#cb133-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-48"><a href="other-useful.html#cb133-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-49"><a href="other-useful.html#cb133-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb133-50"><a href="other-useful.html#cb133-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-51"><a href="other-useful.html#cb133-51" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb133-52"><a href="other-useful.html#cb133-52" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb133-53"><a href="other-useful.html#cb133-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-54"><a href="other-useful.html#cb133-54" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-55"><a href="other-useful.html#cb133-55" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-56"><a href="other-useful.html#cb133-56" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-57"><a href="other-useful.html#cb133-57" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-58"><a href="other-useful.html#cb133-58" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-59"><a href="other-useful.html#cb133-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-60"><a href="other-useful.html#cb133-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-61"><a href="other-useful.html#cb133-61" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb133-62"><a href="other-useful.html#cb133-62" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-63"><a href="other-useful.html#cb133-63" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-64"><a href="other-useful.html#cb133-64" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-65"><a href="other-useful.html#cb133-65" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-66"><a href="other-useful.html#cb133-66" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb133-67"><a href="other-useful.html#cb133-67" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-68"><a href="other-useful.html#cb133-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-69"><a href="other-useful.html#cb133-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-70"><a href="other-useful.html#cb133-70" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb133-71"><a href="other-useful.html#cb133-71" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-72"><a href="other-useful.html#cb133-72" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-73"><a href="other-useful.html#cb133-73" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-74"><a href="other-useful.html#cb133-74" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-75"><a href="other-useful.html#cb133-75" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-76"><a href="other-useful.html#cb133-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-77"><a href="other-useful.html#cb133-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-78"><a href="other-useful.html#cb133-78" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-79"><a href="other-useful.html#cb133-79" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-80"><a href="other-useful.html#cb133-80" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-81"><a href="other-useful.html#cb133-81" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-82"><a href="other-useful.html#cb133-82" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-83"><a href="other-useful.html#cb133-83" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-84"><a href="other-useful.html#cb133-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-85"><a href="other-useful.html#cb133-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-86"><a href="other-useful.html#cb133-86" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-87"><a href="other-useful.html#cb133-87" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb133-88"><a href="other-useful.html#cb133-88" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-89"><a href="other-useful.html#cb133-89" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-90"><a href="other-useful.html#cb133-90" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-91"><a href="other-useful.html#cb133-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb133-92"><a href="other-useful.html#cb133-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-93"><a href="other-useful.html#cb133-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-94"><a href="other-useful.html#cb133-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-95"><a href="other-useful.html#cb133-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-96"><a href="other-useful.html#cb133-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">8</span>,</span>
<span id="cb133-97"><a href="other-useful.html#cb133-97" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-98"><a href="other-useful.html#cb133-98" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-99"><a href="other-useful.html#cb133-99" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-100"><a href="other-useful.html#cb133-100" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-101"><a href="other-useful.html#cb133-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-102"><a href="other-useful.html#cb133-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-103"><a href="other-useful.html#cb133-103" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-104"><a href="other-useful.html#cb133-104" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb133-105"><a href="other-useful.html#cb133-105" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-106"><a href="other-useful.html#cb133-106" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-107"><a href="other-useful.html#cb133-107" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-108"><a href="other-useful.html#cb133-108" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-109"><a href="other-useful.html#cb133-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-110"><a href="other-useful.html#cb133-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-111"><a href="other-useful.html#cb133-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-112"><a href="other-useful.html#cb133-112" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-113"><a href="other-useful.html#cb133-113" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="sc">-</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-114"><a href="other-useful.html#cb133-114" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-115"><a href="other-useful.html#cb133-115" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-116"><a href="other-useful.html#cb133-116" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-117"><a href="other-useful.html#cb133-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-118"><a href="other-useful.html#cb133-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-119"><a href="other-useful.html#cb133-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-120"><a href="other-useful.html#cb133-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-121"><a href="other-useful.html#cb133-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb133-122"><a href="other-useful.html#cb133-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-123"><a href="other-useful.html#cb133-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-124"><a href="other-useful.html#cb133-124" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-125"><a href="other-useful.html#cb133-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-126"><a href="other-useful.html#cb133-126" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-127"><a href="other-useful.html#cb133-127" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-128"><a href="other-useful.html#cb133-128" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-129"><a href="other-useful.html#cb133-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-130"><a href="other-useful.html#cb133-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-131"><a href="other-useful.html#cb133-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-132"><a href="other-useful.html#cb133-132" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-133"><a href="other-useful.html#cb133-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-134"><a href="other-useful.html#cb133-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb133-135"><a href="other-useful.html#cb133-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb133-136"><a href="other-useful.html#cb133-136" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-137"><a href="other-useful.html#cb133-137" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-138"><a href="other-useful.html#cb133-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-139"><a href="other-useful.html#cb133-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-140"><a href="other-useful.html#cb133-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-141"><a href="other-useful.html#cb133-141" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb133-142"><a href="other-useful.html#cb133-142" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-143"><a href="other-useful.html#cb133-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-144"><a href="other-useful.html#cb133-144" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb133-145"><a href="other-useful.html#cb133-145" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-146"><a href="other-useful.html#cb133-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-147"><a href="other-useful.html#cb133-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-148"><a href="other-useful.html#cb133-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-149"><a href="other-useful.html#cb133-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-150"><a href="other-useful.html#cb133-150" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-151"><a href="other-useful.html#cb133-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-152"><a href="other-useful.html#cb133-152" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span>.<span class="dv">2</span>,</span>
<span id="cb133-153"><a href="other-useful.html#cb133-153" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-154"><a href="other-useful.html#cb133-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-155"><a href="other-useful.html#cb133-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-156"><a href="other-useful.html#cb133-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb133-157"><a href="other-useful.html#cb133-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-158"><a href="other-useful.html#cb133-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb133-159"><a href="other-useful.html#cb133-159" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-160"><a href="other-useful.html#cb133-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-161"><a href="other-useful.html#cb133-161" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-162"><a href="other-useful.html#cb133-162" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-163"><a href="other-useful.html#cb133-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-164"><a href="other-useful.html#cb133-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-165"><a href="other-useful.html#cb133-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb133-166"><a href="other-useful.html#cb133-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-167"><a href="other-useful.html#cb133-167" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-168"><a href="other-useful.html#cb133-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-169"><a href="other-useful.html#cb133-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-170"><a href="other-useful.html#cb133-170" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-171"><a href="other-useful.html#cb133-171" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-172"><a href="other-useful.html#cb133-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-173"><a href="other-useful.html#cb133-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb133-174"><a href="other-useful.html#cb133-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb133-175"><a href="other-useful.html#cb133-175" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-176"><a href="other-useful.html#cb133-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-177"><a href="other-useful.html#cb133-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb133-178"><a href="other-useful.html#cb133-178" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb133-179"><a href="other-useful.html#cb133-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb133-180"><a href="other-useful.html#cb133-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb133-181"><a href="other-useful.html#cb133-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb133-182"><a href="other-useful.html#cb133-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb133-183"><a href="other-useful.html#cb133-183" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-184"><a href="other-useful.html#cb133-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-185"><a href="other-useful.html#cb133-185" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>()</code></p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="other-useful.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate covariance matrix for simulated clustered data</span></span>
<span id="cb135-2"><a href="other-useful.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb135-3"><a href="other-useful.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the total number of features in the covariance</span></span>
<span id="cb135-4"><a href="other-useful.html#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix to be created, including latent features, the associated noisy proxies</span></span>
<span id="cb135-5"><a href="other-useful.html#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with each latent feature, and other (weak signal and noise) features.</span></span>
<span id="cb135-6"><a href="other-useful.html#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_blocks Integer or numeric; the number of latent variables in the</span></span>
<span id="cb135-7"><a href="other-useful.html#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data, each of which is associated with an observed cluster in X. Must be at</span></span>
<span id="cb135-8"><a href="other-useful.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; least 1.</span></span>
<span id="cb135-9"><a href="other-useful.html#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb135-10"><a href="other-useful.html#cb135-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, the covariance matrix will include the original latent feature</span></span>
<span id="cb135-11"><a href="other-useful.html#cb135-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plus block_size - 1 noisy proxies that are correlated with the latent</span></span>
<span id="cb135-12"><a href="other-useful.html#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable.</span></span>
<span id="cb135-13"><a href="other-useful.html#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb135-14"><a href="other-useful.html#cb135-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb135-15"><a href="other-useful.html#cb135-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. rho cannot equal 0.</span></span>
<span id="cb135-16"><a href="other-useful.html#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb135-17"><a href="other-useful.html#cb135-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb135-18"><a href="other-useful.html#cb135-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). var cannot equal 0.</span></span>
<span id="cb135-19"><a href="other-useful.html#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A `p` x `p` numeric matrix representing the covariance matrix for</span></span>
<span id="cb135-20"><a href="other-useful.html#cb135-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent features, the associated proxies, and the remaining features. All</span></span>
<span id="cb135-21"><a href="other-useful.html#cb135-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features not in a block will be independent from each other and the blocks</span></span>
<span id="cb135-22"><a href="other-useful.html#cb135-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and have variance var.</span></span>
<span id="cb135-23"><a href="other-useful.html#cb135-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb135-24"><a href="other-useful.html#cb135-24" aria-hidden="true" tabindex="-1"></a><span id='makeCovarianceMatrix'>makeCovarianceMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, nblocks, block_size, rho, var) {</span>
<span id="cb135-25"><a href="other-useful.html#cb135-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb135-26"><a href="other-useful.html#cb135-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-27"><a href="other-useful.html#cb135-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb135-28"><a href="other-useful.html#cb135-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb135-29"><a href="other-useful.html#cb135-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb135-30"><a href="other-useful.html#cb135-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb135-31"><a href="other-useful.html#cb135-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(block_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb135-32"><a href="other-useful.html#cb135-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> nblocks<span class="sc">*</span>block_size)</span>
<span id="cb135-33"><a href="other-useful.html#cb135-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-34"><a href="other-useful.html#cb135-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># start with p x p identity matrix</span></span>
<span id="cb135-35"><a href="other-useful.html#cb135-35" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> var<span class="sc">*</span><span class="fu">diag</span>(p)</span>
<span id="cb135-36"><a href="other-useful.html#cb135-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-37"><a href="other-useful.html#cb135-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create matrix with nblocks rows, each containing a vector of</span></span>
<span id="cb135-38"><a href="other-useful.html#cb135-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># indices of highly correlated features</span></span>
<span id="cb135-39"><a href="other-useful.html#cb135-39" aria-hidden="true" tabindex="-1"></a>    block_feats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(nblocks<span class="sc">*</span>block_size), <span class="at">nrow=</span>nblocks, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-40"><a href="other-useful.html#cb135-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-41"><a href="other-useful.html#cb135-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(block_feats)) <span class="sc">==</span> <span class="fu">length</span>(block_feats))</span>
<span id="cb135-42"><a href="other-useful.html#cb135-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-43"><a href="other-useful.html#cb135-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add covariances of highly correlated features to sigma</span></span>
<span id="cb135-44"><a href="other-useful.html#cb135-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nblocks){</span>
<span id="cb135-45"><a href="other-useful.html#cb135-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(block_size <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb135-46"><a href="other-useful.html#cb135-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(k <span class="cf">in</span> (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>block_size){</span>
<span id="cb135-47"><a href="other-useful.html#cb135-47" aria-hidden="true" tabindex="-1"></a>                feat_1 <span class="ot">&lt;-</span> block_feats[i, j]</span>
<span id="cb135-48"><a href="other-useful.html#cb135-48" aria-hidden="true" tabindex="-1"></a>                feat_2 <span class="ot">&lt;-</span> block_feats[i, k]</span>
<span id="cb135-49"><a href="other-useful.html#cb135-49" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_1, feat_2] <span class="ot">&lt;-</span> rho</span>
<span id="cb135-50"><a href="other-useful.html#cb135-50" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_2, feat_1] <span class="ot">&lt;-</span> rho</span>
<span id="cb135-51"><a href="other-useful.html#cb135-51" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb135-52"><a href="other-useful.html#cb135-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-53"><a href="other-useful.html#cb135-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-54"><a href="other-useful.html#cb135-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(Sigma))</span>
<span id="cb135-55"><a href="other-useful.html#cb135-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(Sigma))</span>
<span id="cb135-56"><a href="other-useful.html#cb135-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Sigma) <span class="sc">==</span> p <span class="sc">&amp;</span> <span class="fu">ncol</span>(Sigma) <span class="sc">==</span> p)</span>
<span id="cb135-57"><a href="other-useful.html#cb135-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(Sigma <span class="sc">==</span> <span class="fu">t</span>(Sigma)))</span>
<span id="cb135-58"><a href="other-useful.html#cb135-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-59"><a href="other-useful.html#cb135-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(Sigma)</span>
<span id="cb135-60"><a href="other-useful.html#cb135-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>()</code></p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="other-useful.html#cb136-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;makeCovarianceMatrix works&quot;</span>, {</span>
<span id="cb136-2"><a href="other-useful.html#cb136-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb136-3"><a href="other-useful.html#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="other-useful.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb136-5"><a href="other-useful.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-6"><a href="other-useful.html#cb136-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret))</span>
<span id="cb136-7"><a href="other-useful.html#cb136-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret))</span>
<span id="cb136-8"><a href="other-useful.html#cb136-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">8</span>)</span>
<span id="cb136-9"><a href="other-useful.html#cb136-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret), <span class="dv">8</span>)</span>
<span id="cb136-10"><a href="other-useful.html#cb136-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret <span class="sc">==</span> <span class="fu">t</span>(ret)))</span>
<span id="cb136-11"><a href="other-useful.html#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test on-diagonal and off-diagonal entries to see if they are as expected</span></span>
<span id="cb136-12"><a href="other-useful.html#cb136-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (only need to check top half of matrix; we already confirmed the matrix is</span></span>
<span id="cb136-13"><a href="other-useful.html#cb136-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># symmetric)</span></span>
<span id="cb136-14"><a href="other-useful.html#cb136-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">diag</span>(ret) <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb136-15"><a href="other-useful.html#cb136-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">2</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-16"><a href="other-useful.html#cb136-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">3</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-17"><a href="other-useful.html#cb136-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">2</span>, <span class="dv">3</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-18"><a href="other-useful.html#cb136-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">5</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-19"><a href="other-useful.html#cb136-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">6</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-20"><a href="other-useful.html#cb136-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">5</span>, <span class="dv">6</span>], <span class="fl">0.8</span>)</span>
<span id="cb136-21"><a href="other-useful.html#cb136-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb136-22"><a href="other-useful.html#cb136-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb136-23"><a href="other-useful.html#cb136-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">7</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb136-24"><a href="other-useful.html#cb136-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb136-25"><a href="other-useful.html#cb136-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-26"><a href="other-useful.html#cb136-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb136-27"><a href="other-useful.html#cb136-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb136-28"><a href="other-useful.html#cb136-28" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span>.<span class="dv">2</span>),</span>
<span id="cb136-29"><a href="other-useful.html#cb136-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-30"><a href="other-useful.html#cb136-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-31"><a href="other-useful.html#cb136-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb136-32"><a href="other-useful.html#cb136-32" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb136-33"><a href="other-useful.html#cb136-33" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nblocks &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-34"><a href="other-useful.html#cb136-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-35"><a href="other-useful.html#cb136-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb136-36"><a href="other-useful.html#cb136-36" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="dv">0</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb136-37"><a href="other-useful.html#cb136-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-38"><a href="other-useful.html#cb136-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-39"><a href="other-useful.html#cb136-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb136-40"><a href="other-useful.html#cb136-40" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.9</span>, <span class="at">var=</span><span class="dv">0</span>),</span>
<span id="cb136-41"><a href="other-useful.html#cb136-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-42"><a href="other-useful.html#cb136-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb136-43"><a href="other-useful.html#cb136-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">5</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb136-44"><a href="other-useful.html#cb136-44" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb136-45"><a href="other-useful.html#cb136-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= nblocks * block_size is not TRUE&quot;</span>,</span>
<span id="cb136-46"><a href="other-useful.html#cb136-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb136-47"><a href="other-useful.html#cb136-47" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='other-useful.html#makeCoefficients'>makeCoefficients</a>()</code>:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="other-useful.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generated coefficients for y in latent variable model</span></span>
<span id="cb138-2"><a href="other-useful.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb138-3"><a href="other-useful.html#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features that will be observed in</span></span>
<span id="cb138-4"><a href="other-useful.html#cb138-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; x plus the number of latent variables (each corresponding to a cluster).</span></span>
<span id="cb138-5"><a href="other-useful.html#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unblocked Integer or numeric; the number of features in X that</span></span>
<span id="cb138-6"><a href="other-useful.html#cb138-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb138-7"><a href="other-useful.html#cb138-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb138-8"><a href="other-useful.html#cb138-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb138-9"><a href="other-useful.html#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_low.</span></span>
<span id="cb138-10"><a href="other-useful.html#cb138-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_low Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb138-11"><a href="other-useful.html#cb138-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unblocked features in X not generated from the</span></span>
<span id="cb138-12"><a href="other-useful.html#cb138-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb138-13"><a href="other-useful.html#cb138-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_low/sqrt(1:k_unblocked).</span></span>
<span id="cb138-14"><a href="other-useful.html#cb138-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_high Integer or numeric; the coefficient used for all</span></span>
<span id="cb138-15"><a href="other-useful.html#cb138-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_blocks latent variables that have nonzero coefficients in the true</span></span>
<span id="cb138-16"><a href="other-useful.html#cb138-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y.</span></span>
<span id="cb138-17"><a href="other-useful.html#cb138-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nblocks Integer or numeric; the number of latent variables that were</span></span>
<span id="cb138-18"><a href="other-useful.html#cb138-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb138-19"><a href="other-useful.html#cb138-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_blocks Integer or numeric; the number of generated latent</span></span>
<span id="cb138-20"><a href="other-useful.html#cb138-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb138-21"><a href="other-useful.html#cb138-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). In particular, the first sig_blocks</span></span>
<span id="cb138-22"><a href="other-useful.html#cb138-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables will have coefficient beta_latent, and the remaining nblocks</span></span>
<span id="cb138-23"><a href="other-useful.html#cb138-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - sig_blocks features will have coefficient 0. Must be less than or equal to</span></span>
<span id="cb138-24"><a href="other-useful.html#cb138-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters.</span></span>
<span id="cb138-25"><a href="other-useful.html#cb138-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb138-26"><a href="other-useful.html#cb138-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, the covariance matrix will include the original latent feature</span></span>
<span id="cb138-27"><a href="other-useful.html#cb138-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plus block_size - 1 noisy proxies that are correlated with the latent</span></span>
<span id="cb138-28"><a href="other-useful.html#cb138-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable.</span></span>
<span id="cb138-29"><a href="other-useful.html#cb138-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{beta}{A vector of</span></span>
<span id="cb138-30"><a href="other-useful.html#cb138-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length `p` containing the coefficients for the true model for y. All entries</span></span>
<span id="cb138-31"><a href="other-useful.html#cb138-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will equal 0 except for the sig_blocks latent variables that will have</span></span>
<span id="cb138-32"><a href="other-useful.html#cb138-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient beta_high and the k_unblocked independent features with</span></span>
<span id="cb138-33"><a href="other-useful.html#cb138-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient determined by beta_low.} \item{blocked_dgp_vars}{An integer</span></span>
<span id="cb138-34"><a href="other-useful.html#cb138-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of length sig_blocks containing the indices of the features</span></span>
<span id="cb138-35"><a href="other-useful.html#cb138-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; corresponding to the latent features that will have nonzero coefficient</span></span>
<span id="cb138-36"><a href="other-useful.html#cb138-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_high in the true model for y.} \item{sig_unblocked_vars}{An integer</span></span>
<span id="cb138-37"><a href="other-useful.html#cb138-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of length k_unblocked containing the indices of the observed features</span></span>
<span id="cb138-38"><a href="other-useful.html#cb138-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are independent of the blocked features and have coefficient beta_low in</span></span>
<span id="cb138-39"><a href="other-useful.html#cb138-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true model for y. If k_unblocked = 0, this will just be NA.}</span></span>
<span id="cb138-40"><a href="other-useful.html#cb138-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{insig_blocked_vars}{An integer vector containing the indices of the</span></span>
<span id="cb138-41"><a href="other-useful.html#cb138-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features corresponding to the latent features that will have coefficient 0 in</span></span>
<span id="cb138-42"><a href="other-useful.html#cb138-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true model for y. If nblocks=0, this will just be NA.}</span></span>
<span id="cb138-43"><a href="other-useful.html#cb138-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{latent_vars}{An integer vector of length nblocks containing the indices</span></span>
<span id="cb138-44"><a href="other-useful.html#cb138-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of all of the latent features.}</span></span>
<span id="cb138-45"><a href="other-useful.html#cb138-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb138-46"><a href="other-useful.html#cb138-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb138-47"><a href="other-useful.html#cb138-47" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb138-48"><a href="other-useful.html#cb138-48" aria-hidden="true" tabindex="-1"></a><span id='makeCoefficients'>makeCoefficients</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unblocked, beta_low, beta_high, nblocks,</span>
<span id="cb138-49"><a href="other-useful.html#cb138-49" aria-hidden="true" tabindex="-1"></a>    sig_blocks, block_size){</span>
<span id="cb138-50"><a href="other-useful.html#cb138-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-51"><a href="other-useful.html#cb138-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb138-52"><a href="other-useful.html#cb138-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unblocked <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb138-53"><a href="other-useful.html#cb138-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">&lt;=</span> nblocks)</span>
<span id="cb138-54"><a href="other-useful.html#cb138-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> nblocks<span class="sc">*</span>block_size <span class="sc">+</span> k_unblocked)</span>
<span id="cb138-55"><a href="other-useful.html#cb138-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb138-56"><a href="other-useful.html#cb138-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-57"><a href="other-useful.html#cb138-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize beta</span></span>
<span id="cb138-58"><a href="other-useful.html#cb138-58" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">numeric</span>(p)</span>
<span id="cb138-59"><a href="other-useful.html#cb138-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-60"><a href="other-useful.html#cb138-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identify indices of first coefficient in each significant block (these</span></span>
<span id="cb138-61"><a href="other-useful.html#cb138-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features will have coefficient beta_high)</span></span>
<span id="cb138-62"><a href="other-useful.html#cb138-62" aria-hidden="true" tabindex="-1"></a>    latent_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb138-63"><a href="other-useful.html#cb138-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>){</span>
<span id="cb138-64"><a href="other-useful.html#cb138-64" aria-hidden="true" tabindex="-1"></a>        latent_vars <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(((<span class="dv">0</span><span class="sc">:</span>(nblocks <span class="sc">-</span> <span class="dv">1</span>))<span class="sc">*</span>block_size <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb138-65"><a href="other-useful.html#cb138-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-66"><a href="other-useful.html#cb138-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(latent_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb138-67"><a href="other-useful.html#cb138-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(latent_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>(block_size<span class="sc">*</span>nblocks))</span>
<span id="cb138-68"><a href="other-useful.html#cb138-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(latent_vars)) <span class="sc">==</span> nblocks)</span>
<span id="cb138-69"><a href="other-useful.html#cb138-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> nblocks)</span>
<span id="cb138-70"><a href="other-useful.html#cb138-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-71"><a href="other-useful.html#cb138-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-72"><a href="other-useful.html#cb138-72" aria-hidden="true" tabindex="-1"></a>    blocked_dgp_vars <span class="ot">&lt;-</span> latent_vars[<span class="dv">1</span><span class="sc">:</span>sig_blocks]</span>
<span id="cb138-73"><a href="other-useful.html#cb138-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-74"><a href="other-useful.html#cb138-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">==</span> <span class="fu">length</span>(blocked_dgp_vars))</span>
<span id="cb138-75"><a href="other-useful.html#cb138-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb138-76"><a href="other-useful.html#cb138-76" aria-hidden="true" tabindex="-1"></a>    beta[blocked_dgp_vars] <span class="ot">&lt;-</span> beta_high</span>
<span id="cb138-77"><a href="other-useful.html#cb138-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-78"><a href="other-useful.html#cb138-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identify remaining coefficients in blocks (which ought to be set to 0)</span></span>
<span id="cb138-79"><a href="other-useful.html#cb138-79" aria-hidden="true" tabindex="-1"></a>    insig_blocked_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb138-80"><a href="other-useful.html#cb138-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-81"><a href="other-useful.html#cb138-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>){</span>
<span id="cb138-82"><a href="other-useful.html#cb138-82" aria-hidden="true" tabindex="-1"></a>        insig_blocked_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>(block_size<span class="sc">*</span>nblocks), blocked_dgp_vars)</span>
<span id="cb138-83"><a href="other-useful.html#cb138-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(beta[insig_blocked_vars] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb138-84"><a href="other-useful.html#cb138-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-85"><a href="other-useful.html#cb138-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find significant unblocked variables (if applicable) and fill in</span></span>
<span id="cb138-86"><a href="other-useful.html#cb138-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coefficients</span></span>
<span id="cb138-87"><a href="other-useful.html#cb138-87" aria-hidden="true" tabindex="-1"></a>    sig_unblocked_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb138-88"><a href="other-useful.html#cb138-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-89"><a href="other-useful.html#cb138-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k_unblocked <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb138-90"><a href="other-useful.html#cb138-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Range of weak signal coefficients</span></span>
<span id="cb138-91"><a href="other-useful.html#cb138-91" aria-hidden="true" tabindex="-1"></a>        beta_lows <span class="ot">&lt;-</span> beta_low<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">:</span>k_unblocked)</span>
<span id="cb138-92"><a href="other-useful.html#cb138-92" aria-hidden="true" tabindex="-1"></a>        sig_unblocked_vars <span class="ot">&lt;-</span> (nblocks<span class="sc">*</span>block_size <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span></span>
<span id="cb138-93"><a href="other-useful.html#cb138-93" aria-hidden="true" tabindex="-1"></a>            (nblocks<span class="sc">*</span>block_size <span class="sc">+</span> k_unblocked)</span>
<span id="cb138-94"><a href="other-useful.html#cb138-94" aria-hidden="true" tabindex="-1"></a>        sig_unblocked_vars <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(sig_unblocked_vars)</span>
<span id="cb138-95"><a href="other-useful.html#cb138-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-96"><a href="other-useful.html#cb138-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(sig_unblocked_vars) <span class="sc">==</span> k_unblocked)</span>
<span id="cb138-97"><a href="other-useful.html#cb138-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(sig_unblocked_vars)) <span class="sc">==</span> k_unblocked)</span>
<span id="cb138-98"><a href="other-useful.html#cb138-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(sig_unblocked_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb138-99"><a href="other-useful.html#cb138-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-100"><a href="other-useful.html#cb138-100" aria-hidden="true" tabindex="-1"></a>        beta[sig_unblocked_vars] <span class="ot">&lt;-</span> beta_lows</span>
<span id="cb138-101"><a href="other-useful.html#cb138-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb138-102"><a href="other-useful.html#cb138-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-103"><a href="other-useful.html#cb138-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(blocked_dgp_vars, sig_unblocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb138-104"><a href="other-useful.html#cb138-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(sig_unblocked_vars, insig_blocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb138-105"><a href="other-useful.html#cb138-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(blocked_dgp_vars, insig_blocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb138-106"><a href="other-useful.html#cb138-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-107"><a href="other-useful.html#cb138-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(insig_blocked_vars) <span class="sc">+</span> <span class="fu">length</span>(blocked_dgp_vars) <span class="sc">==</span></span>
<span id="cb138-108"><a href="other-useful.html#cb138-108" aria-hidden="true" tabindex="-1"></a>        nblocks<span class="sc">*</span>block_size)</span>
<span id="cb138-109"><a href="other-useful.html#cb138-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-110"><a href="other-useful.html#cb138-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">+</span> <span class="fu">length</span>(insig_blocked_vars) <span class="sc">+</span> k_unblocked <span class="sc">&lt;=</span> p)</span>
<span id="cb138-111"><a href="other-useful.html#cb138-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-112"><a href="other-useful.html#cb138-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">sum</span>(beta <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">==</span> sig_blocks <span class="sc">+</span> k_unblocked)</span>
<span id="cb138-113"><a href="other-useful.html#cb138-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(beta) <span class="sc">|</span> <span class="fu">is.integer</span>(beta))</span>
<span id="cb138-114"><a href="other-useful.html#cb138-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-115"><a href="other-useful.html#cb138-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta=</span>beta, <span class="at">blocked_dgp_vars=</span>blocked_dgp_vars,</span>
<span id="cb138-116"><a href="other-useful.html#cb138-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_unblocked_vars=</span>sig_unblocked_vars,</span>
<span id="cb138-117"><a href="other-useful.html#cb138-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">insig_blocked_vars=</span>insig_blocked_vars, <span class="at">latent_vars=</span>latent_vars))</span>
<span id="cb138-118"><a href="other-useful.html#cb138-118" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#makeCoefficients'>makeCoefficients</a>()</code></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="other-useful.html#cb139-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;makeCoefficients works&quot;</span>, {</span>
<span id="cb139-2"><a href="other-useful.html#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">5722</span>)</span>
<span id="cb139-3"><a href="other-useful.html#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="other-useful.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb139-5"><a href="other-useful.html#cb139-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb139-6"><a href="other-useful.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-7"><a href="other-useful.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb139-8"><a href="other-useful.html#cb139-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;blocked_dgp_vars&quot;</span>,</span>
<span id="cb139-9"><a href="other-useful.html#cb139-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;sig_unblocked_vars&quot;</span>,</span>
<span id="cb139-10"><a href="other-useful.html#cb139-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;insig_blocked_vars&quot;</span>, <span class="st">&quot;latent_vars&quot;</span>))</span>
<span id="cb139-11"><a href="other-useful.html#cb139-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-12"><a href="other-useful.html#cb139-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>beta))</span>
<span id="cb139-13"><a href="other-useful.html#cb139-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>beta), <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb139-14"><a href="other-useful.html#cb139-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">sum</span>(ret<span class="sc">$</span>beta <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span>)</span>
<span id="cb139-15"><a href="other-useful.html#cb139-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Checking structure</span></span>
<span id="cb139-16"><a href="other-useful.html#cb139-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>beta[<span class="dv">1</span>], <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb139-17"><a href="other-useful.html#cb139-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb139-18"><a href="other-useful.html#cb139-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">==</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">9</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span>))))</span>
<span id="cb139-19"><a href="other-useful.html#cb139-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb139-20"><a href="other-useful.html#cb139-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-21"><a href="other-useful.html#cb139-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>blocked_dgp_vars) <span class="sc">|</span> <span class="fu">is.numeric</span>(ret<span class="sc">$</span>blocked_dgp_vars))</span>
<span id="cb139-22"><a href="other-useful.html#cb139-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>blocked_dgp_vars, <span class="dv">1</span>)</span>
<span id="cb139-23"><a href="other-useful.html#cb139-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-24"><a href="other-useful.html#cb139-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>sig_unblocked_vars, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb139-25"><a href="other-useful.html#cb139-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-26"><a href="other-useful.html#cb139-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>insig_blocked_vars, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb139-27"><a href="other-useful.html#cb139-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-28"><a href="other-useful.html#cb139-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>latent_vars, <span class="fu">c</span>(1L, 4L))</span>
<span id="cb139-29"><a href="other-useful.html#cb139-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-30"><a href="other-useful.html#cb139-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb139-31"><a href="other-useful.html#cb139-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb139-32"><a href="other-useful.html#cb139-32" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>,</span>
<span id="cb139-33"><a href="other-useful.html#cb139-33" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb139-34"><a href="other-useful.html#cb139-34" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unblocked &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb139-35"><a href="other-useful.html#cb139-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-36"><a href="other-useful.html#cb139-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb139-37"><a href="other-useful.html#cb139-37" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">3</span>,</span>
<span id="cb139-38"><a href="other-useful.html#cb139-38" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb139-39"><a href="other-useful.html#cb139-39" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_blocks &lt;= nblocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb139-40"><a href="other-useful.html#cb139-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-41"><a href="other-useful.html#cb139-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">7</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb139-42"><a href="other-useful.html#cb139-42" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>,</span>
<span id="cb139-43"><a href="other-useful.html#cb139-43" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb139-44"><a href="other-useful.html#cb139-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= nblocks * block_size + k_unblocked is not TRUE&quot;</span>,</span>
<span id="cb139-45"><a href="other-useful.html#cb139-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb139-46"><a href="other-useful.html#cb139-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-47"><a href="other-useful.html#cb139-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb139-48"><a href="other-useful.html#cb139-48" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>,</span>
<span id="cb139-49"><a href="other-useful.html#cb139-49" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sig_blocks=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb139-50"><a href="other-useful.html#cb139-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_blocks &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb139-51"><a href="other-useful.html#cb139-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-52"><a href="other-useful.html#cb139-52" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p><code><a href='other-useful.html#genMuXZSd'>genMuXZSd</a>()</code></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="other-useful.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate observed and latent variables along with conditional mean</span></span>
<span id="cb141-2"><a href="other-useful.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb141-3"><a href="other-useful.html#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb141-4"><a href="other-useful.html#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb141-5"><a href="other-useful.html#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb141-6"><a href="other-useful.html#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of observed features (the generated X</span></span>
<span id="cb141-7"><a href="other-useful.html#cb141-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have p columns).</span></span>
<span id="cb141-8"><a href="other-useful.html#cb141-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta A numeric or integer vector of length `p` + sig_blocks containing</span></span>
<span id="cb141-9"><a href="other-useful.html#cb141-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the coefficients for the true model for y.</span></span>
<span id="cb141-10"><a href="other-useful.html#cb141-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Sigma A (`p` + n_blocks) x (`p` + n_blocks) numeric matrix</span></span>
<span id="cb141-11"><a href="other-useful.html#cb141-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representing the covariance matrix for the latent features, the associated</span></span>
<span id="cb141-12"><a href="other-useful.html#cb141-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies, and the remaining features.</span></span>
<span id="cb141-13"><a href="other-useful.html#cb141-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param blocked_dgp_vars An integer vector of length sig_blocks containing the</span></span>
<span id="cb141-14"><a href="other-useful.html#cb141-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features corresponding to the latent features that have</span></span>
<span id="cb141-15"><a href="other-useful.html#cb141-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero coefficient beta_high in the true model for y.</span></span>
<span id="cb141-16"><a href="other-useful.html#cb141-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param latent_vars An integer vector of length n_blocks containing the</span></span>
<span id="cb141-17"><a href="other-useful.html#cb141-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of all of the latent features.</span></span>
<span id="cb141-18"><a href="other-useful.html#cb141-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb141-19"><a href="other-useful.html#cb141-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain block_size noisy proxies that are correlated with</span></span>
<span id="cb141-20"><a href="other-useful.html#cb141-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb141-21"><a href="other-useful.html#cb141-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_blocks Integer or numeric; the number of latent variables to</span></span>
<span id="cb141-22"><a href="other-useful.html#cb141-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb141-23"><a href="other-useful.html#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb141-24"><a href="other-useful.html#cb141-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb141-25"><a href="other-useful.html#cb141-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb141-26"><a href="other-useful.html#cb141-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb141-27"><a href="other-useful.html#cb141-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb141-28"><a href="other-useful.html#cb141-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb141-29"><a href="other-useful.html#cb141-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb141-30"><a href="other-useful.html#cb141-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{X}{An `n` x `p`</span></span>
<span id="cb141-31"><a href="other-useful.html#cb141-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric matrix containing the observed proxies for the latent variables as</span></span>
<span id="cb141-32"><a href="other-useful.html#cb141-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as the observed unblocked (iid) variables.} \item{mu}{A length `n`</span></span>
<span id="cb141-33"><a href="other-useful.html#cb141-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector; the expected response given X, Z, and the true</span></span>
<span id="cb141-34"><a href="other-useful.html#cb141-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient vector (equal to y minus the added noise).} \item{z}{An `n` x</span></span>
<span id="cb141-35"><a href="other-useful.html#cb141-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_blocks numeric matrix containing the n_blocks latent variables. Note that</span></span>
<span id="cb141-36"><a href="other-useful.html#cb141-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (X, z) is multivariate Gaussian.} \item{sd}{Numeric; the standard deviation</span></span>
<span id="cb141-37"><a href="other-useful.html#cb141-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of the noise added to mu to get y (calculated either from snr or</span></span>
<span id="cb141-38"><a href="other-useful.html#cb141-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sigma_eps_sq).}</span></span>
<span id="cb141-39"><a href="other-useful.html#cb141-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb141-40"><a href="other-useful.html#cb141-40" aria-hidden="true" tabindex="-1"></a><span id='genMuXZSd'>genMuXZSd</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, beta, Sigma, blocked_dgp_vars,</span>
<span id="cb141-41"><a href="other-useful.html#cb141-41" aria-hidden="true" tabindex="-1"></a>    latent_vars, block_size, <span class="at">n_blocks=</span><span class="dv">1</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>){</span>
<span id="cb141-42"><a href="other-useful.html#cb141-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb141-43"><a href="other-useful.html#cb141-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-44"><a href="other-useful.html#cb141-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(blocked_dgp_vars) <span class="sc">&lt;=</span> n_blocks)</span>
<span id="cb141-45"><a href="other-useful.html#cb141-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Sigma) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb141-46"><a href="other-useful.html#cb141-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(Sigma) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb141-47"><a href="other-useful.html#cb141-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb141-48"><a href="other-useful.html#cb141-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq))){</span>
<span id="cb141-49"><a href="other-useful.html#cb141-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sigma_eps_sq) <span class="sc">|</span> <span class="fu">is.integer</span>(sigma_eps_sq))</span>
<span id="cb141-50"><a href="other-useful.html#cb141-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(sigma_eps_sq) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb141-51"><a href="other-useful.html#cb141-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb141-52"><a href="other-useful.html#cb141-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb141-53"><a href="other-useful.html#cb141-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(snr))){</span>
<span id="cb141-54"><a href="other-useful.html#cb141-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Must provide one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb141-55"><a href="other-useful.html#cb141-55" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb141-56"><a href="other-useful.html#cb141-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(snr) <span class="sc">|</span> <span class="fu">is.integer</span>(snr))</span>
<span id="cb141-57"><a href="other-useful.html#cb141-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(snr) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb141-58"><a href="other-useful.html#cb141-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb141-59"><a href="other-useful.html#cb141-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-60"><a href="other-useful.html#cb141-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-61"><a href="other-useful.html#cb141-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(beta) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb141-62"><a href="other-useful.html#cb141-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(beta[blocked_dgp_vars] <span class="sc">!=</span> <span class="dv">0</span>))</span>
<span id="cb141-63"><a href="other-useful.html#cb141-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-64"><a href="other-useful.html#cb141-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> n_blocks)</span>
<span id="cb141-65"><a href="other-useful.html#cb141-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-66"><a href="other-useful.html#cb141-66" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span>n, <span class="at">mu=</span><span class="fu">rep</span>(<span class="dv">0</span>, p <span class="sc">+</span> n_blocks), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb141-67"><a href="other-useful.html#cb141-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-68"><a href="other-useful.html#cb141-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(beta) <span class="sc">==</span> <span class="fu">ncol</span>(x))</span>
<span id="cb141-69"><a href="other-useful.html#cb141-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-70"><a href="other-useful.html#cb141-70" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x <span class="sc">%*%</span> beta)</span>
<span id="cb141-71"><a href="other-useful.html#cb141-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-72"><a href="other-useful.html#cb141-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove true blocked signal feature from each block from x now that I&#39;ve</span></span>
<span id="cb141-73"><a href="other-useful.html#cb141-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generated mu</span></span>
<span id="cb141-74"><a href="other-useful.html#cb141-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_blocks <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb141-75"><a href="other-useful.html#cb141-75" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">nrow=</span>n, <span class="at">ncol=</span>n_blocks)</span>
<span id="cb141-76"><a href="other-useful.html#cb141-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb141-77"><a href="other-useful.html#cb141-77" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb141-78"><a href="other-useful.html#cb141-78" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb141-79"><a href="other-useful.html#cb141-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb141-80"><a href="other-useful.html#cb141-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-81"><a href="other-useful.html#cb141-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb141-82"><a href="other-useful.html#cb141-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb141-83"><a href="other-useful.html#cb141-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb141-84"><a href="other-useful.html#cb141-84" aria-hidden="true" tabindex="-1"></a>        z[, <span class="dv">1</span><span class="sc">:</span>n_blocks] <span class="ot">&lt;-</span> x[, latent_vars]</span>
<span id="cb141-85"><a href="other-useful.html#cb141-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-86"><a href="other-useful.html#cb141-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-87"><a href="other-useful.html#cb141-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb141-88"><a href="other-useful.html#cb141-88" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[, <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>(p <span class="sc">+</span> n_blocks), latent_vars)]</span>
<span id="cb141-89"><a href="other-useful.html#cb141-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-90"><a href="other-useful.html#cb141-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If SNR is null, use sigma_eps_sq</span></span>
<span id="cb141-91"><a href="other-useful.html#cb141-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb141-92"><a href="other-useful.html#cb141-92" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma_eps_sq)</span>
<span id="cb141-93"><a href="other-useful.html#cb141-93" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb141-94"><a href="other-useful.html#cb141-94" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(mu<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">*</span> snr)) <span class="co"># taking snr = ||mu||^2 /(n * sigma^2)</span></span>
<span id="cb141-95"><a href="other-useful.html#cb141-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-96"><a href="other-useful.html#cb141-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-97"><a href="other-useful.html#cb141-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb141-98"><a href="other-useful.html#cb141-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-99"><a href="other-useful.html#cb141-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(mu) <span class="sc">==</span> n)</span>
<span id="cb141-100"><a href="other-useful.html#cb141-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-101"><a href="other-useful.html#cb141-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(x) <span class="sc">==</span> n)</span>
<span id="cb141-102"><a href="other-useful.html#cb141-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(x) <span class="sc">==</span> p)</span>
<span id="cb141-103"><a href="other-useful.html#cb141-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-104"><a href="other-useful.html#cb141-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(z))){</span>
<span id="cb141-105"><a href="other-useful.html#cb141-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(z) <span class="sc">==</span> n)</span>
<span id="cb141-106"><a href="other-useful.html#cb141-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(z) <span class="sc">==</span> n_blocks)</span>
<span id="cb141-107"><a href="other-useful.html#cb141-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb141-108"><a href="other-useful.html#cb141-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-109"><a href="other-useful.html#cb141-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sd) <span class="sc">|</span> <span class="fu">is.integer</span>(sd))</span>
<span id="cb141-110"><a href="other-useful.html#cb141-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sd) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb141-111"><a href="other-useful.html#cb141-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(sd))</span>
<span id="cb141-112"><a href="other-useful.html#cb141-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sd <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb141-113"><a href="other-useful.html#cb141-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-114"><a href="other-useful.html#cb141-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>x, <span class="at">mu=</span>mu, <span class="at">z=</span>z, <span class="at">sd=</span>sd))</span>
<span id="cb141-115"><a href="other-useful.html#cb141-115" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#genMuXZSd'>genMuXZSd</a>()</code></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="other-useful.html#cb142-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genMuXZSd works&quot;</span>, {</span>
<span id="cb142-2"><a href="other-useful.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">61232</span>)</span>
<span id="cb142-3"><a href="other-useful.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-4"><a href="other-useful.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">rho=</span><span class="fl">0.2499</span>,</span>
<span id="cb142-5"><a href="other-useful.html#cb142-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">var=</span>.<span class="dv">25</span>)</span>
<span id="cb142-6"><a href="other-useful.html#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="other-useful.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb142-8"><a href="other-useful.html#cb142-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb142-9"><a href="other-useful.html#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="other-useful.html#cb142-10" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-11"><a href="other-useful.html#cb142-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-12"><a href="other-useful.html#cb142-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb142-13"><a href="other-useful.html#cb142-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>)</span>
<span id="cb142-14"><a href="other-useful.html#cb142-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-15"><a href="other-useful.html#cb142-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb142-16"><a href="other-useful.html#cb142-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb142-17"><a href="other-useful.html#cb142-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-18"><a href="other-useful.html#cb142-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb142-19"><a href="other-useful.html#cb142-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb142-20"><a href="other-useful.html#cb142-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb142-21"><a href="other-useful.html#cb142-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">9</span>)</span>
<span id="cb142-22"><a href="other-useful.html#cb142-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 1/4; expect all observations to lie</span></span>
<span id="cb142-23"><a href="other-useful.html#cb142-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb142-24"><a href="other-useful.html#cb142-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fl">0.25</span>)))</span>
<span id="cb142-25"><a href="other-useful.html#cb142-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-26"><a href="other-useful.html#cb142-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb142-27"><a href="other-useful.html#cb142-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb142-28"><a href="other-useful.html#cb142-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb142-29"><a href="other-useful.html#cb142-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb142-30"><a href="other-useful.html#cb142-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-31"><a href="other-useful.html#cb142-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb142-32"><a href="other-useful.html#cb142-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb142-33"><a href="other-useful.html#cb142-33" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb142-34"><a href="other-useful.html#cb142-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-35"><a href="other-useful.html#cb142-35" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb142-36"><a href="other-useful.html#cb142-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb142-37"><a href="other-useful.html#cb142-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-38"><a href="other-useful.html#cb142-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-39"><a href="other-useful.html#cb142-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb142-40"><a href="other-useful.html#cb142-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb142-41"><a href="other-useful.html#cb142-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-42"><a href="other-useful.html#cb142-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-43"><a href="other-useful.html#cb142-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-44"><a href="other-useful.html#cb142-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">25</span>)</span>
<span id="cb142-45"><a href="other-useful.html#cb142-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">2</span>)</span>
<span id="cb142-46"><a href="other-useful.html#cb142-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-47"><a href="other-useful.html#cb142-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>sd))</span>
<span id="cb142-48"><a href="other-useful.html#cb142-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>sd, <span class="fu">sqrt</span>(<span class="fl">1.2</span>))</span>
<span id="cb142-49"><a href="other-useful.html#cb142-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-50"><a href="other-useful.html#cb142-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sd</span></span>
<span id="cb142-51"><a href="other-useful.html#cb142-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-52"><a href="other-useful.html#cb142-52" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-53"><a href="other-useful.html#cb142-53" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-54"><a href="other-useful.html#cb142-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb142-55"><a href="other-useful.html#cb142-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb142-56"><a href="other-useful.html#cb142-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-57"><a href="other-useful.html#cb142-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb142-58"><a href="other-useful.html#cb142-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb142-59"><a href="other-useful.html#cb142-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-60"><a href="other-useful.html#cb142-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb142-61"><a href="other-useful.html#cb142-61" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb142-62"><a href="other-useful.html#cb142-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">5</span>)</span>
<span id="cb142-63"><a href="other-useful.html#cb142-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">9</span>)</span>
<span id="cb142-64"><a href="other-useful.html#cb142-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-65"><a href="other-useful.html#cb142-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb142-66"><a href="other-useful.html#cb142-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">5</span>)</span>
<span id="cb142-67"><a href="other-useful.html#cb142-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-68"><a href="other-useful.html#cb142-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-69"><a href="other-useful.html#cb142-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-70"><a href="other-useful.html#cb142-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">5</span>)</span>
<span id="cb142-71"><a href="other-useful.html#cb142-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">2</span>)</span>
<span id="cb142-72"><a href="other-useful.html#cb142-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-73"><a href="other-useful.html#cb142-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>sd))</span>
<span id="cb142-74"><a href="other-useful.html#cb142-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret<span class="sc">$</span>sd <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb142-75"><a href="other-useful.html#cb142-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-76"><a href="other-useful.html#cb142-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb142-77"><a href="other-useful.html#cb142-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-78"><a href="other-useful.html#cb142-78" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">nblocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb142-79"><a href="other-useful.html#cb142-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-80"><a href="other-useful.html#cb142-80" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb142-81"><a href="other-useful.html#cb142-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">1</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb142-82"><a href="other-useful.html#cb142-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-83"><a href="other-useful.html#cb142-83" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-84"><a href="other-useful.html#cb142-84" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-85"><a href="other-useful.html#cb142-85" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb142-86"><a href="other-useful.html#cb142-86" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>)</span>
<span id="cb142-87"><a href="other-useful.html#cb142-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-88"><a href="other-useful.html#cb142-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb142-89"><a href="other-useful.html#cb142-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb142-90"><a href="other-useful.html#cb142-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-91"><a href="other-useful.html#cb142-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-92"><a href="other-useful.html#cb142-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb142-93"><a href="other-useful.html#cb142-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">5</span>)</span>
<span id="cb142-94"><a href="other-useful.html#cb142-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">1</span>)</span>
<span id="cb142-95"><a href="other-useful.html#cb142-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-96"><a href="other-useful.html#cb142-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb142-97"><a href="other-useful.html#cb142-97" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb142-98"><a href="other-useful.html#cb142-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-99"><a href="other-useful.html#cb142-99" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb142-100"><a href="other-useful.html#cb142-100" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb142-101"><a href="other-useful.html#cb142-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-102"><a href="other-useful.html#cb142-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-103"><a href="other-useful.html#cb142-103" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-104"><a href="other-useful.html#cb142-104" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">0</span>,</span>
<span id="cb142-105"><a href="other-useful.html#cb142-105" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>),</span>
<span id="cb142-106"><a href="other-useful.html#cb142-106" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(blocked_dgp_vars) &lt;= n_blocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-107"><a href="other-useful.html#cb142-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-108"><a href="other-useful.html#cb142-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-109"><a href="other-useful.html#cb142-109" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-110"><a href="other-useful.html#cb142-110" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">1</span>,</span>
<span id="cb142-111"><a href="other-useful.html#cb142-111" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>),</span>
<span id="cb142-112"><a href="other-useful.html#cb142-112" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nrow(Sigma) == p + n_blocks is not TRUE&quot;</span>,</span>
<span id="cb142-113"><a href="other-useful.html#cb142-113" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-114"><a href="other-useful.html#cb142-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-115"><a href="other-useful.html#cb142-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-116"><a href="other-useful.html#cb142-116" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-117"><a href="other-useful.html#cb142-117" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-118"><a href="other-useful.html#cb142-118" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="st">&quot;1.2&quot;</span>),</span>
<span id="cb142-119"><a href="other-useful.html#cb142-119" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sigma_eps_sq) | is.integer(sigma_eps_sq) is not TRUE&quot;</span>,</span>
<span id="cb142-120"><a href="other-useful.html#cb142-120" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-121"><a href="other-useful.html#cb142-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-122"><a href="other-useful.html#cb142-122" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-123"><a href="other-useful.html#cb142-123" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-124"><a href="other-useful.html#cb142-124" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-125"><a href="other-useful.html#cb142-125" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb142-126"><a href="other-useful.html#cb142-126" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(sigma_eps_sq) == 1 is not TRUE&quot;</span>,</span>
<span id="cb142-127"><a href="other-useful.html#cb142-127" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-128"><a href="other-useful.html#cb142-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-129"><a href="other-useful.html#cb142-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-130"><a href="other-useful.html#cb142-130" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-131"><a href="other-useful.html#cb142-131" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-132"><a href="other-useful.html#cb142-132" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb142-133"><a href="other-useful.html#cb142-133" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-134"><a href="other-useful.html#cb142-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-135"><a href="other-useful.html#cb142-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-136"><a href="other-useful.html#cb142-136" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-137"><a href="other-useful.html#cb142-137" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-138"><a href="other-useful.html#cb142-138" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-139"><a href="other-useful.html#cb142-139" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must provide one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-140"><a href="other-useful.html#cb142-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-141"><a href="other-useful.html#cb142-141" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-142"><a href="other-useful.html#cb142-142" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-143"><a href="other-useful.html#cb142-143" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-144"><a href="other-useful.html#cb142-144" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="st">&quot;1&quot;</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-145"><a href="other-useful.html#cb142-145" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(snr) | is.integer(snr) is not TRUE&quot;</span>,</span>
<span id="cb142-146"><a href="other-useful.html#cb142-146" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-147"><a href="other-useful.html#cb142-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-148"><a href="other-useful.html#cb142-148" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-149"><a href="other-useful.html#cb142-149" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-150"><a href="other-useful.html#cb142-150" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-151"><a href="other-useful.html#cb142-151" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-152"><a href="other-useful.html#cb142-152" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(snr) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-153"><a href="other-useful.html#cb142-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-154"><a href="other-useful.html#cb142-154" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-155"><a href="other-useful.html#cb142-155" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-156"><a href="other-useful.html#cb142-156" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-157"><a href="other-useful.html#cb142-157" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-158"><a href="other-useful.html#cb142-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-159"><a href="other-useful.html#cb142-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-160"><a href="other-useful.html#cb142-160" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-161"><a href="other-useful.html#cb142-161" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-162"><a href="other-useful.html#cb142-162" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-163"><a href="other-useful.html#cb142-163" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-164"><a href="other-useful.html#cb142-164" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(beta) == p + n_blocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-165"><a href="other-useful.html#cb142-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-166"><a href="other-useful.html#cb142-166" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span>), <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-167"><a href="other-useful.html#cb142-167" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-168"><a href="other-useful.html#cb142-168" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-169"><a href="other-useful.html#cb142-169" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-170"><a href="other-useful.html#cb142-170" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(beta[blocked_dgp_vars] != 0) is not TRUE&quot;</span>,</span>
<span id="cb142-171"><a href="other-useful.html#cb142-171" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-172"><a href="other-useful.html#cb142-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb142-173"><a href="other-useful.html#cb142-173" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb142-174"><a href="other-useful.html#cb142-174" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb142-175"><a href="other-useful.html#cb142-175" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb142-176"><a href="other-useful.html#cb142-176" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb142-177"><a href="other-useful.html#cb142-177" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(latent_vars) == n_blocks is not TRUE&quot;</span>,</span>
<span id="cb142-178"><a href="other-useful.html#cb142-178" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb142-179"><a href="other-useful.html#cb142-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-180"><a href="other-useful.html#cb142-180" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥇</code></pre>
<p>Finally, tests for <code><a href='other-useful.html#genClusteredData'>genClusteredData</a>()</code></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="other-useful.html#cb144-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredData works&quot;</span>, {</span>
<span id="cb144-2"><a href="other-useful.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb144-3"><a href="other-useful.html#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="other-useful.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-5"><a href="other-useful.html#cb144-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">3.99</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-6"><a href="other-useful.html#cb144-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb144-7"><a href="other-useful.html#cb144-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-8"><a href="other-useful.html#cb144-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb144-9"><a href="other-useful.html#cb144-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb144-10"><a href="other-useful.html#cb144-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-11"><a href="other-useful.html#cb144-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb144-12"><a href="other-useful.html#cb144-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb144-13"><a href="other-useful.html#cb144-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb144-14"><a href="other-useful.html#cb144-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb144-15"><a href="other-useful.html#cb144-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb144-16"><a href="other-useful.html#cb144-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb144-17"><a href="other-useful.html#cb144-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb144-18"><a href="other-useful.html#cb144-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb144-19"><a href="other-useful.html#cb144-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb144-20"><a href="other-useful.html#cb144-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb144-21"><a href="other-useful.html#cb144-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb144-22"><a href="other-useful.html#cb144-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-23"><a href="other-useful.html#cb144-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb144-24"><a href="other-useful.html#cb144-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb144-25"><a href="other-useful.html#cb144-25" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb144-26"><a href="other-useful.html#cb144-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-27"><a href="other-useful.html#cb144-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb144-28"><a href="other-useful.html#cb144-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb144-29"><a href="other-useful.html#cb144-29" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb144-30"><a href="other-useful.html#cb144-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-31"><a href="other-useful.html#cb144-31" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb144-32"><a href="other-useful.html#cb144-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb144-33"><a href="other-useful.html#cb144-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-34"><a href="other-useful.html#cb144-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb144-35"><a href="other-useful.html#cb144-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb144-36"><a href="other-useful.html#cb144-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-37"><a href="other-useful.html#cb144-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb144-38"><a href="other-useful.html#cb144-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb144-39"><a href="other-useful.html#cb144-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb144-40"><a href="other-useful.html#cb144-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb144-41"><a href="other-useful.html#cb144-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-42"><a href="other-useful.html#cb144-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb144-43"><a href="other-useful.html#cb144-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb144-44"><a href="other-useful.html#cb144-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb144-45"><a href="other-useful.html#cb144-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb144-46"><a href="other-useful.html#cb144-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb144-47"><a href="other-useful.html#cb144-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-48"><a href="other-useful.html#cb144-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb144-49"><a href="other-useful.html#cb144-49" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-50"><a href="other-useful.html#cb144-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-51"><a href="other-useful.html#cb144-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb144-52"><a href="other-useful.html#cb144-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-53"><a href="other-useful.html#cb144-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb144-54"><a href="other-useful.html#cb144-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb144-55"><a href="other-useful.html#cb144-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-56"><a href="other-useful.html#cb144-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb144-57"><a href="other-useful.html#cb144-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb144-58"><a href="other-useful.html#cb144-58" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-59"><a href="other-useful.html#cb144-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-60"><a href="other-useful.html#cb144-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb144-61"><a href="other-useful.html#cb144-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-62"><a href="other-useful.html#cb144-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb144-63"><a href="other-useful.html#cb144-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb144-64"><a href="other-useful.html#cb144-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-65"><a href="other-useful.html#cb144-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb144-66"><a href="other-useful.html#cb144-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb144-67"><a href="other-useful.html#cb144-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">25</span>))</span>
<span id="cb144-68"><a href="other-useful.html#cb144-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-69"><a href="other-useful.html#cb144-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb144-70"><a href="other-useful.html#cb144-70" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb144-71"><a href="other-useful.html#cb144-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-72"><a href="other-useful.html#cb144-72" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb144-73"><a href="other-useful.html#cb144-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-74"><a href="other-useful.html#cb144-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb144-75"><a href="other-useful.html#cb144-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb144-76"><a href="other-useful.html#cb144-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-77"><a href="other-useful.html#cb144-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb144-78"><a href="other-useful.html#cb144-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb144-79"><a href="other-useful.html#cb144-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">5</span>)</span>
<span id="cb144-80"><a href="other-useful.html#cb144-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb144-81"><a href="other-useful.html#cb144-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-82"><a href="other-useful.html#cb144-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb144-83"><a href="other-useful.html#cb144-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-84"><a href="other-useful.html#cb144-84" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-85"><a href="other-useful.html#cb144-85" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>,</span>
<span id="cb144-86"><a href="other-useful.html#cb144-86" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb144-87"><a href="other-useful.html#cb144-87" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-88"><a href="other-useful.html#cb144-88" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb144-89"><a href="other-useful.html#cb144-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-90"><a href="other-useful.html#cb144-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb144-91"><a href="other-useful.html#cb144-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-92"><a href="other-useful.html#cb144-92" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-93"><a href="other-useful.html#cb144-93" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-94"><a href="other-useful.html#cb144-94" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-95"><a href="other-useful.html#cb144-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-96"><a href="other-useful.html#cb144-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-97"><a href="other-useful.html#cb144-97" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-98"><a href="other-useful.html#cb144-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-99"><a href="other-useful.html#cb144-99" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-100"><a href="other-useful.html#cb144-100" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-101"><a href="other-useful.html#cb144-101" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-102"><a href="other-useful.html#cb144-102" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-103"><a href="other-useful.html#cb144-103" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-104"><a href="other-useful.html#cb144-104" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-105"><a href="other-useful.html#cb144-105" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-106"><a href="other-useful.html#cb144-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-107"><a href="other-useful.html#cb144-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-108"><a href="other-useful.html#cb144-108" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-109"><a href="other-useful.html#cb144-109" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-110"><a href="other-useful.html#cb144-110" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-111"><a href="other-useful.html#cb144-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-112"><a href="other-useful.html#cb144-112" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-113"><a href="other-useful.html#cb144-113" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb144-114"><a href="other-useful.html#cb144-114" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-115"><a href="other-useful.html#cb144-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-116"><a href="other-useful.html#cb144-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-117"><a href="other-useful.html#cb144-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb144-118"><a href="other-useful.html#cb144-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-119"><a href="other-useful.html#cb144-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb144-120"><a href="other-useful.html#cb144-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb144-121"><a href="other-useful.html#cb144-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-122"><a href="other-useful.html#cb144-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-123"><a href="other-useful.html#cb144-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-124"><a href="other-useful.html#cb144-124" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-125"><a href="other-useful.html#cb144-125" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb144-126"><a href="other-useful.html#cb144-126" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-127"><a href="other-useful.html#cb144-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-128"><a href="other-useful.html#cb144-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-129"><a href="other-useful.html#cb144-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb144-130"><a href="other-useful.html#cb144-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-131"><a href="other-useful.html#cb144-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-132"><a href="other-useful.html#cb144-132" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-133"><a href="other-useful.html#cb144-133" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-134"><a href="other-useful.html#cb144-134" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb144-135"><a href="other-useful.html#cb144-135" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-136"><a href="other-useful.html#cb144-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-137"><a href="other-useful.html#cb144-137" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-138"><a href="other-useful.html#cb144-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb144-139"><a href="other-useful.html#cb144-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-140"><a href="other-useful.html#cb144-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-141"><a href="other-useful.html#cb144-141" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-142"><a href="other-useful.html#cb144-142" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-143"><a href="other-useful.html#cb144-143" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-144"><a href="other-useful.html#cb144-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-145"><a href="other-useful.html#cb144-145" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-146"><a href="other-useful.html#cb144-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-147"><a href="other-useful.html#cb144-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-148"><a href="other-useful.html#cb144-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-149"><a href="other-useful.html#cb144-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-150"><a href="other-useful.html#cb144-150" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-151"><a href="other-useful.html#cb144-151" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-152"><a href="other-useful.html#cb144-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-153"><a href="other-useful.html#cb144-153" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-154"><a href="other-useful.html#cb144-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-155"><a href="other-useful.html#cb144-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb144-156"><a href="other-useful.html#cb144-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-157"><a href="other-useful.html#cb144-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-158"><a href="other-useful.html#cb144-158" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-159"><a href="other-useful.html#cb144-159" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb144-160"><a href="other-useful.html#cb144-160" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-161"><a href="other-useful.html#cb144-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-162"><a href="other-useful.html#cb144-162" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-163"><a href="other-useful.html#cb144-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-164"><a href="other-useful.html#cb144-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">8</span>,</span>
<span id="cb144-165"><a href="other-useful.html#cb144-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-166"><a href="other-useful.html#cb144-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-167"><a href="other-useful.html#cb144-167" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-168"><a href="other-useful.html#cb144-168" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-169"><a href="other-useful.html#cb144-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-170"><a href="other-useful.html#cb144-170" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-171"><a href="other-useful.html#cb144-171" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-172"><a href="other-useful.html#cb144-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb144-173"><a href="other-useful.html#cb144-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-174"><a href="other-useful.html#cb144-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-175"><a href="other-useful.html#cb144-175" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-176"><a href="other-useful.html#cb144-176" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-177"><a href="other-useful.html#cb144-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-178"><a href="other-useful.html#cb144-178" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-179"><a href="other-useful.html#cb144-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-180"><a href="other-useful.html#cb144-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-181"><a href="other-useful.html#cb144-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="sc">-</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-182"><a href="other-useful.html#cb144-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-183"><a href="other-useful.html#cb144-183" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-184"><a href="other-useful.html#cb144-184" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-185"><a href="other-useful.html#cb144-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-186"><a href="other-useful.html#cb144-186" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-187"><a href="other-useful.html#cb144-187" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-188"><a href="other-useful.html#cb144-188" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-189"><a href="other-useful.html#cb144-189" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb144-190"><a href="other-useful.html#cb144-190" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-191"><a href="other-useful.html#cb144-191" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-192"><a href="other-useful.html#cb144-192" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-193"><a href="other-useful.html#cb144-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-194"><a href="other-useful.html#cb144-194" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-195"><a href="other-useful.html#cb144-195" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-196"><a href="other-useful.html#cb144-196" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-197"><a href="other-useful.html#cb144-197" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-198"><a href="other-useful.html#cb144-198" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-199"><a href="other-useful.html#cb144-199" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-200"><a href="other-useful.html#cb144-200" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-201"><a href="other-useful.html#cb144-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-202"><a href="other-useful.html#cb144-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb144-203"><a href="other-useful.html#cb144-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb144-204"><a href="other-useful.html#cb144-204" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-205"><a href="other-useful.html#cb144-205" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-206"><a href="other-useful.html#cb144-206" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-207"><a href="other-useful.html#cb144-207" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-208"><a href="other-useful.html#cb144-208" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-209"><a href="other-useful.html#cb144-209" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb144-210"><a href="other-useful.html#cb144-210" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-211"><a href="other-useful.html#cb144-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-212"><a href="other-useful.html#cb144-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb144-213"><a href="other-useful.html#cb144-213" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-214"><a href="other-useful.html#cb144-214" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-215"><a href="other-useful.html#cb144-215" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-216"><a href="other-useful.html#cb144-216" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-217"><a href="other-useful.html#cb144-217" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-218"><a href="other-useful.html#cb144-218" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-219"><a href="other-useful.html#cb144-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-220"><a href="other-useful.html#cb144-220" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span>.<span class="dv">2</span>,</span>
<span id="cb144-221"><a href="other-useful.html#cb144-221" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-222"><a href="other-useful.html#cb144-222" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-223"><a href="other-useful.html#cb144-223" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-224"><a href="other-useful.html#cb144-224" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb144-225"><a href="other-useful.html#cb144-225" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-226"><a href="other-useful.html#cb144-226" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb144-227"><a href="other-useful.html#cb144-227" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-228"><a href="other-useful.html#cb144-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-229"><a href="other-useful.html#cb144-229" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-230"><a href="other-useful.html#cb144-230" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-231"><a href="other-useful.html#cb144-231" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-232"><a href="other-useful.html#cb144-232" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-233"><a href="other-useful.html#cb144-233" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb144-234"><a href="other-useful.html#cb144-234" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-235"><a href="other-useful.html#cb144-235" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-236"><a href="other-useful.html#cb144-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-237"><a href="other-useful.html#cb144-237" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-238"><a href="other-useful.html#cb144-238" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-239"><a href="other-useful.html#cb144-239" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-240"><a href="other-useful.html#cb144-240" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-241"><a href="other-useful.html#cb144-241" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb144-242"><a href="other-useful.html#cb144-242" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb144-243"><a href="other-useful.html#cb144-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-244"><a href="other-useful.html#cb144-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-245"><a href="other-useful.html#cb144-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb144-246"><a href="other-useful.html#cb144-246" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb144-247"><a href="other-useful.html#cb144-247" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb144-248"><a href="other-useful.html#cb144-248" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb144-249"><a href="other-useful.html#cb144-249" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb144-250"><a href="other-useful.html#cb144-250" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb144-251"><a href="other-useful.html#cb144-251" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb144-252"><a href="other-useful.html#cb144-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-253"><a href="other-useful.html#cb144-253" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p><code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="other-useful.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb146-2"><a href="other-useful.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, where proxies differ in their relevance (noise level)</span></span>
<span id="cb146-3"><a href="other-useful.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb146-4"><a href="other-useful.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb146-5"><a href="other-useful.html#cb146-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb146-6"><a href="other-useful.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb146-7"><a href="other-useful.html#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb146-8"><a href="other-useful.html#cb146-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb146-9"><a href="other-useful.html#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Section 5.3 of Faletto and Bien (2022).</span></span>
<span id="cb146-10"><a href="other-useful.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb146-11"><a href="other-useful.html#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb146-12"><a href="other-useful.html#cb146-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb146-13"><a href="other-useful.html#cb146-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb146-14"><a href="other-useful.html#cb146-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb146-15"><a href="other-useful.html#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb146-16"><a href="other-useful.html#cb146-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb146-17"><a href="other-useful.html#cb146-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb146-18"><a href="other-useful.html#cb146-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb146-19"><a href="other-useful.html#cb146-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb146-20"><a href="other-useful.html#cb146-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb146-21"><a href="other-useful.html#cb146-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb146-22"><a href="other-useful.html#cb146-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb146-23"><a href="other-useful.html#cb146-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_strong_cluster_vars Integer or numeric; among the cluster_size</span></span>
<span id="cb146-24"><a href="other-useful.html#cb146-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies in each cluster, n_strong_cluster_vars will have a high covariance</span></span>
<span id="cb146-25"><a href="other-useful.html#cb146-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (rho_high) with the latent variable and cluster_size - n_strong_cluster_vars</span></span>
<span id="cb146-26"><a href="other-useful.html#cb146-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have a low covariance (rho_low) with the latent variable.</span></span>
<span id="cb146-27"><a href="other-useful.html#cb146-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb146-28"><a href="other-useful.html#cb146-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb146-29"><a href="other-useful.html#cb146-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb146-30"><a href="other-useful.html#cb146-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb146-31"><a href="other-useful.html#cb146-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb146-32"><a href="other-useful.html#cb146-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb146-33"><a href="other-useful.html#cb146-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb146-34"><a href="other-useful.html#cb146-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the covariance of the &quot;strong proxies&quot; in</span></span>
<span id="cb146-35"><a href="other-useful.html#cb146-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb146-36"><a href="other-useful.html#cb146-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;strong proxy&quot; features in the cluster will be</span></span>
<span id="cb146-37"><a href="other-useful.html#cb146-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_high/var. rho_high cannot equal 0 and must be at least as large as</span></span>
<span id="cb146-38"><a href="other-useful.html#cb146-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low. Default is 0.9.</span></span>
<span id="cb146-39"><a href="other-useful.html#cb146-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the covariance of the &quot;weak proxies&quot; in</span></span>
<span id="cb146-40"><a href="other-useful.html#cb146-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb146-41"><a href="other-useful.html#cb146-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;weak proxy&quot; features in the cluster will be</span></span>
<span id="cb146-42"><a href="other-useful.html#cb146-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low/var. rho_low cannot equal 0 and must be no larger than rho_high.</span></span>
<span id="cb146-43"><a href="other-useful.html#cb146-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0.5.</span></span>
<span id="cb146-44"><a href="other-useful.html#cb146-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb146-45"><a href="other-useful.html#cb146-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb146-46"><a href="other-useful.html#cb146-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb146-47"><a href="other-useful.html#cb146-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb146-48"><a href="other-useful.html#cb146-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb146-49"><a href="other-useful.html#cb146-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb146-50"><a href="other-useful.html#cb146-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb146-51"><a href="other-useful.html#cb146-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb146-52"><a href="other-useful.html#cb146-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb146-53"><a href="other-useful.html#cb146-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb146-54"><a href="other-useful.html#cb146-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb146-55"><a href="other-useful.html#cb146-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb146-56"><a href="other-useful.html#cb146-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb146-57"><a href="other-useful.html#cb146-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb146-58"><a href="other-useful.html#cb146-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb146-59"><a href="other-useful.html#cb146-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb146-60"><a href="other-useful.html#cb146-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb146-61"><a href="other-useful.html#cb146-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb146-62"><a href="other-useful.html#cb146-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb146-63"><a href="other-useful.html#cb146-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb146-64"><a href="other-useful.html#cb146-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb146-65"><a href="other-useful.html#cb146-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb146-66"><a href="other-useful.html#cb146-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb146-67"><a href="other-useful.html#cb146-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb146-68"><a href="other-useful.html#cb146-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb146-69"><a href="other-useful.html#cb146-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb146-70"><a href="other-useful.html#cb146-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb146-71"><a href="other-useful.html#cb146-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb146-72"><a href="other-useful.html#cb146-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb146-73"><a href="other-useful.html#cb146-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb146-74"><a href="other-useful.html#cb146-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb146-75"><a href="other-useful.html#cb146-75" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb146-76"><a href="other-useful.html#cb146-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb146-77"><a href="other-useful.html#cb146-77" aria-hidden="true" tabindex="-1"></a><span id='genClusteredDataWeighted'>genClusteredDataWeighted</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size,</span>
<span id="cb146-78"><a href="other-useful.html#cb146-78" aria-hidden="true" tabindex="-1"></a>    n_strong_cluster_vars, <span class="at">n_clusters=</span><span class="dv">1</span>,  <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span><span class="fl">0.9</span>,</span>
<span id="cb146-79"><a href="other-useful.html#cb146-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">rho_low=</span><span class="fl">0.5</span>, <span class="at">var=</span><span class="dv">1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="dv">1</span>,</span>
<span id="cb146-80"><a href="other-useful.html#cb146-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb146-81"><a href="other-useful.html#cb146-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-82"><a href="other-useful.html#cb146-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb146-83"><a href="other-useful.html#cb146-83" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>(p, k_unclustered, cluster_size,</span>
<span id="cb146-84"><a href="other-useful.html#cb146-84" aria-hidden="true" tabindex="-1"></a>        n_strong_cluster_vars, n_clusters,  sig_clusters, rho_high, rho_low,</span>
<span id="cb146-85"><a href="other-useful.html#cb146-85" aria-hidden="true" tabindex="-1"></a>        var, beta_latent, beta_unclustered, snr, sigma_eps_sq)</span>
<span id="cb146-86"><a href="other-useful.html#cb146-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-87"><a href="other-useful.html#cb146-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate covariance matrix (latent features are mixed in matrix, so each</span></span>
<span id="cb146-88"><a href="other-useful.html#cb146-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster will be of size cluster_size + 1)</span></span>
<span id="cb146-89"><a href="other-useful.html#cb146-89" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb146-90"><a href="other-useful.html#cb146-90" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb146-91"><a href="other-useful.html#cb146-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_strong_block_vars=</span>n_strong_cluster_vars <span class="sc">+</span> <span class="dv">1</span>, <span class="at">rho_high=</span>rho_high,</span>
<span id="cb146-92"><a href="other-useful.html#cb146-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">rho_low=</span>rho_low, <span class="at">var=</span>var)</span>
<span id="cb146-93"><a href="other-useful.html#cb146-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-94"><a href="other-useful.html#cb146-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate coefficients</span></span>
<span id="cb146-95"><a href="other-useful.html#cb146-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note that beta has length p + sig_clusters</span></span>
<span id="cb146-96"><a href="other-useful.html#cb146-96" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">k_unblocked=</span>k_unclustered,</span>
<span id="cb146-97"><a href="other-useful.html#cb146-97" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_low=</span>beta_unclustered, <span class="at">beta_high=</span>beta_latent, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb146-98"><a href="other-useful.html#cb146-98" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_blocks=</span>sig_clusters, <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb146-99"><a href="other-useful.html#cb146-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-100"><a href="other-useful.html#cb146-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate mu, X, z, sd, y</span></span>
<span id="cb146-101"><a href="other-useful.html#cb146-101" aria-hidden="true" tabindex="-1"></a>    gen_mu_x_z_sd_res <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb146-102"><a href="other-useful.html#cb146-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars, <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, </span>
<span id="cb146-103"><a href="other-useful.html#cb146-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size, <span class="at">n_blocks=</span>n_clusters, <span class="at">snr=</span>snr,</span>
<span id="cb146-104"><a href="other-useful.html#cb146-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb146-105"><a href="other-useful.html#cb146-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-106"><a href="other-useful.html#cb146-106" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>mu</span>
<span id="cb146-107"><a href="other-useful.html#cb146-107" aria-hidden="true" tabindex="-1"></a>    sd <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>sd</span>
<span id="cb146-108"><a href="other-useful.html#cb146-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-109"><a href="other-useful.html#cb146-109" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> mu <span class="sc">+</span> sd <span class="sc">*</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb146-110"><a href="other-useful.html#cb146-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-111"><a href="other-useful.html#cb146-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>gen_mu_x_z_sd_res<span class="sc">$</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>gen_mu_x_z_sd_res<span class="sc">$</span>z, <span class="at">mu=</span>mu))</span>
<span id="cb146-112"><a href="other-useful.html#cb146-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>()</code></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="other-useful.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredDataWeighted</span></span>
<span id="cb147-2"><a href="other-useful.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb147-3"><a href="other-useful.html#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb147-4"><a href="other-useful.html#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb147-5"><a href="other-useful.html#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb147-6"><a href="other-useful.html#cb147-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb147-7"><a href="other-useful.html#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb147-8"><a href="other-useful.html#cb147-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb147-9"><a href="other-useful.html#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb147-10"><a href="other-useful.html#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb147-11"><a href="other-useful.html#cb147-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb147-12"><a href="other-useful.html#cb147-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb147-13"><a href="other-useful.html#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb147-14"><a href="other-useful.html#cb147-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb147-15"><a href="other-useful.html#cb147-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb147-16"><a href="other-useful.html#cb147-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_strong_cluster_vars Integer or numeric; among the cluster_size</span></span>
<span id="cb147-17"><a href="other-useful.html#cb147-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies in each cluster, n_strong_cluster_vars will have a high covariance</span></span>
<span id="cb147-18"><a href="other-useful.html#cb147-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (rho_high) with the latent variable and cluster_size - n_strong_cluster_vars</span></span>
<span id="cb147-19"><a href="other-useful.html#cb147-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have a low covariance (rho_low) with the latent variable.</span></span>
<span id="cb147-20"><a href="other-useful.html#cb147-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb147-21"><a href="other-useful.html#cb147-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb147-22"><a href="other-useful.html#cb147-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb147-23"><a href="other-useful.html#cb147-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb147-24"><a href="other-useful.html#cb147-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb147-25"><a href="other-useful.html#cb147-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb147-26"><a href="other-useful.html#cb147-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb147-27"><a href="other-useful.html#cb147-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the covariance of the &quot;strong proxies&quot; in</span></span>
<span id="cb147-28"><a href="other-useful.html#cb147-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb147-29"><a href="other-useful.html#cb147-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;strong proxy&quot; features in the cluster will be</span></span>
<span id="cb147-30"><a href="other-useful.html#cb147-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_high/var. rho_high cannot equal 0 and must be at least as large as</span></span>
<span id="cb147-31"><a href="other-useful.html#cb147-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low. Default is 0.9.</span></span>
<span id="cb147-32"><a href="other-useful.html#cb147-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the covariance of the &quot;weak proxies&quot; in</span></span>
<span id="cb147-33"><a href="other-useful.html#cb147-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb147-34"><a href="other-useful.html#cb147-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;weak proxy&quot; features in the cluster will be</span></span>
<span id="cb147-35"><a href="other-useful.html#cb147-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low/var. rho_low cannot equal 0 and must be no larger than rho_high.</span></span>
<span id="cb147-36"><a href="other-useful.html#cb147-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0.5.</span></span>
<span id="cb147-37"><a href="other-useful.html#cb147-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb147-38"><a href="other-useful.html#cb147-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb147-39"><a href="other-useful.html#cb147-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb147-40"><a href="other-useful.html#cb147-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb147-41"><a href="other-useful.html#cb147-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb147-42"><a href="other-useful.html#cb147-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb147-43"><a href="other-useful.html#cb147-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb147-44"><a href="other-useful.html#cb147-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb147-45"><a href="other-useful.html#cb147-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb147-46"><a href="other-useful.html#cb147-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb147-47"><a href="other-useful.html#cb147-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb147-48"><a href="other-useful.html#cb147-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb147-49"><a href="other-useful.html#cb147-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb147-50"><a href="other-useful.html#cb147-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb147-51"><a href="other-useful.html#cb147-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb147-52"><a href="other-useful.html#cb147-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb147-53"><a href="other-useful.html#cb147-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb147-54"><a href="other-useful.html#cb147-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb147-55"><a href="other-useful.html#cb147-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb147-56"><a href="other-useful.html#cb147-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb147-57"><a href="other-useful.html#cb147-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb147-58"><a href="other-useful.html#cb147-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb147-59"><a href="other-useful.html#cb147-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb147-60"><a href="other-useful.html#cb147-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb147-61"><a href="other-useful.html#cb147-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb147-62"><a href="other-useful.html#cb147-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb147-63"><a href="other-useful.html#cb147-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb147-64"><a href="other-useful.html#cb147-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb147-65"><a href="other-useful.html#cb147-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb147-66"><a href="other-useful.html#cb147-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb147-67"><a href="other-useful.html#cb147-67" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered, cluster_size,</span>
<span id="cb147-68"><a href="other-useful.html#cb147-68" aria-hidden="true" tabindex="-1"></a>        n_strong_cluster_vars, n_clusters, sig_clusters, rho_high, rho_low,</span>
<span id="cb147-69"><a href="other-useful.html#cb147-69" aria-hidden="true" tabindex="-1"></a>        var, beta_latent, beta_unclustered, snr, sigma_eps_sq){</span>
<span id="cb147-70"><a href="other-useful.html#cb147-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-71"><a href="other-useful.html#cb147-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb147-72"><a href="other-useful.html#cb147-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb147-73"><a href="other-useful.html#cb147-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb147-74"><a href="other-useful.html#cb147-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb147-75"><a href="other-useful.html#cb147-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb147-76"><a href="other-useful.html#cb147-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb147-77"><a href="other-useful.html#cb147-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb147-78"><a href="other-useful.html#cb147-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb147-79"><a href="other-useful.html#cb147-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb147-80"><a href="other-useful.html#cb147-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb147-81"><a href="other-useful.html#cb147-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb147-82"><a href="other-useful.html#cb147-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb147-83"><a href="other-useful.html#cb147-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb147-84"><a href="other-useful.html#cb147-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-85"><a href="other-useful.html#cb147-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb147-86"><a href="other-useful.html#cb147-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-87"><a href="other-useful.html#cb147-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(n_strong_cluster_vars) <span class="sc">|</span></span>
<span id="cb147-88"><a href="other-useful.html#cb147-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.numeric</span>(n_strong_cluster_vars))</span>
<span id="cb147-89"><a href="other-useful.html#cb147-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(n_strong_cluster_vars))</span>
<span id="cb147-90"><a href="other-useful.html#cb147-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(n_strong_cluster_vars) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-91"><a href="other-useful.html#cb147-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">==</span> <span class="fu">round</span>(n_strong_cluster_vars))</span>
<span id="cb147-92"><a href="other-useful.html#cb147-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb147-93"><a href="other-useful.html#cb147-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_cluster_vars <span class="sc">&lt;=</span> cluster_size)</span>
<span id="cb147-94"><a href="other-useful.html#cb147-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-95"><a href="other-useful.html#cb147-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho_high) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb147-96"><a href="other-useful.html#cb147-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb147-97"><a href="other-useful.html#cb147-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_low <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb147-98"><a href="other-useful.html#cb147-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho_high) <span class="sc">&gt;=</span> <span class="fu">abs</span>(rho_low))</span>
<span id="cb147-99"><a href="other-useful.html#cb147-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb147-100"><a href="other-useful.html#cb147-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-101"><a href="other-useful.html#cb147-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb147-102"><a href="other-useful.html#cb147-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb147-103"><a href="other-useful.html#cb147-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-104"><a href="other-useful.html#cb147-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb147-105"><a href="other-useful.html#cb147-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb147-106"><a href="other-useful.html#cb147-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb147-107"><a href="other-useful.html#cb147-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb147-108"><a href="other-useful.html#cb147-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb147-109"><a href="other-useful.html#cb147-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-110"><a href="other-useful.html#cb147-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb147-111"><a href="other-useful.html#cb147-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb147-112"><a href="other-useful.html#cb147-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb147-113"><a href="other-useful.html#cb147-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb147-114"><a href="other-useful.html#cb147-114" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb147-115"><a href="other-useful.html#cb147-115" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-116"><a href="other-useful.html#cb147-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb147-117"><a href="other-useful.html#cb147-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(snr)){</span>
<span id="cb147-118"><a href="other-useful.html#cb147-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb147-119"><a href="other-useful.html#cb147-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-120"><a href="other-useful.html#cb147-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb147-121"><a href="other-useful.html#cb147-121" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb147-122"><a href="other-useful.html#cb147-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb147-123"><a href="other-useful.html#cb147-123" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>No tests for <code><a href='other-useful.html#checkGenClusteredDataWeightedInputs'>checkGenClusteredDataWeightedInputs</a>()</code></p>
<p><code><a href='other-useful.html#makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</a>()</code></p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="other-useful.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate covariance matrix for simulated clustered data</span></span>
<span id="cb148-2"><a href="other-useful.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb148-3"><a href="other-useful.html#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the total number of features in the covariance</span></span>
<span id="cb148-4"><a href="other-useful.html#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix to be created, including latent features, the associated noisy proxies</span></span>
<span id="cb148-5"><a href="other-useful.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with each latent feature, and other (weak signal and noise) features.</span></span>
<span id="cb148-6"><a href="other-useful.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_blocks Integer or numeric; the number of latent variables in the</span></span>
<span id="cb148-7"><a href="other-useful.html#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data, each of which is associated with an observed cluster in X. Must be at</span></span>
<span id="cb148-8"><a href="other-useful.html#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; least 1.</span></span>
<span id="cb148-9"><a href="other-useful.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb148-10"><a href="other-useful.html#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, the covariance matrix will include the original latent feature</span></span>
<span id="cb148-11"><a href="other-useful.html#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plus block_size - 1 noisy proxies that are correlated with the latent</span></span>
<span id="cb148-12"><a href="other-useful.html#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable.</span></span>
<span id="cb148-13"><a href="other-useful.html#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_strong_block_vars Integer or numeric; the number of proxies that</span></span>
<span id="cb148-14"><a href="other-useful.html#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have a high covariance (rho_high) with the corresponding latent </span></span>
<span id="cb148-15"><a href="other-useful.html#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features. (The remaining block_size - n_strong_block_vars cluster members</span></span>
<span id="cb148-16"><a href="other-useful.html#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have covariance rho_low with the latent feature.)</span></span>
<span id="cb148-17"><a href="other-useful.html#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_high Integer or numeric; the covariance of the &quot;strong proxies&quot; in</span></span>
<span id="cb148-18"><a href="other-useful.html#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb148-19"><a href="other-useful.html#cb148-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;strong proxy&quot; features in the cluster will be</span></span>
<span id="cb148-20"><a href="other-useful.html#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_high/var. rho_high cannot equal 0 and must be at least as large as</span></span>
<span id="cb148-21"><a href="other-useful.html#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low.</span></span>
<span id="cb148-22"><a href="other-useful.html#cb148-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_low Integer or numeric; the covariance of the &quot;weak proxies&quot; in</span></span>
<span id="cb148-23"><a href="other-useful.html#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each cluster with the latent variable (and each other). Note that the</span></span>
<span id="cb148-24"><a href="other-useful.html#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; correlation between the &quot;weak proxy&quot; features in the cluster will be</span></span>
<span id="cb148-25"><a href="other-useful.html#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; rho_low/var. rho_low cannot equal 0 and must be no larger than rho_high.</span></span>
<span id="cb148-26"><a href="other-useful.html#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb148-27"><a href="other-useful.html#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb148-28"><a href="other-useful.html#cb148-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). var cannot equal 0.</span></span>
<span id="cb148-29"><a href="other-useful.html#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A `p` x `p` numeric matrix representing the covariance matrix for</span></span>
<span id="cb148-30"><a href="other-useful.html#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent features, the associated proxies, and the remaining features. All</span></span>
<span id="cb148-31"><a href="other-useful.html#cb148-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features not in a block will be independent from each other and the blocks</span></span>
<span id="cb148-32"><a href="other-useful.html#cb148-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and have variance var.</span></span>
<span id="cb148-33"><a href="other-useful.html#cb148-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb148-34"><a href="other-useful.html#cb148-34" aria-hidden="true" tabindex="-1"></a><span id='makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, nblocks, block_size,</span>
<span id="cb148-35"><a href="other-useful.html#cb148-35" aria-hidden="true" tabindex="-1"></a>    n_strong_block_vars, rho_high, rho_low, var) {</span>
<span id="cb148-36"><a href="other-useful.html#cb148-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb148-37"><a href="other-useful.html#cb148-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-38"><a href="other-useful.html#cb148-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb148-39"><a href="other-useful.html#cb148-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_high <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb148-40"><a href="other-useful.html#cb148-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho_low <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb148-41"><a href="other-useful.html#cb148-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho_high) <span class="sc">&gt;=</span> <span class="fu">abs</span>(rho_low))</span>
<span id="cb148-42"><a href="other-useful.html#cb148-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb148-43"><a href="other-useful.html#cb148-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho_high) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb148-44"><a href="other-useful.html#cb148-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(block_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb148-45"><a href="other-useful.html#cb148-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> nblocks<span class="sc">*</span>block_size)</span>
<span id="cb148-46"><a href="other-useful.html#cb148-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_strong_block_vars <span class="sc">&lt;=</span> block_size)</span>
<span id="cb148-47"><a href="other-useful.html#cb148-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-48"><a href="other-useful.html#cb148-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># start with p x p identity matrix</span></span>
<span id="cb148-49"><a href="other-useful.html#cb148-49" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> var<span class="sc">*</span><span class="fu">diag</span>(p)</span>
<span id="cb148-50"><a href="other-useful.html#cb148-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-51"><a href="other-useful.html#cb148-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create matrix with nblocks rows, each containing a vector of</span></span>
<span id="cb148-52"><a href="other-useful.html#cb148-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># indices of highly correlated features</span></span>
<span id="cb148-53"><a href="other-useful.html#cb148-53" aria-hidden="true" tabindex="-1"></a>    block_feats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(nblocks<span class="sc">*</span>block_size), <span class="at">nrow=</span>nblocks, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb148-54"><a href="other-useful.html#cb148-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-55"><a href="other-useful.html#cb148-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(block_feats)) <span class="sc">==</span> <span class="fu">length</span>(block_feats))</span>
<span id="cb148-56"><a href="other-useful.html#cb148-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-57"><a href="other-useful.html#cb148-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add covariances of highly correlated features to sigma</span></span>
<span id="cb148-58"><a href="other-useful.html#cb148-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nblocks){</span>
<span id="cb148-59"><a href="other-useful.html#cb148-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(block_size <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb148-60"><a href="other-useful.html#cb148-60" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(k <span class="cf">in</span> (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>block_size){</span>
<span id="cb148-61"><a href="other-useful.html#cb148-61" aria-hidden="true" tabindex="-1"></a>                feat_1 <span class="ot">&lt;-</span> block_feats[i, j]</span>
<span id="cb148-62"><a href="other-useful.html#cb148-62" aria-hidden="true" tabindex="-1"></a>                feat_2 <span class="ot">&lt;-</span> block_feats[i, k]</span>
<span id="cb148-63"><a href="other-useful.html#cb148-63" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_1, feat_2] <span class="ot">&lt;-</span> rho_low</span>
<span id="cb148-64"><a href="other-useful.html#cb148-64" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_2, feat_1] <span class="ot">&lt;-</span> rho_low</span>
<span id="cb148-65"><a href="other-useful.html#cb148-65" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb148-66"><a href="other-useful.html#cb148-66" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb148-67"><a href="other-useful.html#cb148-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-68"><a href="other-useful.html#cb148-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(n_strong_block_vars <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb148-69"><a href="other-useful.html#cb148-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(k <span class="cf">in</span> (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>n_strong_block_vars){</span>
<span id="cb148-70"><a href="other-useful.html#cb148-70" aria-hidden="true" tabindex="-1"></a>                feat_1 <span class="ot">&lt;-</span> block_feats[i, j]</span>
<span id="cb148-71"><a href="other-useful.html#cb148-71" aria-hidden="true" tabindex="-1"></a>                feat_2 <span class="ot">&lt;-</span> block_feats[i, k]</span>
<span id="cb148-72"><a href="other-useful.html#cb148-72" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_1, feat_2] <span class="ot">&lt;-</span> rho_high</span>
<span id="cb148-73"><a href="other-useful.html#cb148-73" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_2, feat_1] <span class="ot">&lt;-</span> rho_high</span>
<span id="cb148-74"><a href="other-useful.html#cb148-74" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb148-75"><a href="other-useful.html#cb148-75" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb148-76"><a href="other-useful.html#cb148-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-77"><a href="other-useful.html#cb148-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-78"><a href="other-useful.html#cb148-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(Sigma))</span>
<span id="cb148-79"><a href="other-useful.html#cb148-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(Sigma))</span>
<span id="cb148-80"><a href="other-useful.html#cb148-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Sigma) <span class="sc">==</span> p <span class="sc">&amp;</span> <span class="fu">ncol</span>(Sigma) <span class="sc">==</span> p)</span>
<span id="cb148-81"><a href="other-useful.html#cb148-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(Sigma <span class="sc">==</span> <span class="fu">t</span>(Sigma)))</span>
<span id="cb148-82"><a href="other-useful.html#cb148-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-83"><a href="other-useful.html#cb148-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(Sigma)</span>
<span id="cb148-84"><a href="other-useful.html#cb148-84" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</a>()</code></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="other-useful.html#cb149-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;makeCovarianceMatrixWeighted works&quot;</span>, {</span>
<span id="cb149-2"><a href="other-useful.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb149-3"><a href="other-useful.html#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="other-useful.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrixWeighted'>makeCovarianceMatrixWeighted</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb149-5"><a href="other-useful.html#cb149-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">n_strong_block_vars=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="fl">0.8</span>,</span>
<span id="cb149-6"><a href="other-useful.html#cb149-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">rho_low=</span><span class="fl">0.2</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb149-7"><a href="other-useful.html#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="other-useful.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret))</span>
<span id="cb149-9"><a href="other-useful.html#cb149-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret))</span>
<span id="cb149-10"><a href="other-useful.html#cb149-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">8</span>)</span>
<span id="cb149-11"><a href="other-useful.html#cb149-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret), <span class="dv">8</span>)</span>
<span id="cb149-12"><a href="other-useful.html#cb149-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret <span class="sc">==</span> <span class="fu">t</span>(ret)))</span>
<span id="cb149-13"><a href="other-useful.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test on-diagonal and off-diagonal entries to see if they are as expected</span></span>
<span id="cb149-14"><a href="other-useful.html#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (only need to check top half of matrix; we already confirmed the matrix is</span></span>
<span id="cb149-15"><a href="other-useful.html#cb149-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># symmetric)</span></span>
<span id="cb149-16"><a href="other-useful.html#cb149-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">diag</span>(ret) <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb149-17"><a href="other-useful.html#cb149-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">2</span>], <span class="fl">0.8</span>)</span>
<span id="cb149-18"><a href="other-useful.html#cb149-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">3</span>], <span class="fl">0.2</span>)</span>
<span id="cb149-19"><a href="other-useful.html#cb149-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">2</span>, <span class="dv">3</span>], <span class="fl">0.2</span>)</span>
<span id="cb149-20"><a href="other-useful.html#cb149-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">5</span>], <span class="fl">0.8</span>)</span>
<span id="cb149-21"><a href="other-useful.html#cb149-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">6</span>], <span class="fl">0.2</span>)</span>
<span id="cb149-22"><a href="other-useful.html#cb149-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">5</span>, <span class="dv">6</span>], <span class="fl">0.2</span>)</span>
<span id="cb149-23"><a href="other-useful.html#cb149-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb149-24"><a href="other-useful.html#cb149-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb149-25"><a href="other-useful.html#cb149-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">7</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb149-26"><a href="other-useful.html#cb149-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb149-27"><a href="other-useful.html#cb149-27" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p>Tests for <code><a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>()</code></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="other-useful.html#cb151-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredDataWeighted works&quot;</span>, {</span>
<span id="cb151-2"><a href="other-useful.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb151-3"><a href="other-useful.html#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="other-useful.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb151-5"><a href="other-useful.html#cb151-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb151-6"><a href="other-useful.html#cb151-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="fl">3.99</span>, <span class="at">rho_low=</span><span class="dv">2</span>,</span>
<span id="cb151-7"><a href="other-useful.html#cb151-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb151-8"><a href="other-useful.html#cb151-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb151-9"><a href="other-useful.html#cb151-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-10"><a href="other-useful.html#cb151-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb151-11"><a href="other-useful.html#cb151-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb151-12"><a href="other-useful.html#cb151-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-13"><a href="other-useful.html#cb151-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb151-14"><a href="other-useful.html#cb151-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb151-15"><a href="other-useful.html#cb151-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb151-16"><a href="other-useful.html#cb151-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb151-17"><a href="other-useful.html#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb151-18"><a href="other-useful.html#cb151-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb151-19"><a href="other-useful.html#cb151-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb151-20"><a href="other-useful.html#cb151-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb151-21"><a href="other-useful.html#cb151-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb151-22"><a href="other-useful.html#cb151-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb151-23"><a href="other-useful.html#cb151-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb151-24"><a href="other-useful.html#cb151-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-25"><a href="other-useful.html#cb151-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb151-26"><a href="other-useful.html#cb151-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb151-27"><a href="other-useful.html#cb151-27" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb151-28"><a href="other-useful.html#cb151-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-29"><a href="other-useful.html#cb151-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">13</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb151-30"><a href="other-useful.html#cb151-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb151-31"><a href="other-useful.html#cb151-31" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb151-32"><a href="other-useful.html#cb151-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-33"><a href="other-useful.html#cb151-33" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb151-34"><a href="other-useful.html#cb151-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb151-35"><a href="other-useful.html#cb151-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-36"><a href="other-useful.html#cb151-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb151-37"><a href="other-useful.html#cb151-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb151-38"><a href="other-useful.html#cb151-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-39"><a href="other-useful.html#cb151-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb151-40"><a href="other-useful.html#cb151-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb151-41"><a href="other-useful.html#cb151-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb151-42"><a href="other-useful.html#cb151-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb151-43"><a href="other-useful.html#cb151-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-44"><a href="other-useful.html#cb151-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb151-45"><a href="other-useful.html#cb151-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb151-46"><a href="other-useful.html#cb151-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb151-47"><a href="other-useful.html#cb151-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb151-48"><a href="other-useful.html#cb151-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb151-49"><a href="other-useful.html#cb151-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-50"><a href="other-useful.html#cb151-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb151-51"><a href="other-useful.html#cb151-51" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb151-52"><a href="other-useful.html#cb151-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb151-53"><a href="other-useful.html#cb151-53" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="fl">3.99</span>, <span class="at">rho_low=</span><span class="dv">2</span>,</span>
<span id="cb151-54"><a href="other-useful.html#cb151-54" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb151-55"><a href="other-useful.html#cb151-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb151-56"><a href="other-useful.html#cb151-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-57"><a href="other-useful.html#cb151-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb151-58"><a href="other-useful.html#cb151-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb151-59"><a href="other-useful.html#cb151-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-60"><a href="other-useful.html#cb151-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb151-61"><a href="other-useful.html#cb151-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb151-62"><a href="other-useful.html#cb151-62" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb151-63"><a href="other-useful.html#cb151-63" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb151-64"><a href="other-useful.html#cb151-64" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho_high=</span><span class="fl">3.99</span>, <span class="at">rho_low=</span><span class="dv">2</span>,</span>
<span id="cb151-65"><a href="other-useful.html#cb151-65" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb151-66"><a href="other-useful.html#cb151-66" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb151-67"><a href="other-useful.html#cb151-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-68"><a href="other-useful.html#cb151-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb151-69"><a href="other-useful.html#cb151-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb151-70"><a href="other-useful.html#cb151-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-71"><a href="other-useful.html#cb151-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb151-72"><a href="other-useful.html#cb151-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb151-73"><a href="other-useful.html#cb151-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="fu">sqrt</span>(.<span class="dv">25</span>)))</span>
<span id="cb151-74"><a href="other-useful.html#cb151-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-75"><a href="other-useful.html#cb151-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb151-76"><a href="other-useful.html#cb151-76" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredDataWeighted'>genClusteredDataWeighted</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb151-77"><a href="other-useful.html#cb151-77" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">n_strong_cluster_vars=</span><span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb151-78"><a href="other-useful.html#cb151-78" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho_high=</span><span class="fl">3.99</span>, <span class="at">rho_low=</span><span class="dv">2</span>,</span>
<span id="cb151-79"><a href="other-useful.html#cb151-79" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb151-80"><a href="other-useful.html#cb151-80" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb151-81"><a href="other-useful.html#cb151-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-82"><a href="other-useful.html#cb151-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb151-83"><a href="other-useful.html#cb151-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb151-84"><a href="other-useful.html#cb151-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-85"><a href="other-useful.html#cb151-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb151-86"><a href="other-useful.html#cb151-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb151-87"><a href="other-useful.html#cb151-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb151-88"><a href="other-useful.html#cb151-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb151-89"><a href="other-useful.html#cb151-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-90"><a href="other-useful.html#cb151-90" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥳</code></pre>
<p><code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code>:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="other-useful.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get lambda value for lasso</span></span>
<span id="cb153-2"><a href="other-useful.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb153-3"><a href="other-useful.html#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Chooses a lambda value for the lasso used on a subsample of size n/2 (as in</span></span>
<span id="cb153-4"><a href="other-useful.html#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster stability selection) by cross-validation.</span></span>
<span id="cb153-5"><a href="other-useful.html#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb153-6"><a href="other-useful.html#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb153-7"><a href="other-useful.html#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors that will be used by cluster stability</span></span>
<span id="cb153-8"><a href="other-useful.html#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection.</span></span>
<span id="cb153-9"><a href="other-useful.html#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; an n-dimensional numeric or integer vector. (Unlike</span></span>
<span id="cb153-10"><a href="other-useful.html#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the more general css setup, this response must be real-valued since</span></span>
<span id="cb153-11"><a href="other-useful.html#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lambda will be determined using the lasso with cross-validation.)</span></span>
<span id="cb153-12"><a href="other-useful.html#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda_choice Character; either &quot;min&quot; or &quot;1se&quot;. If &quot;min&quot;, chooses</span></span>
<span id="cb153-13"><a href="other-useful.html#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the lambda that minimizes the cross-validated error; if &quot;1se&quot;, chooses the</span></span>
<span id="cb153-14"><a href="other-useful.html#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; largest lambda within one standard error of the minimum error lambda</span></span>
<span id="cb153-15"><a href="other-useful.html#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (resulting in a smaller selected set, which may be desirable because the</span></span>
<span id="cb153-16"><a href="other-useful.html#cb153-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size corresponding to the minimum error lambda tends to be larger</span></span>
<span id="cb153-17"><a href="other-useful.html#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than optimal. See, for example, Bühlmann and Meinshausen 2006, Prop. 1 and</span></span>
<span id="cb153-18"><a href="other-useful.html#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bühlmann and van de Geer 2011, Section 2.5.1.). Default is &quot;1se&quot;.</span></span>
<span id="cb153-19"><a href="other-useful.html#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nfolds Numeric or integer; the number of folds for cross-validation.</span></span>
<span id="cb153-20"><a href="other-useful.html#cb153-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 4 (as specified by cv.glmnet). Default is 10.</span></span>
<span id="cb153-21"><a href="other-useful.html#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric; the selected value of lambda.</span></span>
<span id="cb153-22"><a href="other-useful.html#cb153-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb153-23"><a href="other-useful.html#cb153-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Bühlmann, P., &amp; Meinshausen, N. (2006). High-Dimensional Graphs</span></span>
<span id="cb153-24"><a href="other-useful.html#cb153-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and Variable Selection With the Lasso. \emph{The Annals of Statistics},</span></span>
<span id="cb153-25"><a href="other-useful.html#cb153-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 34(3), 1436–1462. \url{https://doi.org/10.1214/009053606000000281}.</span></span>
<span id="cb153-26"><a href="other-useful.html#cb153-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \cr Peter Bühlmann and Sara van de Geer. Statistics for High-Dimensional</span></span>
<span id="cb153-27"><a href="other-useful.html#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Data. \emph{Springer Series in Statistics}. Springer, Heidelberg, 2011. ISBN</span></span>
<span id="cb153-28"><a href="other-useful.html#cb153-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 978-3-642-20191-2. \url{http://dx.doi.org/10.1007/978-3-642-20192-9}. \cr</span></span>
<span id="cb153-29"><a href="other-useful.html#cb153-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Jerome Friedman, Trevor Hastie, Robert Tibshirani (2010). Regularization</span></span>
<span id="cb153-30"><a href="other-useful.html#cb153-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Paths for Generalized Linear Models via Coordinate Descent. \emph{Journal of</span></span>
<span id="cb153-31"><a href="other-useful.html#cb153-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Software}, 33(1), 1-22. URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb153-32"><a href="other-useful.html#cb153-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb153-33"><a href="other-useful.html#cb153-33" aria-hidden="true" tabindex="-1"></a><span id='getLassoLambda'>getLassoLambda</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">10</span>){</span>
<span id="cb153-34"><a href="other-useful.html#cb153-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(lambda_choice))</span>
<span id="cb153-35"><a href="other-useful.html#cb153-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_choice) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb153-36"><a href="other-useful.html#cb153-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(lambda_choice))</span>
<span id="cb153-37"><a href="other-useful.html#cb153-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_choice <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>))</span>
<span id="cb153-38"><a href="other-useful.html#cb153-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-39"><a href="other-useful.html#cb153-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb153-40"><a href="other-useful.html#cb153-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb153-41"><a href="other-useful.html#cb153-41" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb153-42"><a href="other-useful.html#cb153-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-43"><a href="other-useful.html#cb153-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(nfolds) <span class="sc">|</span> <span class="fu">is.integer</span>(nfolds))</span>
<span id="cb153-44"><a href="other-useful.html#cb153-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(nfolds) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb153-45"><a href="other-useful.html#cb153-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">==</span> <span class="fu">round</span>(nfolds))</span>
<span id="cb153-46"><a href="other-useful.html#cb153-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb153-47"><a href="other-useful.html#cb153-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-48"><a href="other-useful.html#cb153-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since we are using the lasso, we require y to be a real-valued response</span></span>
<span id="cb153-49"><a href="other-useful.html#cb153-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (unlike for the general cluster stability selection procedure, where y</span></span>
<span id="cb153-50"><a href="other-useful.html#cb153-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># can have a more general format as long as a suitable feature selection</span></span>
<span id="cb153-51"><a href="other-useful.html#cb153-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function is provided by the user)</span></span>
<span id="cb153-52"><a href="other-useful.html#cb153-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb153-53"><a href="other-useful.html#cb153-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb153-54"><a href="other-useful.html#cb153-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-55"><a href="other-useful.html#cb153-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample size to use: inflate n/2 by a factor of nfolds/(nfolds - 1),</span></span>
<span id="cb153-56"><a href="other-useful.html#cb153-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># so that each individual lasso fit is of size floor(n/2)</span></span>
<span id="cb153-57"><a href="other-useful.html#cb153-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-58"><a href="other-useful.html#cb153-58" aria-hidden="true" tabindex="-1"></a>    n_sample <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>nfolds<span class="sc">/</span>(nfolds <span class="sc">-</span> <span class="dv">1</span>)), n)</span>
<span id="cb153-59"><a href="other-useful.html#cb153-59" aria-hidden="true" tabindex="-1"></a>    nfolds <span class="ot">&lt;-</span> <span class="fu">min</span>(nfolds, n_sample)</span>
<span id="cb153-60"><a href="other-useful.html#cb153-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-61"><a href="other-useful.html#cb153-61" aria-hidden="true" tabindex="-1"></a>    inds_size <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, n_sample)</span>
<span id="cb153-62"><a href="other-useful.html#cb153-62" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X[inds_size, ], <span class="at">y=</span>y[inds_size],</span>
<span id="cb153-63"><a href="other-useful.html#cb153-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="at">nfolds=</span>nfolds)</span>
<span id="cb153-64"><a href="other-useful.html#cb153-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-65"><a href="other-useful.html#cb153-65" aria-hidden="true" tabindex="-1"></a>    lambda_ret <span class="ot">&lt;-</span> size_results[[<span class="fu">paste</span>(<span class="st">&quot;lambda.&quot;</span>, lambda_choice, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)]]</span>
<span id="cb153-66"><a href="other-useful.html#cb153-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-67"><a href="other-useful.html#cb153-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb153-68"><a href="other-useful.html#cb153-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_ret) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb153-69"><a href="other-useful.html#cb153-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(lambda_ret) <span class="sc">|</span> <span class="fu">is.integer</span>(lambda_ret))</span>
<span id="cb153-70"><a href="other-useful.html#cb153-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb153-71"><a href="other-useful.html#cb153-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-72"><a href="other-useful.html#cb153-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(lambda_ret)</span>
<span id="cb153-73"><a href="other-useful.html#cb153-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getLassoLambda'>getLassoLambda</a>()</code>:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="other-useful.html#cb154-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getLassoLambda works&quot;</span>, {</span>
<span id="cb154-2"><a href="other-useful.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7252</span>)</span>
<span id="cb154-3"><a href="other-useful.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-4"><a href="other-useful.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb154-5"><a href="other-useful.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb154-6"><a href="other-useful.html#cb154-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-7"><a href="other-useful.html#cb154-7" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">4</span>)</span>
<span id="cb154-8"><a href="other-useful.html#cb154-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-9"><a href="other-useful.html#cb154-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb154-10"><a href="other-useful.html#cb154-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb154-11"><a href="other-useful.html#cb154-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb154-12"><a href="other-useful.html#cb154-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb154-13"><a href="other-useful.html#cb154-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-14"><a href="other-useful.html#cb154-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;min&quot;</span>, <span class="at">nfolds=</span><span class="dv">5</span>)</span>
<span id="cb154-15"><a href="other-useful.html#cb154-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-16"><a href="other-useful.html#cb154-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb154-17"><a href="other-useful.html#cb154-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb154-18"><a href="other-useful.html#cb154-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb154-19"><a href="other-useful.html#cb154-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb154-20"><a href="other-useful.html#cb154-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-21"><a href="other-useful.html#cb154-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb154-22"><a href="other-useful.html#cb154-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y), <span class="st">&quot;is.matrix(X) is not TRUE&quot;</span>,</span>
<span id="cb154-23"><a href="other-useful.html#cb154-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-24"><a href="other-useful.html#cb154-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-25"><a href="other-useful.html#cb154-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, ], <span class="at">y=</span>y),</span>
<span id="cb154-26"><a href="other-useful.html#cb154-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n == length(y) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-27"><a href="other-useful.html#cb154-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-28"><a href="other-useful.html#cb154-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">TRUE</span>),</span>
<span id="cb154-29"><a href="other-useful.html#cb154-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb154-30"><a href="other-useful.html#cb154-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-31"><a href="other-useful.html#cb154-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-32"><a href="other-useful.html#cb154-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb154-33"><a href="other-useful.html#cb154-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;mni&quot;</span>))</span>
<span id="cb154-34"><a href="other-useful.html#cb154-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-35"><a href="other-useful.html#cb154-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb154-36"><a href="other-useful.html#cb154-36" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">lambda_choice=</span><span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>)),</span>
<span id="cb154-37"><a href="other-useful.html#cb154-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(lambda_choice) == 1 is not TRUE&quot;</span>,</span>
<span id="cb154-38"><a href="other-useful.html#cb154-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-39"><a href="other-useful.html#cb154-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-40"><a href="other-useful.html#cb154-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="dv">1</span>),</span>
<span id="cb154-41"><a href="other-useful.html#cb154-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(lambda_choice) is not TRUE&quot;</span>,</span>
<span id="cb154-42"><a href="other-useful.html#cb154-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-43"><a href="other-useful.html#cb154-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-44"><a href="other-useful.html#cb154-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb154-45"><a href="other-useful.html#cb154-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(nfolds) | is.integer(nfolds) is not TRUE&quot;</span>,</span>
<span id="cb154-46"><a href="other-useful.html#cb154-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-47"><a href="other-useful.html#cb154-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-48"><a href="other-useful.html#cb154-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb154-49"><a href="other-useful.html#cb154-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(nfolds) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-50"><a href="other-useful.html#cb154-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-51"><a href="other-useful.html#cb154-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="fl">3.2</span>),</span>
<span id="cb154-52"><a href="other-useful.html#cb154-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds == round(nfolds) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-53"><a href="other-useful.html#cb154-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb154-54"><a href="other-useful.html#cb154-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">3</span>),</span>
<span id="cb154-55"><a href="other-useful.html#cb154-55" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds &gt; 3 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb154-56"><a href="other-useful.html#cb154-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-57"><a href="other-useful.html#cb154-57" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:7&#39;): getLassoLambda works ──────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;1se&quot;, nfolds = 4)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:14&#39;): getLassoLambda works ─────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;min&quot;, nfolds = 5)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p><code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code>:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="other-useful.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Automated estimation of model size</span></span>
<span id="cb156-2"><a href="other-useful.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb156-3"><a href="other-useful.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This function is uses the lasso with cross-validation to estimate the</span></span>
<span id="cb156-4"><a href="other-useful.html#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size. Before using the lasso, in each cluster all features will be</span></span>
<span id="cb156-5"><a href="other-useful.html#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropped from X except the one feature with the highest marginal correlation</span></span>
<span id="cb156-6"><a href="other-useful.html#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with y, as in the protolasso (Reid and Tibshirani 2016).</span></span>
<span id="cb156-7"><a href="other-useful.html#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb156-8"><a href="other-useful.html#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb156-9"><a href="other-useful.html#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb156-10"><a href="other-useful.html#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors.</span></span>
<span id="cb156-11"><a href="other-useful.html#cb156-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A length-n numeric vector containing the responses; `y[i]` is the</span></span>
<span id="cb156-12"><a href="other-useful.html#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response corresponding to observation `X[i, ]`. (Note that for the css</span></span>
<span id="cb156-13"><a href="other-useful.html#cb156-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function, y does not have to be a numeric response, but for this function,</span></span>
<span id="cb156-14"><a href="other-useful.html#cb156-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the underlying selection procedure is the lasso, so y must be a real-valued</span></span>
<span id="cb156-15"><a href="other-useful.html#cb156-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response.)</span></span>
<span id="cb156-16"><a href="other-useful.html#cb156-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb156-17"><a href="other-useful.html#cb156-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of css.</span></span>
<span id="cb156-18"><a href="other-useful.html#cb156-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb156-19"><a href="other-useful.html#cb156-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb156-20"><a href="other-useful.html#cb156-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb156-21"><a href="other-useful.html#cb156-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1). </span><span class="al">CAUTION</span><span class="co">: if the provided X is a data.frame that</span></span>
<span id="cb156-22"><a href="other-useful.html#cb156-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; contains a categorical feature with more than two levels, then the resulting</span></span>
<span id="cb156-23"><a href="other-useful.html#cb156-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix made from model.matrix will have a different number of columns than</span></span>
<span id="cb156-24"><a href="other-useful.html#cb156-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the provided data.frame, some of the feature numbers will change, and the</span></span>
<span id="cb156-25"><a href="other-useful.html#cb156-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters argument will not work properly (in the current version of the</span></span>
<span id="cb156-26"><a href="other-useful.html#cb156-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; package). To get correct results in this case, please use model.matrix to</span></span>
<span id="cb156-27"><a href="other-useful.html#cb156-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; convert the data.frame to a numeric matrix on your own, then provide this</span></span>
<span id="cb156-28"><a href="other-useful.html#cb156-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix and cluster assignments with respect to this matrix.</span></span>
<span id="cb156-29"><a href="other-useful.html#cb156-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer; the estimated size of the model. The minimum returned</span></span>
<span id="cb156-30"><a href="other-useful.html#cb156-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; value is 1, even if the lasso with cross-validation chose no features.</span></span>
<span id="cb156-31"><a href="other-useful.html#cb156-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb156-32"><a href="other-useful.html#cb156-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Reid, S., &amp; Tibshirani, R. (2016). Sparse regression and marginal</span></span>
<span id="cb156-33"><a href="other-useful.html#cb156-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testing using cluster prototypes. \emph{Biostatistics}, 17(2), 364–376.</span></span>
<span id="cb156-34"><a href="other-useful.html#cb156-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1093/biostatistics/kxv049}.</span></span>
<span id="cb156-35"><a href="other-useful.html#cb156-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb156-36"><a href="other-useful.html#cb156-36" aria-hidden="true" tabindex="-1"></a><span id='getModelSize'>getModelSize</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, clusters){</span>
<span id="cb156-37"><a href="other-useful.html#cb156-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-38"><a href="other-useful.html#cb156-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X) <span class="sc">|</span> <span class="fu">is.data.frame</span>(X))</span>
<span id="cb156-39"><a href="other-useful.html#cb156-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-40"><a href="other-useful.html#cb156-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb156-41"><a href="other-useful.html#cb156-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(X)){</span>
<span id="cb156-42"><a href="other-useful.html#cb156-42" aria-hidden="true" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(X)</span>
<span id="cb156-43"><a href="other-useful.html#cb156-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-44"><a href="other-useful.html#cb156-44" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X)</span>
<span id="cb156-45"><a href="other-useful.html#cb156-45" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> X[, <span class="fu">colnames</span>(X) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb156-46"><a href="other-useful.html#cb156-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-47"><a href="other-useful.html#cb156-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> (p <span class="sc">!=</span> <span class="fu">ncol</span>(X))){</span>
<span id="cb156-48"><a href="other-useful.html#cb156-48" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;When stats::model.matrix converted the provided data.frame X to a matrix, the number of columns changed (probably because the provided data.frame contained a factor variable with at least three levels). Please convert X to a matrix yourself using model.matrix and provide cluster assignments according to the columns of the new matrix.&quot;</span>)</span>
<span id="cb156-49"><a href="other-useful.html#cb156-49" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb156-50"><a href="other-useful.html#cb156-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-51"><a href="other-useful.html#cb156-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-52"><a href="other-useful.html#cb156-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb156-53"><a href="other-useful.html#cb156-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X)))</span>
<span id="cb156-54"><a href="other-useful.html#cb156-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb156-55"><a href="other-useful.html#cb156-55" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb156-56"><a href="other-useful.html#cb156-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-57"><a href="other-useful.html#cb156-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since the model size will be determined by cross-validation, the provided</span></span>
<span id="cb156-58"><a href="other-useful.html#cb156-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y must be real-valued (this should be checked internally in other</span></span>
<span id="cb156-59"><a href="other-useful.html#cb156-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># functions before getModelSize is called, but this check is here just in</span></span>
<span id="cb156-60"><a href="other-useful.html#cb156-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case).</span></span>
<span id="cb156-61"><a href="other-useful.html#cb156-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(y)){</span>
<span id="cb156-62"><a href="other-useful.html#cb156-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>)</span>
<span id="cb156-63"><a href="other-useful.html#cb156-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-64"><a href="other-useful.html#cb156-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb156-65"><a href="other-useful.html#cb156-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-66"><a href="other-useful.html#cb156-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check clusters argument</span></span>
<span id="cb156-67"><a href="other-useful.html#cb156-67" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#checkCssClustersInput'>checkCssClustersInput</a>(clusters)</span>
<span id="cb156-68"><a href="other-useful.html#cb156-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-69"><a href="other-useful.html#cb156-69" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Format clusters into a list where all features are in exactly one</span></span>
<span id="cb156-70"><a href="other-useful.html#cb156-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster (any unclustered features are put in their own &quot;cluster&quot; of size</span></span>
<span id="cb156-71"><a href="other-useful.html#cb156-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1).</span></span>
<span id="cb156-72"><a href="other-useful.html#cb156-72" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb156-73"><a href="other-useful.html#cb156-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">is.list</span>(clusters)){</span>
<span id="cb156-74"><a href="other-useful.html#cb156-74" aria-hidden="true" tabindex="-1"></a>        clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb156-75"><a href="other-useful.html#cb156-75" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-76"><a href="other-useful.html#cb156-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-77"><a href="other-useful.html#cb156-77" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='css.html#formatClusters'>formatClusters</a>(clusters, <span class="at">p=</span><span class="fu">ncol</span>(X),</span>
<span id="cb156-78"><a href="other-useful.html#cb156-78" aria-hidden="true" tabindex="-1"></a>        <span class="at">clust_names=</span>clust_names)<span class="sc">$</span>clusters</span>
<span id="cb156-79"><a href="other-useful.html#cb156-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-80"><a href="other-useful.html#cb156-80" aria-hidden="true" tabindex="-1"></a>    X_size <span class="ot">&lt;-</span> X</span>
<span id="cb156-81"><a href="other-useful.html#cb156-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-82"><a href="other-useful.html#cb156-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb156-83"><a href="other-useful.html#cb156-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create modified design matrix by dropping all but one feature from</span></span>
<span id="cb156-84"><a href="other-useful.html#cb156-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># each cluster</span></span>
<span id="cb156-85"><a href="other-useful.html#cb156-85" aria-hidden="true" tabindex="-1"></a>        feats_to_drop <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb156-86"><a href="other-useful.html#cb156-86" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb156-87"><a href="other-useful.html#cb156-87" aria-hidden="true" tabindex="-1"></a>            cluster_i <span class="ot">&lt;-</span> clusters[[i]]</span>
<span id="cb156-88"><a href="other-useful.html#cb156-88" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(cluster_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb156-89"><a href="other-useful.html#cb156-89" aria-hidden="true" tabindex="-1"></a>                feat_to_keep <span class="ot">&lt;-</span> <a href='css.html#identifyPrototype'>identifyPrototype</a>(cluster_i, X, y)</span>
<span id="cb156-90"><a href="other-useful.html#cb156-90" aria-hidden="true" tabindex="-1"></a>                feats_to_drop <span class="ot">&lt;-</span> <span class="fu">c</span>(feats_to_drop, <span class="fu">setdiff</span>(cluster_i,</span>
<span id="cb156-91"><a href="other-useful.html#cb156-91" aria-hidden="true" tabindex="-1"></a>                    feat_to_keep))</span>
<span id="cb156-92"><a href="other-useful.html#cb156-92" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb156-93"><a href="other-useful.html#cb156-93" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb156-94"><a href="other-useful.html#cb156-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(feats_to_drop) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb156-95"><a href="other-useful.html#cb156-95" aria-hidden="true" tabindex="-1"></a>            X_size <span class="ot">&lt;-</span> X_size[, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>feats_to_drop]</span>
<span id="cb156-96"><a href="other-useful.html#cb156-96" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb156-97"><a href="other-useful.html#cb156-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb156-98"><a href="other-useful.html#cb156-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-99"><a href="other-useful.html#cb156-99" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X_size, <span class="at">y=</span>y, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb156-100"><a href="other-useful.html#cb156-100" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(glmnet<span class="sc">::</span><span class="fu">coef.glmnet</span>(size_results, <span class="at">s=</span><span class="st">&quot;lambda.1se&quot;</span>))</span>
<span id="cb156-101"><a href="other-useful.html#cb156-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-102"><a href="other-useful.html#cb156-102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of nonzero coefficients (subtract one in order to ignore intercept)</span></span>
<span id="cb156-103"><a href="other-useful.html#cb156-103" aria-hidden="true" tabindex="-1"></a>    size <span class="ot">&lt;-</span> <span class="fu">length</span>(coefs[coefs <span class="sc">!=</span> <span class="dv">0</span>]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb156-104"><a href="other-useful.html#cb156-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-105"><a href="other-useful.html#cb156-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb156-106"><a href="other-useful.html#cb156-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(size) <span class="sc">|</span> <span class="fu">is.integer</span>(size))</span>
<span id="cb156-107"><a href="other-useful.html#cb156-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(size))</span>
<span id="cb156-108"><a href="other-useful.html#cb156-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(size) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb156-109"><a href="other-useful.html#cb156-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(size <span class="sc">==</span> <span class="fu">round</span>(size))</span>
<span id="cb156-110"><a href="other-useful.html#cb156-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-111"><a href="other-useful.html#cb156-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.integer</span>(<span class="fu">max</span>(size, <span class="dv">1</span>)))</span>
<span id="cb156-112"><a href="other-useful.html#cb156-112" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getModelSize'>getModelSize</a>()</code>:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="other-useful.html#cb157-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getModelSize works&quot;</span>, {</span>
<span id="cb157-2"><a href="other-useful.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1723</span>)</span>
<span id="cb157-3"><a href="other-useful.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-4"><a href="other-useful.html#cb157-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb157-5"><a href="other-useful.html#cb157-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb157-6"><a href="other-useful.html#cb157-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-7"><a href="other-useful.html#cb157-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb157-8"><a href="other-useful.html#cb157-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb157-9"><a href="other-useful.html#cb157-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-10"><a href="other-useful.html#cb157-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb157-11"><a href="other-useful.html#cb157-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-12"><a href="other-useful.html#cb157-12" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb157-13"><a href="other-useful.html#cb157-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-14"><a href="other-useful.html#cb157-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb157-15"><a href="other-useful.html#cb157-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb157-16"><a href="other-useful.html#cb157-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb157-17"><a href="other-useful.html#cb157-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb157-18"><a href="other-useful.html#cb157-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb157-19"><a href="other-useful.html#cb157-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but two clusters of size 3, so maximum size should</span></span>
<span id="cb157-20"><a href="other-useful.html#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 2 = 7</span></span>
<span id="cb157-21"><a href="other-useful.html#cb157-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb157-22"><a href="other-useful.html#cb157-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-23"><a href="other-useful.html#cb157-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb157-24"><a href="other-useful.html#cb157-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-25"><a href="other-useful.html#cb157-25" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb157-26"><a href="other-useful.html#cb157-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-27"><a href="other-useful.html#cb157-27" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>unnamed_clusters)</span>
<span id="cb157-28"><a href="other-useful.html#cb157-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-29"><a href="other-useful.html#cb157-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb157-30"><a href="other-useful.html#cb157-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb157-31"><a href="other-useful.html#cb157-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb157-32"><a href="other-useful.html#cb157-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb157-33"><a href="other-useful.html#cb157-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb157-34"><a href="other-useful.html#cb157-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb157-35"><a href="other-useful.html#cb157-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb157-36"><a href="other-useful.html#cb157-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb157-37"><a href="other-useful.html#cb157-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-38"><a href="other-useful.html#cb157-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb157-39"><a href="other-useful.html#cb157-39" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb157-40"><a href="other-useful.html#cb157-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-41"><a href="other-useful.html#cb157-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb157-42"><a href="other-useful.html#cb157-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb157-43"><a href="other-useful.html#cb157-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb157-44"><a href="other-useful.html#cb157-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb157-45"><a href="other-useful.html#cb157-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb157-46"><a href="other-useful.html#cb157-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 4 in one cluster, so maximum size should be 11 - 3 = 8</span></span>
<span id="cb157-47"><a href="other-useful.html#cb157-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb157-48"><a href="other-useful.html#cb157-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-49"><a href="other-useful.html#cb157-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-50"><a href="other-useful.html#cb157-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb157-51"><a href="other-useful.html#cb157-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb157-52"><a href="other-useful.html#cb157-52" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb157-53"><a href="other-useful.html#cb157-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-54"><a href="other-useful.html#cb157-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb157-55"><a href="other-useful.html#cb157-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-56"><a href="other-useful.html#cb157-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb157-57"><a href="other-useful.html#cb157-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb157-58"><a href="other-useful.html#cb157-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb157-59"><a href="other-useful.html#cb157-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb157-60"><a href="other-useful.html#cb157-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb157-61"><a href="other-useful.html#cb157-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb157-62"><a href="other-useful.html#cb157-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb157-63"><a href="other-useful.html#cb157-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb157-64"><a href="other-useful.html#cb157-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-65"><a href="other-useful.html#cb157-65" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb157-66"><a href="other-useful.html#cb157-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-67"><a href="other-useful.html#cb157-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb157-68"><a href="other-useful.html#cb157-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.matrix(X) | is.data.frame(X) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-69"><a href="other-useful.html#cb157-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-70"><a href="other-useful.html#cb157-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ], <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb157-71"><a href="other-useful.html#cb157-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(y) == n is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-72"><a href="other-useful.html#cb157-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-73"><a href="other-useful.html#cb157-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">FALSE</span>, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb157-74"><a href="other-useful.html#cb157-74" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>,</span>
<span id="cb157-75"><a href="other-useful.html#cb157-75" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-76"><a href="other-useful.html#cb157-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-77"><a href="other-useful.html#cb157-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)),</span>
<span id="cb157-78"><a href="other-useful.html#cb157-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: 1, 2.&quot;</span>,</span>
<span id="cb157-79"><a href="other-useful.html#cb157-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-80"><a href="other-useful.html#cb157-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-81"><a href="other-useful.html#cb157-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)),</span>
<span id="cb157-82"><a href="other-useful.html#cb157-82" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb157-83"><a href="other-useful.html#cb157-83" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-84"><a href="other-useful.html#cb157-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-85"><a href="other-useful.html#cb157-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb157-86"><a href="other-useful.html#cb157-86" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb157-87"><a href="other-useful.html#cb157-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-88"><a href="other-useful.html#cb157-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-89"><a href="other-useful.html#cb157-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb157-90"><a href="other-useful.html#cb157-90" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>))),</span>
<span id="cb157-91"><a href="other-useful.html#cb157-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(clusters) are not all TRUE&quot;</span>,</span>
<span id="cb157-92"><a href="other-useful.html#cb157-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-93"><a href="other-useful.html#cb157-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-94"><a href="other-useful.html#cb157-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))),</span>
<span id="cb157-95"><a href="other-useful.html#cb157-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb157-96"><a href="other-useful.html#cb157-96" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-97"><a href="other-useful.html#cb157-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-98"><a href="other-useful.html#cb157-98" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb157-99"><a href="other-useful.html#cb157-99" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb157-100"><a href="other-useful.html#cb157-100" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-101"><a href="other-useful.html#cb157-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-102"><a href="other-useful.html#cb157-102" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb157-103"><a href="other-useful.html#cb157-103" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>))),</span>
<span id="cb157-104"><a href="other-useful.html#cb157-104" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] == round(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb157-105"><a href="other-useful.html#cb157-105" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb157-106"><a href="other-useful.html#cb157-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-107"><a href="other-useful.html#cb157-107" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:12&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:27&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = unnamed_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:39&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = 2:5)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:54&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p><code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code>:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="other-useful.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Prepares a data.frame summarazing cluster stability selection output to print</span></span>
<span id="cb159-2"><a href="other-useful.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb159-3"><a href="other-useful.html#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function.</span></span>
<span id="cb159-4"><a href="other-useful.html#cb159-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb159-5"><a href="other-useful.html#cb159-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb159-6"><a href="other-useful.html#cb159-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; the outputted data.frame will display only those</span></span>
<span id="cb159-7"><a href="other-useful.html#cb159-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb159-8"><a href="other-useful.html#cb159-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb159-9"><a href="other-useful.html#cb159-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb159-10"><a href="other-useful.html#cb159-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb159-11"><a href="other-useful.html#cb159-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb159-12"><a href="other-useful.html#cb159-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb159-13"><a href="other-useful.html#cb159-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb159-14"><a href="other-useful.html#cb159-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb159-15"><a href="other-useful.html#cb159-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb159-16"><a href="other-useful.html#cb159-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb159-17"><a href="other-useful.html#cb159-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb159-18"><a href="other-useful.html#cb159-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb159-19"><a href="other-useful.html#cb159-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb159-20"><a href="other-useful.html#cb159-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb159-21"><a href="other-useful.html#cb159-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb159-22"><a href="other-useful.html#cb159-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb159-23"><a href="other-useful.html#cb159-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb159-24"><a href="other-useful.html#cb159-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb159-25"><a href="other-useful.html#cb159-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb159-26"><a href="other-useful.html#cb159-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb159-27"><a href="other-useful.html#cb159-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb159-28"><a href="other-useful.html#cb159-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb159-29"><a href="other-useful.html#cb159-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb159-30"><a href="other-useful.html#cb159-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb159-31"><a href="other-useful.html#cb159-31" aria-hidden="true" tabindex="-1"></a><span id='printCssDf'>printCssDf</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb159-32"><a href="other-useful.html#cb159-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_num_clusts=</span><span class="cn">NA</span>){</span>
<span id="cb159-33"><a href="other-useful.html#cb159-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb159-34"><a href="other-useful.html#cb159-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb159-35"><a href="other-useful.html#cb159-35" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb159-36"><a href="other-useful.html#cb159-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-37"><a href="other-useful.html#cb159-37" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb159-38"><a href="other-useful.html#cb159-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-39"><a href="other-useful.html#cb159-39" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb159-40"><a href="other-useful.html#cb159-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-41"><a href="other-useful.html#cb159-41" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb159-42"><a href="other-useful.html#cb159-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb159-43"><a href="other-useful.html#cb159-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-44"><a href="other-useful.html#cb159-44" aria-hidden="true" tabindex="-1"></a>    sel_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_results, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb159-45"><a href="other-useful.html#cb159-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts,</span>
<span id="cb159-46"><a href="other-useful.html#cb159-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">max_num_clusts=</span>max_num_clusts)<span class="sc">$</span>selected_clusts</span>
<span id="cb159-47"><a href="other-useful.html#cb159-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-48"><a href="other-useful.html#cb159-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sel_clusts is guaranteed to have length at least 1 by</span></span>
<span id="cb159-49"><a href="other-useful.html#cb159-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getCssSelections </span></span>
<span id="cb159-50"><a href="other-useful.html#cb159-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-51"><a href="other-useful.html#cb159-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get prototypes (feature from each cluster with highest selection</span></span>
<span id="cb159-52"><a href="other-useful.html#cb159-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># proportion, breaking ties by using marginal correlations of features with</span></span>
<span id="cb159-53"><a href="other-useful.html#cb159-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y from data provided to css if y is real-valued)</span></span>
<span id="cb159-54"><a href="other-useful.html#cb159-54" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, sel_clusts)</span>
<span id="cb159-55"><a href="other-useful.html#cb159-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-56"><a href="other-useful.html#cb159-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cluster selection proportions</span></span>
<span id="cb159-57"><a href="other-useful.html#cb159-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(sel_clusts) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb159-58"><a href="other-useful.html#cb159-58" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb159-59"><a href="other-useful.html#cb159-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb159-60"><a href="other-useful.html#cb159-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb159-61"><a href="other-useful.html#cb159-61" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">mean</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb159-62"><a href="other-useful.html#cb159-62" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb159-63"><a href="other-useful.html#cb159-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb159-64"><a href="other-useful.html#cb159-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-65"><a href="other-useful.html#cb159-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data.frame: name of cluster, cluster prototype, selection proportion,</span></span>
<span id="cb159-66"><a href="other-useful.html#cb159-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster size</span></span>
<span id="cb159-67"><a href="other-useful.html#cb159-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-68"><a href="other-useful.html#cb159-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(prototypes))){</span>
<span id="cb159-69"><a href="other-useful.html#cb159-69" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb159-70"><a href="other-useful.html#cb159-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoName=</span><span class="fu">names</span>(prototypes), <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes),</span>
<span id="cb159-71"><a href="other-useful.html#cb159-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSelProp=</span>sel_clust_sel_props, <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb159-72"><a href="other-useful.html#cb159-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb159-73"><a href="other-useful.html#cb159-73" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb159-74"><a href="other-useful.html#cb159-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes), <span class="at">ClustSelProp=</span>sel_clust_sel_props,</span>
<span id="cb159-75"><a href="other-useful.html#cb159-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb159-76"><a href="other-useful.html#cb159-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb159-77"><a href="other-useful.html#cb159-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-78"><a href="other-useful.html#cb159-78" aria-hidden="true" tabindex="-1"></a>    print_df <span class="ot">&lt;-</span> print_df[<span class="fu">order</span>(print_df<span class="sc">$</span>ClustSelProp, <span class="at">decreasing=</span><span class="cn">TRUE</span>), ]</span>
<span id="cb159-79"><a href="other-useful.html#cb159-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-80"><a href="other-useful.html#cb159-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(print_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb159-81"><a href="other-useful.html#cb159-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb159-82"><a href="other-useful.html#cb159-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(print_df))</span>
<span id="cb159-83"><a href="other-useful.html#cb159-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(print_df) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb159-84"><a href="other-useful.html#cb159-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-85"><a href="other-useful.html#cb159-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(print_df)</span>
<span id="cb159-86"><a href="other-useful.html#cb159-86" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="other-useful.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Identify selection prototypes from selected clusters</span></span>
<span id="cb160-2"><a href="other-useful.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb160-3"><a href="other-useful.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in list of selected clusters and returns an integer vector of the</span></span>
<span id="cb160-4"><a href="other-useful.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features that were most frequently selected from each cluster</span></span>
<span id="cb160-5"><a href="other-useful.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb160-6"><a href="other-useful.html#cb160-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb160-7"><a href="other-useful.html#cb160-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb160-8"><a href="other-useful.html#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected_clusts A list of integer vectors; each vector must contain</span></span>
<span id="cb160-9"><a href="other-useful.html#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the indices of features in a cluster.</span></span>
<span id="cb160-10"><a href="other-useful.html#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector (of length equal to the number of clusters) of the</span></span>
<span id="cb160-11"><a href="other-useful.html#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the feature prototypes (the features from each cluster that were</span></span>
<span id="cb160-12"><a href="other-useful.html#cb160-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected the most often individually by the base method in cluster stability</span></span>
<span id="cb160-13"><a href="other-useful.html#cb160-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection). In the case of a tie, the tie is broken by choosing the feature</span></span>
<span id="cb160-14"><a href="other-useful.html#cb160-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; most correlated with the response in the full data set provided to css.</span></span>
<span id="cb160-15"><a href="other-useful.html#cb160-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb160-16"><a href="other-useful.html#cb160-16" aria-hidden="true" tabindex="-1"></a><span id='getSelectionPrototypes'>getSelectionPrototypes</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, selected_clusts){</span>
<span id="cb160-17"><a href="other-useful.html#cb160-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb160-18"><a href="other-useful.html#cb160-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb160-19"><a href="other-useful.html#cb160-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb160-20"><a href="other-useful.html#cb160-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-21"><a href="other-useful.html#cb160-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(selected_clusts))</span>
<span id="cb160-22"><a href="other-useful.html#cb160-22" aria-hidden="true" tabindex="-1"></a>    n_selected_clusts <span class="ot">&lt;-</span> <span class="fu">length</span>(selected_clusts)</span>
<span id="cb160-23"><a href="other-useful.html#cb160-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_selected_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb160-24"><a href="other-useful.html#cb160-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb160-25"><a href="other-useful.html#cb160-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-26"><a href="other-useful.html#cb160-26" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.integer</span>(<span class="cn">NA</span>), n_selected_clusts)</span>
<span id="cb160-27"><a href="other-useful.html#cb160-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_selected_clusts){</span>
<span id="cb160-28"><a href="other-useful.html#cb160-28" aria-hidden="true" tabindex="-1"></a>        clust_i <span class="ot">&lt;-</span> selected_clusts[[i]]</span>
<span id="cb160-29"><a href="other-useful.html#cb160-29" aria-hidden="true" tabindex="-1"></a>        sel_props_i <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[clust_i]</span>
<span id="cb160-30"><a href="other-useful.html#cb160-30" aria-hidden="true" tabindex="-1"></a>        proto_i <span class="ot">&lt;-</span> clust_i[sel_props_i <span class="sc">==</span> <span class="fu">max</span>(sel_props_i)]</span>
<span id="cb160-31"><a href="other-useful.html#cb160-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb160-32"><a href="other-useful.html#cb160-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb160-33"><a href="other-useful.html#cb160-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">is.numeric</span>(css_results<span class="sc">$</span>y) <span class="sc">|</span> <span class="fu">is.integer</span>(css_results<span class="sc">$</span>y)){</span>
<span id="cb160-34"><a href="other-useful.html#cb160-34" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Break tie by looking at marginal correlations</span></span>
<span id="cb160-35"><a href="other-useful.html#cb160-35" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">cor</span>(css_results<span class="sc">$</span>X[, proto_i], css_results<span class="sc">$</span>y)[, <span class="dv">1</span>]</span>
<span id="cb160-36"><a href="other-useful.html#cb160-36" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> <span class="fu">abs</span>(corrs_i)</span>
<span id="cb160-37"><a href="other-useful.html#cb160-37" aria-hidden="true" tabindex="-1"></a>                proto_i <span class="ot">&lt;-</span> proto_i[corrs_i <span class="sc">==</span> <span class="fu">max</span>(corrs_i)]</span>
<span id="cb160-38"><a href="other-useful.html#cb160-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb160-39"><a href="other-useful.html#cb160-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb160-40"><a href="other-useful.html#cb160-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If there is still a tie, break by choosing the first feature of those</span></span>
<span id="cb160-41"><a href="other-useful.html#cb160-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remaining</span></span>
<span id="cb160-42"><a href="other-useful.html#cb160-42" aria-hidden="true" tabindex="-1"></a>        prototypes[i] <span class="ot">&lt;-</span> proto_i[<span class="dv">1</span>]</span>
<span id="cb160-43"><a href="other-useful.html#cb160-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(prototypes)[i] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(css_results<span class="sc">$</span>X)[proto_i]</span>
<span id="cb160-44"><a href="other-useful.html#cb160-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb160-45"><a href="other-useful.html#cb160-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-46"><a href="other-useful.html#cb160-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb160-47"><a href="other-useful.html#cb160-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-48"><a href="other-useful.html#cb160-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(prototypes))</span>
<span id="cb160-49"><a href="other-useful.html#cb160-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(prototypes)))</span>
<span id="cb160-50"><a href="other-useful.html#cb160-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(prototypes)))</span>
<span id="cb160-51"><a href="other-useful.html#cb160-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-52"><a href="other-useful.html#cb160-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(prototypes)</span>
<span id="cb160-53"><a href="other-useful.html#cb160-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>()</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="other-useful.html#cb161-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getSelectionPrototypes works&quot;</span>, {</span>
<span id="cb161-2"><a href="other-useful.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb161-3"><a href="other-useful.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-4"><a href="other-useful.html#cb161-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb161-5"><a href="other-useful.html#cb161-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb161-6"><a href="other-useful.html#cb161-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-7"><a href="other-useful.html#cb161-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb161-8"><a href="other-useful.html#cb161-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb161-9"><a href="other-useful.html#cb161-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-10"><a href="other-useful.html#cb161-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb161-11"><a href="other-useful.html#cb161-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-12"><a href="other-useful.html#cb161-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb161-13"><a href="other-useful.html#cb161-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-14"><a href="other-useful.html#cb161-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="at">selected_clusts=</span>good_clusters)</span>
<span id="cb161-15"><a href="other-useful.html#cb161-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-16"><a href="other-useful.html#cb161-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb161-17"><a href="other-useful.html#cb161-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret)))</span>
<span id="cb161-18"><a href="other-useful.html#cb161-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(good_clusters))</span>
<span id="cb161-19"><a href="other-useful.html#cb161-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(<span class="fu">unique</span>(ret)))</span>
<span id="cb161-20"><a href="other-useful.html#cb161-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ret)){</span>
<span id="cb161-21"><a href="other-useful.html#cb161-21" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[i] <span class="sc">%in%</span> good_clusters[[i]])</span>
<span id="cb161-22"><a href="other-useful.html#cb161-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the largest selection proportion of any feature in cluster i</span></span>
<span id="cb161-23"><a href="other-useful.html#cb161-23" aria-hidden="true" tabindex="-1"></a>    max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, good_clusters[[i]]]))</span>
<span id="cb161-24"><a href="other-useful.html#cb161-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb161-25"><a href="other-useful.html#cb161-25" aria-hidden="true" tabindex="-1"></a>    proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret[i]]</span>
<span id="cb161-26"><a href="other-useful.html#cb161-26" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb161-27"><a href="other-useful.html#cb161-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-28"><a href="other-useful.html#cb161-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb161-29"><a href="other-useful.html#cb161-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try with only one selected cluster (still should be in a list)</span></span>
<span id="cb161-30"><a href="other-useful.html#cb161-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-31"><a href="other-useful.html#cb161-31" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb161-32"><a href="other-useful.html#cb161-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">selected_clusts=</span><span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L))</span>
<span id="cb161-33"><a href="other-useful.html#cb161-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-34"><a href="other-useful.html#cb161-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb161-35"><a href="other-useful.html#cb161-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb161-36"><a href="other-useful.html#cb161-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb161-37"><a href="other-useful.html#cb161-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb161-38"><a href="other-useful.html#cb161-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the largest selection proportion of any feature in the cluster</span></span>
<span id="cb161-39"><a href="other-useful.html#cb161-39" aria-hidden="true" tabindex="-1"></a>  max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, 1L<span class="sc">:</span>3L]))</span>
<span id="cb161-40"><a href="other-useful.html#cb161-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb161-41"><a href="other-useful.html#cb161-41" aria-hidden="true" tabindex="-1"></a>  proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret]</span>
<span id="cb161-42"><a href="other-useful.html#cb161-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb161-43"><a href="other-useful.html#cb161-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-44"><a href="other-useful.html#cb161-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb161-45"><a href="other-useful.html#cb161-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-46"><a href="other-useful.html#cb161-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error contains quotation marks</span></span>
<span id="cb161-47"><a href="other-useful.html#cb161-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(x, good_clusters))</span>
<span id="cb161-48"><a href="other-useful.html#cb161-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-49"><a href="other-useful.html#cb161-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, 1L<span class="sc">:</span>3L),</span>
<span id="cb161-50"><a href="other-useful.html#cb161-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(selected_clusts) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb161-51"><a href="other-useful.html#cb161-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-52"><a href="other-useful.html#cb161-52" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="fu">list</span>()),</span>
<span id="cb161-53"><a href="other-useful.html#cb161-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_selected_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb161-54"><a href="other-useful.html#cb161-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-55"><a href="other-useful.html#cb161-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb161-56"><a href="other-useful.html#cb161-56" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L,</span>
<span id="cb161-57"><a href="other-useful.html#cb161-57" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L,</span>
<span id="cb161-58"><a href="other-useful.html#cb161-58" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">bad_cluster=</span><span class="fu">integer</span>())),</span>
<span id="cb161-59"><a href="other-useful.html#cb161-59" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(selected_clusts) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb161-60"><a href="other-useful.html#cb161-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb161-61"><a href="other-useful.html#cb161-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-62"><a href="other-useful.html#cb161-62" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>Tests for <code><a href='other-useful.html#printCssDf'>printCssDf</a>()</code>:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="other-useful.html#cb163-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;printCssDf works&quot;</span>, {</span>
<span id="cb163-2"><a href="other-useful.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb163-3"><a href="other-useful.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-4"><a href="other-useful.html#cb163-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb163-5"><a href="other-useful.html#cb163-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb163-6"><a href="other-useful.html#cb163-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-7"><a href="other-useful.html#cb163-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb163-8"><a href="other-useful.html#cb163-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb163-9"><a href="other-useful.html#cb163-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-10"><a href="other-useful.html#cb163-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb163-11"><a href="other-useful.html#cb163-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-12"><a href="other-useful.html#cb163-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb163-13"><a href="other-useful.html#cb163-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-14"><a href="other-useful.html#cb163-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results)</span>
<span id="cb163-15"><a href="other-useful.html#cb163-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-16"><a href="other-useful.html#cb163-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-17"><a href="other-useful.html#cb163-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb163-18"><a href="other-useful.html#cb163-18" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-19"><a href="other-useful.html#cb163-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-20"><a href="other-useful.html#cb163-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb163-21"><a href="other-useful.html#cb163-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb163-22"><a href="other-useful.html#cb163-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-23"><a href="other-useful.html#cb163-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-24"><a href="other-useful.html#cb163-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-25"><a href="other-useful.html#cb163-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-26"><a href="other-useful.html#cb163-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-27"><a href="other-useful.html#cb163-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-28"><a href="other-useful.html#cb163-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-29"><a href="other-useful.html#cb163-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb163-30"><a href="other-useful.html#cb163-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-31"><a href="other-useful.html#cb163-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb163-32"><a href="other-useful.html#cb163-32" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb163-33"><a href="other-useful.html#cb163-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb163-34"><a href="other-useful.html#cb163-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-35"><a href="other-useful.html#cb163-35" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb163-36"><a href="other-useful.html#cb163-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-37"><a href="other-useful.html#cb163-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-38"><a href="other-useful.html#cb163-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-39"><a href="other-useful.html#cb163-39" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-40"><a href="other-useful.html#cb163-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-41"><a href="other-useful.html#cb163-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-42"><a href="other-useful.html#cb163-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-43"><a href="other-useful.html#cb163-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-44"><a href="other-useful.html#cb163-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb163-45"><a href="other-useful.html#cb163-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-46"><a href="other-useful.html#cb163-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again naming features</span></span>
<span id="cb163-47"><a href="other-useful.html#cb163-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-48"><a href="other-useful.html#cb163-48" aria-hidden="true" tabindex="-1"></a>  x_named <span class="ot">&lt;-</span> x</span>
<span id="cb163-49"><a href="other-useful.html#cb163-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_named) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb163-50"><a href="other-useful.html#cb163-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-51"><a href="other-useful.html#cb163-51" aria-hidden="true" tabindex="-1"></a>  css_results_name_feats <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_named, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb163-52"><a href="other-useful.html#cb163-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb163-53"><a href="other-useful.html#cb163-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-54"><a href="other-useful.html#cb163-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_name_feats)</span>
<span id="cb163-55"><a href="other-useful.html#cb163-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-56"><a href="other-useful.html#cb163-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-57"><a href="other-useful.html#cb163-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoName&quot;</span>,</span>
<span id="cb163-58"><a href="other-useful.html#cb163-58" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustProtoNum&quot;</span>, <span class="st">&quot;ClustSelProp&quot;</span>,</span>
<span id="cb163-59"><a href="other-useful.html#cb163-59" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-60"><a href="other-useful.html#cb163-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-61"><a href="other-useful.html#cb163-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb163-62"><a href="other-useful.html#cb163-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb163-63"><a href="other-useful.html#cb163-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-64"><a href="other-useful.html#cb163-64" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-65"><a href="other-useful.html#cb163-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-66"><a href="other-useful.html#cb163-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-67"><a href="other-useful.html#cb163-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-68"><a href="other-useful.html#cb163-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustProtoName))</span>
<span id="cb163-69"><a href="other-useful.html#cb163-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-70"><a href="other-useful.html#cb163-70" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb163-71"><a href="other-useful.html#cb163-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-72"><a href="other-useful.html#cb163-72" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb163-73"><a href="other-useful.html#cb163-73" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb163-74"><a href="other-useful.html#cb163-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb163-75"><a href="other-useful.html#cb163-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-76"><a href="other-useful.html#cb163-76" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>])))</span>
<span id="cb163-77"><a href="other-useful.html#cb163-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-78"><a href="other-useful.html#cb163-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-79"><a href="other-useful.html#cb163-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-80"><a href="other-useful.html#cb163-80" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb163-81"><a href="other-useful.html#cb163-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-82"><a href="other-useful.html#cb163-82" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb163-83"><a href="other-useful.html#cb163-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb163-84"><a href="other-useful.html#cb163-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-85"><a href="other-useful.html#cb163-85" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb163-86"><a href="other-useful.html#cb163-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-87"><a href="other-useful.html#cb163-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-88"><a href="other-useful.html#cb163-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-89"><a href="other-useful.html#cb163-89" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-90"><a href="other-useful.html#cb163-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-91"><a href="other-useful.html#cb163-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-92"><a href="other-useful.html#cb163-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-93"><a href="other-useful.html#cb163-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-94"><a href="other-useful.html#cb163-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb163-95"><a href="other-useful.html#cb163-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-96"><a href="other-useful.html#cb163-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unnamed clusters</span></span>
<span id="cb163-97"><a href="other-useful.html#cb163-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-98"><a href="other-useful.html#cb163-98" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb163-99"><a href="other-useful.html#cb163-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-100"><a href="other-useful.html#cb163-100" aria-hidden="true" tabindex="-1"></a>  css_results_unnamed <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>unnamed_clusters,</span>
<span id="cb163-101"><a href="other-useful.html#cb163-101" aria-hidden="true" tabindex="-1"></a>                             <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb163-102"><a href="other-useful.html#cb163-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-103"><a href="other-useful.html#cb163-103" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_unnamed)</span>
<span id="cb163-104"><a href="other-useful.html#cb163-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-105"><a href="other-useful.html#cb163-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-106"><a href="other-useful.html#cb163-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb163-107"><a href="other-useful.html#cb163-107" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-108"><a href="other-useful.html#cb163-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-109"><a href="other-useful.html#cb163-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb163-110"><a href="other-useful.html#cb163-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb163-111"><a href="other-useful.html#cb163-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-112"><a href="other-useful.html#cb163-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-113"><a href="other-useful.html#cb163-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-114"><a href="other-useful.html#cb163-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-115"><a href="other-useful.html#cb163-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-116"><a href="other-useful.html#cb163-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-117"><a href="other-useful.html#cb163-117" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-118"><a href="other-useful.html#cb163-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-119"><a href="other-useful.html#cb163-119" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-120"><a href="other-useful.html#cb163-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-121"><a href="other-useful.html#cb163-121" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-122"><a href="other-useful.html#cb163-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-123"><a href="other-useful.html#cb163-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try other settings for cutoff, min_num_clusts, max_num_clusts, etc.</span></span>
<span id="cb163-124"><a href="other-useful.html#cb163-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-125"><a href="other-useful.html#cb163-125" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="dv">3</span>)</span>
<span id="cb163-126"><a href="other-useful.html#cb163-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-127"><a href="other-useful.html#cb163-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-128"><a href="other-useful.html#cb163-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb163-129"><a href="other-useful.html#cb163-129" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-130"><a href="other-useful.html#cb163-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-131"><a href="other-useful.html#cb163-131" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb163-132"><a href="other-useful.html#cb163-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-133"><a href="other-useful.html#cb163-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-134"><a href="other-useful.html#cb163-134" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-135"><a href="other-useful.html#cb163-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-136"><a href="other-useful.html#cb163-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-137"><a href="other-useful.html#cb163-137" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb163-138"><a href="other-useful.html#cb163-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb163-139"><a href="other-useful.html#cb163-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-140"><a href="other-useful.html#cb163-140" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb163-141"><a href="other-useful.html#cb163-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-142"><a href="other-useful.html#cb163-142" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-143"><a href="other-useful.html#cb163-143" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-144"><a href="other-useful.html#cb163-144" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-145"><a href="other-useful.html#cb163-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-146"><a href="other-useful.html#cb163-146" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-147"><a href="other-useful.html#cb163-147" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb163-148"><a href="other-useful.html#cb163-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-149"><a href="other-useful.html#cb163-149" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-150"><a href="other-useful.html#cb163-150" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-151"><a href="other-useful.html#cb163-151" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb163-152"><a href="other-useful.html#cb163-152" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-153"><a href="other-useful.html#cb163-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-154"><a href="other-useful.html#cb163-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-155"><a href="other-useful.html#cb163-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-156"><a href="other-useful.html#cb163-156" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-157"><a href="other-useful.html#cb163-157" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb163-158"><a href="other-useful.html#cb163-158" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-159"><a href="other-useful.html#cb163-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-160"><a href="other-useful.html#cb163-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-161"><a href="other-useful.html#cb163-161" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb163-162"><a href="other-useful.html#cb163-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-163"><a href="other-useful.html#cb163-163" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-164"><a href="other-useful.html#cb163-164" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb163-165"><a href="other-useful.html#cb163-165" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-166"><a href="other-useful.html#cb163-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-167"><a href="other-useful.html#cb163-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb163-168"><a href="other-useful.html#cb163-168" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb163-169"><a href="other-useful.html#cb163-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb163-170"><a href="other-useful.html#cb163-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-171"><a href="other-useful.html#cb163-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-172"><a href="other-useful.html#cb163-172" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-173"><a href="other-useful.html#cb163-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-174"><a href="other-useful.html#cb163-174" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-175"><a href="other-useful.html#cb163-175" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb163-176"><a href="other-useful.html#cb163-176" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb163-177"><a href="other-useful.html#cb163-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-178"><a href="other-useful.html#cb163-178" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb163-179"><a href="other-useful.html#cb163-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-180"><a href="other-useful.html#cb163-180" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-181"><a href="other-useful.html#cb163-181" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-182"><a href="other-useful.html#cb163-182" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-183"><a href="other-useful.html#cb163-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-184"><a href="other-useful.html#cb163-184" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-185"><a href="other-useful.html#cb163-185" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb163-186"><a href="other-useful.html#cb163-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-187"><a href="other-useful.html#cb163-187" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-188"><a href="other-useful.html#cb163-188" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-189"><a href="other-useful.html#cb163-189" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb163-190"><a href="other-useful.html#cb163-190" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-191"><a href="other-useful.html#cb163-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-192"><a href="other-useful.html#cb163-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-193"><a href="other-useful.html#cb163-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-194"><a href="other-useful.html#cb163-194" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-195"><a href="other-useful.html#cb163-195" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb163-196"><a href="other-useful.html#cb163-196" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-197"><a href="other-useful.html#cb163-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-198"><a href="other-useful.html#cb163-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-199"><a href="other-useful.html#cb163-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb163-200"><a href="other-useful.html#cb163-200" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb163-201"><a href="other-useful.html#cb163-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-202"><a href="other-useful.html#cb163-202" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb163-203"><a href="other-useful.html#cb163-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb163-204"><a href="other-useful.html#cb163-204" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb163-205"><a href="other-useful.html#cb163-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-206"><a href="other-useful.html#cb163-206" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb163-207"><a href="other-useful.html#cb163-207" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb163-208"><a href="other-useful.html#cb163-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-209"><a href="other-useful.html#cb163-209" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb163-210"><a href="other-useful.html#cb163-210" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb163-211"><a href="other-useful.html#cb163-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-212"><a href="other-useful.html#cb163-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb163-213"><a href="other-useful.html#cb163-213" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb163-214"><a href="other-useful.html#cb163-214" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb163-215"><a href="other-useful.html#cb163-215" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb163-216"><a href="other-useful.html#cb163-216" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb163-217"><a href="other-useful.html#cb163-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-218"><a href="other-useful.html#cb163-218" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb163-219"><a href="other-useful.html#cb163-219" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb163-220"><a href="other-useful.html#cb163-220" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb163-221"><a href="other-useful.html#cb163-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-222"><a href="other-useful.html#cb163-222" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb163-223"><a href="other-useful.html#cb163-223" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb163-224"><a href="other-useful.html#cb163-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-225"><a href="other-useful.html#cb163-225" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-226"><a href="other-useful.html#cb163-226" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb163-227"><a href="other-useful.html#cb163-227" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb163-228"><a href="other-useful.html#cb163-228" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-229"><a href="other-useful.html#cb163-229" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-230"><a href="other-useful.html#cb163-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-231"><a href="other-useful.html#cb163-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb163-232"><a href="other-useful.html#cb163-232" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb163-233"><a href="other-useful.html#cb163-233" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb163-234"><a href="other-useful.html#cb163-234" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb163-235"><a href="other-useful.html#cb163-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-236"><a href="other-useful.html#cb163-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-237"><a href="other-useful.html#cb163-237" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb163-238"><a href="other-useful.html#cb163-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-239"><a href="other-useful.html#cb163-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb163-240"><a href="other-useful.html#cb163-240" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="st">&quot;css_results&quot;</span>))</span>
<span id="cb163-241"><a href="other-useful.html#cb163-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-242"><a href="other-useful.html#cb163-242" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="sc">-</span>.<span class="dv">1</span>),</span>
<span id="cb163-243"><a href="other-useful.html#cb163-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb163-244"><a href="other-useful.html#cb163-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-245"><a href="other-useful.html#cb163-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="fl">3.2</span>),</span>
<span id="cb163-246"><a href="other-useful.html#cb163-246" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts == round(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb163-247"><a href="other-useful.html#cb163-247" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb163-248"><a href="other-useful.html#cb163-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-249"><a href="other-useful.html#cb163-249" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb163-250"><a href="other-useful.html#cb163-250" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb163-251"><a href="other-useful.html#cb163-251" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb163-252"><a href="other-useful.html#cb163-252" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p><code><a href='other-useful.html#print.cssr'>print.cssr</a>()</code></p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="other-useful.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print cluster stability selection output</span></span>
<span id="cb165-2"><a href="other-useful.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb165-3"><a href="other-useful.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function (using output from</span></span>
<span id="cb165-4"><a href="other-useful.html#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; printCssDf function).</span></span>
<span id="cb165-5"><a href="other-useful.html#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x An object of class &quot;cssr&quot; (the output of the function css).</span></span>
<span id="cb165-6"><a href="other-useful.html#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; print.cssr will display only those</span></span>
<span id="cb165-7"><a href="other-useful.html#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb165-8"><a href="other-useful.html#cb165-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb165-9"><a href="other-useful.html#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb165-10"><a href="other-useful.html#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb165-11"><a href="other-useful.html#cb165-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb165-12"><a href="other-useful.html#cb165-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb165-13"><a href="other-useful.html#cb165-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb165-14"><a href="other-useful.html#cb165-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb165-15"><a href="other-useful.html#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb165-16"><a href="other-useful.html#cb165-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb165-17"><a href="other-useful.html#cb165-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb165-18"><a href="other-useful.html#cb165-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb165-19"><a href="other-useful.html#cb165-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Additional arguments to generic print.data.frame function</span></span>
<span id="cb165-20"><a href="other-useful.html#cb165-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb165-21"><a href="other-useful.html#cb165-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb165-22"><a href="other-useful.html#cb165-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb165-23"><a href="other-useful.html#cb165-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb165-24"><a href="other-useful.html#cb165-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb165-25"><a href="other-useful.html#cb165-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb165-26"><a href="other-useful.html#cb165-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb165-27"><a href="other-useful.html#cb165-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb165-28"><a href="other-useful.html#cb165-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb165-29"><a href="other-useful.html#cb165-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb165-30"><a href="other-useful.html#cb165-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb165-31"><a href="other-useful.html#cb165-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb165-32"><a href="other-useful.html#cb165-32" aria-hidden="true" tabindex="-1"></a><span id='print.cssr'>print.cssr</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>, ...){</span>
<span id="cb165-33"><a href="other-useful.html#cb165-33" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="at">css_results=</span>x, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb165-34"><a href="other-useful.html#cb165-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts, <span class="at">max_num_clusts=</span>max_num_clusts)</span>
<span id="cb165-35"><a href="other-useful.html#cb165-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print.data.frame</span>(df, ...)</span>
<span id="cb165-36"><a href="other-useful.html#cb165-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sel-and-pred.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrapper-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
