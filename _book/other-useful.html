<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Other useful functions | Creating the cssr R package</title>
  <meta name="description" content="7 Other useful functions | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Other useful functions | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Other useful functions | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-01-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sel-and-pred.html"/>
<link rel="next" href="wrapper-functions.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a></li>
<li class="chapter" data-level="4" data-path="helper-functions.html"><a href="helper-functions.html"><i class="fa fa-check"></i><b>4</b> Helper functions</a></li>
<li class="chapter" data-level="5" data-path="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html"><a href="tests-for-main-functions-in-cssr-now-that-helper-functions-have-been-defined.html"><i class="fa fa-check"></i><b>5</b> Tests for main functions in <code>cssr</code> (now that helper functions have been defined)</a></li>
<li class="chapter" data-level="6" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>6</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="7" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>7</b> Other useful functions</a></li>
<li class="chapter" data-level="8" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>8</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="9" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>9</b> Competitor Methods</a></li>
<li class="chapter" data-level="10" data-path="documenting-the-package-and-adding-readme.html"><a href="documenting-the-package-and-adding-readme.html"><i class="fa fa-check"></i><b>10</b> Documenting the package and adding README</a>
<ul>
<li class="chapter" data-level="10.1" data-path="documenting-the-package-and-adding-readme.html"><a href="documenting-the-package-and-adding-readme.html#add-readme"><i class="fa fa-check"></i><b>10.1</b> Add README</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="other-useful" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Other useful functions<a href="other-useful.html#other-useful" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following are some other functions that are useful for specific tasks.</p>
<ul>
<li><p>genClusteredData generates jointly Gaussian data sets that include clusters of features that are correlated with a latent feature (the latent features themselves are also provided).</p></li>
<li><p>getLassoLambda uses a data set to choose a good value of lambda for subsamples of size n/2 (as in cluster stability selection) by cross-validation.</p></li>
<li><p>getModelSize estimates the best size for a lasso model on a provided data set.</p></li>
<li><p>printCssDf converts the output of the css function (an object of class cssr) to a data.frame that is ready to be printed. We provide end-user access to printCssDf because this data.frame itself may be useful as an object that summarizes the output from css.</p></li>
<li><p>print.cssr is the print function for objects of class cssr.</p></li>
<li><p>genClusteredData</p>
<ul>
<li>checkGenClusteredDataInputs checks that the inputs to genClusteredData are as expected.</li>
<li>makeCovarianceMatrix generates a covariance matrix for a jointly Gaussian random variable with distribution matching the provided inputs.</li>
<li>makeCoefficients generates a coefficient vector for the response according to the provided inputs.</li>
<li>Finally, genMuXZSd draws a random Z (matrix of latent variables), X (observed matrix, containing, in general, features correlated with latent features, directly observed features that are associated with y, and noise features), conditional means mu, and observed responses y.</li>
</ul></li>
<li><p>getLassoLambda</p></li>
<li><p>getModelSize</p></li>
<li><p>printCssDf</p>
<ul>
<li>getSelectionPrototypes identifies the prototypes from selected clusters (the feature in each cluster that is most correlated with the response)</li>
</ul></li>
<li><p>print.cssr</p></li>
</ul>
<p>genClusteredData</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="other-useful.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate randomly sampled data including noisy observations of latent</span></span>
<span id="cb127-2"><a href="other-useful.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables</span></span>
<span id="cb127-3"><a href="other-useful.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb127-4"><a href="other-useful.html#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class="al">TODO</span><span class="co">(gregfaletto) change cluster_size into a vector of sizes (maybe also</span></span>
<span id="cb127-5"><a href="other-useful.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; deprecate n_clusters as an input, since this would be inferred by the length</span></span>
<span id="cb127-6"><a href="other-useful.html#cb127-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of cluster_sizes?)</span></span>
<span id="cb127-7"><a href="other-useful.html#cb127-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb127-8"><a href="other-useful.html#cb127-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb127-9"><a href="other-useful.html#cb127-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb127-10"><a href="other-useful.html#cb127-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb127-11"><a href="other-useful.html#cb127-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb127-12"><a href="other-useful.html#cb127-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Faletto and Bien (2022).</span></span>
<span id="cb127-13"><a href="other-useful.html#cb127-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb127-14"><a href="other-useful.html#cb127-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb127-15"><a href="other-useful.html#cb127-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb127-16"><a href="other-useful.html#cb127-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb127-17"><a href="other-useful.html#cb127-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb127-18"><a href="other-useful.html#cb127-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb127-19"><a href="other-useful.html#cb127-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb127-20"><a href="other-useful.html#cb127-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb127-21"><a href="other-useful.html#cb127-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb127-22"><a href="other-useful.html#cb127-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb127-23"><a href="other-useful.html#cb127-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb127-24"><a href="other-useful.html#cb127-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb127-25"><a href="other-useful.html#cb127-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb127-26"><a href="other-useful.html#cb127-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb127-27"><a href="other-useful.html#cb127-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb127-28"><a href="other-useful.html#cb127-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb127-29"><a href="other-useful.html#cb127-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb127-30"><a href="other-useful.html#cb127-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb127-31"><a href="other-useful.html#cb127-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb127-32"><a href="other-useful.html#cb127-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb127-33"><a href="other-useful.html#cb127-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb127-34"><a href="other-useful.html#cb127-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb127-35"><a href="other-useful.html#cb127-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. Can&#39;t equal 0. Default is 0.9.</span></span>
<span id="cb127-36"><a href="other-useful.html#cb127-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb127-37"><a href="other-useful.html#cb127-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb127-38"><a href="other-useful.html#cb127-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb127-39"><a href="other-useful.html#cb127-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb127-40"><a href="other-useful.html#cb127-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb127-41"><a href="other-useful.html#cb127-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb127-42"><a href="other-useful.html#cb127-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb127-43"><a href="other-useful.html#cb127-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb127-44"><a href="other-useful.html#cb127-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb127-45"><a href="other-useful.html#cb127-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb127-46"><a href="other-useful.html#cb127-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb127-47"><a href="other-useful.html#cb127-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb127-48"><a href="other-useful.html#cb127-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb127-49"><a href="other-useful.html#cb127-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb127-50"><a href="other-useful.html#cb127-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb127-51"><a href="other-useful.html#cb127-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb127-52"><a href="other-useful.html#cb127-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb127-53"><a href="other-useful.html#cb127-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb127-54"><a href="other-useful.html#cb127-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb127-55"><a href="other-useful.html#cb127-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb127-56"><a href="other-useful.html#cb127-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb127-57"><a href="other-useful.html#cb127-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb127-58"><a href="other-useful.html#cb127-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb127-59"><a href="other-useful.html#cb127-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb127-60"><a href="other-useful.html#cb127-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb127-61"><a href="other-useful.html#cb127-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb127-62"><a href="other-useful.html#cb127-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb127-63"><a href="other-useful.html#cb127-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb127-64"><a href="other-useful.html#cb127-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb127-65"><a href="other-useful.html#cb127-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb127-66"><a href="other-useful.html#cb127-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb127-67"><a href="other-useful.html#cb127-67" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb127-68"><a href="other-useful.html#cb127-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb127-69"><a href="other-useful.html#cb127-69" aria-hidden="true" tabindex="-1"></a><span id='genClusteredData'>genClusteredData</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, k_unclustered, cluster_size, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb127-70"><a href="other-useful.html#cb127-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span><span class="fl">0.9</span>, <span class="at">var=</span><span class="dv">1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="dv">1</span>,</span>
<span id="cb127-71"><a href="other-useful.html#cb127-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">snr=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">sigma_eps_sq=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>)){</span>
<span id="cb127-72"><a href="other-useful.html#cb127-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-73"><a href="other-useful.html#cb127-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb127-74"><a href="other-useful.html#cb127-74" aria-hidden="true" tabindex="-1"></a>    <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(p, k_unclustered, cluster_size, n_clusters,</span>
<span id="cb127-75"><a href="other-useful.html#cb127-75" aria-hidden="true" tabindex="-1"></a>        sig_clusters, rho, var, beta_latent, beta_unclustered, snr,</span>
<span id="cb127-76"><a href="other-useful.html#cb127-76" aria-hidden="true" tabindex="-1"></a>        sigma_eps_sq)</span>
<span id="cb127-77"><a href="other-useful.html#cb127-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-78"><a href="other-useful.html#cb127-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate covariance matrix (latent features are mixed in matrix, so each</span></span>
<span id="cb127-79"><a href="other-useful.html#cb127-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster will be of size cluster_size + 1)</span></span>
<span id="cb127-80"><a href="other-useful.html#cb127-80" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb127-81"><a href="other-useful.html#cb127-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>, <span class="at">rho=</span>rho, <span class="at">var=</span>var)</span>
<span id="cb127-82"><a href="other-useful.html#cb127-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-83"><a href="other-useful.html#cb127-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate coefficients</span></span>
<span id="cb127-84"><a href="other-useful.html#cb127-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note that beta has length p + sig_clusters</span></span>
<span id="cb127-85"><a href="other-useful.html#cb127-85" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span>p <span class="sc">+</span> n_clusters, <span class="at">k_unblocked=</span>k_unclustered,</span>
<span id="cb127-86"><a href="other-useful.html#cb127-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta_low=</span>beta_unclustered, <span class="at">beta_high=</span>beta_latent, <span class="at">nblocks=</span>n_clusters,</span>
<span id="cb127-87"><a href="other-useful.html#cb127-87" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_blocks=</span>sig_clusters, <span class="at">block_size=</span>cluster_size <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb127-88"><a href="other-useful.html#cb127-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-89"><a href="other-useful.html#cb127-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate mu, X, z, sd, y</span></span>
<span id="cb127-90"><a href="other-useful.html#cb127-90" aria-hidden="true" tabindex="-1"></a>    gen_mu_x_z_sd_res <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span>n, <span class="at">p=</span>p, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb127-91"><a href="other-useful.html#cb127-91" aria-hidden="true" tabindex="-1"></a>        <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars, <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, </span>
<span id="cb127-92"><a href="other-useful.html#cb127-92" aria-hidden="true" tabindex="-1"></a>        <span class="at">block_size=</span>cluster_size, <span class="at">n_blocks=</span>n_clusters, <span class="at">snr=</span>snr,</span>
<span id="cb127-93"><a href="other-useful.html#cb127-93" aria-hidden="true" tabindex="-1"></a>        <span class="at">sigma_eps_sq=</span>sigma_eps_sq)</span>
<span id="cb127-94"><a href="other-useful.html#cb127-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-95"><a href="other-useful.html#cb127-95" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>mu</span>
<span id="cb127-96"><a href="other-useful.html#cb127-96" aria-hidden="true" tabindex="-1"></a>    sd <span class="ot">&lt;-</span> gen_mu_x_z_sd_res<span class="sc">$</span>sd</span>
<span id="cb127-97"><a href="other-useful.html#cb127-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-98"><a href="other-useful.html#cb127-98" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> mu <span class="sc">+</span> sd <span class="sc">*</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb127-99"><a href="other-useful.html#cb127-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-100"><a href="other-useful.html#cb127-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>gen_mu_x_z_sd_res<span class="sc">$</span>X, <span class="at">y=</span>y, <span class="at">Z=</span>gen_mu_x_z_sd_res<span class="sc">$</span>z, <span class="at">mu=</span>mu))</span>
<span id="cb127-101"><a href="other-useful.html#cb127-101" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>checkGenClusteredDataInputs ## NEED TO START WITH ROXYGEN FORMATTING</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="other-useful.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span><span class="al">TODO</span><span class="co">(gregfaletto) fix this description!!!</span></span>
<span id="cb128-2"><a href="other-useful.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Check inputs to genClusteredData</span></span>
<span id="cb128-3"><a href="other-useful.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb128-4"><a href="other-useful.html#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate a data set including latent features Z, observed features X (which</span></span>
<span id="cb128-5"><a href="other-useful.html#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; may include noisy or noiseless observations of the latent features in Z),</span></span>
<span id="cb128-6"><a href="other-useful.html#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; an observed response y which is a linear model of features from Z and X as</span></span>
<span id="cb128-7"><a href="other-useful.html#cb128-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as independent mean zero noise, and mu (the responses from y without</span></span>
<span id="cb128-8"><a href="other-useful.html#cb128-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the added noise). Data is generated in the same way as in the simulations</span></span>
<span id="cb128-9"><a href="other-useful.html#cb128-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Faletto and Bien (2022).</span></span>
<span id="cb128-10"><a href="other-useful.html#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features to generate. The</span></span>
<span id="cb128-11"><a href="other-useful.html#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X will have p columns.</span></span>
<span id="cb128-12"><a href="other-useful.html#cb128-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unclustered Integer or numeric; the number of features in X that</span></span>
<span id="cb128-13"><a href="other-useful.html#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb128-14"><a href="other-useful.html#cb128-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb128-15"><a href="other-useful.html#cb128-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb128-16"><a href="other-useful.html#cb128-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_unclustered.</span></span>
<span id="cb128-17"><a href="other-useful.html#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_size Integer or numeric; for each of the n_clusters latent</span></span>
<span id="cb128-18"><a href="other-useful.html#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain cluster_size noisy proxies that are correlated with</span></span>
<span id="cb128-19"><a href="other-useful.html#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb128-20"><a href="other-useful.html#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer or numeric; the number of latent variables to</span></span>
<span id="cb128-21"><a href="other-useful.html#cb128-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb128-22"><a href="other-useful.html#cb128-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb128-23"><a href="other-useful.html#cb128-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_clusters Integer or numeric; the number of generated latent</span></span>
<span id="cb128-24"><a href="other-useful.html#cb128-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb128-25"><a href="other-useful.html#cb128-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). Must be less than or equal to</span></span>
<span id="cb128-26"><a href="other-useful.html#cb128-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters. Default is 1.</span></span>
<span id="cb128-27"><a href="other-useful.html#cb128-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb128-28"><a href="other-useful.html#cb128-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb128-29"><a href="other-useful.html#cb128-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. Can&#39;t equal 0. Default is 0.9.</span></span>
<span id="cb128-30"><a href="other-useful.html#cb128-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb128-31"><a href="other-useful.html#cb128-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb128-32"><a href="other-useful.html#cb128-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb128-33"><a href="other-useful.html#cb128-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_latent Integer or numeric; the coefficient used for all</span></span>
<span id="cb128-34"><a href="other-useful.html#cb128-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_clusters latent variables that have nonzero coefficients in the true</span></span>
<span id="cb128-35"><a href="other-useful.html#cb128-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y. Can&#39;t equal 0. Default is 1.5.</span></span>
<span id="cb128-36"><a href="other-useful.html#cb128-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_unclustered Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb128-37"><a href="other-useful.html#cb128-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unclustered features in X not generated from the</span></span>
<span id="cb128-38"><a href="other-useful.html#cb128-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb128-39"><a href="other-useful.html#cb128-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_unclustered/sqrt(1:k_unclustered). Can&#39;t equal 0. Default is 1.</span></span>
<span id="cb128-40"><a href="other-useful.html#cb128-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb128-41"><a href="other-useful.html#cb128-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb128-42"><a href="other-useful.html#cb128-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb128-43"><a href="other-useful.html#cb128-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb128-44"><a href="other-useful.html#cb128-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb128-45"><a href="other-useful.html#cb128-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb128-46"><a href="other-useful.html#cb128-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A list of the following elements. \item{X}{An n x p numeric matrix of</span></span>
<span id="cb128-47"><a href="other-useful.html#cb128-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n observations from a p-dimensional multivariate normal distribution</span></span>
<span id="cb128-48"><a href="other-useful.html#cb128-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated using the specified parameters. The first n_clusters times</span></span>
<span id="cb128-49"><a href="other-useful.html#cb128-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster_size features will be the clusters of features correlated with the</span></span>
<span id="cb128-50"><a href="other-useful.html#cb128-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters latent variables. The next k_unclustered features will be the</span></span>
<span id="cb128-51"><a href="other-useful.html#cb128-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weak signal&quot; features, and the remaining p - n_clusters*cluster_size -</span></span>
<span id="cb128-52"><a href="other-useful.html#cb128-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; k_unclustered features will be the unclustered noise features.} \item{y}{A</span></span>
<span id="cb128-53"><a href="other-useful.html#cb128-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n numeric vector; the response generated from X, the latent features</span></span>
<span id="cb128-54"><a href="other-useful.html#cb128-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from Z, and the coefficient vector, along with additive noise.} \item{Z}{The</span></span>
<span id="cb128-55"><a href="other-useful.html#cb128-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent features; either a numeric vector (if n_clusters &gt; 1) or a numeric</span></span>
<span id="cb128-56"><a href="other-useful.html#cb128-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix (if n_clusters &gt; 1). Note that (X, Z) is multivariate Gaussian.}</span></span>
<span id="cb128-57"><a href="other-useful.html#cb128-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; item{mu}{A length `n` numeric vector; the expected response given X, Z, and</span></span>
<span id="cb128-58"><a href="other-useful.html#cb128-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true coefficient vector (equal to y minus the added noise).}</span></span>
<span id="cb128-59"><a href="other-useful.html#cb128-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb128-60"><a href="other-useful.html#cb128-60" aria-hidden="true" tabindex="-1"></a><span id='checkGenClusteredDataInputs'>checkGenClusteredDataInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unclustered, cluster_size,</span>
<span id="cb128-61"><a href="other-useful.html#cb128-61" aria-hidden="true" tabindex="-1"></a>    n_clusters, sig_clusters, rho, var, beta_latent, beta_unclustered, snr,</span>
<span id="cb128-62"><a href="other-useful.html#cb128-62" aria-hidden="true" tabindex="-1"></a>    sigma_eps_sq){</span>
<span id="cb128-63"><a href="other-useful.html#cb128-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-64"><a href="other-useful.html#cb128-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sig_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(sig_clusters))</span>
<span id="cb128-65"><a href="other-useful.html#cb128-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb128-66"><a href="other-useful.html#cb128-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb128-67"><a href="other-useful.html#cb128-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_clusters <span class="sc">==</span> <span class="fu">round</span>(sig_clusters))</span>
<span id="cb128-68"><a href="other-useful.html#cb128-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-69"><a href="other-useful.html#cb128-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(n_clusters) <span class="sc">|</span> <span class="fu">is.integer</span>(n_clusters))</span>
<span id="cb128-70"><a href="other-useful.html#cb128-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">==</span> <span class="fu">round</span>(n_clusters))</span>
<span id="cb128-71"><a href="other-useful.html#cb128-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): is it easy to remove the requirement that n_clusters is</span></span>
<span id="cb128-72"><a href="other-useful.html#cb128-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at least 1 (so that it&#39;s possible to generate data with no latent </span></span>
<span id="cb128-73"><a href="other-useful.html#cb128-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features)? If so, should only check that cluster_size &gt;= 1 if n_clusters</span></span>
<span id="cb128-74"><a href="other-useful.html#cb128-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;= 1, and in makeCovarianceMatrix function only need block_size &gt;= 1</span></span>
<span id="cb128-75"><a href="other-useful.html#cb128-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rather than 2.</span></span>
<span id="cb128-76"><a href="other-useful.html#cb128-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_clusters <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb128-77"><a href="other-useful.html#cb128-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-78"><a href="other-useful.html#cb128-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cluster_size <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb128-79"><a href="other-useful.html#cb128-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-80"><a href="other-useful.html#cb128-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb128-81"><a href="other-useful.html#cb128-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb128-82"><a href="other-useful.html#cb128-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb128-83"><a href="other-useful.html#cb128-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-84"><a href="other-useful.html#cb128-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_latent <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb128-85"><a href="other-useful.html#cb128-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(beta_unclustered <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb128-86"><a href="other-useful.html#cb128-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-87"><a href="other-useful.html#cb128-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(k_unclustered) <span class="sc">|</span> <span class="fu">is.integer</span>(k_unclustered))</span>
<span id="cb128-88"><a href="other-useful.html#cb128-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb128-89"><a href="other-useful.html#cb128-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unclustered <span class="sc">==</span> <span class="fu">round</span>(k_unclustered))</span>
<span id="cb128-90"><a href="other-useful.html#cb128-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-91"><a href="other-useful.html#cb128-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> n_clusters<span class="sc">*</span>cluster_size <span class="sc">+</span> k_unclustered)</span>
<span id="cb128-92"><a href="other-useful.html#cb128-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-93"><a href="other-useful.html#cb128-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Same as make_sparse_blocked_linear_model_random, but ith coefficient</span></span>
<span id="cb128-94"><a href="other-useful.html#cb128-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># of weak signal features is beta_unclustered/sqrt(i) in order to have</span></span>
<span id="cb128-95"><a href="other-useful.html#cb128-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a definitive ranking of weak signal features.</span></span>
<span id="cb128-96"><a href="other-useful.html#cb128-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(snr) <span class="sc">&amp;</span> <span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb128-97"><a href="other-useful.html#cb128-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb128-98"><a href="other-useful.html#cb128-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb128-99"><a href="other-useful.html#cb128-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb128-100"><a href="other-useful.html#cb128-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(snr)){</span>
<span id="cb128-101"><a href="other-useful.html#cb128-101" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb128-102"><a href="other-useful.html#cb128-102" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb128-103"><a href="other-useful.html#cb128-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb128-104"><a href="other-useful.html#cb128-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb128-105"><a href="other-useful.html#cb128-105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb128-106"><a href="other-useful.html#cb128-106" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for checkGenClusteredDataInputs</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="other-useful.html#cb129-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGenClusteredDataInputs works&quot;</span>, {</span>
<span id="cb129-2"><a href="other-useful.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb129-3"><a href="other-useful.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="other-useful.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Should get no error</span></span>
<span id="cb129-5"><a href="other-useful.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-6"><a href="other-useful.html#cb129-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-7"><a href="other-useful.html#cb129-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb129-8"><a href="other-useful.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-9"><a href="other-useful.html#cb129-9" aria-hidden="true" tabindex="-1"></a>  <a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-10"><a href="other-useful.html#cb129-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-11"><a href="other-useful.html#cb129-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb129-12"><a href="other-useful.html#cb129-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-13"><a href="other-useful.html#cb129-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sig_clusters</span></span>
<span id="cb129-14"><a href="other-useful.html#cb129-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-15"><a href="other-useful.html#cb129-15" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-16"><a href="other-useful.html#cb129-16" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-17"><a href="other-useful.html#cb129-17" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-18"><a href="other-useful.html#cb129-18" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-19"><a href="other-useful.html#cb129-19" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-20"><a href="other-useful.html#cb129-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb129-21"><a href="other-useful.html#cb129-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-22"><a href="other-useful.html#cb129-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-23"><a href="other-useful.html#cb129-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-24"><a href="other-useful.html#cb129-24" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-25"><a href="other-useful.html#cb129-25" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-26"><a href="other-useful.html#cb129-26" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-27"><a href="other-useful.html#cb129-27" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-28"><a href="other-useful.html#cb129-28" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-29"><a href="other-useful.html#cb129-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-30"><a href="other-useful.html#cb129-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-31"><a href="other-useful.html#cb129-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-32"><a href="other-useful.html#cb129-32" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-33"><a href="other-useful.html#cb129-33" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-34"><a href="other-useful.html#cb129-34" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-35"><a href="other-useful.html#cb129-35" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-36"><a href="other-useful.html#cb129-36" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-37"><a href="other-useful.html#cb129-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-38"><a href="other-useful.html#cb129-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-39"><a href="other-useful.html#cb129-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-40"><a href="other-useful.html#cb129-40" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-41"><a href="other-useful.html#cb129-41" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-42"><a href="other-useful.html#cb129-42" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-43"><a href="other-useful.html#cb129-43" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-44"><a href="other-useful.html#cb129-44" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-45"><a href="other-useful.html#cb129-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb129-46"><a href="other-useful.html#cb129-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-47"><a href="other-useful.html#cb129-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-48"><a href="other-useful.html#cb129-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-49"><a href="other-useful.html#cb129-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb129-50"><a href="other-useful.html#cb129-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-51"><a href="other-useful.html#cb129-51" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb129-52"><a href="other-useful.html#cb129-52" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb129-53"><a href="other-useful.html#cb129-53" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-54"><a href="other-useful.html#cb129-54" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-55"><a href="other-useful.html#cb129-55" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-56"><a href="other-useful.html#cb129-56" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-57"><a href="other-useful.html#cb129-57" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb129-58"><a href="other-useful.html#cb129-58" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-59"><a href="other-useful.html#cb129-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-60"><a href="other-useful.html#cb129-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-61"><a href="other-useful.html#cb129-61" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb129-62"><a href="other-useful.html#cb129-62" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-63"><a href="other-useful.html#cb129-63" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-64"><a href="other-useful.html#cb129-64" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-65"><a href="other-useful.html#cb129-65" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-66"><a href="other-useful.html#cb129-66" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb129-67"><a href="other-useful.html#cb129-67" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-68"><a href="other-useful.html#cb129-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-69"><a href="other-useful.html#cb129-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-70"><a href="other-useful.html#cb129-70" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb129-71"><a href="other-useful.html#cb129-71" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-72"><a href="other-useful.html#cb129-72" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-73"><a href="other-useful.html#cb129-73" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-74"><a href="other-useful.html#cb129-74" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-75"><a href="other-useful.html#cb129-75" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-76"><a href="other-useful.html#cb129-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-77"><a href="other-useful.html#cb129-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-78"><a href="other-useful.html#cb129-78" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-79"><a href="other-useful.html#cb129-79" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-80"><a href="other-useful.html#cb129-80" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-81"><a href="other-useful.html#cb129-81" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-82"><a href="other-useful.html#cb129-82" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-83"><a href="other-useful.html#cb129-83" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-84"><a href="other-useful.html#cb129-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-85"><a href="other-useful.html#cb129-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-86"><a href="other-useful.html#cb129-86" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-87"><a href="other-useful.html#cb129-87" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb129-88"><a href="other-useful.html#cb129-88" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-89"><a href="other-useful.html#cb129-89" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-90"><a href="other-useful.html#cb129-90" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-91"><a href="other-useful.html#cb129-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb129-92"><a href="other-useful.html#cb129-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-93"><a href="other-useful.html#cb129-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-94"><a href="other-useful.html#cb129-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-95"><a href="other-useful.html#cb129-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-96"><a href="other-useful.html#cb129-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">8</span>,</span>
<span id="cb129-97"><a href="other-useful.html#cb129-97" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-98"><a href="other-useful.html#cb129-98" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-99"><a href="other-useful.html#cb129-99" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-100"><a href="other-useful.html#cb129-100" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-101"><a href="other-useful.html#cb129-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-102"><a href="other-useful.html#cb129-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-103"><a href="other-useful.html#cb129-103" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-104"><a href="other-useful.html#cb129-104" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb129-105"><a href="other-useful.html#cb129-105" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-106"><a href="other-useful.html#cb129-106" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-107"><a href="other-useful.html#cb129-107" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-108"><a href="other-useful.html#cb129-108" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-109"><a href="other-useful.html#cb129-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-110"><a href="other-useful.html#cb129-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-111"><a href="other-useful.html#cb129-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-112"><a href="other-useful.html#cb129-112" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-113"><a href="other-useful.html#cb129-113" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="sc">-</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-114"><a href="other-useful.html#cb129-114" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-115"><a href="other-useful.html#cb129-115" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-116"><a href="other-useful.html#cb129-116" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-117"><a href="other-useful.html#cb129-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-118"><a href="other-useful.html#cb129-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-119"><a href="other-useful.html#cb129-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-120"><a href="other-useful.html#cb129-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-121"><a href="other-useful.html#cb129-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb129-122"><a href="other-useful.html#cb129-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-123"><a href="other-useful.html#cb129-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-124"><a href="other-useful.html#cb129-124" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-125"><a href="other-useful.html#cb129-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-126"><a href="other-useful.html#cb129-126" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-127"><a href="other-useful.html#cb129-127" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-128"><a href="other-useful.html#cb129-128" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-129"><a href="other-useful.html#cb129-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-130"><a href="other-useful.html#cb129-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-131"><a href="other-useful.html#cb129-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-132"><a href="other-useful.html#cb129-132" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-133"><a href="other-useful.html#cb129-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-134"><a href="other-useful.html#cb129-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb129-135"><a href="other-useful.html#cb129-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb129-136"><a href="other-useful.html#cb129-136" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-137"><a href="other-useful.html#cb129-137" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-138"><a href="other-useful.html#cb129-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-139"><a href="other-useful.html#cb129-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-140"><a href="other-useful.html#cb129-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-141"><a href="other-useful.html#cb129-141" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb129-142"><a href="other-useful.html#cb129-142" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-143"><a href="other-useful.html#cb129-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-144"><a href="other-useful.html#cb129-144" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb129-145"><a href="other-useful.html#cb129-145" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-146"><a href="other-useful.html#cb129-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-147"><a href="other-useful.html#cb129-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-148"><a href="other-useful.html#cb129-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-149"><a href="other-useful.html#cb129-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-150"><a href="other-useful.html#cb129-150" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-151"><a href="other-useful.html#cb129-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-152"><a href="other-useful.html#cb129-152" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span>.<span class="dv">2</span>,</span>
<span id="cb129-153"><a href="other-useful.html#cb129-153" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-154"><a href="other-useful.html#cb129-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-155"><a href="other-useful.html#cb129-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-156"><a href="other-useful.html#cb129-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb129-157"><a href="other-useful.html#cb129-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-158"><a href="other-useful.html#cb129-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb129-159"><a href="other-useful.html#cb129-159" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-160"><a href="other-useful.html#cb129-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-161"><a href="other-useful.html#cb129-161" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-162"><a href="other-useful.html#cb129-162" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-163"><a href="other-useful.html#cb129-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-164"><a href="other-useful.html#cb129-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-165"><a href="other-useful.html#cb129-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb129-166"><a href="other-useful.html#cb129-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-167"><a href="other-useful.html#cb129-167" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-168"><a href="other-useful.html#cb129-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-169"><a href="other-useful.html#cb129-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-170"><a href="other-useful.html#cb129-170" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-171"><a href="other-useful.html#cb129-171" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-172"><a href="other-useful.html#cb129-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-173"><a href="other-useful.html#cb129-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb129-174"><a href="other-useful.html#cb129-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb129-175"><a href="other-useful.html#cb129-175" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-176"><a href="other-useful.html#cb129-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-177"><a href="other-useful.html#cb129-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#checkGenClusteredDataInputs'>checkGenClusteredDataInputs</a>(<span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb129-178"><a href="other-useful.html#cb129-178" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb129-179"><a href="other-useful.html#cb129-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb129-180"><a href="other-useful.html#cb129-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb129-181"><a href="other-useful.html#cb129-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb129-182"><a href="other-useful.html#cb129-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb129-183"><a href="other-useful.html#cb129-183" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-184"><a href="other-useful.html#cb129-184" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-185"><a href="other-useful.html#cb129-185" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p>makeCovarianceMatrix</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="other-useful.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate covariance matrix for simulated clustered data</span></span>
<span id="cb131-2"><a href="other-useful.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb131-3"><a href="other-useful.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the total number of features in the covariance</span></span>
<span id="cb131-4"><a href="other-useful.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix to be created, including latent features, the associated noisy proxies</span></span>
<span id="cb131-5"><a href="other-useful.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with each latent feature, and other (weak signal and noise) features.</span></span>
<span id="cb131-6"><a href="other-useful.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_blocks Integer or numeric; the number of latent variables in the</span></span>
<span id="cb131-7"><a href="other-useful.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data, each of which is associated with an observed cluster in X. Must be at</span></span>
<span id="cb131-8"><a href="other-useful.html#cb131-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; least 1.</span></span>
<span id="cb131-9"><a href="other-useful.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb131-10"><a href="other-useful.html#cb131-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, the covariance matrix will include the original latent feature</span></span>
<span id="cb131-11"><a href="other-useful.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plus block_size - 1 noisy proxies that are correlated with the latent</span></span>
<span id="cb131-12"><a href="other-useful.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable.</span></span>
<span id="cb131-13"><a href="other-useful.html#cb131-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho Integer or numeric; the covariance of the proxies in each cluster</span></span>
<span id="cb131-14"><a href="other-useful.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with the latent variable (and each other). Note that the correlation between</span></span>
<span id="cb131-15"><a href="other-useful.html#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the features in the cluster will be rho/var. rho cannot equal 0.</span></span>
<span id="cb131-16"><a href="other-useful.html#cb131-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param var Integer or numeric; the variance of all of the observed features</span></span>
<span id="cb131-17"><a href="other-useful.html#cb131-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in X (both the proxies for the latent variables and the k_unclustered other</span></span>
<span id="cb131-18"><a href="other-useful.html#cb131-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features). var cannot equal 0.</span></span>
<span id="cb131-19"><a href="other-useful.html#cb131-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A `p` x `p` numeric matrix representing the covariance matrix for</span></span>
<span id="cb131-20"><a href="other-useful.html#cb131-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent features, the associated proxies, and the remaining features. All</span></span>
<span id="cb131-21"><a href="other-useful.html#cb131-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features not in a block will be independent from each other and the blocks</span></span>
<span id="cb131-22"><a href="other-useful.html#cb131-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and have variance var.</span></span>
<span id="cb131-23"><a href="other-useful.html#cb131-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb131-24"><a href="other-useful.html#cb131-24" aria-hidden="true" tabindex="-1"></a><span id='makeCovarianceMatrix'>makeCovarianceMatrix</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, nblocks, block_size, rho, var) {</span>
<span id="cb131-25"><a href="other-useful.html#cb131-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb131-26"><a href="other-useful.html#cb131-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-27"><a href="other-useful.html#cb131-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb131-28"><a href="other-useful.html#cb131-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(rho <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb131-29"><a href="other-useful.html#cb131-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(var <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb131-30"><a href="other-useful.html#cb131-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(rho) <span class="sc">&lt;=</span> <span class="fu">abs</span>(var))</span>
<span id="cb131-31"><a href="other-useful.html#cb131-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(block_size <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb131-32"><a href="other-useful.html#cb131-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> nblocks<span class="sc">*</span>block_size)</span>
<span id="cb131-33"><a href="other-useful.html#cb131-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-34"><a href="other-useful.html#cb131-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># start with p x p identity matrix</span></span>
<span id="cb131-35"><a href="other-useful.html#cb131-35" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">&lt;-</span> var<span class="sc">*</span><span class="fu">diag</span>(p)</span>
<span id="cb131-36"><a href="other-useful.html#cb131-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-37"><a href="other-useful.html#cb131-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create matrix with nblocks rows, each containing a vector of</span></span>
<span id="cb131-38"><a href="other-useful.html#cb131-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># indices of highly correlated features</span></span>
<span id="cb131-39"><a href="other-useful.html#cb131-39" aria-hidden="true" tabindex="-1"></a>    block_feats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(nblocks<span class="sc">*</span>block_size), <span class="at">nrow=</span>nblocks, <span class="at">byrow=</span><span class="cn">TRUE</span>)</span>
<span id="cb131-40"><a href="other-useful.html#cb131-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-41"><a href="other-useful.html#cb131-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(block_feats)) <span class="sc">==</span> <span class="fu">length</span>(block_feats))</span>
<span id="cb131-42"><a href="other-useful.html#cb131-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-43"><a href="other-useful.html#cb131-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add covariances of highly correlated features to sigma</span></span>
<span id="cb131-44"><a href="other-useful.html#cb131-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nblocks){</span>
<span id="cb131-45"><a href="other-useful.html#cb131-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(block_size <span class="sc">-</span> <span class="dv">1</span>)){</span>
<span id="cb131-46"><a href="other-useful.html#cb131-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span>(k <span class="cf">in</span> (j<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>block_size){</span>
<span id="cb131-47"><a href="other-useful.html#cb131-47" aria-hidden="true" tabindex="-1"></a>                feat_1 <span class="ot">&lt;-</span> block_feats[i, j]</span>
<span id="cb131-48"><a href="other-useful.html#cb131-48" aria-hidden="true" tabindex="-1"></a>                feat_2 <span class="ot">&lt;-</span> block_feats[i, k]</span>
<span id="cb131-49"><a href="other-useful.html#cb131-49" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_1, feat_2] <span class="ot">&lt;-</span> rho</span>
<span id="cb131-50"><a href="other-useful.html#cb131-50" aria-hidden="true" tabindex="-1"></a>                Sigma[feat_2, feat_1] <span class="ot">&lt;-</span> rho</span>
<span id="cb131-51"><a href="other-useful.html#cb131-51" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb131-52"><a href="other-useful.html#cb131-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb131-53"><a href="other-useful.html#cb131-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb131-54"><a href="other-useful.html#cb131-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(Sigma))</span>
<span id="cb131-55"><a href="other-useful.html#cb131-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(Sigma))</span>
<span id="cb131-56"><a href="other-useful.html#cb131-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Sigma) <span class="sc">==</span> p <span class="sc">&amp;</span> <span class="fu">ncol</span>(Sigma) <span class="sc">==</span> p)</span>
<span id="cb131-57"><a href="other-useful.html#cb131-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(Sigma <span class="sc">==</span> <span class="fu">t</span>(Sigma)))</span>
<span id="cb131-58"><a href="other-useful.html#cb131-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-59"><a href="other-useful.html#cb131-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(Sigma)</span>
<span id="cb131-60"><a href="other-useful.html#cb131-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for makeCovarianceMatrix</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="other-useful.html#cb132-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;makeCovarianceMatrix works&quot;</span>, {</span>
<span id="cb132-2"><a href="other-useful.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7612</span>)</span>
<span id="cb132-3"><a href="other-useful.html#cb132-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-4"><a href="other-useful.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb132-5"><a href="other-useful.html#cb132-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-6"><a href="other-useful.html#cb132-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret))</span>
<span id="cb132-7"><a href="other-useful.html#cb132-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret))</span>
<span id="cb132-8"><a href="other-useful.html#cb132-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">8</span>)</span>
<span id="cb132-9"><a href="other-useful.html#cb132-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret), <span class="dv">8</span>)</span>
<span id="cb132-10"><a href="other-useful.html#cb132-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret <span class="sc">==</span> <span class="fu">t</span>(ret)))</span>
<span id="cb132-11"><a href="other-useful.html#cb132-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test on-diagonal and off-diagonal entries to see if they are as expected</span></span>
<span id="cb132-12"><a href="other-useful.html#cb132-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (only need to check top half of matrix; we already confirmed the matrix is</span></span>
<span id="cb132-13"><a href="other-useful.html#cb132-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># symmetric)</span></span>
<span id="cb132-14"><a href="other-useful.html#cb132-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">diag</span>(ret) <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb132-15"><a href="other-useful.html#cb132-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">2</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-16"><a href="other-useful.html#cb132-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">1</span>, <span class="dv">3</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-17"><a href="other-useful.html#cb132-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">2</span>, <span class="dv">3</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-18"><a href="other-useful.html#cb132-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">5</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-19"><a href="other-useful.html#cb132-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">4</span>, <span class="dv">6</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-20"><a href="other-useful.html#cb132-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[<span class="dv">5</span>, <span class="dv">6</span>], <span class="fl">0.8</span>)</span>
<span id="cb132-21"><a href="other-useful.html#cb132-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb132-22"><a href="other-useful.html#cb132-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb132-23"><a href="other-useful.html#cb132-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">7</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">8</span>)] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb132-24"><a href="other-useful.html#cb132-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[<span class="dv">8</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb132-25"><a href="other-useful.html#cb132-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-26"><a href="other-useful.html#cb132-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb132-27"><a href="other-useful.html#cb132-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb132-28"><a href="other-useful.html#cb132-28" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span>.<span class="dv">2</span>),</span>
<span id="cb132-29"><a href="other-useful.html#cb132-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-30"><a href="other-useful.html#cb132-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-31"><a href="other-useful.html#cb132-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb132-32"><a href="other-useful.html#cb132-32" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb132-33"><a href="other-useful.html#cb132-33" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nblocks &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-34"><a href="other-useful.html#cb132-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-35"><a href="other-useful.html#cb132-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb132-36"><a href="other-useful.html#cb132-36" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="dv">0</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb132-37"><a href="other-useful.html#cb132-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-38"><a href="other-useful.html#cb132-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-39"><a href="other-useful.html#cb132-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">8</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb132-40"><a href="other-useful.html#cb132-40" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.9</span>, <span class="at">var=</span><span class="dv">0</span>),</span>
<span id="cb132-41"><a href="other-useful.html#cb132-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-42"><a href="other-useful.html#cb132-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-43"><a href="other-useful.html#cb132-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">5</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb132-44"><a href="other-useful.html#cb132-44" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>),</span>
<span id="cb132-45"><a href="other-useful.html#cb132-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= nblocks * block_size is not TRUE&quot;</span>,</span>
<span id="cb132-46"><a href="other-useful.html#cb132-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-47"><a href="other-useful.html#cb132-47" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="other-useful.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generated coefficients for y in latent variable model</span></span>
<span id="cb134-2"><a href="other-useful.html#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb134-3"><a href="other-useful.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of features that will be observed in</span></span>
<span id="cb134-4"><a href="other-useful.html#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; x plus the number of latent variables (each corresponding to a cluster).</span></span>
<span id="cb134-5"><a href="other-useful.html#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param k_unblocked Integer or numeric; the number of features in X that</span></span>
<span id="cb134-6"><a href="other-useful.html#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have nonzero coefficients in the true model for y among those features </span></span>
<span id="cb134-7"><a href="other-useful.html#cb134-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; not generated from the n_clusters latent variables (called &quot;weak signal&quot; </span></span>
<span id="cb134-8"><a href="other-useful.html#cb134-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features in the simulations from Faletto and Bien 2022). The coefficients on</span></span>
<span id="cb134-9"><a href="other-useful.html#cb134-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; these features will be determined by beta_low.</span></span>
<span id="cb134-10"><a href="other-useful.html#cb134-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_low Integer or numeric; the maximum coefficient in the</span></span>
<span id="cb134-11"><a href="other-useful.html#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y among the k_unblocked features in X not generated from the</span></span>
<span id="cb134-12"><a href="other-useful.html#cb134-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables. The coefficients of the features will be</span></span>
<span id="cb134-13"><a href="other-useful.html#cb134-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_low/sqrt(1:k_unblocked).</span></span>
<span id="cb134-14"><a href="other-useful.html#cb134-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta_high Integer or numeric; the coefficient used for all</span></span>
<span id="cb134-15"><a href="other-useful.html#cb134-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sig_blocks latent variables that have nonzero coefficients in the true</span></span>
<span id="cb134-16"><a href="other-useful.html#cb134-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model for y.</span></span>
<span id="cb134-17"><a href="other-useful.html#cb134-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nblocks Integer or numeric; the number of latent variables that were</span></span>
<span id="cb134-18"><a href="other-useful.html#cb134-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb134-19"><a href="other-useful.html#cb134-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sig_blocks Integer or numeric; the number of generated latent</span></span>
<span id="cb134-20"><a href="other-useful.html#cb134-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features that will have nonzero coefficients in the true model for y (all of</span></span>
<span id="cb134-21"><a href="other-useful.html#cb134-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; them will have coefficient beta_latent). In particular, the first sig_blocks</span></span>
<span id="cb134-22"><a href="other-useful.html#cb134-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; latent variables will have coefficient beta_latent, and the remaining nblocks</span></span>
<span id="cb134-23"><a href="other-useful.html#cb134-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - sig_blocks features will have coefficient 0. Must be less than or equal to</span></span>
<span id="cb134-24"><a href="other-useful.html#cb134-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_clusters.</span></span>
<span id="cb134-25"><a href="other-useful.html#cb134-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb134-26"><a href="other-useful.html#cb134-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, the covariance matrix will include the original latent feature</span></span>
<span id="cb134-27"><a href="other-useful.html#cb134-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; plus block_size - 1 noisy proxies that are correlated with the latent</span></span>
<span id="cb134-28"><a href="other-useful.html#cb134-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable.</span></span>
<span id="cb134-29"><a href="other-useful.html#cb134-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{beta}{A vector of</span></span>
<span id="cb134-30"><a href="other-useful.html#cb134-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length `p` containing the coefficients for the true model for y. All entries</span></span>
<span id="cb134-31"><a href="other-useful.html#cb134-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will equal 0 except for the sig_blocks latent variables that will have</span></span>
<span id="cb134-32"><a href="other-useful.html#cb134-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient beta_high and the k_unblocked independent features with</span></span>
<span id="cb134-33"><a href="other-useful.html#cb134-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient determined by beta_low.} \item{blocked_dgp_vars}{An integer</span></span>
<span id="cb134-34"><a href="other-useful.html#cb134-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of length sig_blocks containing the indices of the features</span></span>
<span id="cb134-35"><a href="other-useful.html#cb134-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; corresponding to the latent features that will have nonzero coefficient</span></span>
<span id="cb134-36"><a href="other-useful.html#cb134-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; beta_high in the true model for y.} \item{sig_unblocked_vars}{An integer</span></span>
<span id="cb134-37"><a href="other-useful.html#cb134-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; vector of length k_unblocked containing the indices of the observed features</span></span>
<span id="cb134-38"><a href="other-useful.html#cb134-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are independent of the blocked features and have coefficient beta_low in</span></span>
<span id="cb134-39"><a href="other-useful.html#cb134-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true model for y. If k_unblocked = 0, this will just be NA.}</span></span>
<span id="cb134-40"><a href="other-useful.html#cb134-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{insig_blocked_vars}{An integer vector containing the indices of the</span></span>
<span id="cb134-41"><a href="other-useful.html#cb134-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features corresponding to the latent features that will have coefficient 0 in</span></span>
<span id="cb134-42"><a href="other-useful.html#cb134-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the true model for y. If nblocks=0, this will just be NA.}</span></span>
<span id="cb134-43"><a href="other-useful.html#cb134-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{latent_vars}{An integer vector of length nblocks containing the indices</span></span>
<span id="cb134-44"><a href="other-useful.html#cb134-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of all of the latent features.}</span></span>
<span id="cb134-45"><a href="other-useful.html#cb134-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb134-46"><a href="other-useful.html#cb134-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb134-47"><a href="other-useful.html#cb134-47" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb134-48"><a href="other-useful.html#cb134-48" aria-hidden="true" tabindex="-1"></a><span id='makeCoefficients'>makeCoefficients</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(p, k_unblocked, beta_low, beta_high, nblocks,</span>
<span id="cb134-49"><a href="other-useful.html#cb134-49" aria-hidden="true" tabindex="-1"></a>    sig_blocks, block_size){</span>
<span id="cb134-50"><a href="other-useful.html#cb134-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-51"><a href="other-useful.html#cb134-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb134-52"><a href="other-useful.html#cb134-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(k_unblocked <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb134-53"><a href="other-useful.html#cb134-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">&lt;=</span> nblocks)</span>
<span id="cb134-54"><a href="other-useful.html#cb134-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> nblocks<span class="sc">*</span>block_size <span class="sc">+</span> k_unblocked)</span>
<span id="cb134-55"><a href="other-useful.html#cb134-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb134-56"><a href="other-useful.html#cb134-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-57"><a href="other-useful.html#cb134-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialize beta</span></span>
<span id="cb134-58"><a href="other-useful.html#cb134-58" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">numeric</span>(p)</span>
<span id="cb134-59"><a href="other-useful.html#cb134-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-60"><a href="other-useful.html#cb134-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identify indices of first coefficient in each significant block (these</span></span>
<span id="cb134-61"><a href="other-useful.html#cb134-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># features will have coefficient beta_high)</span></span>
<span id="cb134-62"><a href="other-useful.html#cb134-62" aria-hidden="true" tabindex="-1"></a>    latent_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb134-63"><a href="other-useful.html#cb134-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>){</span>
<span id="cb134-64"><a href="other-useful.html#cb134-64" aria-hidden="true" tabindex="-1"></a>        latent_vars <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(((<span class="dv">0</span><span class="sc">:</span>(nblocks <span class="sc">-</span> <span class="dv">1</span>))<span class="sc">*</span>block_size <span class="sc">+</span> <span class="dv">1</span>))</span>
<span id="cb134-65"><a href="other-useful.html#cb134-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-66"><a href="other-useful.html#cb134-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(latent_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb134-67"><a href="other-useful.html#cb134-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(latent_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>(block_size<span class="sc">*</span>nblocks))</span>
<span id="cb134-68"><a href="other-useful.html#cb134-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(latent_vars)) <span class="sc">==</span> nblocks)</span>
<span id="cb134-69"><a href="other-useful.html#cb134-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> nblocks)</span>
<span id="cb134-70"><a href="other-useful.html#cb134-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb134-71"><a href="other-useful.html#cb134-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-72"><a href="other-useful.html#cb134-72" aria-hidden="true" tabindex="-1"></a>    blocked_dgp_vars <span class="ot">&lt;-</span> latent_vars[<span class="dv">1</span><span class="sc">:</span>sig_blocks]</span>
<span id="cb134-73"><a href="other-useful.html#cb134-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-74"><a href="other-useful.html#cb134-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">==</span> <span class="fu">length</span>(blocked_dgp_vars))</span>
<span id="cb134-75"><a href="other-useful.html#cb134-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb134-76"><a href="other-useful.html#cb134-76" aria-hidden="true" tabindex="-1"></a>    beta[blocked_dgp_vars] <span class="ot">&lt;-</span> beta_high</span>
<span id="cb134-77"><a href="other-useful.html#cb134-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-78"><a href="other-useful.html#cb134-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># identify remaining coefficients in blocks (which ought to be set to 0)</span></span>
<span id="cb134-79"><a href="other-useful.html#cb134-79" aria-hidden="true" tabindex="-1"></a>    insig_blocked_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb134-80"><a href="other-useful.html#cb134-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-81"><a href="other-useful.html#cb134-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(nblocks <span class="sc">&gt;=</span> <span class="dv">1</span>){</span>
<span id="cb134-82"><a href="other-useful.html#cb134-82" aria-hidden="true" tabindex="-1"></a>        insig_blocked_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>(block_size<span class="sc">*</span>nblocks), blocked_dgp_vars)</span>
<span id="cb134-83"><a href="other-useful.html#cb134-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(beta[insig_blocked_vars] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb134-84"><a href="other-useful.html#cb134-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb134-85"><a href="other-useful.html#cb134-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># find significant unblocked variables (if applicable) and fill in</span></span>
<span id="cb134-86"><a href="other-useful.html#cb134-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># coefficients</span></span>
<span id="cb134-87"><a href="other-useful.html#cb134-87" aria-hidden="true" tabindex="-1"></a>    sig_unblocked_vars <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb134-88"><a href="other-useful.html#cb134-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-89"><a href="other-useful.html#cb134-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(k_unblocked <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb134-90"><a href="other-useful.html#cb134-90" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Range of weak signal coefficients</span></span>
<span id="cb134-91"><a href="other-useful.html#cb134-91" aria-hidden="true" tabindex="-1"></a>        beta_lows <span class="ot">&lt;-</span> beta_low<span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">:</span>k_unblocked)</span>
<span id="cb134-92"><a href="other-useful.html#cb134-92" aria-hidden="true" tabindex="-1"></a>        sig_unblocked_vars <span class="ot">&lt;-</span> (nblocks<span class="sc">*</span>block_size <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span></span>
<span id="cb134-93"><a href="other-useful.html#cb134-93" aria-hidden="true" tabindex="-1"></a>            (nblocks<span class="sc">*</span>block_size <span class="sc">+</span> k_unblocked)</span>
<span id="cb134-94"><a href="other-useful.html#cb134-94" aria-hidden="true" tabindex="-1"></a>        sig_unblocked_vars <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(sig_unblocked_vars)</span>
<span id="cb134-95"><a href="other-useful.html#cb134-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-96"><a href="other-useful.html#cb134-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(sig_unblocked_vars) <span class="sc">==</span> k_unblocked)</span>
<span id="cb134-97"><a href="other-useful.html#cb134-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(sig_unblocked_vars)) <span class="sc">==</span> k_unblocked)</span>
<span id="cb134-98"><a href="other-useful.html#cb134-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(sig_unblocked_vars) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb134-99"><a href="other-useful.html#cb134-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-100"><a href="other-useful.html#cb134-100" aria-hidden="true" tabindex="-1"></a>        beta[sig_unblocked_vars] <span class="ot">&lt;-</span> beta_lows</span>
<span id="cb134-101"><a href="other-useful.html#cb134-101" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb134-102"><a href="other-useful.html#cb134-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-103"><a href="other-useful.html#cb134-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(blocked_dgp_vars, sig_unblocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb134-104"><a href="other-useful.html#cb134-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(sig_unblocked_vars, insig_blocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb134-105"><a href="other-useful.html#cb134-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(blocked_dgp_vars, insig_blocked_vars)) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb134-106"><a href="other-useful.html#cb134-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-107"><a href="other-useful.html#cb134-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(insig_blocked_vars) <span class="sc">+</span> <span class="fu">length</span>(blocked_dgp_vars) <span class="sc">==</span></span>
<span id="cb134-108"><a href="other-useful.html#cb134-108" aria-hidden="true" tabindex="-1"></a>        nblocks<span class="sc">*</span>block_size)</span>
<span id="cb134-109"><a href="other-useful.html#cb134-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-110"><a href="other-useful.html#cb134-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sig_blocks <span class="sc">+</span> <span class="fu">length</span>(insig_blocked_vars) <span class="sc">+</span> k_unblocked <span class="sc">&lt;=</span> p)</span>
<span id="cb134-111"><a href="other-useful.html#cb134-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-112"><a href="other-useful.html#cb134-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">sum</span>(beta <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">==</span> sig_blocks <span class="sc">+</span> k_unblocked)</span>
<span id="cb134-113"><a href="other-useful.html#cb134-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(beta) <span class="sc">|</span> <span class="fu">is.integer</span>(beta))</span>
<span id="cb134-114"><a href="other-useful.html#cb134-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-115"><a href="other-useful.html#cb134-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta=</span>beta, <span class="at">blocked_dgp_vars=</span>blocked_dgp_vars,</span>
<span id="cb134-116"><a href="other-useful.html#cb134-116" aria-hidden="true" tabindex="-1"></a>        <span class="at">sig_unblocked_vars=</span>sig_unblocked_vars,</span>
<span id="cb134-117"><a href="other-useful.html#cb134-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">insig_blocked_vars=</span>insig_blocked_vars, <span class="at">latent_vars=</span>latent_vars))</span>
<span id="cb134-118"><a href="other-useful.html#cb134-118" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for makeCoefficients</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="other-useful.html#cb135-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;makeCoefficients works&quot;</span>, {</span>
<span id="cb135-2"><a href="other-useful.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">5722</span>)</span>
<span id="cb135-3"><a href="other-useful.html#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="other-useful.html#cb135-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb135-5"><a href="other-useful.html#cb135-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb135-6"><a href="other-useful.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-7"><a href="other-useful.html#cb135-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb135-8"><a href="other-useful.html#cb135-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;blocked_dgp_vars&quot;</span>,</span>
<span id="cb135-9"><a href="other-useful.html#cb135-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;sig_unblocked_vars&quot;</span>,</span>
<span id="cb135-10"><a href="other-useful.html#cb135-10" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;insig_blocked_vars&quot;</span>, <span class="st">&quot;latent_vars&quot;</span>))</span>
<span id="cb135-11"><a href="other-useful.html#cb135-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-12"><a href="other-useful.html#cb135-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>beta))</span>
<span id="cb135-13"><a href="other-useful.html#cb135-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>beta), <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span>)</span>
<span id="cb135-14"><a href="other-useful.html#cb135-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">sum</span>(ret<span class="sc">$</span>beta <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">3</span>)</span>
<span id="cb135-15"><a href="other-useful.html#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Checking structure</span></span>
<span id="cb135-16"><a href="other-useful.html#cb135-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>beta[<span class="dv">1</span>], <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb135-17"><a href="other-useful.html#cb135-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb135-18"><a href="other-useful.html#cb135-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">==</span> <span class="fu">c</span>(.<span class="dv">9</span>, .<span class="dv">9</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span>))))</span>
<span id="cb135-19"><a href="other-useful.html#cb135-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret<span class="sc">$</span>beta[<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>] <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb135-20"><a href="other-useful.html#cb135-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-21"><a href="other-useful.html#cb135-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>blocked_dgp_vars) <span class="sc">|</span> <span class="fu">is.numeric</span>(ret<span class="sc">$</span>blocked_dgp_vars))</span>
<span id="cb135-22"><a href="other-useful.html#cb135-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>blocked_dgp_vars, <span class="dv">1</span>)</span>
<span id="cb135-23"><a href="other-useful.html#cb135-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-24"><a href="other-useful.html#cb135-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>sig_unblocked_vars, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb135-25"><a href="other-useful.html#cb135-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-26"><a href="other-useful.html#cb135-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>insig_blocked_vars, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb135-27"><a href="other-useful.html#cb135-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-28"><a href="other-useful.html#cb135-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>latent_vars, <span class="fu">c</span>(1L, 4L))</span>
<span id="cb135-29"><a href="other-useful.html#cb135-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-30"><a href="other-useful.html#cb135-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb135-31"><a href="other-useful.html#cb135-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb135-32"><a href="other-useful.html#cb135-32" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>,</span>
<span id="cb135-33"><a href="other-useful.html#cb135-33" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb135-34"><a href="other-useful.html#cb135-34" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unblocked &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-35"><a href="other-useful.html#cb135-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-36"><a href="other-useful.html#cb135-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb135-37"><a href="other-useful.html#cb135-37" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">3</span>,</span>
<span id="cb135-38"><a href="other-useful.html#cb135-38" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb135-39"><a href="other-useful.html#cb135-39" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_blocks &lt;= nblocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-40"><a href="other-useful.html#cb135-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-41"><a href="other-useful.html#cb135-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">7</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb135-42"><a href="other-useful.html#cb135-42" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>,</span>
<span id="cb135-43"><a href="other-useful.html#cb135-43" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb135-44"><a href="other-useful.html#cb135-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= nblocks * block_size + k_unblocked is not TRUE&quot;</span>,</span>
<span id="cb135-45"><a href="other-useful.html#cb135-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-46"><a href="other-useful.html#cb135-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-47"><a href="other-useful.html#cb135-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>,</span>
<span id="cb135-48"><a href="other-useful.html#cb135-48" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>,</span>
<span id="cb135-49"><a href="other-useful.html#cb135-49" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sig_blocks=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>),</span>
<span id="cb135-50"><a href="other-useful.html#cb135-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_blocks &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-51"><a href="other-useful.html#cb135-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-52"><a href="other-useful.html#cb135-52" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>genMuXZSd</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="other-useful.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate observed and latent variables along with conditional mean</span></span>
<span id="cb137-2"><a href="other-useful.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb137-3"><a href="other-useful.html#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n Integer or numeric; the number of observations to generate. (The</span></span>
<span id="cb137-4"><a href="other-useful.html#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated X and Z will have n rows, and the generated y and mu will have</span></span>
<span id="cb137-5"><a href="other-useful.html#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; length n.)</span></span>
<span id="cb137-6"><a href="other-useful.html#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer or numeric; the number of observed features (the generated X</span></span>
<span id="cb137-7"><a href="other-useful.html#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will have p columns).</span></span>
<span id="cb137-8"><a href="other-useful.html#cb137-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta A numeric or integer vector of length `p` + sig_blocks containing</span></span>
<span id="cb137-9"><a href="other-useful.html#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the coefficients for the true model for y.</span></span>
<span id="cb137-10"><a href="other-useful.html#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Sigma A (`p` + n_blocks) x (`p` + n_blocks) numeric matrix</span></span>
<span id="cb137-11"><a href="other-useful.html#cb137-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representing the covariance matrix for the latent features, the associated</span></span>
<span id="cb137-12"><a href="other-useful.html#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proxies, and the remaining features.</span></span>
<span id="cb137-13"><a href="other-useful.html#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param blocked_dgp_vars An integer vector of length sig_blocks containing the</span></span>
<span id="cb137-14"><a href="other-useful.html#cb137-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features corresponding to the latent features that have</span></span>
<span id="cb137-15"><a href="other-useful.html#cb137-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero coefficient beta_high in the true model for y.</span></span>
<span id="cb137-16"><a href="other-useful.html#cb137-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param latent_vars An integer vector of length n_blocks containing the</span></span>
<span id="cb137-17"><a href="other-useful.html#cb137-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of all of the latent features.</span></span>
<span id="cb137-18"><a href="other-useful.html#cb137-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param block_size Integer or numeric; for each of the n_blocks latent</span></span>
<span id="cb137-19"><a href="other-useful.html#cb137-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variables, X will contain block_size noisy proxies that are correlated with</span></span>
<span id="cb137-20"><a href="other-useful.html#cb137-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the latent variable.</span></span>
<span id="cb137-21"><a href="other-useful.html#cb137-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_blocks Integer or numeric; the number of latent variables to</span></span>
<span id="cb137-22"><a href="other-useful.html#cb137-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generate, each of which will be associated with an observed cluster in X.</span></span>
<span id="cb137-23"><a href="other-useful.html#cb137-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 1. Default is 1.</span></span>
<span id="cb137-24"><a href="other-useful.html#cb137-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param snr Integer or numeric; the signal-to-noise ratio of the response</span></span>
<span id="cb137-25"><a href="other-useful.html#cb137-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; y. If sigma_eps_sq is not specified, the variance of the noise in y will be</span></span>
<span id="cb137-26"><a href="other-useful.html#cb137-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; calculated using the formula sigma_eps_sq = sum(mu^2)/(n * snr). Only one of</span></span>
<span id="cb137-27"><a href="other-useful.html#cb137-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb137-28"><a href="other-useful.html#cb137-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sigma_eps_sq Integer or numeric; the variance on the noise added</span></span>
<span id="cb137-29"><a href="other-useful.html#cb137-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to y. Only one of snr and sigma_eps_sq must be specified. Default is NA.</span></span>
<span id="cb137-30"><a href="other-useful.html#cb137-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{X}{An `n` x `p`</span></span>
<span id="cb137-31"><a href="other-useful.html#cb137-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric matrix containing the observed proxies for the latent variables as</span></span>
<span id="cb137-32"><a href="other-useful.html#cb137-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; well as the observed unblocked (iid) variables.} \item{mu}{A length `n`</span></span>
<span id="cb137-33"><a href="other-useful.html#cb137-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; numeric vector; the expected response given X, Z, and the true</span></span>
<span id="cb137-34"><a href="other-useful.html#cb137-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coefficient vector (equal to y minus the added noise).} \item{z}{An `n` x</span></span>
<span id="cb137-35"><a href="other-useful.html#cb137-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; n_blocks numeric matrix containing the n_blocks latent variables. Note that</span></span>
<span id="cb137-36"><a href="other-useful.html#cb137-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (X, z) is multivariate Gaussian.} \item{sd}{Numeric; the standard deviation</span></span>
<span id="cb137-37"><a href="other-useful.html#cb137-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of the noise added to mu to get y (calculated either from snr or</span></span>
<span id="cb137-38"><a href="other-useful.html#cb137-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; sigma_eps_sq).}</span></span>
<span id="cb137-39"><a href="other-useful.html#cb137-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb137-40"><a href="other-useful.html#cb137-40" aria-hidden="true" tabindex="-1"></a><span id='genMuXZSd'>genMuXZSd</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n, p, beta, Sigma, blocked_dgp_vars,</span>
<span id="cb137-41"><a href="other-useful.html#cb137-41" aria-hidden="true" tabindex="-1"></a>    latent_vars, block_size, <span class="at">n_blocks=</span><span class="dv">1</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>){</span>
<span id="cb137-42"><a href="other-useful.html#cb137-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb137-43"><a href="other-useful.html#cb137-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-44"><a href="other-useful.html#cb137-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(blocked_dgp_vars) <span class="sc">&lt;=</span> n_blocks)</span>
<span id="cb137-45"><a href="other-useful.html#cb137-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(Sigma) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb137-46"><a href="other-useful.html#cb137-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(Sigma) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb137-47"><a href="other-useful.html#cb137-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb137-48"><a href="other-useful.html#cb137-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq))){</span>
<span id="cb137-49"><a href="other-useful.html#cb137-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sigma_eps_sq) <span class="sc">|</span> <span class="fu">is.integer</span>(sigma_eps_sq))</span>
<span id="cb137-50"><a href="other-useful.html#cb137-50" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(sigma_eps_sq) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb137-51"><a href="other-useful.html#cb137-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(sigma_eps_sq <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb137-52"><a href="other-useful.html#cb137-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb137-53"><a href="other-useful.html#cb137-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(snr))){</span>
<span id="cb137-54"><a href="other-useful.html#cb137-54" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Must provide one of snr or sigma_eps_sq&quot;</span>)</span>
<span id="cb137-55"><a href="other-useful.html#cb137-55" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb137-56"><a href="other-useful.html#cb137-56" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(snr) <span class="sc">|</span> <span class="fu">is.integer</span>(snr))</span>
<span id="cb137-57"><a href="other-useful.html#cb137-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(snr) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb137-58"><a href="other-useful.html#cb137-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(snr <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb137-59"><a href="other-useful.html#cb137-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-60"><a href="other-useful.html#cb137-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-61"><a href="other-useful.html#cb137-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(beta) <span class="sc">==</span> p <span class="sc">+</span> n_blocks)</span>
<span id="cb137-62"><a href="other-useful.html#cb137-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(beta[blocked_dgp_vars] <span class="sc">!=</span> <span class="dv">0</span>))</span>
<span id="cb137-63"><a href="other-useful.html#cb137-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-64"><a href="other-useful.html#cb137-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> n_blocks)</span>
<span id="cb137-65"><a href="other-useful.html#cb137-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-66"><a href="other-useful.html#cb137-66" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="at">n=</span>n, <span class="at">mu=</span><span class="fu">rep</span>(<span class="dv">0</span>, p <span class="sc">+</span> n_blocks), <span class="at">Sigma=</span>Sigma)</span>
<span id="cb137-67"><a href="other-useful.html#cb137-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-68"><a href="other-useful.html#cb137-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(beta) <span class="sc">==</span> <span class="fu">ncol</span>(x))</span>
<span id="cb137-69"><a href="other-useful.html#cb137-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-70"><a href="other-useful.html#cb137-70" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(x <span class="sc">%*%</span> beta)</span>
<span id="cb137-71"><a href="other-useful.html#cb137-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-72"><a href="other-useful.html#cb137-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove true blocked signal feature from each block from x now that I&#39;ve</span></span>
<span id="cb137-73"><a href="other-useful.html#cb137-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generated mu</span></span>
<span id="cb137-74"><a href="other-useful.html#cb137-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_blocks <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb137-75"><a href="other-useful.html#cb137-75" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">nrow=</span>n, <span class="at">ncol=</span>n_blocks)</span>
<span id="cb137-76"><a href="other-useful.html#cb137-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb137-77"><a href="other-useful.html#cb137-77" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb137-78"><a href="other-useful.html#cb137-78" aria-hidden="true" tabindex="-1"></a>        z <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb137-79"><a href="other-useful.html#cb137-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(latent_vars) <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb137-80"><a href="other-useful.html#cb137-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-81"><a href="other-useful.html#cb137-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb137-82"><a href="other-useful.html#cb137-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb137-83"><a href="other-useful.html#cb137-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(latent_vars) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb137-84"><a href="other-useful.html#cb137-84" aria-hidden="true" tabindex="-1"></a>        z[, <span class="dv">1</span><span class="sc">:</span>n_blocks] <span class="ot">&lt;-</span> x[, latent_vars]</span>
<span id="cb137-85"><a href="other-useful.html#cb137-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-86"><a href="other-useful.html#cb137-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-87"><a href="other-useful.html#cb137-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb137-88"><a href="other-useful.html#cb137-88" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[, <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>(p <span class="sc">+</span> n_blocks), latent_vars)]</span>
<span id="cb137-89"><a href="other-useful.html#cb137-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-90"><a href="other-useful.html#cb137-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If SNR is null, use sigma_eps_sq</span></span>
<span id="cb137-91"><a href="other-useful.html#cb137-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(sigma_eps_sq)){</span>
<span id="cb137-92"><a href="other-useful.html#cb137-92" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(sigma_eps_sq)</span>
<span id="cb137-93"><a href="other-useful.html#cb137-93" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{</span>
<span id="cb137-94"><a href="other-useful.html#cb137-94" aria-hidden="true" tabindex="-1"></a>        sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(mu<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (n <span class="sc">*</span> snr)) <span class="co"># taking snr = ||mu||^2 /(n * sigma^2)</span></span>
<span id="cb137-95"><a href="other-useful.html#cb137-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-96"><a href="other-useful.html#cb137-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-97"><a href="other-useful.html#cb137-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb137-98"><a href="other-useful.html#cb137-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-99"><a href="other-useful.html#cb137-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(mu) <span class="sc">==</span> n)</span>
<span id="cb137-100"><a href="other-useful.html#cb137-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-101"><a href="other-useful.html#cb137-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(x) <span class="sc">==</span> n)</span>
<span id="cb137-102"><a href="other-useful.html#cb137-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(x) <span class="sc">==</span> p)</span>
<span id="cb137-103"><a href="other-useful.html#cb137-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-104"><a href="other-useful.html#cb137-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span><span class="fu">is.na</span>(z))){</span>
<span id="cb137-105"><a href="other-useful.html#cb137-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(z) <span class="sc">==</span> n)</span>
<span id="cb137-106"><a href="other-useful.html#cb137-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(z) <span class="sc">==</span> n_blocks)</span>
<span id="cb137-107"><a href="other-useful.html#cb137-107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb137-108"><a href="other-useful.html#cb137-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-109"><a href="other-useful.html#cb137-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sd) <span class="sc">|</span> <span class="fu">is.integer</span>(sd))</span>
<span id="cb137-110"><a href="other-useful.html#cb137-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sd) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb137-111"><a href="other-useful.html#cb137-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(sd))</span>
<span id="cb137-112"><a href="other-useful.html#cb137-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(sd <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb137-113"><a href="other-useful.html#cb137-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-114"><a href="other-useful.html#cb137-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">X=</span>x, <span class="at">mu=</span>mu, <span class="at">z=</span>z, <span class="at">sd=</span>sd))</span>
<span id="cb137-115"><a href="other-useful.html#cb137-115" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for genMuXZSd</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="other-useful.html#cb138-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genMuXZSd works&quot;</span>, {</span>
<span id="cb138-2"><a href="other-useful.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">61232</span>)</span>
<span id="cb138-3"><a href="other-useful.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-4"><a href="other-useful.html#cb138-4" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">rho=</span><span class="fl">0.2499</span>,</span>
<span id="cb138-5"><a href="other-useful.html#cb138-5" aria-hidden="true" tabindex="-1"></a>                                <span class="at">var=</span>.<span class="dv">25</span>)</span>
<span id="cb138-6"><a href="other-useful.html#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="other-useful.html#cb138-7" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb138-8"><a href="other-useful.html#cb138-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb138-9"><a href="other-useful.html#cb138-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-10"><a href="other-useful.html#cb138-10" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-11"><a href="other-useful.html#cb138-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-12"><a href="other-useful.html#cb138-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb138-13"><a href="other-useful.html#cb138-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>)</span>
<span id="cb138-14"><a href="other-useful.html#cb138-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-15"><a href="other-useful.html#cb138-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb138-16"><a href="other-useful.html#cb138-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb138-17"><a href="other-useful.html#cb138-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-18"><a href="other-useful.html#cb138-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb138-19"><a href="other-useful.html#cb138-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb138-20"><a href="other-useful.html#cb138-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb138-21"><a href="other-useful.html#cb138-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">9</span>)</span>
<span id="cb138-22"><a href="other-useful.html#cb138-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 1/4; expect all observations to lie</span></span>
<span id="cb138-23"><a href="other-useful.html#cb138-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb138-24"><a href="other-useful.html#cb138-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fl">0.25</span>)))</span>
<span id="cb138-25"><a href="other-useful.html#cb138-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-26"><a href="other-useful.html#cb138-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb138-27"><a href="other-useful.html#cb138-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb138-28"><a href="other-useful.html#cb138-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb138-29"><a href="other-useful.html#cb138-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb138-30"><a href="other-useful.html#cb138-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-31"><a href="other-useful.html#cb138-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb138-32"><a href="other-useful.html#cb138-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb138-33"><a href="other-useful.html#cb138-33" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb138-34"><a href="other-useful.html#cb138-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-35"><a href="other-useful.html#cb138-35" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">7</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb138-36"><a href="other-useful.html#cb138-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb138-37"><a href="other-useful.html#cb138-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-38"><a href="other-useful.html#cb138-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-39"><a href="other-useful.html#cb138-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb138-40"><a href="other-useful.html#cb138-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb138-41"><a href="other-useful.html#cb138-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-42"><a href="other-useful.html#cb138-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-43"><a href="other-useful.html#cb138-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-44"><a href="other-useful.html#cb138-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">25</span>)</span>
<span id="cb138-45"><a href="other-useful.html#cb138-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">2</span>)</span>
<span id="cb138-46"><a href="other-useful.html#cb138-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-47"><a href="other-useful.html#cb138-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>sd))</span>
<span id="cb138-48"><a href="other-useful.html#cb138-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret<span class="sc">$</span>sd, <span class="fu">sqrt</span>(<span class="fl">1.2</span>))</span>
<span id="cb138-49"><a href="other-useful.html#cb138-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-50"><a href="other-useful.html#cb138-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sd</span></span>
<span id="cb138-51"><a href="other-useful.html#cb138-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-52"><a href="other-useful.html#cb138-52" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-53"><a href="other-useful.html#cb138-53" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-54"><a href="other-useful.html#cb138-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb138-55"><a href="other-useful.html#cb138-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb138-56"><a href="other-useful.html#cb138-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-57"><a href="other-useful.html#cb138-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb138-58"><a href="other-useful.html#cb138-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb138-59"><a href="other-useful.html#cb138-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-60"><a href="other-useful.html#cb138-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb138-61"><a href="other-useful.html#cb138-61" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb138-62"><a href="other-useful.html#cb138-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">5</span>)</span>
<span id="cb138-63"><a href="other-useful.html#cb138-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">9</span>)</span>
<span id="cb138-64"><a href="other-useful.html#cb138-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-65"><a href="other-useful.html#cb138-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb138-66"><a href="other-useful.html#cb138-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">5</span>)</span>
<span id="cb138-67"><a href="other-useful.html#cb138-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-68"><a href="other-useful.html#cb138-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-69"><a href="other-useful.html#cb138-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-70"><a href="other-useful.html#cb138-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">5</span>)</span>
<span id="cb138-71"><a href="other-useful.html#cb138-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">2</span>)</span>
<span id="cb138-72"><a href="other-useful.html#cb138-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-73"><a href="other-useful.html#cb138-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>sd))</span>
<span id="cb138-74"><a href="other-useful.html#cb138-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret<span class="sc">$</span>sd <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb138-75"><a href="other-useful.html#cb138-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-76"><a href="other-useful.html#cb138-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb138-77"><a href="other-useful.html#cb138-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-78"><a href="other-useful.html#cb138-78" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">nblocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb138-79"><a href="other-useful.html#cb138-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-80"><a href="other-useful.html#cb138-80" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">1</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb138-81"><a href="other-useful.html#cb138-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">1</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb138-82"><a href="other-useful.html#cb138-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-83"><a href="other-useful.html#cb138-83" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-84"><a href="other-useful.html#cb138-84" aria-hidden="true" tabindex="-1"></a>                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-85"><a href="other-useful.html#cb138-85" aria-hidden="true" tabindex="-1"></a>                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>,</span>
<span id="cb138-86"><a href="other-useful.html#cb138-86" aria-hidden="true" tabindex="-1"></a>                   <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>)</span>
<span id="cb138-87"><a href="other-useful.html#cb138-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-88"><a href="other-useful.html#cb138-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb138-89"><a href="other-useful.html#cb138-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;mu&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="st">&quot;sd&quot;</span>))</span>
<span id="cb138-90"><a href="other-useful.html#cb138-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-91"><a href="other-useful.html#cb138-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-92"><a href="other-useful.html#cb138-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>z))</span>
<span id="cb138-93"><a href="other-useful.html#cb138-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>z), <span class="dv">5</span>)</span>
<span id="cb138-94"><a href="other-useful.html#cb138-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>z), <span class="dv">1</span>)</span>
<span id="cb138-95"><a href="other-useful.html#cb138-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-96"><a href="other-useful.html#cb138-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb138-97"><a href="other-useful.html#cb138-97" aria-hidden="true" tabindex="-1"></a>  Sigma <span class="ot">&lt;-</span> <a href='other-useful.html#makeCovarianceMatrix'>makeCovarianceMatrix</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">rho=</span><span class="fl">0.8</span>, <span class="at">var=</span><span class="dv">2</span>)</span>
<span id="cb138-98"><a href="other-useful.html#cb138-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-99"><a href="other-useful.html#cb138-99" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <a href='other-useful.html#makeCoefficients'>makeCoefficients</a>(<span class="at">p=</span><span class="dv">9</span><span class="sc">+</span><span class="dv">2</span>, <span class="at">k_unblocked=</span><span class="dv">2</span>, <span class="at">beta_low=</span>.<span class="dv">9</span>, <span class="at">beta_high=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb138-100"><a href="other-useful.html#cb138-100" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nblocks=</span><span class="dv">2</span>, <span class="at">sig_blocks=</span><span class="dv">1</span>, <span class="at">block_size=</span><span class="dv">3</span>)</span>
<span id="cb138-101"><a href="other-useful.html#cb138-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-102"><a href="other-useful.html#cb138-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-103"><a href="other-useful.html#cb138-103" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-104"><a href="other-useful.html#cb138-104" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">0</span>,</span>
<span id="cb138-105"><a href="other-useful.html#cb138-105" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>),</span>
<span id="cb138-106"><a href="other-useful.html#cb138-106" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(blocked_dgp_vars) &lt;= n_blocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-107"><a href="other-useful.html#cb138-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-108"><a href="other-useful.html#cb138-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-109"><a href="other-useful.html#cb138-109" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-110"><a href="other-useful.html#cb138-110" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">1</span>,</span>
<span id="cb138-111"><a href="other-useful.html#cb138-111" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="fl">1.2</span>),</span>
<span id="cb138-112"><a href="other-useful.html#cb138-112" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nrow(Sigma) == p + n_blocks is not TRUE&quot;</span>,</span>
<span id="cb138-113"><a href="other-useful.html#cb138-113" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-114"><a href="other-useful.html#cb138-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-115"><a href="other-useful.html#cb138-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-116"><a href="other-useful.html#cb138-116" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-117"><a href="other-useful.html#cb138-117" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-118"><a href="other-useful.html#cb138-118" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="st">&quot;1.2&quot;</span>),</span>
<span id="cb138-119"><a href="other-useful.html#cb138-119" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sigma_eps_sq) | is.integer(sigma_eps_sq) is not TRUE&quot;</span>,</span>
<span id="cb138-120"><a href="other-useful.html#cb138-120" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-121"><a href="other-useful.html#cb138-121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-122"><a href="other-useful.html#cb138-122" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-123"><a href="other-useful.html#cb138-123" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-124"><a href="other-useful.html#cb138-124" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-125"><a href="other-useful.html#cb138-125" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb138-126"><a href="other-useful.html#cb138-126" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(sigma_eps_sq) == 1 is not TRUE&quot;</span>,</span>
<span id="cb138-127"><a href="other-useful.html#cb138-127" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-128"><a href="other-useful.html#cb138-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-129"><a href="other-useful.html#cb138-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-130"><a href="other-useful.html#cb138-130" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-131"><a href="other-useful.html#cb138-131" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-132"><a href="other-useful.html#cb138-132" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb138-133"><a href="other-useful.html#cb138-133" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-134"><a href="other-useful.html#cb138-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-135"><a href="other-useful.html#cb138-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-136"><a href="other-useful.html#cb138-136" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-137"><a href="other-useful.html#cb138-137" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-138"><a href="other-useful.html#cb138-138" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-139"><a href="other-useful.html#cb138-139" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must provide one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-140"><a href="other-useful.html#cb138-140" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-141"><a href="other-useful.html#cb138-141" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-142"><a href="other-useful.html#cb138-142" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-143"><a href="other-useful.html#cb138-143" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-144"><a href="other-useful.html#cb138-144" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="st">&quot;1&quot;</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-145"><a href="other-useful.html#cb138-145" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(snr) | is.integer(snr) is not TRUE&quot;</span>,</span>
<span id="cb138-146"><a href="other-useful.html#cb138-146" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-147"><a href="other-useful.html#cb138-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-148"><a href="other-useful.html#cb138-148" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-149"><a href="other-useful.html#cb138-149" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-150"><a href="other-useful.html#cb138-150" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-151"><a href="other-useful.html#cb138-151" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-152"><a href="other-useful.html#cb138-152" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(snr) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-153"><a href="other-useful.html#cb138-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-154"><a href="other-useful.html#cb138-154" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-155"><a href="other-useful.html#cb138-155" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-156"><a href="other-useful.html#cb138-156" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-157"><a href="other-useful.html#cb138-157" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-158"><a href="other-useful.html#cb138-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-159"><a href="other-useful.html#cb138-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-160"><a href="other-useful.html#cb138-160" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-161"><a href="other-useful.html#cb138-161" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-162"><a href="other-useful.html#cb138-162" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-163"><a href="other-useful.html#cb138-163" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-164"><a href="other-useful.html#cb138-164" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(beta) == p + n_blocks is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-165"><a href="other-useful.html#cb138-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-166"><a href="other-useful.html#cb138-166" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span><span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">9</span> <span class="sc">+</span> <span class="dv">2</span>), <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-167"><a href="other-useful.html#cb138-167" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-168"><a href="other-useful.html#cb138-168" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span>coefs<span class="sc">$</span>latent_vars, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-169"><a href="other-useful.html#cb138-169" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-170"><a href="other-useful.html#cb138-170" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(beta[blocked_dgp_vars] != 0) is not TRUE&quot;</span>,</span>
<span id="cb138-171"><a href="other-useful.html#cb138-171" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-172"><a href="other-useful.html#cb138-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb138-173"><a href="other-useful.html#cb138-173" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genMuXZSd'>genMuXZSd</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">9</span>, <span class="at">beta=</span>coefs<span class="sc">$</span>beta, <span class="at">Sigma=</span>Sigma,</span>
<span id="cb138-174"><a href="other-useful.html#cb138-174" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">blocked_dgp_vars=</span>coefs<span class="sc">$</span>blocked_dgp_vars,</span>
<span id="cb138-175"><a href="other-useful.html#cb138-175" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">latent_vars=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">n_blocks=</span><span class="dv">2</span>,</span>
<span id="cb138-176"><a href="other-useful.html#cb138-176" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">block_size=</span><span class="dv">3</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb138-177"><a href="other-useful.html#cb138-177" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(latent_vars) == n_blocks is not TRUE&quot;</span>,</span>
<span id="cb138-178"><a href="other-useful.html#cb138-178" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb138-179"><a href="other-useful.html#cb138-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-180"><a href="other-useful.html#cb138-180" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🥇</code></pre>
<p>Finally, tests for genClusteredData</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="other-useful.html#cb140-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;genClusteredData works&quot;</span>, {</span>
<span id="cb140-2"><a href="other-useful.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23478</span>)</span>
<span id="cb140-3"><a href="other-useful.html#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="other-useful.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">25</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-5"><a href="other-useful.html#cb140-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">3.99</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-6"><a href="other-useful.html#cb140-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb140-7"><a href="other-useful.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-8"><a href="other-useful.html#cb140-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb140-9"><a href="other-useful.html#cb140-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb140-10"><a href="other-useful.html#cb140-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-11"><a href="other-useful.html#cb140-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>X))</span>
<span id="cb140-12"><a href="other-useful.html#cb140-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>X))</span>
<span id="cb140-13"><a href="other-useful.html#cb140-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>X), <span class="dv">19</span>)</span>
<span id="cb140-14"><a href="other-useful.html#cb140-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>X), <span class="dv">25</span>)</span>
<span id="cb140-15"><a href="other-useful.html#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X is Gaussian with mean 0 and variance 4; expect all observations to lie</span></span>
<span id="cb140-16"><a href="other-useful.html#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># within 5 standard deviations of mean</span></span>
<span id="cb140-17"><a href="other-useful.html#cb140-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>X) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span><span class="dv">2</span>))</span>
<span id="cb140-18"><a href="other-useful.html#cb140-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test that clusters are correlated--within-cluster correlation should be</span></span>
<span id="cb140-19"><a href="other-useful.html#cb140-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># high, correlation with other features should be low</span></span>
<span id="cb140-20"><a href="other-useful.html#cb140-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb140-21"><a href="other-useful.html#cb140-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">19</span>]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb140-22"><a href="other-useful.html#cb140-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-23"><a href="other-useful.html#cb140-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb140-24"><a href="other-useful.html#cb140-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>],</span>
<span id="cb140-25"><a href="other-useful.html#cb140-25" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">11</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb140-26"><a href="other-useful.html#cb140-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-27"><a href="other-useful.html#cb140-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">min</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>])) <span class="sc">&gt;</span> .<span class="dv">9</span>)</span>
<span id="cb140-28"><a href="other-useful.html#cb140-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(<span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>],</span>
<span id="cb140-29"><a href="other-useful.html#cb140-29" aria-hidden="true" tabindex="-1"></a>                                    ret<span class="sc">$</span>X[, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>)]))) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb140-30"><a href="other-useful.html#cb140-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-31"><a href="other-useful.html#cb140-31" aria-hidden="true" tabindex="-1"></a>  cor_indeps <span class="ot">&lt;-</span> <span class="fu">cor</span>(ret<span class="sc">$</span>X[, <span class="dv">16</span><span class="sc">:</span><span class="dv">19</span>])</span>
<span id="cb140-32"><a href="other-useful.html#cb140-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">max</span>(<span class="fu">abs</span>(cor_indeps[<span class="fu">lower.tri</span>(cor_indeps)])) <span class="sc">&lt;</span> .<span class="dv">6</span>)</span>
<span id="cb140-33"><a href="other-useful.html#cb140-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-34"><a href="other-useful.html#cb140-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>y))</span>
<span id="cb140-35"><a href="other-useful.html#cb140-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>y), <span class="dv">25</span>)</span>
<span id="cb140-36"><a href="other-useful.html#cb140-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-37"><a href="other-useful.html#cb140-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb140-38"><a href="other-useful.html#cb140-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb140-39"><a href="other-useful.html#cb140-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">25</span>)</span>
<span id="cb140-40"><a href="other-useful.html#cb140-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">3</span>)</span>
<span id="cb140-41"><a href="other-useful.html#cb140-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-42"><a href="other-useful.html#cb140-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>mu))</span>
<span id="cb140-43"><a href="other-useful.html#cb140-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>mu), <span class="dv">25</span>)</span>
<span id="cb140-44"><a href="other-useful.html#cb140-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb140-45"><a href="other-useful.html#cb140-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb140-46"><a href="other-useful.html#cb140-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">5</span>))</span>
<span id="cb140-47"><a href="other-useful.html#cb140-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-48"><a href="other-useful.html#cb140-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specify SNR instead of sigma_eps_sq</span></span>
<span id="cb140-49"><a href="other-useful.html#cb140-49" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-50"><a href="other-useful.html#cb140-50" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-51"><a href="other-useful.html#cb140-51" aria-hidden="true" tabindex="-1"></a>                       <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>)</span>
<span id="cb140-52"><a href="other-useful.html#cb140-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-53"><a href="other-useful.html#cb140-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb140-54"><a href="other-useful.html#cb140-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb140-55"><a href="other-useful.html#cb140-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-56"><a href="other-useful.html#cb140-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If sigma_eps_sq is specified, snr should be ignored. (Set an SNR that</span></span>
<span id="cb140-57"><a href="other-useful.html#cb140-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implies a very large noise variance to test this)</span></span>
<span id="cb140-58"><a href="other-useful.html#cb140-58" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-59"><a href="other-useful.html#cb140-59" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-60"><a href="other-useful.html#cb140-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span>.<span class="dv">01</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">25</span>)</span>
<span id="cb140-61"><a href="other-useful.html#cb140-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-62"><a href="other-useful.html#cb140-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb140-63"><a href="other-useful.html#cb140-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb140-64"><a href="other-useful.html#cb140-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-65"><a href="other-useful.html#cb140-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Because y is Gaussian with mean mu and standard deviation .5 conditional on</span></span>
<span id="cb140-66"><a href="other-useful.html#cb140-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mu, expect all observations to lie within 5 sds of mu</span></span>
<span id="cb140-67"><a href="other-useful.html#cb140-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(ret<span class="sc">$</span>y <span class="sc">-</span> ret<span class="sc">$</span>mu) <span class="sc">&lt;</span> <span class="dv">5</span><span class="sc">*</span>.<span class="dv">25</span>))</span>
<span id="cb140-68"><a href="other-useful.html#cb140-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-69"><a href="other-useful.html#cb140-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try a single latent variable (z should be a one-column matrix)</span></span>
<span id="cb140-70"><a href="other-useful.html#cb140-70" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>, <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">1</span>,</span>
<span id="cb140-71"><a href="other-useful.html#cb140-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="dv">4</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-72"><a href="other-useful.html#cb140-72" aria-hidden="true" tabindex="-1"></a>                <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>, <span class="at">sigma_eps_sq=</span>.<span class="dv">5</span>)</span>
<span id="cb140-73"><a href="other-useful.html#cb140-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-74"><a href="other-useful.html#cb140-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(ret))</span>
<span id="cb140-75"><a href="other-useful.html#cb140-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(ret), <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>, <span class="st">&quot;mu&quot;</span>))</span>
<span id="cb140-76"><a href="other-useful.html#cb140-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-77"><a href="other-useful.html#cb140-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb140-78"><a href="other-useful.html#cb140-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(ret<span class="sc">$</span>Z))</span>
<span id="cb140-79"><a href="other-useful.html#cb140-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret<span class="sc">$</span>Z), <span class="dv">5</span>)</span>
<span id="cb140-80"><a href="other-useful.html#cb140-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(ret<span class="sc">$</span>Z), <span class="dv">1</span>)</span>
<span id="cb140-81"><a href="other-useful.html#cb140-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-82"><a href="other-useful.html#cb140-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb140-83"><a href="other-useful.html#cb140-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-84"><a href="other-useful.html#cb140-84" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-85"><a href="other-useful.html#cb140-85" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">sig_clusters=</span><span class="st">&quot;2&quot;</span>, <span class="at">rho=</span>.<span class="dv">8</span>, <span class="at">var=</span><span class="fl">1.1</span>,</span>
<span id="cb140-86"><a href="other-useful.html#cb140-86" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">beta_latent=</span><span class="fl">1.5</span>, <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb140-87"><a href="other-useful.html#cb140-87" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">snr=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-88"><a href="other-useful.html#cb140-88" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(sig_clusters) | is.integer(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb140-89"><a href="other-useful.html#cb140-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-90"><a href="other-useful.html#cb140-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-91"><a href="other-useful.html#cb140-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-92"><a href="other-useful.html#cb140-92" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-93"><a href="other-useful.html#cb140-93" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">4</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-94"><a href="other-useful.html#cb140-94" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-95"><a href="other-useful.html#cb140-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-96"><a href="other-useful.html#cb140-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-97"><a href="other-useful.html#cb140-97" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-98"><a href="other-useful.html#cb140-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-99"><a href="other-useful.html#cb140-99" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-100"><a href="other-useful.html#cb140-100" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-101"><a href="other-useful.html#cb140-101" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-102"><a href="other-useful.html#cb140-102" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-103"><a href="other-useful.html#cb140-103" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-104"><a href="other-useful.html#cb140-104" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-105"><a href="other-useful.html#cb140-105" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-106"><a href="other-useful.html#cb140-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-107"><a href="other-useful.html#cb140-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-108"><a href="other-useful.html#cb140-108" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-109"><a href="other-useful.html#cb140-109" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span>.<span class="dv">6</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-110"><a href="other-useful.html#cb140-110" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-111"><a href="other-useful.html#cb140-111" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-112"><a href="other-useful.html#cb140-112" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-113"><a href="other-useful.html#cb140-113" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sig_clusters == round(sig_clusters) is not TRUE&quot;</span>,</span>
<span id="cb140-114"><a href="other-useful.html#cb140-114" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-115"><a href="other-useful.html#cb140-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-116"><a href="other-useful.html#cb140-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-117"><a href="other-useful.html#cb140-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_clusters</span></span>
<span id="cb140-118"><a href="other-useful.html#cb140-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-119"><a href="other-useful.html#cb140-119" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>,</span>
<span id="cb140-120"><a href="other-useful.html#cb140-120" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">n_clusters=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb140-121"><a href="other-useful.html#cb140-121" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-122"><a href="other-useful.html#cb140-122" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-123"><a href="other-useful.html#cb140-123" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-124"><a href="other-useful.html#cb140-124" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-125"><a href="other-useful.html#cb140-125" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(n_clusters) | is.integer(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb140-126"><a href="other-useful.html#cb140-126" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-127"><a href="other-useful.html#cb140-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-128"><a href="other-useful.html#cb140-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-129"><a href="other-useful.html#cb140-129" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="fl">3.2</span>,</span>
<span id="cb140-130"><a href="other-useful.html#cb140-130" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-131"><a href="other-useful.html#cb140-131" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-132"><a href="other-useful.html#cb140-132" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-133"><a href="other-useful.html#cb140-133" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-134"><a href="other-useful.html#cb140-134" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters == round(n_clusters) is not TRUE&quot;</span>,</span>
<span id="cb140-135"><a href="other-useful.html#cb140-135" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-136"><a href="other-useful.html#cb140-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-137"><a href="other-useful.html#cb140-137" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-138"><a href="other-useful.html#cb140-138" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">0</span>,</span>
<span id="cb140-139"><a href="other-useful.html#cb140-139" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">0</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-140"><a href="other-useful.html#cb140-140" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-141"><a href="other-useful.html#cb140-141" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-142"><a href="other-useful.html#cb140-142" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-143"><a href="other-useful.html#cb140-143" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_clusters &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-144"><a href="other-useful.html#cb140-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-145"><a href="other-useful.html#cb140-145" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-146"><a href="other-useful.html#cb140-146" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span>.<span class="dv">3</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-147"><a href="other-useful.html#cb140-147" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-148"><a href="other-useful.html#cb140-148" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-149"><a href="other-useful.html#cb140-149" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-150"><a href="other-useful.html#cb140-150" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-151"><a href="other-useful.html#cb140-151" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cluster_size &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-152"><a href="other-useful.html#cb140-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-153"><a href="other-useful.html#cb140-153" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">p=</span><span class="dv">16</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-154"><a href="other-useful.html#cb140-154" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-155"><a href="other-useful.html#cb140-155" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span>.<span class="dv">8</span>,</span>
<span id="cb140-156"><a href="other-useful.html#cb140-156" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-157"><a href="other-useful.html#cb140-157" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-158"><a href="other-useful.html#cb140-158" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-159"><a href="other-useful.html#cb140-159" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;p &gt;= n_clusters * cluster_size + k_unclustered is not TRUE&quot;</span>,</span>
<span id="cb140-160"><a href="other-useful.html#cb140-160" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-161"><a href="other-useful.html#cb140-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-162"><a href="other-useful.html#cb140-162" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-163"><a href="other-useful.html#cb140-163" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-164"><a href="other-useful.html#cb140-164" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">8</span>,</span>
<span id="cb140-165"><a href="other-useful.html#cb140-165" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-166"><a href="other-useful.html#cb140-166" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-167"><a href="other-useful.html#cb140-167" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-168"><a href="other-useful.html#cb140-168" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;abs(rho) &lt;= abs(var) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-169"><a href="other-useful.html#cb140-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-170"><a href="other-useful.html#cb140-170" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-171"><a href="other-useful.html#cb140-171" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-172"><a href="other-useful.html#cb140-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="dv">0</span>,</span>
<span id="cb140-173"><a href="other-useful.html#cb140-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-174"><a href="other-useful.html#cb140-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-175"><a href="other-useful.html#cb140-175" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-176"><a href="other-useful.html#cb140-176" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;rho != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-177"><a href="other-useful.html#cb140-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-178"><a href="other-useful.html#cb140-178" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-179"><a href="other-useful.html#cb140-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-180"><a href="other-useful.html#cb140-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-181"><a href="other-useful.html#cb140-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="sc">-</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-182"><a href="other-useful.html#cb140-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-183"><a href="other-useful.html#cb140-183" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-184"><a href="other-useful.html#cb140-184" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;var &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-185"><a href="other-useful.html#cb140-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-186"><a href="other-useful.html#cb140-186" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-187"><a href="other-useful.html#cb140-187" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-188"><a href="other-useful.html#cb140-188" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-189"><a href="other-useful.html#cb140-189" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="dv">0</span>,</span>
<span id="cb140-190"><a href="other-useful.html#cb140-190" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-191"><a href="other-useful.html#cb140-191" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-192"><a href="other-useful.html#cb140-192" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_latent != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-193"><a href="other-useful.html#cb140-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-194"><a href="other-useful.html#cb140-194" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-195"><a href="other-useful.html#cb140-195" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-196"><a href="other-useful.html#cb140-196" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-197"><a href="other-useful.html#cb140-197" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-198"><a href="other-useful.html#cb140-198" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="dv">0</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-199"><a href="other-useful.html#cb140-199" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-200"><a href="other-useful.html#cb140-200" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;beta_unclustered != 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-201"><a href="other-useful.html#cb140-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-202"><a href="other-useful.html#cb140-202" aria-hidden="true" tabindex="-1"></a>  <span class="co"># k_unclustered</span></span>
<span id="cb140-203"><a href="other-useful.html#cb140-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb140-204"><a href="other-useful.html#cb140-204" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-205"><a href="other-useful.html#cb140-205" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-206"><a href="other-useful.html#cb140-206" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-207"><a href="other-useful.html#cb140-207" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-208"><a href="other-useful.html#cb140-208" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-209"><a href="other-useful.html#cb140-209" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(k_unclustered) | is.integer(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb140-210"><a href="other-useful.html#cb140-210" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-211"><a href="other-useful.html#cb140-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-212"><a href="other-useful.html#cb140-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb140-213"><a href="other-useful.html#cb140-213" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-214"><a href="other-useful.html#cb140-214" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-215"><a href="other-useful.html#cb140-215" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-216"><a href="other-useful.html#cb140-216" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-217"><a href="other-useful.html#cb140-217" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-218"><a href="other-useful.html#cb140-218" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-219"><a href="other-useful.html#cb140-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-220"><a href="other-useful.html#cb140-220" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span>.<span class="dv">2</span>,</span>
<span id="cb140-221"><a href="other-useful.html#cb140-221" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-222"><a href="other-useful.html#cb140-222" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-223"><a href="other-useful.html#cb140-223" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-224"><a href="other-useful.html#cb140-224" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="dv">1</span>,</span>
<span id="cb140-225"><a href="other-useful.html#cb140-225" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-226"><a href="other-useful.html#cb140-226" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;k_unclustered == round(k_unclustered) is not TRUE&quot;</span>,</span>
<span id="cb140-227"><a href="other-useful.html#cb140-227" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-228"><a href="other-useful.html#cb140-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-229"><a href="other-useful.html#cb140-229" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-230"><a href="other-useful.html#cb140-230" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-231"><a href="other-useful.html#cb140-231" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-232"><a href="other-useful.html#cb140-232" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-233"><a href="other-useful.html#cb140-233" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb140-234"><a href="other-useful.html#cb140-234" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-235"><a href="other-useful.html#cb140-235" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Must specify one of snr or sigma_eps_sq&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-236"><a href="other-useful.html#cb140-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-237"><a href="other-useful.html#cb140-237" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-238"><a href="other-useful.html#cb140-238" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-239"><a href="other-useful.html#cb140-239" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-240"><a href="other-useful.html#cb140-240" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-241"><a href="other-useful.html#cb140-241" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="sc">-</span>.<span class="dv">2</span>,</span>
<span id="cb140-242"><a href="other-useful.html#cb140-242" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="cn">NA</span>),</span>
<span id="cb140-243"><a href="other-useful.html#cb140-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;snr &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-244"><a href="other-useful.html#cb140-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-245"><a href="other-useful.html#cb140-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">5</span>, <span class="at">p=</span><span class="dv">19</span>, <span class="at">k_unclustered=</span><span class="dv">2</span>,</span>
<span id="cb140-246"><a href="other-useful.html#cb140-246" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cluster_size=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">3</span>,</span>
<span id="cb140-247"><a href="other-useful.html#cb140-247" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sig_clusters=</span><span class="dv">2</span>, <span class="at">rho=</span><span class="fl">0.8</span>,</span>
<span id="cb140-248"><a href="other-useful.html#cb140-248" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">var=</span><span class="fl">1.1</span>, <span class="at">beta_latent=</span><span class="fl">1.5</span>,</span>
<span id="cb140-249"><a href="other-useful.html#cb140-249" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">beta_unclustered=</span><span class="sc">-</span><span class="dv">2</span>, <span class="at">snr=</span><span class="cn">NA</span>,</span>
<span id="cb140-250"><a href="other-useful.html#cb140-250" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">sigma_eps_sq=</span><span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb140-251"><a href="other-useful.html#cb140-251" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;sigma_eps_sq &gt; 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb140-252"><a href="other-useful.html#cb140-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-253"><a href="other-useful.html#cb140-253" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😀</code></pre>
<p>getLassoLambda:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="other-useful.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Get lambda value for lasso</span></span>
<span id="cb142-2"><a href="other-useful.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb142-3"><a href="other-useful.html#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Chooses a lambda value for the lasso used on a subsample of size n/2 (as in</span></span>
<span id="cb142-4"><a href="other-useful.html#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster stability selection) by cross-validation.</span></span>
<span id="cb142-5"><a href="other-useful.html#cb142-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb142-6"><a href="other-useful.html#cb142-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb142-7"><a href="other-useful.html#cb142-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors that will be used by cluster stability</span></span>
<span id="cb142-8"><a href="other-useful.html#cb142-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection.</span></span>
<span id="cb142-9"><a href="other-useful.html#cb142-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y The response; an n-dimensional numeric or integer vector. (Unlike</span></span>
<span id="cb142-10"><a href="other-useful.html#cb142-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the more general css setup, this response must be real-valued since</span></span>
<span id="cb142-11"><a href="other-useful.html#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; lambda will be determined using the lasso with cross-validation.)</span></span>
<span id="cb142-12"><a href="other-useful.html#cb142-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lambda_choice Character; either &quot;min&quot; or &quot;1se&quot;. If &quot;min&quot;, chooses</span></span>
<span id="cb142-13"><a href="other-useful.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the lambda that minimizes the cross-validated error; if &quot;1se&quot;, chooses the</span></span>
<span id="cb142-14"><a href="other-useful.html#cb142-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; largest lambda within one standard error of the minimum error lambda</span></span>
<span id="cb142-15"><a href="other-useful.html#cb142-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (resulting in a smaller selected set, which may be desirable because the</span></span>
<span id="cb142-16"><a href="other-useful.html#cb142-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size corresponding to the minimum error lambda tends to be larger</span></span>
<span id="cb142-17"><a href="other-useful.html#cb142-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; than optimal. See, for example, Bühlmann and Meinshausen 2006, Prop. 1 and</span></span>
<span id="cb142-18"><a href="other-useful.html#cb142-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Bühlmann and van de Geer 2011, Section 2.5.1.). Default is &quot;1se&quot;.</span></span>
<span id="cb142-19"><a href="other-useful.html#cb142-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param nfolds Numeric or integer; the number of folds for cross-validation.</span></span>
<span id="cb142-20"><a href="other-useful.html#cb142-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Must be at least 4 (as specified by cv.glmnet). Default is 10.</span></span>
<span id="cb142-21"><a href="other-useful.html#cb142-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric; the selected value of lambda.</span></span>
<span id="cb142-22"><a href="other-useful.html#cb142-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb142-23"><a href="other-useful.html#cb142-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Bühlmann, P., &amp; Meinshausen, N. (2006). High-Dimensional Graphs</span></span>
<span id="cb142-24"><a href="other-useful.html#cb142-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and Variable Selection With the Lasso. \emph{The Annals of Statistics},</span></span>
<span id="cb142-25"><a href="other-useful.html#cb142-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 34(3), 1436–1462. \url{https://doi.org/10.1214/009053606000000281}.</span></span>
<span id="cb142-26"><a href="other-useful.html#cb142-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \cr Peter Bühlmann and Sara van de Geer. Statistics for High-Dimensional</span></span>
<span id="cb142-27"><a href="other-useful.html#cb142-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Data. \emph{Springer Series in Statistics}. Springer, Heidelberg, 2011. ISBN</span></span>
<span id="cb142-28"><a href="other-useful.html#cb142-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 978-3-642-20191-2. \url{http://dx.doi.org/10.1007/978-3-642-20192-9}. \cr</span></span>
<span id="cb142-29"><a href="other-useful.html#cb142-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Jerome Friedman, Trevor Hastie, Robert Tibshirani (2010). Regularization</span></span>
<span id="cb142-30"><a href="other-useful.html#cb142-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Paths for Generalized Linear Models via Coordinate Descent. \emph{Journal of</span></span>
<span id="cb142-31"><a href="other-useful.html#cb142-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Statistical Software}, 33(1), 1-22. URL \url{https://www.jstatsoft.org/v33/i01/}.</span></span>
<span id="cb142-32"><a href="other-useful.html#cb142-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb142-33"><a href="other-useful.html#cb142-33" aria-hidden="true" tabindex="-1"></a><span id='getLassoLambda'>getLassoLambda</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">10</span>){</span>
<span id="cb142-34"><a href="other-useful.html#cb142-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(lambda_choice))</span>
<span id="cb142-35"><a href="other-useful.html#cb142-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_choice) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb142-36"><a href="other-useful.html#cb142-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(lambda_choice))</span>
<span id="cb142-37"><a href="other-useful.html#cb142-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_choice <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>))</span>
<span id="cb142-38"><a href="other-useful.html#cb142-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-39"><a href="other-useful.html#cb142-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb142-40"><a href="other-useful.html#cb142-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb142-41"><a href="other-useful.html#cb142-41" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb142-42"><a href="other-useful.html#cb142-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-43"><a href="other-useful.html#cb142-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(nfolds) <span class="sc">|</span> <span class="fu">is.integer</span>(nfolds))</span>
<span id="cb142-44"><a href="other-useful.html#cb142-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(nfolds) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb142-45"><a href="other-useful.html#cb142-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">==</span> <span class="fu">round</span>(nfolds))</span>
<span id="cb142-46"><a href="other-useful.html#cb142-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(nfolds <span class="sc">&gt;</span> <span class="dv">3</span>)</span>
<span id="cb142-47"><a href="other-useful.html#cb142-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-48"><a href="other-useful.html#cb142-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since we are using the lasso, we require y to be a real-valued response</span></span>
<span id="cb142-49"><a href="other-useful.html#cb142-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># (unlike for the general cluster stability selection procedure, where y</span></span>
<span id="cb142-50"><a href="other-useful.html#cb142-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># can have a more general format as long as a suitable feature selection</span></span>
<span id="cb142-51"><a href="other-useful.html#cb142-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function is provided by the user)</span></span>
<span id="cb142-52"><a href="other-useful.html#cb142-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(y) <span class="sc">|</span> <span class="fu">is.integer</span>(y))</span>
<span id="cb142-53"><a href="other-useful.html#cb142-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">==</span> <span class="fu">length</span>(y))</span>
<span id="cb142-54"><a href="other-useful.html#cb142-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-55"><a href="other-useful.html#cb142-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample size to use: inflate n/2 by a factor of nfolds/(nfolds - 1),</span></span>
<span id="cb142-56"><a href="other-useful.html#cb142-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># so that each individual lasso fit is of size floor(n/2)</span></span>
<span id="cb142-57"><a href="other-useful.html#cb142-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-58"><a href="other-useful.html#cb142-58" aria-hidden="true" tabindex="-1"></a>    n_sample <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>nfolds<span class="sc">/</span>(nfolds <span class="sc">-</span> <span class="dv">1</span>)), n)</span>
<span id="cb142-59"><a href="other-useful.html#cb142-59" aria-hidden="true" tabindex="-1"></a>    nfolds <span class="ot">&lt;-</span> <span class="fu">min</span>(nfolds, n_sample)</span>
<span id="cb142-60"><a href="other-useful.html#cb142-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-61"><a href="other-useful.html#cb142-61" aria-hidden="true" tabindex="-1"></a>    inds_size <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, n_sample)</span>
<span id="cb142-62"><a href="other-useful.html#cb142-62" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X[inds_size, ], <span class="at">y=</span>y[inds_size],</span>
<span id="cb142-63"><a href="other-useful.html#cb142-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>, <span class="at">nfolds=</span>nfolds)</span>
<span id="cb142-64"><a href="other-useful.html#cb142-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-65"><a href="other-useful.html#cb142-65" aria-hidden="true" tabindex="-1"></a>    lambda_ret <span class="ot">&lt;-</span> size_results[[<span class="fu">paste</span>(<span class="st">&quot;lambda.&quot;</span>, lambda_choice, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)]]</span>
<span id="cb142-66"><a href="other-useful.html#cb142-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-67"><a href="other-useful.html#cb142-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb142-68"><a href="other-useful.html#cb142-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(lambda_ret) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb142-69"><a href="other-useful.html#cb142-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(lambda_ret) <span class="sc">|</span> <span class="fu">is.integer</span>(lambda_ret))</span>
<span id="cb142-70"><a href="other-useful.html#cb142-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(lambda_ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb142-71"><a href="other-useful.html#cb142-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-72"><a href="other-useful.html#cb142-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(lambda_ret)</span>
<span id="cb142-73"><a href="other-useful.html#cb142-73" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for getLassoLambda:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="other-useful.html#cb143-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getLassoLambda works&quot;</span>, {</span>
<span id="cb143-2"><a href="other-useful.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">7252</span>)</span>
<span id="cb143-3"><a href="other-useful.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-4"><a href="other-useful.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb143-5"><a href="other-useful.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb143-6"><a href="other-useful.html#cb143-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-7"><a href="other-useful.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;1se&quot;</span>, <span class="at">nfolds=</span><span class="dv">4</span>)</span>
<span id="cb143-8"><a href="other-useful.html#cb143-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-9"><a href="other-useful.html#cb143-9" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb143-10"><a href="other-useful.html#cb143-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb143-11"><a href="other-useful.html#cb143-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb143-12"><a href="other-useful.html#cb143-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb143-13"><a href="other-useful.html#cb143-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-14"><a href="other-useful.html#cb143-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;min&quot;</span>, <span class="at">nfolds=</span><span class="dv">5</span>)</span>
<span id="cb143-15"><a href="other-useful.html#cb143-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-16"><a href="other-useful.html#cb143-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb143-17"><a href="other-useful.html#cb143-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb143-18"><a href="other-useful.html#cb143-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb143-19"><a href="other-useful.html#cb143-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb143-20"><a href="other-useful.html#cb143-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-21"><a href="other-useful.html#cb143-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb143-22"><a href="other-useful.html#cb143-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y), <span class="st">&quot;is.matrix(X) is not TRUE&quot;</span>,</span>
<span id="cb143-23"><a href="other-useful.html#cb143-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-24"><a href="other-useful.html#cb143-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-25"><a href="other-useful.html#cb143-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, ], <span class="at">y=</span>y),</span>
<span id="cb143-26"><a href="other-useful.html#cb143-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n == length(y) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-27"><a href="other-useful.html#cb143-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-28"><a href="other-useful.html#cb143-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">TRUE</span>),</span>
<span id="cb143-29"><a href="other-useful.html#cb143-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(y) | is.integer(y) is not TRUE&quot;</span>,</span>
<span id="cb143-30"><a href="other-useful.html#cb143-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-31"><a href="other-useful.html#cb143-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-32"><a href="other-useful.html#cb143-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb143-33"><a href="other-useful.html#cb143-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="st">&quot;mni&quot;</span>))</span>
<span id="cb143-34"><a href="other-useful.html#cb143-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-35"><a href="other-useful.html#cb143-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb143-36"><a href="other-useful.html#cb143-36" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">lambda_choice=</span><span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;1se&quot;</span>)),</span>
<span id="cb143-37"><a href="other-useful.html#cb143-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(lambda_choice) == 1 is not TRUE&quot;</span>,</span>
<span id="cb143-38"><a href="other-useful.html#cb143-38" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-39"><a href="other-useful.html#cb143-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-40"><a href="other-useful.html#cb143-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda_choice=</span><span class="dv">1</span>),</span>
<span id="cb143-41"><a href="other-useful.html#cb143-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.character(lambda_choice) is not TRUE&quot;</span>,</span>
<span id="cb143-42"><a href="other-useful.html#cb143-42" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-43"><a href="other-useful.html#cb143-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-44"><a href="other-useful.html#cb143-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb143-45"><a href="other-useful.html#cb143-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(nfolds) | is.integer(nfolds) is not TRUE&quot;</span>,</span>
<span id="cb143-46"><a href="other-useful.html#cb143-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-47"><a href="other-useful.html#cb143-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-48"><a href="other-useful.html#cb143-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb143-49"><a href="other-useful.html#cb143-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(nfolds) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-50"><a href="other-useful.html#cb143-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-51"><a href="other-useful.html#cb143-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="fl">3.2</span>),</span>
<span id="cb143-52"><a href="other-useful.html#cb143-52" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds == round(nfolds) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-53"><a href="other-useful.html#cb143-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-54"><a href="other-useful.html#cb143-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">nfolds=</span><span class="dv">3</span>),</span>
<span id="cb143-55"><a href="other-useful.html#cb143-55" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;nfolds &gt; 3 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb143-56"><a href="other-useful.html#cb143-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-57"><a href="other-useful.html#cb143-57" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:7&#39;): getLassoLambda works ──────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;1se&quot;, nfolds = 4)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:14&#39;): getLassoLambda works ─────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getLassoLambda'>getLassoLambda</a>(X = x, y = y, lambda_choice = &quot;min&quot;, nfolds = 5)
##  2. glmnet::cv.glmnet(...)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p>getModelSize:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="other-useful.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Automated estimation of model size</span></span>
<span id="cb145-2"><a href="other-useful.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb145-3"><a href="other-useful.html#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This function is uses the lasso with cross-validation to estimate the</span></span>
<span id="cb145-4"><a href="other-useful.html#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; model size. Before using the lasso, in each cluster all features will be</span></span>
<span id="cb145-5"><a href="other-useful.html#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; dropped from X except the one feature with the highest marginal correlation</span></span>
<span id="cb145-6"><a href="other-useful.html#cb145-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with y, as in the protolasso (Reid and Tibshirani 2016).</span></span>
<span id="cb145-7"><a href="other-useful.html#cb145-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb145-8"><a href="other-useful.html#cb145-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param X An n x p numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb145-9"><a href="other-useful.html#cb145-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb145-10"><a href="other-useful.html#cb145-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the p &gt;= 2 features/predictors.</span></span>
<span id="cb145-11"><a href="other-useful.html#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param y A length-n numeric vector containing the responses; `y[i]` is the</span></span>
<span id="cb145-12"><a href="other-useful.html#cb145-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response corresponding to observation `X[i, ]`. (Note that for the css</span></span>
<span id="cb145-13"><a href="other-useful.html#cb145-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function, y does not have to be a numeric response, but for this function,</span></span>
<span id="cb145-14"><a href="other-useful.html#cb145-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the underlying selection procedure is the lasso, so y must be a real-valued</span></span>
<span id="cb145-15"><a href="other-useful.html#cb145-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response.)</span></span>
<span id="cb145-16"><a href="other-useful.html#cb145-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clusters A named list where each entry is an integer vector of indices</span></span>
<span id="cb145-17"><a href="other-useful.html#cb145-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of features that are in a common cluster, as in the output of css.</span></span>
<span id="cb145-18"><a href="other-useful.html#cb145-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (The length of list clusters is equal to the number of clusters.) All</span></span>
<span id="cb145-19"><a href="other-useful.html#cb145-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; identified clusters must be non-overlapping, and all features must appear in</span></span>
<span id="cb145-20"><a href="other-useful.html#cb145-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; exactly one cluster (any unclustered features should be in their own</span></span>
<span id="cb145-21"><a href="other-useful.html#cb145-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;cluster&quot; of size 1).</span></span>
<span id="cb145-22"><a href="other-useful.html#cb145-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer; the estimated size of the model. The minimum returned</span></span>
<span id="cb145-23"><a href="other-useful.html#cb145-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; value is 1, even if the lasso with cross-validation chose no features.</span></span>
<span id="cb145-24"><a href="other-useful.html#cb145-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb145-25"><a href="other-useful.html#cb145-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references Reid, S., &amp; Tibshirani, R. (2016). Sparse regression and marginal</span></span>
<span id="cb145-26"><a href="other-useful.html#cb145-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testing using cluster prototypes. \emph{Biostatistics}, 17(2), 364–376.</span></span>
<span id="cb145-27"><a href="other-useful.html#cb145-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \url{https://doi.org/10.1093/biostatistics/kxv049}.</span></span>
<span id="cb145-28"><a href="other-useful.html#cb145-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb145-29"><a href="other-useful.html#cb145-29" aria-hidden="true" tabindex="-1"></a><span id='getModelSize'>getModelSize</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, clusters){</span>
<span id="cb145-30"><a href="other-useful.html#cb145-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X) <span class="sc">|</span> <span class="fu">is.data.frame</span>(X))</span>
<span id="cb145-31"><a href="other-useful.html#cb145-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-32"><a href="other-useful.html#cb145-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb145-33"><a href="other-useful.html#cb145-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(X)){</span>
<span id="cb145-34"><a href="other-useful.html#cb145-34" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X)</span>
<span id="cb145-35"><a href="other-useful.html#cb145-35" aria-hidden="true" tabindex="-1"></a>        X <span class="ot">&lt;-</span> X[, <span class="fu">colnames</span>(X) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb145-36"><a href="other-useful.html#cb145-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb145-37"><a href="other-useful.html#cb145-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-38"><a href="other-useful.html#cb145-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(X))</span>
<span id="cb145-39"><a href="other-useful.html#cb145-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X)))</span>
<span id="cb145-40"><a href="other-useful.html#cb145-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(X) <span class="sc">|</span> <span class="fu">is.integer</span>(X))</span>
<span id="cb145-41"><a href="other-useful.html#cb145-41" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb145-42"><a href="other-useful.html#cb145-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-43"><a href="other-useful.html#cb145-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Since the model size will be determined by cross-validation, the provided</span></span>
<span id="cb145-44"><a href="other-useful.html#cb145-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y must be real-valued (this should be checked internally in other</span></span>
<span id="cb145-45"><a href="other-useful.html#cb145-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># functions before getModelSize is called, but this check is here just in</span></span>
<span id="cb145-46"><a href="other-useful.html#cb145-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># case).</span></span>
<span id="cb145-47"><a href="other-useful.html#cb145-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(y)){</span>
<span id="cb145-48"><a href="other-useful.html#cb145-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>)</span>
<span id="cb145-49"><a href="other-useful.html#cb145-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb145-50"><a href="other-useful.html#cb145-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y) <span class="sc">==</span> n)</span>
<span id="cb145-51"><a href="other-useful.html#cb145-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-52"><a href="other-useful.html#cb145-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check clusters argument</span></span>
<span id="cb145-53"><a href="other-useful.html#cb145-53" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='helper-functions.html#checkCssClustersInput'>checkCssClustersInput</a>(clusters)</span>
<span id="cb145-54"><a href="other-useful.html#cb145-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-55"><a href="other-useful.html#cb145-55" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Format clusters into a list where all features are in exactly one</span></span>
<span id="cb145-56"><a href="other-useful.html#cb145-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster (any unclustered features are put in their own &quot;cluster&quot; of size</span></span>
<span id="cb145-57"><a href="other-useful.html#cb145-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1).</span></span>
<span id="cb145-58"><a href="other-useful.html#cb145-58" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb145-59"><a href="other-useful.html#cb145-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(clusters)) <span class="sc">&amp;</span> <span class="fu">is.list</span>(clusters)){</span>
<span id="cb145-60"><a href="other-useful.html#cb145-60" aria-hidden="true" tabindex="-1"></a>        clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(clusters)</span>
<span id="cb145-61"><a href="other-useful.html#cb145-61" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb145-62"><a href="other-useful.html#cb145-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-63"><a href="other-useful.html#cb145-63" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> <a href='helper-functions.html#formatClusters'>formatClusters</a>(clusters, <span class="at">p=</span><span class="fu">ncol</span>(X),</span>
<span id="cb145-64"><a href="other-useful.html#cb145-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">clust_names=</span>clust_names)<span class="sc">$</span>clusters</span>
<span id="cb145-65"><a href="other-useful.html#cb145-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-66"><a href="other-useful.html#cb145-66" aria-hidden="true" tabindex="-1"></a>    X_size <span class="ot">&lt;-</span> X</span>
<span id="cb145-67"><a href="other-useful.html#cb145-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-68"><a href="other-useful.html#cb145-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(clusters) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb145-69"><a href="other-useful.html#cb145-69" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create modified design matrix by dropping all but one feature from</span></span>
<span id="cb145-70"><a href="other-useful.html#cb145-70" aria-hidden="true" tabindex="-1"></a>        <span class="co"># each cluster</span></span>
<span id="cb145-71"><a href="other-useful.html#cb145-71" aria-hidden="true" tabindex="-1"></a>        feats_to_drop <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb145-72"><a href="other-useful.html#cb145-72" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(clusters)){</span>
<span id="cb145-73"><a href="other-useful.html#cb145-73" aria-hidden="true" tabindex="-1"></a>            cluster_i <span class="ot">&lt;-</span> clusters[[i]]</span>
<span id="cb145-74"><a href="other-useful.html#cb145-74" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(cluster_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb145-75"><a href="other-useful.html#cb145-75" aria-hidden="true" tabindex="-1"></a>                feat_to_keep <span class="ot">&lt;-</span> <a href='helper-functions.html#identifyPrototype'>identifyPrototype</a>(cluster_i, X, y)</span>
<span id="cb145-76"><a href="other-useful.html#cb145-76" aria-hidden="true" tabindex="-1"></a>                feats_to_drop <span class="ot">&lt;-</span> <span class="fu">c</span>(feats_to_drop, <span class="fu">setdiff</span>(cluster_i,</span>
<span id="cb145-77"><a href="other-useful.html#cb145-77" aria-hidden="true" tabindex="-1"></a>                    feat_to_keep))</span>
<span id="cb145-78"><a href="other-useful.html#cb145-78" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb145-79"><a href="other-useful.html#cb145-79" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb145-80"><a href="other-useful.html#cb145-80" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(feats_to_drop) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb145-81"><a href="other-useful.html#cb145-81" aria-hidden="true" tabindex="-1"></a>            X_size <span class="ot">&lt;-</span> X_size[, <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>feats_to_drop]</span>
<span id="cb145-82"><a href="other-useful.html#cb145-82" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb145-83"><a href="other-useful.html#cb145-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb145-84"><a href="other-useful.html#cb145-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-85"><a href="other-useful.html#cb145-85" aria-hidden="true" tabindex="-1"></a>    size_results <span class="ot">&lt;-</span> glmnet<span class="sc">::</span><span class="fu">cv.glmnet</span>(<span class="at">x=</span>X_size, <span class="at">y=</span>y, <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>)</span>
<span id="cb145-86"><a href="other-useful.html#cb145-86" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(glmnet<span class="sc">::</span><span class="fu">coef.glmnet</span>(size_results, <span class="at">s=</span><span class="st">&quot;lambda.1se&quot;</span>))</span>
<span id="cb145-87"><a href="other-useful.html#cb145-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-88"><a href="other-useful.html#cb145-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Number of nonzero coefficients (subtract one in order to ignore intercept)</span></span>
<span id="cb145-89"><a href="other-useful.html#cb145-89" aria-hidden="true" tabindex="-1"></a>    size <span class="ot">&lt;-</span> <span class="fu">length</span>(coefs[coefs <span class="sc">!=</span> <span class="dv">0</span>]) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb145-90"><a href="other-useful.html#cb145-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-91"><a href="other-useful.html#cb145-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb145-92"><a href="other-useful.html#cb145-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(size) <span class="sc">|</span> <span class="fu">is.integer</span>(size))</span>
<span id="cb145-93"><a href="other-useful.html#cb145-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(size))</span>
<span id="cb145-94"><a href="other-useful.html#cb145-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(size) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb145-95"><a href="other-useful.html#cb145-95" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(size <span class="sc">==</span> <span class="fu">round</span>(size))</span>
<span id="cb145-96"><a href="other-useful.html#cb145-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-97"><a href="other-useful.html#cb145-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">as.integer</span>(<span class="fu">max</span>(size, <span class="dv">1</span>)))</span>
<span id="cb145-98"><a href="other-useful.html#cb145-98" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for getModelSize:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="other-useful.html#cb146-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getModelSize works&quot;</span>, {</span>
<span id="cb146-2"><a href="other-useful.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1723</span>)</span>
<span id="cb146-3"><a href="other-useful.html#cb146-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-4"><a href="other-useful.html#cb146-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb146-5"><a href="other-useful.html#cb146-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb146-6"><a href="other-useful.html#cb146-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-7"><a href="other-useful.html#cb146-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb146-8"><a href="other-useful.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb146-9"><a href="other-useful.html#cb146-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-10"><a href="other-useful.html#cb146-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb146-11"><a href="other-useful.html#cb146-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-12"><a href="other-useful.html#cb146-12" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb146-13"><a href="other-useful.html#cb146-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-14"><a href="other-useful.html#cb146-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb146-15"><a href="other-useful.html#cb146-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb146-16"><a href="other-useful.html#cb146-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb146-17"><a href="other-useful.html#cb146-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb146-18"><a href="other-useful.html#cb146-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb146-19"><a href="other-useful.html#cb146-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but two clusters of size 3, so maximum size should</span></span>
<span id="cb146-20"><a href="other-useful.html#cb146-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 2 = 7</span></span>
<span id="cb146-21"><a href="other-useful.html#cb146-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb146-22"><a href="other-useful.html#cb146-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-23"><a href="other-useful.html#cb146-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying other inputs</span></span>
<span id="cb146-24"><a href="other-useful.html#cb146-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-25"><a href="other-useful.html#cb146-25" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>3L, 5L<span class="sc">:</span>8L)</span>
<span id="cb146-26"><a href="other-useful.html#cb146-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-27"><a href="other-useful.html#cb146-27" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>unnamed_clusters)</span>
<span id="cb146-28"><a href="other-useful.html#cb146-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-29"><a href="other-useful.html#cb146-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb146-30"><a href="other-useful.html#cb146-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb146-31"><a href="other-useful.html#cb146-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb146-32"><a href="other-useful.html#cb146-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb146-33"><a href="other-useful.html#cb146-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb146-34"><a href="other-useful.html#cb146-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb146-35"><a href="other-useful.html#cb146-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb146-36"><a href="other-useful.html#cb146-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb146-37"><a href="other-useful.html#cb146-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-38"><a href="other-useful.html#cb146-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Single cluster</span></span>
<span id="cb146-39"><a href="other-useful.html#cb146-39" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb146-40"><a href="other-useful.html#cb146-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-41"><a href="other-useful.html#cb146-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb146-42"><a href="other-useful.html#cb146-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb146-43"><a href="other-useful.html#cb146-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb146-44"><a href="other-useful.html#cb146-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb146-45"><a href="other-useful.html#cb146-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb146-46"><a href="other-useful.html#cb146-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 4 in one cluster, so maximum size should be 11 - 3 = 8</span></span>
<span id="cb146-47"><a href="other-useful.html#cb146-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">8</span>)</span>
<span id="cb146-48"><a href="other-useful.html#cb146-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-49"><a href="other-useful.html#cb146-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-50"><a href="other-useful.html#cb146-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Intentionally don&#39;t provide clusters for all feature, mix up formatting,</span></span>
<span id="cb146-51"><a href="other-useful.html#cb146-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># etc.</span></span>
<span id="cb146-52"><a href="other-useful.html#cb146-52" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb146-53"><a href="other-useful.html#cb146-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-54"><a href="other-useful.html#cb146-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb146-55"><a href="other-useful.html#cb146-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-56"><a href="other-useful.html#cb146-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret) <span class="sc">|</span> <span class="fu">is.integer</span>(ret))</span>
<span id="cb146-57"><a href="other-useful.html#cb146-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb146-58"><a href="other-useful.html#cb146-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb146-59"><a href="other-useful.html#cb146-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret, <span class="fu">round</span>(ret))</span>
<span id="cb146-60"><a href="other-useful.html#cb146-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb146-61"><a href="other-useful.html#cb146-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 11 features, but 3 in one cluster and 4 in another, so maximum size should</span></span>
<span id="cb146-62"><a href="other-useful.html#cb146-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># be 11 - 2 - 3 = 6</span></span>
<span id="cb146-63"><a href="other-useful.html#cb146-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">&lt;=</span> <span class="dv">6</span>)</span>
<span id="cb146-64"><a href="other-useful.html#cb146-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-65"><a href="other-useful.html#cb146-65" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb146-66"><a href="other-useful.html#cb146-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-67"><a href="other-useful.html#cb146-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span><span class="st">&quot;x&quot;</span>, <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb146-68"><a href="other-useful.html#cb146-68" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.matrix(X) | is.data.frame(X) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-69"><a href="other-useful.html#cb146-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-70"><a href="other-useful.html#cb146-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ], <span class="at">y=</span>y, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb146-71"><a href="other-useful.html#cb146-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(y) == n is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-72"><a href="other-useful.html#cb146-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-73"><a href="other-useful.html#cb146-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span><span class="cn">FALSE</span>, <span class="at">clusters=</span>good_clusters),</span>
<span id="cb146-74"><a href="other-useful.html#cb146-74" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;getModelSize is trying to determine max_num_clusts using the lasso with cross-validation, but the y provided to getModelSize was not real-valued.&quot;</span>,</span>
<span id="cb146-75"><a href="other-useful.html#cb146-75" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-76"><a href="other-useful.html#cb146-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-77"><a href="other-useful.html#cb146-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>)),</span>
<span id="cb146-78"><a href="other-useful.html#cb146-78" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Overlapping clusters detected; clusters must be non-overlapping. Overlapping clusters: 1, 2.&quot;</span>,</span>
<span id="cb146-79"><a href="other-useful.html#cb146-79" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-80"><a href="other-useful.html#cb146-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb146-81"><a href="other-useful.html#cb146-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)),</span>
<span id="cb146-82"><a href="other-useful.html#cb146-82" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters) == length(unique(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb146-83"><a href="other-useful.html#cb146-83" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-84"><a href="other-useful.html#cb146-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-85"><a href="other-useful.html#cb146-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb146-86"><a href="other-useful.html#cb146-86" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(all_clustered_feats) == p is not TRUE&quot;</span>,</span>
<span id="cb146-87"><a href="other-useful.html#cb146-87" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-88"><a href="other-useful.html#cb146-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-89"><a href="other-useful.html#cb146-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y,</span>
<span id="cb146-90"><a href="other-useful.html#cb146-90" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">as.integer</span>(<span class="cn">NA</span>))),</span>
<span id="cb146-91"><a href="other-useful.html#cb146-91" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(clusters) are not all TRUE&quot;</span>,</span>
<span id="cb146-92"><a href="other-useful.html#cb146-92" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-93"><a href="other-useful.html#cb146-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-94"><a href="other-useful.html#cb146-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))),</span>
<span id="cb146-95"><a href="other-useful.html#cb146-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(clusters[[i]]) == length(unique(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb146-96"><a href="other-useful.html#cb146-96" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-97"><a href="other-useful.html#cb146-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-98"><a href="other-useful.html#cb146-98" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb146-99"><a href="other-useful.html#cb146-99" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb146-100"><a href="other-useful.html#cb146-100" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-101"><a href="other-useful.html#cb146-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-102"><a href="other-useful.html#cb146-102" aria-hidden="true" tabindex="-1"></a>   testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getModelSize'>getModelSize</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">clusters=</span><span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb146-103"><a href="other-useful.html#cb146-103" aria-hidden="true" tabindex="-1"></a>                                                               <span class="fu">c</span>(<span class="fl">2.3</span>, <span class="fl">1.2</span>))),</span>
<span id="cb146-104"><a href="other-useful.html#cb146-104" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(clusters[[i]] == round(clusters[[i]])) is not TRUE&quot;</span>,</span>
<span id="cb146-105"><a href="other-useful.html#cb146-105" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb146-106"><a href="other-useful.html#cb146-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-107"><a href="other-useful.html#cb146-107" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## ── Warning (&#39;&lt;text&gt;:12&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:27&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = unnamed_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:39&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = 2:5)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)
## 
## ── Warning (&#39;&lt;text&gt;:54&#39;): getModelSize works ───────────────────────────────────
## Option grouped=FALSE enforced in cv.glmnet, since &lt; 3 observations per fold
## Backtrace:
##  1. litr (local) <a href='other-useful.html#getModelSize'>getModelSize</a>(X = x, y = y, clusters = good_clusters)
##  2. glmnet::cv.glmnet(x = X_size, y = y, family = &quot;gaussian&quot;)
##  3. glmnet:::cv.glmnet.raw(...)</code></pre>
<p>printCssDf:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="other-useful.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Prepares a data.frame summarazing cluster stability selection output to print</span></span>
<span id="cb148-2"><a href="other-useful.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb148-3"><a href="other-useful.html#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function.</span></span>
<span id="cb148-4"><a href="other-useful.html#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb148-5"><a href="other-useful.html#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb148-6"><a href="other-useful.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; the outputted data.frame will display only those</span></span>
<span id="cb148-7"><a href="other-useful.html#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb148-8"><a href="other-useful.html#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb148-9"><a href="other-useful.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb148-10"><a href="other-useful.html#cb148-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb148-11"><a href="other-useful.html#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb148-12"><a href="other-useful.html#cb148-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb148-13"><a href="other-useful.html#cb148-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb148-14"><a href="other-useful.html#cb148-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb148-15"><a href="other-useful.html#cb148-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb148-16"><a href="other-useful.html#cb148-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb148-17"><a href="other-useful.html#cb148-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb148-18"><a href="other-useful.html#cb148-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb148-19"><a href="other-useful.html#cb148-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb148-20"><a href="other-useful.html#cb148-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb148-21"><a href="other-useful.html#cb148-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb148-22"><a href="other-useful.html#cb148-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb148-23"><a href="other-useful.html#cb148-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb148-24"><a href="other-useful.html#cb148-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb148-25"><a href="other-useful.html#cb148-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb148-26"><a href="other-useful.html#cb148-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb148-27"><a href="other-useful.html#cb148-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb148-28"><a href="other-useful.html#cb148-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb148-29"><a href="other-useful.html#cb148-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb148-30"><a href="other-useful.html#cb148-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb148-31"><a href="other-useful.html#cb148-31" aria-hidden="true" tabindex="-1"></a><span id='printCssDf'>printCssDf</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb148-32"><a href="other-useful.html#cb148-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_num_clusts=</span><span class="cn">NA</span>){</span>
<span id="cb148-33"><a href="other-useful.html#cb148-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb148-34"><a href="other-useful.html#cb148-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb148-35"><a href="other-useful.html#cb148-35" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb148-36"><a href="other-useful.html#cb148-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-37"><a href="other-useful.html#cb148-37" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb148-38"><a href="other-useful.html#cb148-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-39"><a href="other-useful.html#cb148-39" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb148-40"><a href="other-useful.html#cb148-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-41"><a href="other-useful.html#cb148-41" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb148-42"><a href="other-useful.html#cb148-42" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb148-43"><a href="other-useful.html#cb148-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-44"><a href="other-useful.html#cb148-44" aria-hidden="true" tabindex="-1"></a>    sel_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_results, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb148-45"><a href="other-useful.html#cb148-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts,</span>
<span id="cb148-46"><a href="other-useful.html#cb148-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">max_num_clusts=</span>max_num_clusts)<span class="sc">$</span>selected_clusts</span>
<span id="cb148-47"><a href="other-useful.html#cb148-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-48"><a href="other-useful.html#cb148-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sel_clusts is guaranteed to have length at least 1 by</span></span>
<span id="cb148-49"><a href="other-useful.html#cb148-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getCssSelections </span></span>
<span id="cb148-50"><a href="other-useful.html#cb148-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-51"><a href="other-useful.html#cb148-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get prototypes (feature from each cluster with highest selection</span></span>
<span id="cb148-52"><a href="other-useful.html#cb148-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># proportion, breaking ties by using marginal correlations of features with</span></span>
<span id="cb148-53"><a href="other-useful.html#cb148-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y from data provided to css if y is real-valued)</span></span>
<span id="cb148-54"><a href="other-useful.html#cb148-54" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, sel_clusts)</span>
<span id="cb148-55"><a href="other-useful.html#cb148-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-56"><a href="other-useful.html#cb148-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cluster selection proportions</span></span>
<span id="cb148-57"><a href="other-useful.html#cb148-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(sel_clusts) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb148-58"><a href="other-useful.html#cb148-58" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb148-59"><a href="other-useful.html#cb148-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb148-60"><a href="other-useful.html#cb148-60" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb148-61"><a href="other-useful.html#cb148-61" aria-hidden="true" tabindex="-1"></a>        sel_clust_sel_props <span class="ot">&lt;-</span> <span class="fu">mean</span>(css_results<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb148-62"><a href="other-useful.html#cb148-62" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(sel_clusts)])</span>
<span id="cb148-63"><a href="other-useful.html#cb148-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-64"><a href="other-useful.html#cb148-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-65"><a href="other-useful.html#cb148-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Data.frame: name of cluster, cluster prototype, selection proportion,</span></span>
<span id="cb148-66"><a href="other-useful.html#cb148-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster size</span></span>
<span id="cb148-67"><a href="other-useful.html#cb148-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-68"><a href="other-useful.html#cb148-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(prototypes))){</span>
<span id="cb148-69"><a href="other-useful.html#cb148-69" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb148-70"><a href="other-useful.html#cb148-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoName=</span><span class="fu">names</span>(prototypes), <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes),</span>
<span id="cb148-71"><a href="other-useful.html#cb148-71" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSelProp=</span>sel_clust_sel_props, <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb148-72"><a href="other-useful.html#cb148-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb148-73"><a href="other-useful.html#cb148-73" aria-hidden="true" tabindex="-1"></a>        print_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ClustName=</span><span class="fu">names</span>(sel_clusts),</span>
<span id="cb148-74"><a href="other-useful.html#cb148-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustProtoNum=</span><span class="fu">unname</span>(prototypes), <span class="at">ClustSelProp=</span>sel_clust_sel_props,</span>
<span id="cb148-75"><a href="other-useful.html#cb148-75" aria-hidden="true" tabindex="-1"></a>            <span class="at">ClustSize=</span><span class="fu">lengths</span>(sel_clusts))</span>
<span id="cb148-76"><a href="other-useful.html#cb148-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb148-77"><a href="other-useful.html#cb148-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-78"><a href="other-useful.html#cb148-78" aria-hidden="true" tabindex="-1"></a>    print_df <span class="ot">&lt;-</span> print_df[<span class="fu">order</span>(print_df<span class="sc">$</span>ClustSelProp, <span class="at">decreasing=</span><span class="cn">TRUE</span>), ]</span>
<span id="cb148-79"><a href="other-useful.html#cb148-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-80"><a href="other-useful.html#cb148-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(print_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb148-81"><a href="other-useful.html#cb148-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb148-82"><a href="other-useful.html#cb148-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.data.frame</span>(print_df))</span>
<span id="cb148-83"><a href="other-useful.html#cb148-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(print_df) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb148-84"><a href="other-useful.html#cb148-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-85"><a href="other-useful.html#cb148-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(print_df)</span>
<span id="cb148-86"><a href="other-useful.html#cb148-86" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>getSelectionPrototypes</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="other-useful.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Identify selection prototypes from selected clusters</span></span>
<span id="cb149-2"><a href="other-useful.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb149-3"><a href="other-useful.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes in list of selected clusters and returns an integer vector of the</span></span>
<span id="cb149-4"><a href="other-useful.html#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features that were most frequently selected from each cluster</span></span>
<span id="cb149-5"><a href="other-useful.html#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb149-6"><a href="other-useful.html#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb149-7"><a href="other-useful.html#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb149-8"><a href="other-useful.html#cb149-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected_clusts A list of integer vectors; each vector must contain</span></span>
<span id="cb149-9"><a href="other-useful.html#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the indices of features in a cluster.</span></span>
<span id="cb149-10"><a href="other-useful.html#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return An integer vector (of length equal to the number of clusters) of the</span></span>
<span id="cb149-11"><a href="other-useful.html#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the feature prototypes (the features from each cluster that were</span></span>
<span id="cb149-12"><a href="other-useful.html#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected the most often individually by the base method in cluster stability</span></span>
<span id="cb149-13"><a href="other-useful.html#cb149-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection). In the case of a tie, the tie is broken by choosing the feature</span></span>
<span id="cb149-14"><a href="other-useful.html#cb149-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; most correlated with the response in the full data set provided to css.</span></span>
<span id="cb149-15"><a href="other-useful.html#cb149-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb149-16"><a href="other-useful.html#cb149-16" aria-hidden="true" tabindex="-1"></a><span id='getSelectionPrototypes'>getSelectionPrototypes</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, selected_clusts){</span>
<span id="cb149-17"><a href="other-useful.html#cb149-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb149-18"><a href="other-useful.html#cb149-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb149-19"><a href="other-useful.html#cb149-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb149-20"><a href="other-useful.html#cb149-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-21"><a href="other-useful.html#cb149-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(selected_clusts))</span>
<span id="cb149-22"><a href="other-useful.html#cb149-22" aria-hidden="true" tabindex="-1"></a>    n_selected_clusts <span class="ot">&lt;-</span> <span class="fu">length</span>(selected_clusts)</span>
<span id="cb149-23"><a href="other-useful.html#cb149-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_selected_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb149-24"><a href="other-useful.html#cb149-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">lengths</span>(selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb149-25"><a href="other-useful.html#cb149-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-26"><a href="other-useful.html#cb149-26" aria-hidden="true" tabindex="-1"></a>    prototypes <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.integer</span>(<span class="cn">NA</span>), n_selected_clusts)</span>
<span id="cb149-27"><a href="other-useful.html#cb149-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_selected_clusts){</span>
<span id="cb149-28"><a href="other-useful.html#cb149-28" aria-hidden="true" tabindex="-1"></a>        clust_i <span class="ot">&lt;-</span> selected_clusts[[i]]</span>
<span id="cb149-29"><a href="other-useful.html#cb149-29" aria-hidden="true" tabindex="-1"></a>        sel_props_i <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[clust_i]</span>
<span id="cb149-30"><a href="other-useful.html#cb149-30" aria-hidden="true" tabindex="-1"></a>        proto_i <span class="ot">&lt;-</span> clust_i[sel_props_i <span class="sc">==</span> <span class="fu">max</span>(sel_props_i)]</span>
<span id="cb149-31"><a href="other-useful.html#cb149-31" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb149-32"><a href="other-useful.html#cb149-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(proto_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb149-33"><a href="other-useful.html#cb149-33" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">is.numeric</span>(css_results<span class="sc">$</span>y) <span class="sc">|</span> <span class="fu">is.integer</span>(css_results<span class="sc">$</span>y)){</span>
<span id="cb149-34"><a href="other-useful.html#cb149-34" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Break tie by looking at marginal correlations</span></span>
<span id="cb149-35"><a href="other-useful.html#cb149-35" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">cor</span>(css_results<span class="sc">$</span>X[, proto_i], css_results<span class="sc">$</span>y)[, <span class="dv">1</span>]</span>
<span id="cb149-36"><a href="other-useful.html#cb149-36" aria-hidden="true" tabindex="-1"></a>                corrs_i <span class="ot">&lt;-</span> <span class="fu">abs</span>(corrs_i)</span>
<span id="cb149-37"><a href="other-useful.html#cb149-37" aria-hidden="true" tabindex="-1"></a>                proto_i <span class="ot">&lt;-</span> proto_i[corrs_i <span class="sc">==</span> <span class="fu">max</span>(corrs_i)]</span>
<span id="cb149-38"><a href="other-useful.html#cb149-38" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb149-39"><a href="other-useful.html#cb149-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb149-40"><a href="other-useful.html#cb149-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If there is still a tie, break by choosing the first feature of those</span></span>
<span id="cb149-41"><a href="other-useful.html#cb149-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># remaining</span></span>
<span id="cb149-42"><a href="other-useful.html#cb149-42" aria-hidden="true" tabindex="-1"></a>        prototypes[i] <span class="ot">&lt;-</span> proto_i[<span class="dv">1</span>]</span>
<span id="cb149-43"><a href="other-useful.html#cb149-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(prototypes)[i] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(css_results<span class="sc">$</span>X)[proto_i]</span>
<span id="cb149-44"><a href="other-useful.html#cb149-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb149-45"><a href="other-useful.html#cb149-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-46"><a href="other-useful.html#cb149-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb149-47"><a href="other-useful.html#cb149-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-48"><a href="other-useful.html#cb149-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(prototypes))</span>
<span id="cb149-49"><a href="other-useful.html#cb149-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(prototypes)))</span>
<span id="cb149-50"><a href="other-useful.html#cb149-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(prototypes) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(prototypes)))</span>
<span id="cb149-51"><a href="other-useful.html#cb149-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-52"><a href="other-useful.html#cb149-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(prototypes)</span>
<span id="cb149-53"><a href="other-useful.html#cb149-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for getSelectionPrototypes:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="other-useful.html#cb150-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getSelectionPrototypes works&quot;</span>, {</span>
<span id="cb150-2"><a href="other-useful.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb150-3"><a href="other-useful.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-4"><a href="other-useful.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb150-5"><a href="other-useful.html#cb150-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb150-6"><a href="other-useful.html#cb150-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-7"><a href="other-useful.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb150-8"><a href="other-useful.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb150-9"><a href="other-useful.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-10"><a href="other-useful.html#cb150-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb150-11"><a href="other-useful.html#cb150-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-12"><a href="other-useful.html#cb150-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters)</span>
<span id="cb150-13"><a href="other-useful.html#cb150-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-14"><a href="other-useful.html#cb150-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="at">selected_clusts=</span>good_clusters)</span>
<span id="cb150-15"><a href="other-useful.html#cb150-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-16"><a href="other-useful.html#cb150-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb150-17"><a href="other-useful.html#cb150-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret)))</span>
<span id="cb150-18"><a href="other-useful.html#cb150-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(good_clusters))</span>
<span id="cb150-19"><a href="other-useful.html#cb150-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="fu">length</span>(<span class="fu">unique</span>(ret)))</span>
<span id="cb150-20"><a href="other-useful.html#cb150-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ret)){</span>
<span id="cb150-21"><a href="other-useful.html#cb150-21" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[i] <span class="sc">%in%</span> good_clusters[[i]])</span>
<span id="cb150-22"><a href="other-useful.html#cb150-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the largest selection proportion of any feature in cluster i</span></span>
<span id="cb150-23"><a href="other-useful.html#cb150-23" aria-hidden="true" tabindex="-1"></a>    max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, good_clusters[[i]]]))</span>
<span id="cb150-24"><a href="other-useful.html#cb150-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb150-25"><a href="other-useful.html#cb150-25" aria-hidden="true" tabindex="-1"></a>    proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret[i]]</span>
<span id="cb150-26"><a href="other-useful.html#cb150-26" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb150-27"><a href="other-useful.html#cb150-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb150-28"><a href="other-useful.html#cb150-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb150-29"><a href="other-useful.html#cb150-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try with only one selected cluster (still should be in a list)</span></span>
<span id="cb150-30"><a href="other-useful.html#cb150-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-31"><a href="other-useful.html#cb150-31" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb150-32"><a href="other-useful.html#cb150-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">selected_clusts=</span><span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L))</span>
<span id="cb150-33"><a href="other-useful.html#cb150-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-34"><a href="other-useful.html#cb150-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret))</span>
<span id="cb150-35"><a href="other-useful.html#cb150-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(ret))</span>
<span id="cb150-36"><a href="other-useful.html#cb150-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret), <span class="dv">1</span>)</span>
<span id="cb150-37"><a href="other-useful.html#cb150-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb150-38"><a href="other-useful.html#cb150-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the largest selection proportion of any feature in the cluster</span></span>
<span id="cb150-39"><a href="other-useful.html#cb150-39" aria-hidden="true" tabindex="-1"></a>  max_prop <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat[, 1L<span class="sc">:</span>3L]))</span>
<span id="cb150-40"><a href="other-useful.html#cb150-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the selection proportion of the identified prototype</span></span>
<span id="cb150-41"><a href="other-useful.html#cb150-41" aria-hidden="true" tabindex="-1"></a>  proto_prop <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)[ret]</span>
<span id="cb150-42"><a href="other-useful.html#cb150-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(max_prop, proto_prop)</span>
<span id="cb150-43"><a href="other-useful.html#cb150-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-44"><a href="other-useful.html#cb150-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb150-45"><a href="other-useful.html#cb150-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-46"><a href="other-useful.html#cb150-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error contains quotation marks</span></span>
<span id="cb150-47"><a href="other-useful.html#cb150-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(x, good_clusters))</span>
<span id="cb150-48"><a href="other-useful.html#cb150-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-49"><a href="other-useful.html#cb150-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, 1L<span class="sc">:</span>3L),</span>
<span id="cb150-50"><a href="other-useful.html#cb150-50" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.list(selected_clusts) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb150-51"><a href="other-useful.html#cb150-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-52"><a href="other-useful.html#cb150-52" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results, <span class="fu">list</span>()),</span>
<span id="cb150-53"><a href="other-useful.html#cb150-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;n_selected_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb150-54"><a href="other-useful.html#cb150-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-55"><a href="other-useful.html#cb150-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#getSelectionPrototypes'>getSelectionPrototypes</a>(css_results,</span>
<span id="cb150-56"><a href="other-useful.html#cb150-56" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L,</span>
<span id="cb150-57"><a href="other-useful.html#cb150-57" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L,</span>
<span id="cb150-58"><a href="other-useful.html#cb150-58" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">bad_cluster=</span><span class="fu">integer</span>())),</span>
<span id="cb150-59"><a href="other-useful.html#cb150-59" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(lengths(selected_clusts) &gt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb150-60"><a href="other-useful.html#cb150-60" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb150-61"><a href="other-useful.html#cb150-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-62"><a href="other-useful.html#cb150-62" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 😸</code></pre>
<p>Tests for printCssDf:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="other-useful.html#cb152-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;printCssDf works&quot;</span>, {</span>
<span id="cb152-2"><a href="other-useful.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">67234</span>)</span>
<span id="cb152-3"><a href="other-useful.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-4"><a href="other-useful.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <a href='other-useful.html#genClusteredData'>genClusteredData</a>(<span class="at">n=</span><span class="dv">15</span>, <span class="at">p=</span><span class="dv">11</span>, <span class="at">k_unclustered=</span><span class="dv">1</span>, <span class="at">cluster_size=</span><span class="dv">3</span>,</span>
<span id="cb152-5"><a href="other-useful.html#cb152-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n_clusters=</span><span class="dv">2</span>, <span class="at">sig_clusters=</span><span class="dv">1</span>, <span class="at">sigma_eps_sq=</span><span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb152-6"><a href="other-useful.html#cb152-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-7"><a href="other-useful.html#cb152-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> data<span class="sc">$</span>X</span>
<span id="cb152-8"><a href="other-useful.html#cb152-8" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> data<span class="sc">$</span>y</span>
<span id="cb152-9"><a href="other-useful.html#cb152-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-10"><a href="other-useful.html#cb152-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">red_cluster=</span>1L<span class="sc">:</span>3L, <span class="at">green_cluster=</span>4L<span class="sc">:</span>6L)</span>
<span id="cb152-11"><a href="other-useful.html#cb152-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-12"><a href="other-useful.html#cb152-12" aria-hidden="true" tabindex="-1"></a>  css_results <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb152-13"><a href="other-useful.html#cb152-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-14"><a href="other-useful.html#cb152-14" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results)</span>
<span id="cb152-15"><a href="other-useful.html#cb152-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-16"><a href="other-useful.html#cb152-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-17"><a href="other-useful.html#cb152-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb152-18"><a href="other-useful.html#cb152-18" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-19"><a href="other-useful.html#cb152-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-20"><a href="other-useful.html#cb152-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb152-21"><a href="other-useful.html#cb152-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb152-22"><a href="other-useful.html#cb152-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-23"><a href="other-useful.html#cb152-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-24"><a href="other-useful.html#cb152-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-25"><a href="other-useful.html#cb152-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-26"><a href="other-useful.html#cb152-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-27"><a href="other-useful.html#cb152-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-28"><a href="other-useful.html#cb152-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-29"><a href="other-useful.html#cb152-29" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb152-30"><a href="other-useful.html#cb152-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-31"><a href="other-useful.html#cb152-31" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb152-32"><a href="other-useful.html#cb152-32" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb152-33"><a href="other-useful.html#cb152-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb152-34"><a href="other-useful.html#cb152-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-35"><a href="other-useful.html#cb152-35" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb152-36"><a href="other-useful.html#cb152-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-37"><a href="other-useful.html#cb152-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-38"><a href="other-useful.html#cb152-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-39"><a href="other-useful.html#cb152-39" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-40"><a href="other-useful.html#cb152-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-41"><a href="other-useful.html#cb152-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-42"><a href="other-useful.html#cb152-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-43"><a href="other-useful.html#cb152-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-44"><a href="other-useful.html#cb152-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb152-45"><a href="other-useful.html#cb152-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-46"><a href="other-useful.html#cb152-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again naming features</span></span>
<span id="cb152-47"><a href="other-useful.html#cb152-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-48"><a href="other-useful.html#cb152-48" aria-hidden="true" tabindex="-1"></a>  x_named <span class="ot">&lt;-</span> x</span>
<span id="cb152-49"><a href="other-useful.html#cb152-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_named) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb152-50"><a href="other-useful.html#cb152-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-51"><a href="other-useful.html#cb152-51" aria-hidden="true" tabindex="-1"></a>  css_results_name_feats <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_named, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb152-52"><a href="other-useful.html#cb152-52" aria-hidden="true" tabindex="-1"></a>                                <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb152-53"><a href="other-useful.html#cb152-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-54"><a href="other-useful.html#cb152-54" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_name_feats)</span>
<span id="cb152-55"><a href="other-useful.html#cb152-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-56"><a href="other-useful.html#cb152-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-57"><a href="other-useful.html#cb152-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoName&quot;</span>,</span>
<span id="cb152-58"><a href="other-useful.html#cb152-58" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustProtoNum&quot;</span>, <span class="st">&quot;ClustSelProp&quot;</span>,</span>
<span id="cb152-59"><a href="other-useful.html#cb152-59" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-60"><a href="other-useful.html#cb152-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-61"><a href="other-useful.html#cb152-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb152-62"><a href="other-useful.html#cb152-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb152-63"><a href="other-useful.html#cb152-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-64"><a href="other-useful.html#cb152-64" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-65"><a href="other-useful.html#cb152-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(good_clusters) <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-66"><a href="other-useful.html#cb152-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-67"><a href="other-useful.html#cb152-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-68"><a href="other-useful.html#cb152-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustProtoName))</span>
<span id="cb152-69"><a href="other-useful.html#cb152-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-70"><a href="other-useful.html#cb152-70" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb152-71"><a href="other-useful.html#cb152-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-72"><a href="other-useful.html#cb152-72" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb152-73"><a href="other-useful.html#cb152-73" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb152-74"><a href="other-useful.html#cb152-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>] <span class="sc">%in%</span> LETTERS[<span class="dv">7</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb152-75"><a href="other-useful.html#cb152-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-76"><a href="other-useful.html#cb152-76" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoName&quot;</span>])))</span>
<span id="cb152-77"><a href="other-useful.html#cb152-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-78"><a href="other-useful.html#cb152-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-79"><a href="other-useful.html#cb152-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-80"><a href="other-useful.html#cb152-80" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb152-81"><a href="other-useful.html#cb152-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-82"><a href="other-useful.html#cb152-82" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb152-83"><a href="other-useful.html#cb152-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb152-84"><a href="other-useful.html#cb152-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-85"><a href="other-useful.html#cb152-85" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb152-86"><a href="other-useful.html#cb152-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-87"><a href="other-useful.html#cb152-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-88"><a href="other-useful.html#cb152-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-89"><a href="other-useful.html#cb152-89" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-90"><a href="other-useful.html#cb152-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-91"><a href="other-useful.html#cb152-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-92"><a href="other-useful.html#cb152-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-93"><a href="other-useful.html#cb152-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-94"><a href="other-useful.html#cb152-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb152-95"><a href="other-useful.html#cb152-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-96"><a href="other-useful.html#cb152-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unnamed clusters</span></span>
<span id="cb152-97"><a href="other-useful.html#cb152-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-98"><a href="other-useful.html#cb152-98" aria-hidden="true" tabindex="-1"></a>  unnamed_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)</span>
<span id="cb152-99"><a href="other-useful.html#cb152-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-100"><a href="other-useful.html#cb152-100" aria-hidden="true" tabindex="-1"></a>  css_results_unnamed <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>unnamed_clusters,</span>
<span id="cb152-101"><a href="other-useful.html#cb152-101" aria-hidden="true" tabindex="-1"></a>                             <span class="at">B=</span><span class="dv">10</span>)</span>
<span id="cb152-102"><a href="other-useful.html#cb152-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-103"><a href="other-useful.html#cb152-103" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results_unnamed)</span>
<span id="cb152-104"><a href="other-useful.html#cb152-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-105"><a href="other-useful.html#cb152-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-106"><a href="other-useful.html#cb152-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb152-107"><a href="other-useful.html#cb152-107" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-108"><a href="other-useful.html#cb152-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-109"><a href="other-useful.html#cb152-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb152-110"><a href="other-useful.html#cb152-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(ret), <span class="dv">7</span>)</span>
<span id="cb152-111"><a href="other-useful.html#cb152-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-112"><a href="other-useful.html#cb152-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-113"><a href="other-useful.html#cb152-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-114"><a href="other-useful.html#cb152-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-115"><a href="other-useful.html#cb152-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-116"><a href="other-useful.html#cb152-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-117"><a href="other-useful.html#cb152-117" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-118"><a href="other-useful.html#cb152-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-119"><a href="other-useful.html#cb152-119" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-120"><a href="other-useful.html#cb152-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-121"><a href="other-useful.html#cb152-121" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-122"><a href="other-useful.html#cb152-122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-123"><a href="other-useful.html#cb152-123" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try other settings for cutoff, min_num_clusts, max_num_clusts, etc.</span></span>
<span id="cb152-124"><a href="other-useful.html#cb152-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-125"><a href="other-useful.html#cb152-125" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="dv">3</span>)</span>
<span id="cb152-126"><a href="other-useful.html#cb152-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-127"><a href="other-useful.html#cb152-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-128"><a href="other-useful.html#cb152-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb152-129"><a href="other-useful.html#cb152-129" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-130"><a href="other-useful.html#cb152-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-131"><a href="other-useful.html#cb152-131" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb152-132"><a href="other-useful.html#cb152-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-133"><a href="other-useful.html#cb152-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-134"><a href="other-useful.html#cb152-134" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-135"><a href="other-useful.html#cb152-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-136"><a href="other-useful.html#cb152-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-137"><a href="other-useful.html#cb152-137" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb152-138"><a href="other-useful.html#cb152-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb152-139"><a href="other-useful.html#cb152-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-140"><a href="other-useful.html#cb152-140" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb152-141"><a href="other-useful.html#cb152-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-142"><a href="other-useful.html#cb152-142" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-143"><a href="other-useful.html#cb152-143" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-144"><a href="other-useful.html#cb152-144" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-145"><a href="other-useful.html#cb152-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-146"><a href="other-useful.html#cb152-146" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-147"><a href="other-useful.html#cb152-147" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb152-148"><a href="other-useful.html#cb152-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-149"><a href="other-useful.html#cb152-149" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-150"><a href="other-useful.html#cb152-150" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-151"><a href="other-useful.html#cb152-151" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb152-152"><a href="other-useful.html#cb152-152" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-153"><a href="other-useful.html#cb152-153" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-154"><a href="other-useful.html#cb152-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-155"><a href="other-useful.html#cb152-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-156"><a href="other-useful.html#cb152-156" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-157"><a href="other-useful.html#cb152-157" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb152-158"><a href="other-useful.html#cb152-158" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-159"><a href="other-useful.html#cb152-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-160"><a href="other-useful.html#cb152-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-161"><a href="other-useful.html#cb152-161" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb152-162"><a href="other-useful.html#cb152-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-163"><a href="other-useful.html#cb152-163" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-164"><a href="other-useful.html#cb152-164" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb152-165"><a href="other-useful.html#cb152-165" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-166"><a href="other-useful.html#cb152-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-167"><a href="other-useful.html#cb152-167" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total number of clusters is 11 - (3 - 1) - (3 - 1) = 7</span></span>
<span id="cb152-168"><a href="other-useful.html#cb152-168" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb152-169"><a href="other-useful.html#cb152-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb152-170"><a href="other-useful.html#cb152-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-171"><a href="other-useful.html#cb152-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-172"><a href="other-useful.html#cb152-172" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-173"><a href="other-useful.html#cb152-173" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-174"><a href="other-useful.html#cb152-174" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-175"><a href="other-useful.html#cb152-175" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb152-176"><a href="other-useful.html#cb152-176" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb152-177"><a href="other-useful.html#cb152-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-178"><a href="other-useful.html#cb152-178" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb152-179"><a href="other-useful.html#cb152-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-180"><a href="other-useful.html#cb152-180" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-181"><a href="other-useful.html#cb152-181" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-182"><a href="other-useful.html#cb152-182" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-183"><a href="other-useful.html#cb152-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-184"><a href="other-useful.html#cb152-184" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-185"><a href="other-useful.html#cb152-185" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb152-186"><a href="other-useful.html#cb152-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-187"><a href="other-useful.html#cb152-187" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-188"><a href="other-useful.html#cb152-188" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-189"><a href="other-useful.html#cb152-189" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb152-190"><a href="other-useful.html#cb152-190" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-191"><a href="other-useful.html#cb152-191" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-192"><a href="other-useful.html#cb152-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-193"><a href="other-useful.html#cb152-193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-194"><a href="other-useful.html#cb152-194" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-195"><a href="other-useful.html#cb152-195" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb152-196"><a href="other-useful.html#cb152-196" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-197"><a href="other-useful.html#cb152-197" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-198"><a href="other-useful.html#cb152-198" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-199"><a href="other-useful.html#cb152-199" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb152-200"><a href="other-useful.html#cb152-200" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="dv">1</span>)</span>
<span id="cb152-201"><a href="other-useful.html#cb152-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-202"><a href="other-useful.html#cb152-202" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.data.frame</span>(ret))</span>
<span id="cb152-203"><a href="other-useful.html#cb152-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(ret), <span class="fu">c</span>(<span class="st">&quot;ClustName&quot;</span>, <span class="st">&quot;ClustProtoNum&quot;</span>,</span>
<span id="cb152-204"><a href="other-useful.html#cb152-204" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;ClustSelProp&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>))</span>
<span id="cb152-205"><a href="other-useful.html#cb152-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-206"><a href="other-useful.html#cb152-206" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb152-207"><a href="other-useful.html#cb152-207" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">nrow</span>(ret) <span class="sc">&lt;=</span> <span class="dv">7</span>)</span>
<span id="cb152-208"><a href="other-useful.html#cb152-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-209"><a href="other-useful.html#cb152-209" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(ret<span class="sc">$</span>ClustName))</span>
<span id="cb152-210"><a href="other-useful.html#cb152-210" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(ret<span class="sc">$</span>ClustName), <span class="fu">length</span>(<span class="fu">unique</span>(ret<span class="sc">$</span>ClustName)))</span>
<span id="cb152-211"><a href="other-useful.html#cb152-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-212"><a href="other-useful.html#cb152-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustProtoNum))</span>
<span id="cb152-213"><a href="other-useful.html#cb152-213" aria-hidden="true" tabindex="-1"></a>  other_rows <span class="ot">&lt;-</span> <span class="sc">!</span>(ret<span class="sc">$</span>ClustName <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;green_cluster&quot;</span>))</span>
<span id="cb152-214"><a href="other-useful.html#cb152-214" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 7L<span class="sc">:</span>11L))</span>
<span id="cb152-215"><a href="other-useful.html#cb152-215" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>]) <span class="sc">==</span></span>
<span id="cb152-216"><a href="other-useful.html#cb152-216" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(<span class="fu">unique</span>(ret[other_rows, <span class="st">&quot;ClustProtoNum&quot;</span>])))</span>
<span id="cb152-217"><a href="other-useful.html#cb152-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-218"><a href="other-useful.html#cb152-218" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(ret<span class="sc">$</span>ClustSelProp))</span>
<span id="cb152-219"><a href="other-useful.html#cb152-219" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(ret<span class="sc">$</span>ClustSelProp, <span class="fu">sort</span>(ret<span class="sc">$</span>ClustSelProp,</span>
<span id="cb152-220"><a href="other-useful.html#cb152-220" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">decreasing=</span><span class="cn">TRUE</span>))</span>
<span id="cb152-221"><a href="other-useful.html#cb152-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-222"><a href="other-useful.html#cb152-222" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(ret<span class="sc">$</span>ClustSize))</span>
<span id="cb152-223"><a href="other-useful.html#cb152-223" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(ret[other_rows, <span class="st">&quot;ClustSize&quot;</span>] <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb152-224"><a href="other-useful.html#cb152-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-225"><a href="other-useful.html#cb152-225" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;red_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-226"><a href="other-useful.html#cb152-226" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>,</span>
<span id="cb152-227"><a href="other-useful.html#cb152-227" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 1L<span class="sc">:</span>3L)</span>
<span id="cb152-228"><a href="other-useful.html#cb152-228" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;red_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-229"><a href="other-useful.html#cb152-229" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-230"><a href="other-useful.html#cb152-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-231"><a href="other-useful.html#cb152-231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;green_cluster&quot;</span> <span class="sc">%in%</span> ret<span class="sc">$</span>ClustName){</span>
<span id="cb152-232"><a href="other-useful.html#cb152-232" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>,</span>
<span id="cb152-233"><a href="other-useful.html#cb152-233" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;ClustProtoNum&quot;</span>] <span class="sc">%in%</span> 4L<span class="sc">:</span>6L)</span>
<span id="cb152-234"><a href="other-useful.html#cb152-234" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(ret[ret<span class="sc">$</span>ClustName<span class="sc">==</span><span class="st">&quot;green_cluster&quot;</span>, <span class="st">&quot;ClustSize&quot;</span>], <span class="dv">3</span>)</span>
<span id="cb152-235"><a href="other-useful.html#cb152-235" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb152-236"><a href="other-useful.html#cb152-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-237"><a href="other-useful.html#cb152-237" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Trying bad inputs</span></span>
<span id="cb152-238"><a href="other-useful.html#cb152-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-239"><a href="other-useful.html#cb152-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb152-240"><a href="other-useful.html#cb152-240" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="st">&quot;css_results&quot;</span>))</span>
<span id="cb152-241"><a href="other-useful.html#cb152-241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-242"><a href="other-useful.html#cb152-242" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">cutoff=</span><span class="sc">-</span>.<span class="dv">1</span>),</span>
<span id="cb152-243"><a href="other-useful.html#cb152-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb152-244"><a href="other-useful.html#cb152-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-245"><a href="other-useful.html#cb152-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">min_num_clusts=</span><span class="fl">3.2</span>),</span>
<span id="cb152-246"><a href="other-useful.html#cb152-246" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts == round(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb152-247"><a href="other-useful.html#cb152-247" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb152-248"><a href="other-useful.html#cb152-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb152-249"><a href="other-useful.html#cb152-249" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='other-useful.html#printCssDf'>printCssDf</a>(css_results, <span class="at">max_num_clusts=</span><span class="st">&quot;5&quot;</span>),</span>
<span id="cb152-250"><a href="other-useful.html#cb152-250" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb152-251"><a href="other-useful.html#cb152-251" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb152-252"><a href="other-useful.html#cb152-252" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed 🎉</code></pre>
<p>print.cssr</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="other-useful.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print cluster stability selection output</span></span>
<span id="cb154-2"><a href="other-useful.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb154-3"><a href="other-useful.html#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Print a summary of the information from the css function (using output from</span></span>
<span id="cb154-4"><a href="other-useful.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; printCssDf function).</span></span>
<span id="cb154-5"><a href="other-useful.html#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param x An object of class &quot;cssr&quot; (the output of the function css).</span></span>
<span id="cb154-6"><a href="other-useful.html#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; print.cssr will display only those</span></span>
<span id="cb154-7"><a href="other-useful.html#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb154-8"><a href="other-useful.html#cb154-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are displayed, or</span></span>
<span id="cb154-9"><a href="other-useful.html#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are, if max_num_clusts is specified).</span></span>
<span id="cb154-10"><a href="other-useful.html#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb154-11"><a href="other-useful.html#cb154-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb154-12"><a href="other-useful.html#cb154-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb154-13"><a href="other-useful.html#cb154-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb154-14"><a href="other-useful.html#cb154-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb154-15"><a href="other-useful.html#cb154-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb154-16"><a href="other-useful.html#cb154-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb154-17"><a href="other-useful.html#cb154-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb154-18"><a href="other-useful.html#cb154-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb154-19"><a href="other-useful.html#cb154-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param ... Additional arguments to generic print.data.frame function</span></span>
<span id="cb154-20"><a href="other-useful.html#cb154-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A data.frame; each row contains a cluster, arranged in decreasing</span></span>
<span id="cb154-21"><a href="other-useful.html#cb154-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; order of cluster selection proportion from top to bottom. The columns are</span></span>
<span id="cb154-22"><a href="other-useful.html#cb154-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustName (the name of the cluster that was either provided to css or made by</span></span>
<span id="cb154-23"><a href="other-useful.html#cb154-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css if no name was provided); ClustProtoName (the name of the selection</span></span>
<span id="cb154-24"><a href="other-useful.html#cb154-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; prototype from the cluster, which is the feature with the greatest individual</span></span>
<span id="cb154-25"><a href="other-useful.html#cb154-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportion among all the cluster members, with ties broken by</span></span>
<span id="cb154-26"><a href="other-useful.html#cb154-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; choosing the feature with the highest correlation with the response if the</span></span>
<span id="cb154-27"><a href="other-useful.html#cb154-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response is real-valued; only returned if the features are named),</span></span>
<span id="cb154-28"><a href="other-useful.html#cb154-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ClustProtoNum (the column number of the prototype in the X matrix provided to</span></span>
<span id="cb154-29"><a href="other-useful.html#cb154-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css), and ClustSize (the size of the cluster).</span></span>
<span id="cb154-30"><a href="other-useful.html#cb154-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb154-31"><a href="other-useful.html#cb154-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb154-32"><a href="other-useful.html#cb154-32" aria-hidden="true" tabindex="-1"></a><span id='print.cssr'>print.cssr</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>, ...){</span>
<span id="cb154-33"><a href="other-useful.html#cb154-33" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <a href='other-useful.html#printCssDf'>printCssDf</a>(<span class="at">css_results=</span>x, <span class="at">cutoff=</span>cutoff,</span>
<span id="cb154-34"><a href="other-useful.html#cb154-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">min_num_clusts=</span>min_num_clusts, <span class="at">max_num_clusts=</span>max_num_clusts)</span>
<span id="cb154-35"><a href="other-useful.html#cb154-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print.data.frame</span>(df, ...)</span>
<span id="cb154-36"><a href="other-useful.html#cb154-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="sel-and-pred.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrapper-functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
