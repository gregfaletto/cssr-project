<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Selection and prediction functions | Creating the cssr R package</title>
  <meta name="description" content="5 Selection and prediction functions | Creating the cssr R package" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Selection and prediction functions | Creating the cssr R package" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Selection and prediction functions | Creating the cssr R package" />
  
  
  

<meta name="author" content="Gregory Faletto" />


<meta name="date" content="2023-02-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tests-for-main-functions-in-cssr.html"/>
<link rel="next" href="other-useful.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="overview.html"><a href="overview.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="overview.html"><a href="overview.html#cpss"><i class="fa fa-check"></i><b>2.1.1</b> Complementary pairs stability selection</a></li>
<li class="chapter" data-level="2.1.2" data-path="overview.html"><a href="overview.html#cluster-stability-selection"><i class="fa fa-check"></i><b>2.1.2</b> Cluster stability selection</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="overview.html"><a href="overview.html#outline"><i class="fa fa-check"></i><b>2.2</b> Outline</a></li>
<li class="chapter" data-level="2.3" data-path="overview.html"><a href="overview.html#package-setup"><i class="fa fa-check"></i><b>2.3</b> Package setup</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="css.html"><a href="css.html"><i class="fa fa-check"></i><b>3</b> The core function: <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="css.html"><a href="css.html#main-components-of-css"><i class="fa fa-check"></i><b>3.1</b> Main components of <code>css</code></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="css.html"><a href="css.html#generating-subsamples"><i class="fa fa-check"></i><b>3.1.1</b> Generating subsamples</a></li>
<li class="chapter" data-level="3.1.2" data-path="css.html"><a href="css.html#forming-selection-matrices"><i class="fa fa-check"></i><b>3.1.2</b> Forming selection matrices</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="css.html"><a href="css.html#helper-functions"><i class="fa fa-check"></i><b>3.2</b> Helper functions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tests-for-main-functions-in-cssr.html"><a href="tests-for-main-functions-in-cssr.html"><i class="fa fa-check"></i><b>4</b> Tests for main functions in <code>cssr</code></a></li>
<li class="chapter" data-level="5" data-path="sel-and-pred.html"><a href="sel-and-pred.html"><i class="fa fa-check"></i><b>5</b> Selection and prediction functions</a></li>
<li class="chapter" data-level="6" data-path="other-useful.html"><a href="other-useful.html"><i class="fa fa-check"></i><b>6</b> Other useful functions</a></li>
<li class="chapter" data-level="7" data-path="wrapper-functions.html"><a href="wrapper-functions.html"><i class="fa fa-check"></i><b>7</b> Convenient wrapper functions</a></li>
<li class="chapter" data-level="8" data-path="competitor-methods.html"><a href="competitor-methods.html"><i class="fa fa-check"></i><b>8</b> Competitor Methods</a></li>
<li class="chapter" data-level="9" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><i class="fa fa-check"></i><b>9</b> Documenting the package and adding README and pkgdown website</a>
<ul>
<li class="chapter" data-level="9.1" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-readme"><i class="fa fa-check"></i><b>9.1</b> Add README</a></li>
<li class="chapter" data-level="9.2" data-path="documenting-the-package-and-adding-readme-and-pkgdown-website.html"><a href="documenting-the-package-and-adding-readme-and-pkgdown-website.html#add-pkdgown-site"><i class="fa fa-check"></i><b>9.2</b> Add pkdgown site</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Creating the <code>cssr</code> R package</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="sel-and-pred" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Selection and prediction functions<a href="sel-and-pred.html#sel-and-pred" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Now that <code><a href='css.html#css'>css</a>()</code> has been defined and tested, we write functions to work with the output of <code><a href='css.html#css'>css</a>()</code>. The output of these functions will be of more direct interest for most end users than the output of <code><a href='css.html#css'>css</a>()</code>. These functions are defined separately from <code><a href='css.html#css'>css</a>()</code> because the most computationally intensive steps happen within <code><a href='css.html#css'>css</a>()</code>. <code><a href='css.html#css'>css</a>()</code> can be called only once on a data set, and then the functions that follow can be explored relatively quickly (one can try different parameters, etc.).</p>
<ul>
<li><code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code> takes in the results of <code><a href='css.html#css'>css</a>()</code> along with user-defined parameters on how to select clusters (a minimum or maximum number of clusters to select, along with a cutoff for cluster selection proportions) and selects clusters as well as features from those clusters.</li>
<li><code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code> takes in the same inputs as <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code> along with an unlabeled test matrix of features X (containing the same features as the X matrix provided originally to <code><a href='css.html#css'>css</a>()</code>). It uses the results from <code><a href='css.html#css'>css</a>()</code> to select clusters like <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code>, then it uses a user-selected weighting scheme to compute weighted averages of the cluster members. It returns a test matrix of cluster representatives, which can be used for downstream predictive tasks.</li>
<li>Finally, <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code> has the same inputs as <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code> <em>FIX THIS TYPO</em>, except it also accepts a set of labeled training data (where the response must be real-valued). <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code> selects clusters, forms matrices of cluster representatives on the training and test data, uses the training matrix of cluster representatives (along with the vector of responses for the training data) to estimate a linear model via ordinary least squares, and finally generates predictions on the test data using this linear model.</li>
</ul>
<p>As in the previous section, we first define each function and then define the helper functions called by that function. Tests are written for each function as soon as all of its dependencies have been defined.</p>
<ul>
<li><code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code>
<ul>
<li>Calls <code><a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>()</code>, which checks that the specified cutoff input is as expected</li>
<li><code><a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>()</code> verifies the weighting input to <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code></li>
<li><code><a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>()</code> confirms that the <code>min_num_clusts</code> parameter provided to <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code> is as expected</li>
<li>Likewise for <code><a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>()</code></li>
<li><code><a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>()</code> is the workhorse function of <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code>, doing most of the work to get the selected clusters (and the selected features from those clusters) with the verified inputs
<ul>
<li><code><a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>()</code> checks internally that the selected clusters are as expected</li>
<li><code><a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>()</code> gets the weights for each of the members of the selected clusters
<ul>
<li><code><a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>()</code> gets the weights for a single cluster</li>
</ul></li>
<li><code><a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>()</code> verifies the output of <code><a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>()</code></li>
</ul></li>
</ul></li>
<li><code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code>
<ul>
<li><code><a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>()</code> confirms that the design matrix provided to <code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code> matches the characteristics of the matrix that was provided to <code><a href='css.html#css'>css</a>()</code>.
<ul>
<li><code><a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>()</code> also verifies these inputs (and is also used by <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code> on both the training and test data)</li>
</ul></li>
<li><code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code> is the workhorse function, generating a matrix of cluster representatives with the verified inputs to <code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code>
<ul>
<li><code><a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>()</code> verifies the inputs to <code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code> (somewhat redundantly here, but <code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code> is called by more than one function, so this verifies the inputs to <code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code> regardless of where it is called).</li>
</ul></li>
</ul></li>
<li><code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code>
<ul>
<li><code><a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>()</code> verifies the inputs to <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code></li>
</ul></li>
</ul>
<p><code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="sel-and-pred.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Obtain a selected set of clusters and features</span></span>
<span id="cb80-2"><a href="sel-and-pred.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb80-3"><a href="sel-and-pred.html#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate sets of selected clusters and features from cluster stability</span></span>
<span id="cb80-4"><a href="sel-and-pred.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection.</span></span>
<span id="cb80-5"><a href="sel-and-pred.html#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb80-6"><a href="sel-and-pred.html#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb80-7"><a href="sel-and-pred.html#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights for</span></span>
<span id="cb80-8"><a href="sel-and-pred.html#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual features within the selected clusters. Only those features with</span></span>
<span id="cb80-9"><a href="sel-and-pred.html#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero weight within the selected clusters will be returned. Must be one of</span></span>
<span id="cb80-10"><a href="sel-and-pred.html#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;sparse&quot;, &quot;weighted_avg&quot;, or &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is</span></span>
<span id="cb80-11"><a href="sel-and-pred.html#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; put on the most frequently</span></span>
<span id="cb80-12"><a href="sel-and-pred.html#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb80-13"><a href="sel-and-pred.html#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb80-14"><a href="sel-and-pred.html#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, only the features within a selected cluster that were</span></span>
<span id="cb80-15"><a href="sel-and-pred.html#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; themselves selected on at least one subsample will have nonzero weight. For</span></span>
<span id="cb80-16"><a href="sel-and-pred.html#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb80-17"><a href="sel-and-pred.html#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, all cluster members within</span></span>
<span id="cb80-18"><a href="sel-and-pred.html#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each selected cluster will be returned.). See Faletto and Bien (2022) for</span></span>
<span id="cb80-19"><a href="sel-and-pred.html#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; details. Default is &quot;sparse&quot;.</span></span>
<span id="cb80-20"><a href="sel-and-pred.html#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; getCssSelections will select and return only of those</span></span>
<span id="cb80-21"><a href="sel-and-pred.html#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb80-22"><a href="sel-and-pred.html#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1. Default is 0 (in which case either all clusters are selected, or</span></span>
<span id="cb80-23"><a href="sel-and-pred.html#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts are selected, if max_num_clusts is specified).</span></span>
<span id="cb80-24"><a href="sel-and-pred.html#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb80-25"><a href="sel-and-pred.html#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb80-26"><a href="sel-and-pred.html#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb80-27"><a href="sel-and-pred.html#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb80-28"><a href="sel-and-pred.html#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb80-29"><a href="sel-and-pred.html#cb80-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb80-30"><a href="sel-and-pred.html#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb80-31"><a href="sel-and-pred.html#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb80-32"><a href="sel-and-pred.html#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb80-33"><a href="sel-and-pred.html#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with two items. \item{selected_clusts}{A named list of</span></span>
<span id="cb80-34"><a href="sel-and-pred.html#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; integer vectors; each vector contains the indices of the features in one of</span></span>
<span id="cb80-35"><a href="sel-and-pred.html#cb80-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the selected clusters.} \item{selected_feats}{A named integer vector; the</span></span>
<span id="cb80-36"><a href="sel-and-pred.html#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of the features with nonzero weights from all of the selected</span></span>
<span id="cb80-37"><a href="sel-and-pred.html#cb80-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters.} \item{weights}{A named list of the same length as selected_clusts.</span></span>
<span id="cb80-38"><a href="sel-and-pred.html#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Each list element weights[[j]] is a numeric vector of the weights to use for</span></span>
<span id="cb80-39"><a href="sel-and-pred.html#cb80-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the jth selected cluster, and it has the same name as the cluster it</span></span>
<span id="cb80-40"><a href="sel-and-pred.html#cb80-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; corresponds to.}</span></span>
<span id="cb80-41"><a href="sel-and-pred.html#cb80-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb80-42"><a href="sel-and-pred.html#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references </span></span>
<span id="cb80-43"><a href="sel-and-pred.html#cb80-43" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb80-44"><a href="sel-and-pred.html#cb80-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb80-45"><a href="sel-and-pred.html#cb80-45" aria-hidden="true" tabindex="-1"></a><span id='getCssSelections'>getCssSelections</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb80-46"><a href="sel-and-pred.html#cb80-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>){</span>
<span id="cb80-47"><a href="sel-and-pred.html#cb80-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb80-48"><a href="sel-and-pred.html#cb80-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb80-49"><a href="sel-and-pred.html#cb80-49" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb80-50"><a href="sel-and-pred.html#cb80-50" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(weighting)</span>
<span id="cb80-51"><a href="sel-and-pred.html#cb80-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-52"><a href="sel-and-pred.html#cb80-52" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb80-53"><a href="sel-and-pred.html#cb80-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-54"><a href="sel-and-pred.html#cb80-54" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb80-55"><a href="sel-and-pred.html#cb80-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-56"><a href="sel-and-pred.html#cb80-56" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb80-57"><a href="sel-and-pred.html#cb80-57" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb80-58"><a href="sel-and-pred.html#cb80-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-59"><a href="sel-and-pred.html#cb80-59" aria-hidden="true" tabindex="-1"></a>    sel_results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_results, weighting, cutoff,</span>
<span id="cb80-60"><a href="sel-and-pred.html#cb80-60" aria-hidden="true" tabindex="-1"></a>        min_num_clusts, max_num_clusts)</span>
<span id="cb80-61"><a href="sel-and-pred.html#cb80-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-62"><a href="sel-and-pred.html#cb80-62" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sel_results$selected_clusts is guaranteed to have length at least 1 by</span></span>
<span id="cb80-63"><a href="sel-and-pred.html#cb80-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># getSelectedClusters</span></span>
<span id="cb80-64"><a href="sel-and-pred.html#cb80-64" aria-hidden="true" tabindex="-1"></a>    sel_clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(sel_results<span class="sc">$</span>selected_clusts)</span>
<span id="cb80-65"><a href="sel-and-pred.html#cb80-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-66"><a href="sel-and-pred.html#cb80-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sel_clust_names) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb80-67"><a href="sel-and-pred.html#cb80-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(sel_clust_names <span class="sc">%in%</span> <span class="fu">names</span>(css_results<span class="sc">$</span>clusters)))</span>
<span id="cb80-68"><a href="sel-and-pred.html#cb80-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-69"><a href="sel-and-pred.html#cb80-69" aria-hidden="true" tabindex="-1"></a>    sel_clusts <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb80-70"><a href="sel-and-pred.html#cb80-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sel_clust_names)){</span>
<span id="cb80-71"><a href="sel-and-pred.html#cb80-71" aria-hidden="true" tabindex="-1"></a>        sel_clusts[[i]] <span class="ot">&lt;-</span> css_results<span class="sc">$</span>clusters[[sel_clust_names[i]]]</span>
<span id="cb80-72"><a href="sel-and-pred.html#cb80-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(sel_clusts)[i] <span class="ot">&lt;-</span> sel_clust_names[i]</span>
<span id="cb80-73"><a href="sel-and-pred.html#cb80-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-74"><a href="sel-and-pred.html#cb80-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-75"><a href="sel-and-pred.html#cb80-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(sel_clusts))</span>
<span id="cb80-76"><a href="sel-and-pred.html#cb80-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(sel_clusts) <span class="sc">==</span> <span class="fu">length</span>(sel_clust_names))</span>
<span id="cb80-77"><a href="sel-and-pred.html#cb80-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-78"><a href="sel-and-pred.html#cb80-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sel_results$selected_feats is guaranteed to have length at least as long</span></span>
<span id="cb80-79"><a href="sel-and-pred.html#cb80-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># as sel_results$selected_clusts by getSelectedClusters</span></span>
<span id="cb80-80"><a href="sel-and-pred.html#cb80-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb80-81"><a href="sel-and-pred.html#cb80-81" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected_feats=</span>sel_results<span class="sc">$</span>selected_feats, <span class="at">weights=</span>sel_results<span class="sc">$</span>weights))</span>
<span id="cb80-82"><a href="sel-and-pred.html#cb80-82" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>()</code>:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="sel-and-pred.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument cutoff to several functions is</span></span>
<span id="cb81-2"><a href="sel-and-pred.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; as expected</span></span>
<span id="cb81-3"><a href="sel-and-pred.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb81-4"><a href="sel-and-pred.html#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; only those clusters with selection proportions equal</span></span>
<span id="cb81-5"><a href="sel-and-pred.html#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to at least cutoff will be selected by cluster stability selection. Must be</span></span>
<span id="cb81-6"><a href="sel-and-pred.html#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; between 0 and 1.</span></span>
<span id="cb81-7"><a href="sel-and-pred.html#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb81-8"><a href="sel-and-pred.html#cb81-8" aria-hidden="true" tabindex="-1"></a><span id='checkCutoff'>checkCutoff</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(cutoff){</span>
<span id="cb81-9"><a href="sel-and-pred.html#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(cutoff) <span class="sc">|</span> <span class="fu">is.integer</span>(cutoff))</span>
<span id="cb81-10"><a href="sel-and-pred.html#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(cutoff) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb81-11"><a href="sel-and-pred.html#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(cutoff))</span>
<span id="cb81-12"><a href="sel-and-pred.html#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cutoff <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb81-13"><a href="sel-and-pred.html#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(cutoff <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb81-14"><a href="sel-and-pred.html#cb81-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>()</code>:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="sel-and-pred.html#cb82-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkCutoff works&quot;</span>, {</span>
<span id="cb82-2"><a href="sel-and-pred.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="dv">0</span>))</span>
<span id="cb82-3"><a href="sel-and-pred.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="fl">0.2</span>))</span>
<span id="cb82-4"><a href="sel-and-pred.html#cb82-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="dv">1</span>))</span>
<span id="cb82-5"><a href="sel-and-pred.html#cb82-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-6"><a href="sel-and-pred.html#cb82-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="sc">-</span>.<span class="dv">2</span>), <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-7"><a href="sel-and-pred.html#cb82-7" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="dv">2</span>), <span class="st">&quot;cutoff &lt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-8"><a href="sel-and-pred.html#cb82-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="st">&quot;.3&quot;</span>),</span>
<span id="cb82-9"><a href="sel-and-pred.html#cb82-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb82-10"><a href="sel-and-pred.html#cb82-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-11"><a href="sel-and-pred.html#cb82-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow=</span><span class="dv">4</span>, <span class="at">ncol=</span><span class="dv">3</span>)),</span>
<span id="cb82-12"><a href="sel-and-pred.html#cb82-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(cutoff) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-13"><a href="sel-and-pred.html#cb82-13" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="fu">numeric</span>()),</span>
<span id="cb82-14"><a href="sel-and-pred.html#cb82-14" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(cutoff) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-15"><a href="sel-and-pred.html#cb82-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>)),</span>
<span id="cb82-16"><a href="sel-and-pred.html#cb82-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb82-17"><a href="sel-and-pred.html#cb82-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-18"><a href="sel-and-pred.html#cb82-18" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ˜€</code></pre>
<p><code><a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>()</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="sel-and-pred.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument weighting to several </span></span>
<span id="cb84-2"><a href="sel-and-pred.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb84-3"><a href="sel-and-pred.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb84-4"><a href="sel-and-pred.html#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb84-5"><a href="sel-and-pred.html#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb84-6"><a href="sel-and-pred.html#cb84-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb84-7"><a href="sel-and-pred.html#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;.</span></span>
<span id="cb84-8"><a href="sel-and-pred.html#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb84-9"><a href="sel-and-pred.html#cb84-9" aria-hidden="true" tabindex="-1"></a><span id='checkWeighting'>checkWeighting</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(weighting){</span>
<span id="cb84-10"><a href="sel-and-pred.html#cb84-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(weighting)<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb84-11"><a href="sel-and-pred.html#cb84-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(weighting))</span>
<span id="cb84-12"><a href="sel-and-pred.html#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.character</span>(weighting)){</span>
<span id="cb84-13"><a href="sel-and-pred.html#cb84-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Weighting must be a character&quot;</span>)</span>
<span id="cb84-14"><a href="sel-and-pred.html#cb84-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-15"><a href="sel-and-pred.html#cb84-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span>(weighting <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>, <span class="st">&quot;weighted_avg&quot;</span>))){</span>
<span id="cb84-16"><a href="sel-and-pred.html#cb84-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>)</span>
<span id="cb84-17"><a href="sel-and-pred.html#cb84-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb84-18"><a href="sel-and-pred.html#cb84-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>()</code>:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="sel-and-pred.html#cb85-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkWeighting works&quot;</span>, {</span>
<span id="cb85-2"><a href="sel-and-pred.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="st">&quot;sparse&quot;</span>))</span>
<span id="cb85-3"><a href="sel-and-pred.html#cb85-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="st">&quot;simple_avg&quot;</span>))</span>
<span id="cb85-4"><a href="sel-and-pred.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="st">&quot;weighted_avg&quot;</span>))</span>
<span id="cb85-5"><a href="sel-and-pred.html#cb85-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb85-6"><a href="sel-and-pred.html#cb85-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>)),</span>
<span id="cb85-7"><a href="sel-and-pred.html#cb85-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-8"><a href="sel-and-pred.html#cb85-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="cn">NA</span>), <span class="st">&quot;!is.na(weighting) is not TRUE&quot;</span>,</span>
<span id="cb85-9"><a href="sel-and-pred.html#cb85-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-10"><a href="sel-and-pred.html#cb85-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="dv">1</span>), <span class="st">&quot;Weighting must be a character&quot;</span>,</span>
<span id="cb85-11"><a href="sel-and-pred.html#cb85-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-12"><a href="sel-and-pred.html#cb85-12" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(<span class="st">&quot;spasre&quot;</span>),</span>
<span id="cb85-13"><a href="sel-and-pred.html#cb85-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb85-14"><a href="sel-and-pred.html#cb85-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb85-15"><a href="sel-and-pred.html#cb85-15" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸŒˆ</code></pre>
<p><code><a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>()</code>:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="sel-and-pred.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument min_num_clusts to several </span></span>
<span id="cb87-2"><a href="sel-and-pred.html#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb87-3"><a href="sel-and-pred.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb87-4"><a href="sel-and-pred.html#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb87-5"><a href="sel-and-pred.html#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb87-6"><a href="sel-and-pred.html#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb87-7"><a href="sel-and-pred.html#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.)</span></span>
<span id="cb87-8"><a href="sel-and-pred.html#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; since this is an upper bound on the number</span></span>
<span id="cb87-9"><a href="sel-and-pred.html#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of clusters of features, it is also an upper bound on min_num_clusts.</span></span>
<span id="cb87-10"><a href="sel-and-pred.html#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters The number of clusters; note that this is an upper bound</span></span>
<span id="cb87-11"><a href="sel-and-pred.html#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on min_num_clusts</span></span>
<span id="cb87-12"><a href="sel-and-pred.html#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb87-13"><a href="sel-and-pred.html#cb87-13" aria-hidden="true" tabindex="-1"></a><span id='checkMinNumClusts'>checkMinNumClusts</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(min_num_clusts, p, n_clusters){</span>
<span id="cb87-14"><a href="sel-and-pred.html#cb87-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(min_num_clusts) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb87-15"><a href="sel-and-pred.html#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(min_num_clusts) <span class="sc">|</span> <span class="fu">is.integer</span>(min_num_clusts))</span>
<span id="cb87-16"><a href="sel-and-pred.html#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.na</span>(min_num_clusts))</span>
<span id="cb87-17"><a href="sel-and-pred.html#cb87-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(min_num_clusts <span class="sc">==</span> <span class="fu">round</span>(min_num_clusts))</span>
<span id="cb87-18"><a href="sel-and-pred.html#cb87-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(min_num_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb87-19"><a href="sel-and-pred.html#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(min_num_clusts <span class="sc">&lt;=</span> p)</span>
<span id="cb87-20"><a href="sel-and-pred.html#cb87-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(min_num_clusts <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb87-21"><a href="sel-and-pred.html#cb87-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>()</code>:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="sel-and-pred.html#cb88-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkMinNumClusts works&quot;</span>, {</span>
<span id="cb88-2"><a href="sel-and-pred.html#cb88-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb88-3"><a href="sel-and-pred.html#cb88-3" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">6</span>))</span>
<span id="cb88-4"><a href="sel-and-pred.html#cb88-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">3</span>, <span class="dv">1932</span>, <span class="dv">3</span>))</span>
<span id="cb88-5"><a href="sel-and-pred.html#cb88-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb88-6"><a href="sel-and-pred.html#cb88-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb88-7"><a href="sel-and-pred.html#cb88-7" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-8"><a href="sel-and-pred.html#cb88-8" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="st">&quot;3&quot;</span>, <span class="st">&quot;1932&quot;</span>, <span class="st">&quot;3&quot;</span>),</span>
<span id="cb88-9"><a href="sel-and-pred.html#cb88-9" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb88-10"><a href="sel-and-pred.html#cb88-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-11"><a href="sel-and-pred.html#cb88-11" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb88-12"><a href="sel-and-pred.html#cb88-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb88-13"><a href="sel-and-pred.html#cb88-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-14"><a href="sel-and-pred.html#cb88-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb88-15"><a href="sel-and-pred.html#cb88-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">as.numeric</span>(<span class="cn">NA</span>)),</span>
<span id="cb88-16"><a href="sel-and-pred.html#cb88-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(min_num_clusts) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-17"><a href="sel-and-pred.html#cb88-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">0</span>, <span class="dv">13</span>, <span class="dv">7</span>),</span>
<span id="cb88-18"><a href="sel-and-pred.html#cb88-18" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-19"><a href="sel-and-pred.html#cb88-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">8</span>),</span>
<span id="cb88-20"><a href="sel-and-pred.html#cb88-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-21"><a href="sel-and-pred.html#cb88-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">6</span>, <span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb88-22"><a href="sel-and-pred.html#cb88-22" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-23"><a href="sel-and-pred.html#cb88-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">5</span>),</span>
<span id="cb88-24"><a href="sel-and-pred.html#cb88-24" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb88-25"><a href="sel-and-pred.html#cb88-25" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p><code><a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>()</code>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="sel-and-pred.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the argument max_num_clusts to several </span></span>
<span id="cb90-2"><a href="sel-and-pred.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; functions is as expected</span></span>
<span id="cb90-3"><a href="sel-and-pred.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb90-4"><a href="sel-and-pred.html#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb90-5"><a href="sel-and-pred.html#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb90-6"><a href="sel-and-pred.html#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb90-7"><a href="sel-and-pred.html#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Can be NA, in which case</span></span>
<span id="cb90-8"><a href="sel-and-pred.html#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts will be ignored.</span></span>
<span id="cb90-9"><a href="sel-and-pred.html#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb90-10"><a href="sel-and-pred.html#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb90-11"><a href="sel-and-pred.html#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb90-12"><a href="sel-and-pred.html#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) max_num_clusts must be at least as</span></span>
<span id="cb90-13"><a href="sel-and-pred.html#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; large as min_num_clusts.</span></span>
<span id="cb90-14"><a href="sel-and-pred.html#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p The number of features; since this is an upper bound on the number</span></span>
<span id="cb90-15"><a href="sel-and-pred.html#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of clusters of features, it is also an upper bound on max_num_clusts.</span></span>
<span id="cb90-16"><a href="sel-and-pred.html#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters The number of clusters; note that this is an upper bound</span></span>
<span id="cb90-17"><a href="sel-and-pred.html#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; on max_num_clusts</span></span>
<span id="cb90-18"><a href="sel-and-pred.html#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return The provided max_num_clusts, coerced to an integer if needed, and</span></span>
<span id="cb90-19"><a href="sel-and-pred.html#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; coerced to be less than or equal to the total number of clusters.</span></span>
<span id="cb90-20"><a href="sel-and-pred.html#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb90-21"><a href="sel-and-pred.html#cb90-21" aria-hidden="true" tabindex="-1"></a><span id='checkMaxNumClusts'>checkMaxNumClusts</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(max_num_clusts, min_num_clusts, p, n_clusters){</span>
<span id="cb90-22"><a href="sel-and-pred.html#cb90-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(max_num_clusts) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb90-23"><a href="sel-and-pred.html#cb90-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(max_num_clusts)){</span>
<span id="cb90-24"><a href="sel-and-pred.html#cb90-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(max_num_clusts) <span class="sc">|</span> <span class="fu">is.integer</span>(max_num_clusts))</span>
<span id="cb90-25"><a href="sel-and-pred.html#cb90-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(max_num_clusts <span class="sc">==</span> <span class="fu">round</span>(max_num_clusts))</span>
<span id="cb90-26"><a href="sel-and-pred.html#cb90-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(max_num_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb90-27"><a href="sel-and-pred.html#cb90-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(max_num_clusts <span class="sc">&lt;=</span> p)</span>
<span id="cb90-28"><a href="sel-and-pred.html#cb90-28" aria-hidden="true" tabindex="-1"></a>        max_num_clusts <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">min</span>(n_clusters, max_num_clusts))</span>
<span id="cb90-29"><a href="sel-and-pred.html#cb90-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(max_num_clusts <span class="sc">&gt;=</span> min_num_clusts)</span>
<span id="cb90-30"><a href="sel-and-pred.html#cb90-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb90-31"><a href="sel-and-pred.html#cb90-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(max_num_clusts)</span>
<span id="cb90-32"><a href="sel-and-pred.html#cb90-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>()</code>:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="sel-and-pred.html#cb91-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkMaxNumClusts works&quot;</span>, {</span>
<span id="cb91-2"><a href="sel-and-pred.html#cb91-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="dv">4</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb91-3"><a href="sel-and-pred.html#cb91-3" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>), <span class="dv">4</span>)</span>
<span id="cb91-4"><a href="sel-and-pred.html#cb91-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb91-5"><a href="sel-and-pred.html#cb91-5" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>), <span class="dv">4</span>)</span>
<span id="cb91-6"><a href="sel-and-pred.html#cb91-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb91-7"><a href="sel-and-pred.html#cb91-7" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">p=</span><span class="dv">5</span>,</span>
<span id="cb91-8"><a href="sel-and-pred.html#cb91-8" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">n_clusters=</span><span class="dv">4</span>)))</span>
<span id="cb91-9"><a href="sel-and-pred.html#cb91-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-10"><a href="sel-and-pred.html#cb91-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="st">&quot;4&quot;</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb91-11"><a href="sel-and-pred.html#cb91-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-12"><a href="sel-and-pred.html#cb91-12" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb91-13"><a href="sel-and-pred.html#cb91-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-14"><a href="sel-and-pred.html#cb91-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="fl">3.2</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-15"><a href="sel-and-pred.html#cb91-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-16"><a href="sel-and-pred.html#cb91-16" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb91-17"><a href="sel-and-pred.html#cb91-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-18"><a href="sel-and-pred.html#cb91-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="dv">1</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-19"><a href="sel-and-pred.html#cb91-19" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-20"><a href="sel-and-pred.html#cb91-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb91-21"><a href="sel-and-pred.html#cb91-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-22"><a href="sel-and-pred.html#cb91-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-23"><a href="sel-and-pred.html#cb91-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb91-24"><a href="sel-and-pred.html#cb91-24" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-25"><a href="sel-and-pred.html#cb91-25" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-26"><a href="sel-and-pred.html#cb91-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(max_num_clusts) == 1 is not TRUE&quot;</span>,</span>
<span id="cb91-27"><a href="sel-and-pred.html#cb91-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-28"><a href="sel-and-pred.html#cb91-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-29"><a href="sel-and-pred.html#cb91-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="st">&quot;4&quot;</span>,</span>
<span id="cb91-30"><a href="sel-and-pred.html#cb91-30" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">min_num_clusts=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb91-31"><a href="sel-and-pred.html#cb91-31" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="st">&quot;5&quot;</span>, <span class="at">n_clusters=</span><span class="st">&quot;4&quot;</span>),</span>
<span id="cb91-32"><a href="sel-and-pred.html#cb91-32" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb91-33"><a href="sel-and-pred.html#cb91-33" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-34"><a href="sel-and-pred.html#cb91-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-35"><a href="sel-and-pred.html#cb91-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-36"><a href="sel-and-pred.html#cb91-36" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-37"><a href="sel-and-pred.html#cb91-37" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-38"><a href="sel-and-pred.html#cb91-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-39"><a href="sel-and-pred.html#cb91-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="dv">6</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-40"><a href="sel-and-pred.html#cb91-40" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-41"><a href="sel-and-pred.html#cb91-41" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-42"><a href="sel-and-pred.html#cb91-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-43"><a href="sel-and-pred.html#cb91-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(<span class="at">max_num_clusts=</span><span class="dv">1</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb91-44"><a href="sel-and-pred.html#cb91-44" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">p=</span><span class="dv">5</span>, <span class="at">n_clusters=</span><span class="dv">4</span>),</span>
<span id="cb91-45"><a href="sel-and-pred.html#cb91-45" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb91-46"><a href="sel-and-pred.html#cb91-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-47"><a href="sel-and-pred.html#cb91-47" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ˜€</code></pre>
<p><code><a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>()</code>:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="sel-and-pred.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; From css output, obtain names of selected clusters and selection proportions,</span></span>
<span id="cb93-2"><a href="sel-and-pred.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; indices of all selected features, and weights of individual cluster members</span></span>
<span id="cb93-3"><a href="sel-and-pred.html#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb93-4"><a href="sel-and-pred.html#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; If cutoff is too high for at least min_num_clusts clusters to be selected,</span></span>
<span id="cb93-5"><a href="sel-and-pred.html#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; then it will be lowered until min_num_clusts can be selected. After that, if</span></span>
<span id="cb93-6"><a href="sel-and-pred.html#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cutoff is too low such that more than max_num_clusts are selected, then</span></span>
<span id="cb93-7"><a href="sel-and-pred.html#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the cutoff will be increased until no more than max_num_clusts are selected.</span></span>
<span id="cb93-8"><a href="sel-and-pred.html#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Note that because clusters can have tied selection proportions, it is</span></span>
<span id="cb93-9"><a href="sel-and-pred.html#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; possible that the number of selected clusters will be strictly lower than</span></span>
<span id="cb93-10"><a href="sel-and-pred.html#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts or strictly greater than min_num_clusts. In fact, it is</span></span>
<span id="cb93-11"><a href="sel-and-pred.html#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; possible that both cutoffs won&#39;t be able to be satisfied simulteaneously,</span></span>
<span id="cb93-12"><a href="sel-and-pred.html#cb93-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; even if there is a strictly positive difference between max_num_clusts and</span></span>
<span id="cb93-13"><a href="sel-and-pred.html#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts. If this occurs, max_num_clusts will take precedence over</span></span>
<span id="cb93-14"><a href="sel-and-pred.html#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts. getSelectedClusters will throw an error if the provided</span></span>
<span id="cb93-15"><a href="sel-and-pred.html#cb93-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; inputs don&#39;t allow it to select any clusters. </span></span>
<span id="cb93-16"><a href="sel-and-pred.html#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb93-17"><a href="sel-and-pred.html#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb93-18"><a href="sel-and-pred.html#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb93-19"><a href="sel-and-pred.html#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights for</span></span>
<span id="cb93-20"><a href="sel-and-pred.html#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual features within the selected clusters. Only those features with</span></span>
<span id="cb93-21"><a href="sel-and-pred.html#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero weight within the selected clusters will be returned. Must be one of</span></span>
<span id="cb93-22"><a href="sel-and-pred.html#cb93-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;sparse&quot;, &quot;weighted_avg&quot;, or &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is</span></span>
<span id="cb93-23"><a href="sel-and-pred.html#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; put on the most frequently</span></span>
<span id="cb93-24"><a href="sel-and-pred.html#cb93-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb93-25"><a href="sel-and-pred.html#cb93-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb93-26"><a href="sel-and-pred.html#cb93-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, only the features within a selected cluster that were</span></span>
<span id="cb93-27"><a href="sel-and-pred.html#cb93-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; themselves selected on at least one subsample will have nonzero weight. For</span></span>
<span id="cb93-28"><a href="sel-and-pred.html#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb93-29"><a href="sel-and-pred.html#cb93-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, all cluster members within</span></span>
<span id="cb93-30"><a href="sel-and-pred.html#cb93-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each selected cluster will be returned.). See Faletto and Bien (2022) for</span></span>
<span id="cb93-31"><a href="sel-and-pred.html#cb93-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; details.</span></span>
<span id="cb93-32"><a href="sel-and-pred.html#cb93-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; getCssSelections will select and return only of those</span></span>
<span id="cb93-33"><a href="sel-and-pred.html#cb93-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters with selection proportions equal to at least cutoff. Must be between</span></span>
<span id="cb93-34"><a href="sel-and-pred.html#cb93-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; 0 and 1.</span></span>
<span id="cb93-35"><a href="sel-and-pred.html#cb93-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb93-36"><a href="sel-and-pred.html#cb93-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb93-37"><a href="sel-and-pred.html#cb93-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb93-38"><a href="sel-and-pred.html#cb93-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.)</span></span>
<span id="cb93-39"><a href="sel-and-pred.html#cb93-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb93-40"><a href="sel-and-pred.html#cb93-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb93-41"><a href="sel-and-pred.html#cb93-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb93-42"><a href="sel-and-pred.html#cb93-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) If NA, max_num_clusts is ignored.</span></span>
<span id="cb93-43"><a href="sel-and-pred.html#cb93-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{selected_clusts}{A</span></span>
<span id="cb93-44"><a href="sel-and-pred.html#cb93-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named numeric vector containing the selection proportions for the selected</span></span>
<span id="cb93-45"><a href="sel-and-pred.html#cb93-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters. The name of each entry is the name of the corresponding cluster.}</span></span>
<span id="cb93-46"><a href="sel-and-pred.html#cb93-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{selected_feats}{A named integer vector; the indices of the features</span></span>
<span id="cb93-47"><a href="sel-and-pred.html#cb93-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with nonzero weights from all of the selected clusters.} \item{weights}{A</span></span>
<span id="cb93-48"><a href="sel-and-pred.html#cb93-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; named list of the same length as the number of selected clusters. Each list</span></span>
<span id="cb93-49"><a href="sel-and-pred.html#cb93-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; element weights[[j]] is a numeric vector of the weights to use for the jth</span></span>
<span id="cb93-50"><a href="sel-and-pred.html#cb93-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected cluster, and it has the same name as the cluster it corresponds</span></span>
<span id="cb93-51"><a href="sel-and-pred.html#cb93-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to.}</span></span>
<span id="cb93-52"><a href="sel-and-pred.html#cb93-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb93-53"><a href="sel-and-pred.html#cb93-53" aria-hidden="true" tabindex="-1"></a><span id='getSelectedClusters'>getSelectedClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, weighting, cutoff, min_num_clusts,</span>
<span id="cb93-54"><a href="sel-and-pred.html#cb93-54" aria-hidden="true" tabindex="-1"></a>    max_num_clusts){</span>
<span id="cb93-55"><a href="sel-and-pred.html#cb93-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check input</span></span>
<span id="cb93-56"><a href="sel-and-pred.html#cb93-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb93-57"><a href="sel-and-pred.html#cb93-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-58"><a href="sel-and-pred.html#cb93-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Eliminate clusters with selection proportions below cutoff</span></span>
<span id="cb93-59"><a href="sel-and-pred.html#cb93-59" aria-hidden="true" tabindex="-1"></a>    clus_sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>clus_sel_mat)</span>
<span id="cb93-60"><a href="sel-and-pred.html#cb93-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-61"><a href="sel-and-pred.html#cb93-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selected clusters</span></span>
<span id="cb93-62"><a href="sel-and-pred.html#cb93-62" aria-hidden="true" tabindex="-1"></a>    selected_clusts <span class="ot">&lt;-</span> clus_sel_props[clus_sel_props <span class="sc">&gt;=</span> cutoff]</span>
<span id="cb93-63"><a href="sel-and-pred.html#cb93-63" aria-hidden="true" tabindex="-1"></a>    B <span class="ot">&lt;-</span> <span class="fu">nrow</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb93-64"><a href="sel-and-pred.html#cb93-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-65"><a href="sel-and-pred.html#cb93-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check that selected_clusts has length at least min_num_clusts</span></span>
<span id="cb93-66"><a href="sel-and-pred.html#cb93-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&lt;</span> min_num_clusts){</span>
<span id="cb93-67"><a href="sel-and-pred.html#cb93-67" aria-hidden="true" tabindex="-1"></a>        cutoff <span class="ot">&lt;-</span> cutoff <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span>B</span>
<span id="cb93-68"><a href="sel-and-pred.html#cb93-68" aria-hidden="true" tabindex="-1"></a>        selected_clusts <span class="ot">&lt;-</span> clus_sel_props[clus_sel_props <span class="sc">&gt;=</span> cutoff]</span>
<span id="cb93-69"><a href="sel-and-pred.html#cb93-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb93-70"><a href="sel-and-pred.html#cb93-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-71"><a href="sel-and-pred.html#cb93-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check that selected_clusts has length at most max_num_clusts</span></span>
<span id="cb93-72"><a href="sel-and-pred.html#cb93-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(max_num_clusts)){</span>
<span id="cb93-73"><a href="sel-and-pred.html#cb93-73" aria-hidden="true" tabindex="-1"></a>        n_clusters <span class="ot">&lt;-</span> <span class="fu">ncol</span>(css_results<span class="sc">$</span>clus_sel_mat)</span>
<span id="cb93-74"><a href="sel-and-pred.html#cb93-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&gt;</span> max_num_clusts){</span>
<span id="cb93-75"><a href="sel-and-pred.html#cb93-75" aria-hidden="true" tabindex="-1"></a>            cutoff <span class="ot">&lt;-</span> cutoff <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>B</span>
<span id="cb93-76"><a href="sel-and-pred.html#cb93-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(cutoff <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb93-77"><a href="sel-and-pred.html#cb93-77" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb93-78"><a href="sel-and-pred.html#cb93-78" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb93-79"><a href="sel-and-pred.html#cb93-79" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Make sure we don&#39;t reduce to a selected set of size 0</span></span>
<span id="cb93-80"><a href="sel-and-pred.html#cb93-80" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">any</span>(clus_sel_props <span class="sc">&gt;=</span> cutoff)){</span>
<span id="cb93-81"><a href="sel-and-pred.html#cb93-81" aria-hidden="true" tabindex="-1"></a>                selected_clusts <span class="ot">&lt;-</span> clus_sel_props[clus_sel_props <span class="sc">&gt;=</span> cutoff]</span>
<span id="cb93-82"><a href="sel-and-pred.html#cb93-82" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span>{</span>
<span id="cb93-83"><a href="sel-and-pred.html#cb93-83" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb93-84"><a href="sel-and-pred.html#cb93-84" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb93-85"><a href="sel-and-pred.html#cb93-85" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb93-86"><a href="sel-and-pred.html#cb93-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb93-87"><a href="sel-and-pred.html#cb93-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-88"><a href="sel-and-pred.html#cb93-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb93-89"><a href="sel-and-pred.html#cb93-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-90"><a href="sel-and-pred.html#cb93-90" aria-hidden="true" tabindex="-1"></a>    clust_names <span class="ot">&lt;-</span> <span class="fu">names</span>(selected_clusts)</span>
<span id="cb93-91"><a href="sel-and-pred.html#cb93-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-92"><a href="sel-and-pred.html#cb93-92" aria-hidden="true" tabindex="-1"></a>    n_sel_clusts <span class="ot">&lt;-</span> <span class="fu">length</span>(selected_clusts)</span>
<span id="cb93-93"><a href="sel-and-pred.html#cb93-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-94"><a href="sel-and-pred.html#cb93-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check that n_sel_clusts is as expected, and throw warnings or an error if</span></span>
<span id="cb93-95"><a href="sel-and-pred.html#cb93-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># not</span></span>
<span id="cb93-96"><a href="sel-and-pred.html#cb93-96" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(n_sel_clusts, min_num_clusts, max_num_clusts,</span>
<span id="cb93-97"><a href="sel-and-pred.html#cb93-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">max</span>(clus_sel_props))</span>
<span id="cb93-98"><a href="sel-and-pred.html#cb93-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-99"><a href="sel-and-pred.html#cb93-99" aria-hidden="true" tabindex="-1"></a>    <span class="do">### Get selected features from selected clusters</span></span>
<span id="cb93-100"><a href="sel-and-pred.html#cb93-100" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> css_results<span class="sc">$</span>clusters</span>
<span id="cb93-101"><a href="sel-and-pred.html#cb93-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(clust_names <span class="sc">%in%</span> <span class="fu">names</span>(clusters)))</span>
<span id="cb93-102"><a href="sel-and-pred.html#cb93-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-103"><a href="sel-and-pred.html#cb93-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get a list of weights for all of the selected clusters</span></span>
<span id="cb93-104"><a href="sel-and-pred.html#cb93-104" aria-hidden="true" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(css_results, selected_clusts, weighting)</span>
<span id="cb93-105"><a href="sel-and-pred.html#cb93-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-106"><a href="sel-and-pred.html#cb93-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selected features from each cluster (those features with nonzero</span></span>
<span id="cb93-107"><a href="sel-and-pred.html#cb93-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># weights)</span></span>
<span id="cb93-108"><a href="sel-and-pred.html#cb93-108" aria-hidden="true" tabindex="-1"></a>    selected_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb93-109"><a href="sel-and-pred.html#cb93-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sel_clusts){</span>
<span id="cb93-110"><a href="sel-and-pred.html#cb93-110" aria-hidden="true" tabindex="-1"></a>        clus_i_name <span class="ot">&lt;-</span> clust_names[i]</span>
<span id="cb93-111"><a href="sel-and-pred.html#cb93-111" aria-hidden="true" tabindex="-1"></a>        clust_i <span class="ot">&lt;-</span> clusters[[clus_i_name]]</span>
<span id="cb93-112"><a href="sel-and-pred.html#cb93-112" aria-hidden="true" tabindex="-1"></a>        weights_i <span class="ot">&lt;-</span> weights[[i]]</span>
<span id="cb93-113"><a href="sel-and-pred.html#cb93-113" aria-hidden="true" tabindex="-1"></a>        selected_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(selected_feats, clust_i[weights_i <span class="sc">!=</span> <span class="dv">0</span>])</span>
<span id="cb93-114"><a href="sel-and-pred.html#cb93-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb93-115"><a href="sel-and-pred.html#cb93-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-116"><a href="sel-and-pred.html#cb93-116" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb93-117"><a href="sel-and-pred.html#cb93-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-118"><a href="sel-and-pred.html#cb93-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(selected_feats) <span class="ot">&lt;-</span> feat_names[selected_feats]</span>
<span id="cb93-119"><a href="sel-and-pred.html#cb93-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-120"><a href="sel-and-pred.html#cb93-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output (already checked weights wihin getAllClustWeights)</span></span>
<span id="cb93-121"><a href="sel-and-pred.html#cb93-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-122"><a href="sel-and-pred.html#cb93-122" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(selected_clusts, selected_feats,</span>
<span id="cb93-123"><a href="sel-and-pred.html#cb93-123" aria-hidden="true" tabindex="-1"></a>        weights, <span class="at">n_clusters=</span><span class="fu">length</span>(clusters), <span class="at">p=</span><span class="fu">ncol</span>(css_results<span class="sc">$</span>feat_sel_mat))</span>
<span id="cb93-124"><a href="sel-and-pred.html#cb93-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-125"><a href="sel-and-pred.html#cb93-125" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">selected_clusts=</span>selected_clusts,</span>
<span id="cb93-126"><a href="sel-and-pred.html#cb93-126" aria-hidden="true" tabindex="-1"></a>        <span class="at">selected_feats=</span>selected_feats, <span class="at">weights=</span>weights))</span>
<span id="cb93-127"><a href="sel-and-pred.html#cb93-127" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>()</code>:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="sel-and-pred.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to check operations within getSelectedClusters function</span></span>
<span id="cb94-2"><a href="sel-and-pred.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb94-3"><a href="sel-and-pred.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_sel_clusts The number of selected clusters; should be constrained</span></span>
<span id="cb94-4"><a href="sel-and-pred.html#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; by min_num_clusts and max_num_clusts (though it may not be possible to</span></span>
<span id="cb94-5"><a href="sel-and-pred.html#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; satisfy both constraints simulteneously, in which case a warning will be</span></span>
<span id="cb94-6"><a href="sel-and-pred.html#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; thrown).</span></span>
<span id="cb94-7"><a href="sel-and-pred.html#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb94-8"><a href="sel-and-pred.html#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb94-9"><a href="sel-and-pred.html#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb94-10"><a href="sel-and-pred.html#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.)</span></span>
<span id="cb94-11"><a href="sel-and-pred.html#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb94-12"><a href="sel-and-pred.html#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb94-13"><a href="sel-and-pred.html#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb94-14"><a href="sel-and-pred.html#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) If NA, max_num_clusts is ignored.</span></span>
<span id="cb94-15"><a href="sel-and-pred.html#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_sel_prop Numeric; the maximum selection proportion observed for </span></span>
<span id="cb94-16"><a href="sel-and-pred.html#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; any cluster.</span></span>
<span id="cb94-17"><a href="sel-and-pred.html#cb94-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb94-18"><a href="sel-and-pred.html#cb94-18" aria-hidden="true" tabindex="-1"></a><span id='checkSelectedClusters'>checkSelectedClusters</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(n_sel_clusts, min_num_clusts, max_num_clusts,</span>
<span id="cb94-19"><a href="sel-and-pred.html#cb94-19" aria-hidden="true" tabindex="-1"></a>    max_sel_prop){</span>
<span id="cb94-20"><a href="sel-and-pred.html#cb94-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_sel_clusts <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb94-21"><a href="sel-and-pred.html#cb94-21" aria-hidden="true" tabindex="-1"></a>        err <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;No clusters selected with this cutoff (try a cutoff below the maximum cluster selection proportion, &quot;</span>,</span>
<span id="cb94-22"><a href="sel-and-pred.html#cb94-22" aria-hidden="true" tabindex="-1"></a>            max_sel_prop, <span class="st">&quot;)&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb94-23"><a href="sel-and-pred.html#cb94-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(err)</span>
<span id="cb94-24"><a href="sel-and-pred.html#cb94-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-25"><a href="sel-and-pred.html#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="sel-and-pred.html#cb94-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n_sel_clusts <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb94-27"><a href="sel-and-pred.html#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="sel-and-pred.html#cb94-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># It may be impossible to get at least min_num_clusts or at most</span></span>
<span id="cb94-29"><a href="sel-and-pred.html#cb94-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># max_num_clusts; if so, give a warning</span></span>
<span id="cb94-30"><a href="sel-and-pred.html#cb94-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(n_sel_clusts <span class="sc">&lt;</span> min_num_clusts){</span>
<span id="cb94-31"><a href="sel-and-pred.html#cb94-31" aria-hidden="true" tabindex="-1"></a>        warn <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Returning fewer than min_num_clusts = &quot;</span>, min_num_clusts,</span>
<span id="cb94-32"><a href="sel-and-pred.html#cb94-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot; clusters because decreasing the cutoff any further would require returning more than max_num_clusts = &quot;</span>,</span>
<span id="cb94-33"><a href="sel-and-pred.html#cb94-33" aria-hidden="true" tabindex="-1"></a>            max_num_clusts, <span class="st">&quot; clusters&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb94-34"><a href="sel-and-pred.html#cb94-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(warn)</span>
<span id="cb94-35"><a href="sel-and-pred.html#cb94-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-36"><a href="sel-and-pred.html#cb94-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.na</span>(max_num_clusts)){</span>
<span id="cb94-37"><a href="sel-and-pred.html#cb94-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(n_sel_clusts <span class="sc">&gt;</span> max_num_clusts){</span>
<span id="cb94-38"><a href="sel-and-pred.html#cb94-38" aria-hidden="true" tabindex="-1"></a>            warn <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Returning more than max_num_clusts = &quot;</span>,</span>
<span id="cb94-39"><a href="sel-and-pred.html#cb94-39" aria-hidden="true" tabindex="-1"></a>                max_num_clusts,</span>
<span id="cb94-40"><a href="sel-and-pred.html#cb94-40" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot; clusters because increasing the cutoff any further would require returning 0 clusters&quot;</span>,</span>
<span id="cb94-41"><a href="sel-and-pred.html#cb94-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb94-42"><a href="sel-and-pred.html#cb94-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(warn)</span>
<span id="cb94-43"><a href="sel-and-pred.html#cb94-43" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb94-44"><a href="sel-and-pred.html#cb94-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb94-45"><a href="sel-and-pred.html#cb94-45" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Test for <code><a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>()</code>:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="sel-and-pred.html#cb95-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkSelectedClusters works&quot;</span>, {</span>
<span id="cb95-2"><a href="sel-and-pred.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb95-3"><a href="sel-and-pred.html#cb95-3" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">max_sel_prop=</span>.<span class="dv">8</span>))</span>
<span id="cb95-4"><a href="sel-and-pred.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">5</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb95-5"><a href="sel-and-pred.html#cb95-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">max_sel_prop=</span>.<span class="dv">3</span>))</span>
<span id="cb95-6"><a href="sel-and-pred.html#cb95-6" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">2</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb95-7"><a href="sel-and-pred.html#cb95-7" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">max_sel_prop=</span>.<span class="dv">3</span>))</span>
<span id="cb95-8"><a href="sel-and-pred.html#cb95-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-9"><a href="sel-and-pred.html#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="sel-and-pred.html#cb95-10" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb95-11"><a href="sel-and-pred.html#cb95-11" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">max_num_clusts=</span><span class="dv">5</span>,</span>
<span id="cb95-12"><a href="sel-and-pred.html#cb95-12" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">max_sel_prop=</span>.<span class="dv">6</span>),</span>
<span id="cb95-13"><a href="sel-and-pred.html#cb95-13" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;No clusters selected with this cutoff (try a cutoff below the maximum cluster selection proportion, 0.6)&quot;</span>,</span>
<span id="cb95-14"><a href="sel-and-pred.html#cb95-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb95-15"><a href="sel-and-pred.html#cb95-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-16"><a href="sel-and-pred.html#cb95-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">1</span>,</span>
<span id="cb95-17"><a href="sel-and-pred.html#cb95-17" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb95-18"><a href="sel-and-pred.html#cb95-18" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">max_num_clusts=</span><span class="dv">5</span>,</span>
<span id="cb95-19"><a href="sel-and-pred.html#cb95-19" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">max_sel_prop=</span>.<span class="dv">6</span>),</span>
<span id="cb95-20"><a href="sel-and-pred.html#cb95-20" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Returning fewer than min_num_clusts = 2 clusters because decreasing the cutoff any further would require returning more than max_num_clusts = 5 clusters&quot;</span>,</span>
<span id="cb95-21"><a href="sel-and-pred.html#cb95-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb95-22"><a href="sel-and-pred.html#cb95-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkSelectedClusters'>checkSelectedClusters</a>(<span class="at">n_sel_clusts=</span><span class="dv">6</span>,</span>
<span id="cb95-23"><a href="sel-and-pred.html#cb95-23" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb95-24"><a href="sel-and-pred.html#cb95-24" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">max_num_clusts=</span><span class="dv">5</span>,</span>
<span id="cb95-25"><a href="sel-and-pred.html#cb95-25" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">max_sel_prop=</span>.<span class="dv">6</span>),</span>
<span id="cb95-26"><a href="sel-and-pred.html#cb95-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Returning more than max_num_clusts = 5 clusters because increasing the cutoff any further would require returning 0 clusters&quot;</span>,</span>
<span id="cb95-27"><a href="sel-and-pred.html#cb95-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb95-28"><a href="sel-and-pred.html#cb95-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb95-29"><a href="sel-and-pred.html#cb95-29" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p><code><a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>()</code>:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="sel-and-pred.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate weights for each cluster member of all of the selected clusters.</span></span>
<span id="cb97-2"><a href="sel-and-pred.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb97-3"><a href="sel-and-pred.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb97-4"><a href="sel-and-pred.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb97-5"><a href="sel-and-pred.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sel_clusters A named numeric vector containing the selection</span></span>
<span id="cb97-6"><a href="sel-and-pred.html#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportions for the selected clusters. The name of each entry is the name</span></span>
<span id="cb97-7"><a href="sel-and-pred.html#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of the corresponding cluster.</span></span>
<span id="cb97-8"><a href="sel-and-pred.html#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights for</span></span>
<span id="cb97-9"><a href="sel-and-pred.html#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual features within the selected clusters. Only those features with</span></span>
<span id="cb97-10"><a href="sel-and-pred.html#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero weight within the selected clusters will be returned. Must be one of</span></span>
<span id="cb97-11"><a href="sel-and-pred.html#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;sparse&quot;, &quot;weighted_avg&quot;, or &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is</span></span>
<span id="cb97-12"><a href="sel-and-pred.html#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; put on the most frequently</span></span>
<span id="cb97-13"><a href="sel-and-pred.html#cb97-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb97-14"><a href="sel-and-pred.html#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb97-15"><a href="sel-and-pred.html#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, only the features within a selected cluster that were</span></span>
<span id="cb97-16"><a href="sel-and-pred.html#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; themselves selected on at least one subsample will have nonzero weight. For</span></span>
<span id="cb97-17"><a href="sel-and-pred.html#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb97-18"><a href="sel-and-pred.html#cb97-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, all cluster members within</span></span>
<span id="cb97-19"><a href="sel-and-pred.html#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each selected cluster will be returned.). See Faletto and Bien (2022) for</span></span>
<span id="cb97-20"><a href="sel-and-pred.html#cb97-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; details.</span></span>
<span id="cb97-21"><a href="sel-and-pred.html#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list of the same length as sel_clusters of numeric vectors.</span></span>
<span id="cb97-22"><a href="sel-and-pred.html#cb97-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; weights[[j]] is the weights to use for the jth selected cluster, and it has</span></span>
<span id="cb97-23"><a href="sel-and-pred.html#cb97-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the same name as the cluster it corresponds to.</span></span>
<span id="cb97-24"><a href="sel-and-pred.html#cb97-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb97-25"><a href="sel-and-pred.html#cb97-25" aria-hidden="true" tabindex="-1"></a><span id='getAllClustWeights'>getAllClustWeights</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, sel_clusters, weighting){</span>
<span id="cb97-26"><a href="sel-and-pred.html#cb97-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-27"><a href="sel-and-pred.html#cb97-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb97-28"><a href="sel-and-pred.html#cb97-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb97-29"><a href="sel-and-pred.html#cb97-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-30"><a href="sel-and-pred.html#cb97-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(sel_clusters))</span>
<span id="cb97-31"><a href="sel-and-pred.html#cb97-31" aria-hidden="true" tabindex="-1"></a>    p_ret <span class="ot">&lt;-</span> <span class="fu">length</span>(sel_clusters)</span>
<span id="cb97-32"><a href="sel-and-pred.html#cb97-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(sel_clusters))) <span class="sc">==</span> p_ret)</span>
<span id="cb97-33"><a href="sel-and-pred.html#cb97-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p_ret <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb97-34"><a href="sel-and-pred.html#cb97-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-35"><a href="sel-and-pred.html#cb97-35" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(weighting)</span>
<span id="cb97-36"><a href="sel-and-pred.html#cb97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-37"><a href="sel-and-pred.html#cb97-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get selection proportions and clusters</span></span>
<span id="cb97-38"><a href="sel-and-pred.html#cb97-38" aria-hidden="true" tabindex="-1"></a>    feat_sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(css_results<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb97-39"><a href="sel-and-pred.html#cb97-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-40"><a href="sel-and-pred.html#cb97-40" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">length</span>(feat_sel_props)</span>
<span id="cb97-41"><a href="sel-and-pred.html#cb97-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> p_ret)</span>
<span id="cb97-42"><a href="sel-and-pred.html#cb97-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-43"><a href="sel-and-pred.html#cb97-43" aria-hidden="true" tabindex="-1"></a>    clusters <span class="ot">&lt;-</span> css_results<span class="sc">$</span>clusters</span>
<span id="cb97-44"><a href="sel-and-pred.html#cb97-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">names</span>(sel_clusters) <span class="sc">%in%</span> <span class="fu">names</span>(clusters)))</span>
<span id="cb97-45"><a href="sel-and-pred.html#cb97-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-46"><a href="sel-and-pred.html#cb97-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Identify weights</span></span>
<span id="cb97-47"><a href="sel-and-pred.html#cb97-47" aria-hidden="true" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb97-48"><a href="sel-and-pred.html#cb97-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-49"><a href="sel-and-pred.html#cb97-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p_ret){</span>
<span id="cb97-50"><a href="sel-and-pred.html#cb97-50" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Find the members of the cluster feature j is a member of</span></span>
<span id="cb97-51"><a href="sel-and-pred.html#cb97-51" aria-hidden="true" tabindex="-1"></a>        cluster_j <span class="ot">&lt;-</span> clusters[[<span class="fu">names</span>(sel_clusters)[j]]]</span>
<span id="cb97-52"><a href="sel-and-pred.html#cb97-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get the weights for this cluster and add them to the list</span></span>
<span id="cb97-53"><a href="sel-and-pred.html#cb97-53" aria-hidden="true" tabindex="-1"></a>        weights[[j]] <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>(cluster_j, weighting, feat_sel_props)</span>
<span id="cb97-54"><a href="sel-and-pred.html#cb97-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb97-55"><a href="sel-and-pred.html#cb97-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-56"><a href="sel-and-pred.html#cb97-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add names to weights</span></span>
<span id="cb97-57"><a href="sel-and-pred.html#cb97-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(weights) <span class="ot">&lt;-</span> <span class="fu">names</span>(sel_clusters)</span>
<span id="cb97-58"><a href="sel-and-pred.html#cb97-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-59"><a href="sel-and-pred.html#cb97-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb97-60"><a href="sel-and-pred.html#cb97-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-61"><a href="sel-and-pred.html#cb97-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(weights) <span class="sc">==</span> p_ret)</span>
<span id="cb97-62"><a href="sel-and-pred.html#cb97-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(weights))</span>
<span id="cb97-63"><a href="sel-and-pred.html#cb97-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-64"><a href="sel-and-pred.html#cb97-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p_ret){</span>
<span id="cb97-65"><a href="sel-and-pred.html#cb97-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clusters[[<span class="fu">names</span>(sel_clusters)[i]]]) <span class="sc">==</span></span>
<span id="cb97-66"><a href="sel-and-pred.html#cb97-66" aria-hidden="true" tabindex="-1"></a>            <span class="fu">length</span>(weights[[i]]))</span>
<span id="cb97-67"><a href="sel-and-pred.html#cb97-67" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(weights[[i]] <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb97-68"><a href="sel-and-pred.html#cb97-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(weights[[i]] <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb97-69"><a href="sel-and-pred.html#cb97-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">abs</span>(<span class="fu">sum</span>(weights[[i]]) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb97-70"><a href="sel-and-pred.html#cb97-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb97-71"><a href="sel-and-pred.html#cb97-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(weights)</span>
<span id="cb97-72"><a href="sel-and-pred.html#cb97-72" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>()</code>:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="sel-and-pred.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate weights for members of a cluster using selection proportions</span></span>
<span id="cb98-2"><a href="sel-and-pred.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb98-3"><a href="sel-and-pred.html#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Given a cluster of features, the selection proportions for each cluster</span></span>
<span id="cb98-4"><a href="sel-and-pred.html#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; member, and a specified weighting scheme, calculate the appropriate weights</span></span>
<span id="cb98-5"><a href="sel-and-pred.html#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for the cluster.</span></span>
<span id="cb98-6"><a href="sel-and-pred.html#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cluster_i An integer vector containing the indices of the members</span></span>
<span id="cb98-7"><a href="sel-and-pred.html#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of a cluster.</span></span>
<span id="cb98-8"><a href="sel-and-pred.html#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights for</span></span>
<span id="cb98-9"><a href="sel-and-pred.html#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual features within the selected clusters. Only those features with</span></span>
<span id="cb98-10"><a href="sel-and-pred.html#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; nonzero weight within the selected clusters will be returned. Must be one of</span></span>
<span id="cb98-11"><a href="sel-and-pred.html#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;sparse&quot;, &quot;weighted_avg&quot;, or &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is</span></span>
<span id="cb98-12"><a href="sel-and-pred.html#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; put on the most frequently</span></span>
<span id="cb98-13"><a href="sel-and-pred.html#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb98-14"><a href="sel-and-pred.html#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb98-15"><a href="sel-and-pred.html#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, only the features within a selected cluster that were</span></span>
<span id="cb98-16"><a href="sel-and-pred.html#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; themselves selected on at least one subsample will have nonzero weight. For</span></span>
<span id="cb98-17"><a href="sel-and-pred.html#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb98-18"><a href="sel-and-pred.html#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, all cluster members within</span></span>
<span id="cb98-19"><a href="sel-and-pred.html#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; each selected cluster will be returned.). See Faletto and Bien (2022) for</span></span>
<span id="cb98-20"><a href="sel-and-pred.html#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; details.</span></span>
<span id="cb98-21"><a href="sel-and-pred.html#cb98-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param feat_sel_props A numeric vector of selection proportions corresponding</span></span>
<span id="cb98-22"><a href="sel-and-pred.html#cb98-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to each of the p features.</span></span>
<span id="cb98-23"><a href="sel-and-pred.html#cb98-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A numeric vector of the same length as cluster_i containing the</span></span>
<span id="cb98-24"><a href="sel-and-pred.html#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; weights corresponding to each of the features in cluster_i. The weights</span></span>
<span id="cb98-25"><a href="sel-and-pred.html#cb98-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will all be nonnegative and sum to 1.</span></span>
<span id="cb98-26"><a href="sel-and-pred.html#cb98-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb98-27"><a href="sel-and-pred.html#cb98-27" aria-hidden="true" tabindex="-1"></a><span id='getClustWeights'>getClustWeights</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(cluster_i, weighting, feat_sel_props){</span>
<span id="cb98-28"><a href="sel-and-pred.html#cb98-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-29"><a href="sel-and-pred.html#cb98-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(cluster_i) <span class="sc">|</span> <span class="fu">is.numeric</span>(cluster_i))</span>
<span id="cb98-30"><a href="sel-and-pred.html#cb98-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(cluster_i <span class="sc">==</span> <span class="fu">round</span>(cluster_i)))</span>
<span id="cb98-31"><a href="sel-and-pred.html#cb98-31" aria-hidden="true" tabindex="-1"></a>    n_weights <span class="ot">&lt;-</span> <span class="fu">length</span>(cluster_i)</span>
<span id="cb98-32"><a href="sel-and-pred.html#cb98-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">unique</span>(cluster_i)) <span class="sc">==</span> n_weights)</span>
<span id="cb98-33"><a href="sel-and-pred.html#cb98-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-34"><a href="sel-and-pred.html#cb98-34" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">length</span>(feat_sel_props)</span>
<span id="cb98-35"><a href="sel-and-pred.html#cb98-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(cluster_i <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p))</span>
<span id="cb98-36"><a href="sel-and-pred.html#cb98-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-37"><a href="sel-and-pred.html#cb98-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the selection proportions of each cluster member</span></span>
<span id="cb98-38"><a href="sel-and-pred.html#cb98-38" aria-hidden="true" tabindex="-1"></a>    sel_props <span class="ot">&lt;-</span> feat_sel_props[cluster_i]</span>
<span id="cb98-39"><a href="sel-and-pred.html#cb98-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-40"><a href="sel-and-pred.html#cb98-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(sel_props <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb98-41"><a href="sel-and-pred.html#cb98-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(sel_props <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb98-42"><a href="sel-and-pred.html#cb98-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-43"><a href="sel-and-pred.html#cb98-43" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), n_weights)</span>
<span id="cb98-44"><a href="sel-and-pred.html#cb98-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-45"><a href="sel-and-pred.html#cb98-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Weighted or simple average?</span></span>
<span id="cb98-46"><a href="sel-and-pred.html#cb98-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(weighting <span class="sc">==</span> <span class="st">&quot;sparse&quot;</span>){</span>
<span id="cb98-47"><a href="sel-and-pred.html#cb98-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Sparse cluster stability selection: All features in cluster with</span></span>
<span id="cb98-48"><a href="sel-and-pred.html#cb98-48" aria-hidden="true" tabindex="-1"></a>        <span class="co"># selection proportion equal to the max</span></span>
<span id="cb98-49"><a href="sel-and-pred.html#cb98-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for the cluster get equal weight; rest of cluster gets 0 weight</span></span>
<span id="cb98-50"><a href="sel-and-pred.html#cb98-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">sum</span>(sel_props) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb98-51"><a href="sel-and-pred.html#cb98-51" aria-hidden="true" tabindex="-1"></a>            weights_i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>n_weights, n_weights)</span>
<span id="cb98-52"><a href="sel-and-pred.html#cb98-52" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb98-53"><a href="sel-and-pred.html#cb98-53" aria-hidden="true" tabindex="-1"></a>            maxes <span class="ot">&lt;-</span> sel_props<span class="sc">==</span><span class="fu">max</span>(sel_props)</span>
<span id="cb98-54"><a href="sel-and-pred.html#cb98-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-55"><a href="sel-and-pred.html#cb98-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">sum</span>(maxes) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb98-56"><a href="sel-and-pred.html#cb98-56" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">sum</span>(maxes) <span class="sc">&lt;=</span> n_weights)</span>
<span id="cb98-57"><a href="sel-and-pred.html#cb98-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-58"><a href="sel-and-pred.html#cb98-58" aria-hidden="true" tabindex="-1"></a>            weights_i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_weights)</span>
<span id="cb98-59"><a href="sel-and-pred.html#cb98-59" aria-hidden="true" tabindex="-1"></a>            weights_i[maxes] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sum</span>(maxes)</span>
<span id="cb98-60"><a href="sel-and-pred.html#cb98-60" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-61"><a href="sel-and-pred.html#cb98-61" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(weighting <span class="sc">==</span> <span class="st">&quot;weighted_avg&quot;</span>){</span>
<span id="cb98-62"><a href="sel-and-pred.html#cb98-62" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get weights for weighted average</span></span>
<span id="cb98-63"><a href="sel-and-pred.html#cb98-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">sum</span>(sel_props) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb98-64"><a href="sel-and-pred.html#cb98-64" aria-hidden="true" tabindex="-1"></a>            weights_i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>n_weights, n_weights)</span>
<span id="cb98-65"><a href="sel-and-pred.html#cb98-65" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb98-66"><a href="sel-and-pred.html#cb98-66" aria-hidden="true" tabindex="-1"></a>            weights_i <span class="ot">&lt;-</span> sel_props<span class="sc">/</span><span class="fu">sum</span>(sel_props)</span>
<span id="cb98-67"><a href="sel-and-pred.html#cb98-67" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb98-68"><a href="sel-and-pred.html#cb98-68" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(weighting <span class="sc">==</span> <span class="st">&quot;simple_avg&quot;</span>){</span>
<span id="cb98-69"><a href="sel-and-pred.html#cb98-69" aria-hidden="true" tabindex="-1"></a>        weights_i <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>n_weights, n_weights)</span>
<span id="cb98-70"><a href="sel-and-pred.html#cb98-70" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb98-71"><a href="sel-and-pred.html#cb98-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">&quot;weighting must be one of sparse, simple_avg, or weighted_avg&quot;</span>)</span>
<span id="cb98-72"><a href="sel-and-pred.html#cb98-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb98-73"><a href="sel-and-pred.html#cb98-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-74"><a href="sel-and-pred.html#cb98-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">abs</span>(<span class="fu">sum</span>(weights_i) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">6</span>))</span>
<span id="cb98-75"><a href="sel-and-pred.html#cb98-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(weights_i) <span class="sc">==</span> n_weights)</span>
<span id="cb98-76"><a href="sel-and-pred.html#cb98-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(weights_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb98-77"><a href="sel-and-pred.html#cb98-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(weights_i <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb98-78"><a href="sel-and-pred.html#cb98-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(weights_i <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb98-79"><a href="sel-and-pred.html#cb98-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-80"><a href="sel-and-pred.html#cb98-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(weights_i)</span>
<span id="cb98-81"><a href="sel-and-pred.html#cb98-81" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>()</code>:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="sel-and-pred.html#cb99-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getClustWeights works&quot;</span>, {</span>
<span id="cb99-2"><a href="sel-and-pred.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  sel_props <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>)</span>
<span id="cb99-3"><a href="sel-and-pred.html#cb99-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-4"><a href="sel-and-pred.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sparse</span></span>
<span id="cb99-5"><a href="sel-and-pred.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>(<span class="at">cluster_i=</span><span class="fu">c</span>(3L, 4L, 5L),</span>
<span id="cb99-6"><a href="sel-and-pred.html#cb99-6" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb99-7"><a href="sel-and-pred.html#cb99-7" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">feat_sel_props=</span>sel_props),</span>
<span id="cb99-8"><a href="sel-and-pred.html#cb99-8" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb99-9"><a href="sel-and-pred.html#cb99-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-10"><a href="sel-and-pred.html#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weighted_avg</span></span>
<span id="cb99-11"><a href="sel-and-pred.html#cb99-11" aria-hidden="true" tabindex="-1"></a>  cluster<span class="ot">=</span><span class="fu">c</span>(1L, 3L, 5L)</span>
<span id="cb99-12"><a href="sel-and-pred.html#cb99-12" aria-hidden="true" tabindex="-1"></a>  true_weights <span class="ot">&lt;-</span> sel_props[cluster]<span class="sc">/</span><span class="fu">sum</span>(sel_props[cluster])</span>
<span id="cb99-13"><a href="sel-and-pred.html#cb99-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-14"><a href="sel-and-pred.html#cb99-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>(<span class="at">cluster_i=</span>cluster,</span>
<span id="cb99-15"><a href="sel-and-pred.html#cb99-15" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb99-16"><a href="sel-and-pred.html#cb99-16" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">feat_sel_props=</span>sel_props),</span>
<span id="cb99-17"><a href="sel-and-pred.html#cb99-17" aria-hidden="true" tabindex="-1"></a>                             true_weights)</span>
<span id="cb99-18"><a href="sel-and-pred.html#cb99-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-19"><a href="sel-and-pred.html#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simple_avg</span></span>
<span id="cb99-20"><a href="sel-and-pred.html#cb99-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getClustWeights'>getClustWeights</a>(<span class="at">cluster_i=</span><span class="fu">c</span>(2L, 3L, 4L, 5L),</span>
<span id="cb99-21"><a href="sel-and-pred.html#cb99-21" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb99-22"><a href="sel-and-pred.html#cb99-22" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">feat_sel_props=</span>sel_props),</span>
<span id="cb99-23"><a href="sel-and-pred.html#cb99-23" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(<span class="fl">0.25</span>, <span class="dv">4</span>))</span>
<span id="cb99-24"><a href="sel-and-pred.html#cb99-24" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥³</code></pre>
<p>Tests for <code><a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>()</code>:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="sel-and-pred.html#cb101-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getAllClustWeights works&quot;</span>, {</span>
<span id="cb101-2"><a href="sel-and-pred.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-3"><a href="sel-and-pred.html#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">1872</span>)</span>
<span id="cb101-4"><a href="sel-and-pred.html#cb101-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-5"><a href="sel-and-pred.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb101-6"><a href="sel-and-pred.html#cb101-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb101-7"><a href="sel-and-pred.html#cb101-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-8"><a href="sel-and-pred.html#cb101-8" aria-hidden="true" tabindex="-1"></a>  clust_names <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb101-9"><a href="sel-and-pred.html#cb101-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-10"><a href="sel-and-pred.html#cb101-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb101-11"><a href="sel-and-pred.html#cb101-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-12"><a href="sel-and-pred.html#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(good_clusters) <span class="ot">&lt;-</span> clust_names</span>
<span id="cb101-13"><a href="sel-and-pred.html#cb101-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-14"><a href="sel-and-pred.html#cb101-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">fitfun =</span> cssLasso,</span>
<span id="cb101-15"><a href="sel-and-pred.html#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">sampling_type =</span> <span class="st">&quot;SS&quot;</span>, <span class="at">B =</span> <span class="dv">10</span>, <span class="at">prop_feats_remove =</span> <span class="dv">0</span>, <span class="at">train_inds =</span> <span class="fu">integer</span>(),</span>
<span id="cb101-16"><a href="sel-and-pred.html#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_cores =</span> 1L)</span>
<span id="cb101-17"><a href="sel-and-pred.html#cb101-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-18"><a href="sel-and-pred.html#cb101-18" aria-hidden="true" tabindex="-1"></a>  sel_props <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(res<span class="sc">$</span>feat_sel_mat)</span>
<span id="cb101-19"><a href="sel-and-pred.html#cb101-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-20"><a href="sel-and-pred.html#cb101-20" aria-hidden="true" tabindex="-1"></a>  sel_clusts <span class="ot">&lt;-</span> <span class="fu">list</span>(1L<span class="sc">:</span>2L, 3L<span class="sc">:</span>4L)</span>
<span id="cb101-21"><a href="sel-and-pred.html#cb101-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-22"><a href="sel-and-pred.html#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sel_clusts) <span class="ot">&lt;-</span> clust_names[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb101-23"><a href="sel-and-pred.html#cb101-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-24"><a href="sel-and-pred.html#cb101-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sparse</span></span>
<span id="cb101-25"><a href="sel-and-pred.html#cb101-25" aria-hidden="true" tabindex="-1"></a>  true_weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-26"><a href="sel-and-pred.html#cb101-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-27"><a href="sel-and-pred.html#cb101-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb101-28"><a href="sel-and-pred.html#cb101-28" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> sel_props[sel_clusts[[i]]]<span class="sc">/</span><span class="fu">sum</span>(sel_props[sel_clusts[[i]]])</span>
<span id="cb101-29"><a href="sel-and-pred.html#cb101-29" aria-hidden="true" tabindex="-1"></a>    true_weights[[i]] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(weights_i))</span>
<span id="cb101-30"><a href="sel-and-pred.html#cb101-30" aria-hidden="true" tabindex="-1"></a>    true_weights[[i]][weights_i <span class="sc">==</span> <span class="fu">max</span>(weights_i)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-31"><a href="sel-and-pred.html#cb101-31" aria-hidden="true" tabindex="-1"></a>    true_weights[[i]] <span class="ot">&lt;-</span> true_weights[[i]]<span class="sc">/</span><span class="fu">sum</span>(true_weights[[i]])</span>
<span id="cb101-32"><a href="sel-and-pred.html#cb101-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-33"><a href="sel-and-pred.html#cb101-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-34"><a href="sel-and-pred.html#cb101-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(true_weights) <span class="ot">&lt;-</span> clust_names[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb101-35"><a href="sel-and-pred.html#cb101-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-36"><a href="sel-and-pred.html#cb101-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res,</span>
<span id="cb101-37"><a href="sel-and-pred.html#cb101-37" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-38"><a href="sel-and-pred.html#cb101-38" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&quot;sparse&quot;</span>), true_weights)</span>
<span id="cb101-39"><a href="sel-and-pred.html#cb101-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-40"><a href="sel-and-pred.html#cb101-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weighted_avg</span></span>
<span id="cb101-41"><a href="sel-and-pred.html#cb101-41" aria-hidden="true" tabindex="-1"></a>  true_weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-42"><a href="sel-and-pred.html#cb101-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-43"><a href="sel-and-pred.html#cb101-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb101-44"><a href="sel-and-pred.html#cb101-44" aria-hidden="true" tabindex="-1"></a>    true_weights[[i]] <span class="ot">&lt;-</span> sel_props[sel_clusts[[i]]]<span class="sc">/</span><span class="fu">sum</span>(sel_props[<span class="fu">unlist</span>(sel_clusts[[i]])])</span>
<span id="cb101-45"><a href="sel-and-pred.html#cb101-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-46"><a href="sel-and-pred.html#cb101-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-47"><a href="sel-and-pred.html#cb101-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(true_weights) <span class="ot">&lt;-</span> clust_names[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb101-48"><a href="sel-and-pred.html#cb101-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-49"><a href="sel-and-pred.html#cb101-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res,</span>
<span id="cb101-50"><a href="sel-and-pred.html#cb101-50" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-51"><a href="sel-and-pred.html#cb101-51" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&quot;weighted_avg&quot;</span>), true_weights)</span>
<span id="cb101-52"><a href="sel-and-pred.html#cb101-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-53"><a href="sel-and-pred.html#cb101-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simple_avg</span></span>
<span id="cb101-54"><a href="sel-and-pred.html#cb101-54" aria-hidden="true" tabindex="-1"></a>  true_weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-55"><a href="sel-and-pred.html#cb101-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-56"><a href="sel-and-pred.html#cb101-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb101-57"><a href="sel-and-pred.html#cb101-57" aria-hidden="true" tabindex="-1"></a>    n_weights_i <span class="ot">&lt;-</span> <span class="fu">length</span>(sel_clusts[[i]])</span>
<span id="cb101-58"><a href="sel-and-pred.html#cb101-58" aria-hidden="true" tabindex="-1"></a>    true_weights[[i]] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span>n_weights_i, n_weights_i)</span>
<span id="cb101-59"><a href="sel-and-pred.html#cb101-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-60"><a href="sel-and-pred.html#cb101-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-61"><a href="sel-and-pred.html#cb101-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(true_weights) <span class="ot">&lt;-</span> clust_names[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb101-62"><a href="sel-and-pred.html#cb101-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-63"><a href="sel-and-pred.html#cb101-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res,</span>
<span id="cb101-64"><a href="sel-and-pred.html#cb101-64" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-65"><a href="sel-and-pred.html#cb101-65" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">&quot;simple_avg&quot;</span>), true_weights)</span>
<span id="cb101-66"><a href="sel-and-pred.html#cb101-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-67"><a href="sel-and-pred.html#cb101-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Errors</span></span>
<span id="cb101-68"><a href="sel-and-pred.html#cb101-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-69"><a href="sel-and-pred.html#cb101-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># css_results not correct (error has quotation marks)</span></span>
<span id="cb101-70"><a href="sel-and-pred.html#cb101-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb101-71"><a href="sel-and-pred.html#cb101-71" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-72"><a href="sel-and-pred.html#cb101-72" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">&quot;simple_avg&quot;</span>))</span>
<span id="cb101-73"><a href="sel-and-pred.html#cb101-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-74"><a href="sel-and-pred.html#cb101-74" aria-hidden="true" tabindex="-1"></a>  bad_sel_clusts <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb101-75"><a href="sel-and-pred.html#cb101-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bad_sel_clusts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>)</span>
<span id="cb101-76"><a href="sel-and-pred.html#cb101-76" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res, bad_sel_clusts, <span class="st">&quot;sparse&quot;</span>),</span>
<span id="cb101-77"><a href="sel-and-pred.html#cb101-77" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(names(sel_clusters) %in% names(clusters)) is not TRUE&quot;</span>,</span>
<span id="cb101-78"><a href="sel-and-pred.html#cb101-78" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb101-79"><a href="sel-and-pred.html#cb101-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-80"><a href="sel-and-pred.html#cb101-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-81"><a href="sel-and-pred.html#cb101-81" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res, <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb101-82"><a href="sel-and-pred.html#cb101-82" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-83"><a href="sel-and-pred.html#cb101-83" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>)),</span>
<span id="cb101-84"><a href="sel-and-pred.html#cb101-84" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb101-85"><a href="sel-and-pred.html#cb101-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-86"><a href="sel-and-pred.html#cb101-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res, <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb101-87"><a href="sel-and-pred.html#cb101-87" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-88"><a href="sel-and-pred.html#cb101-88" aria-hidden="true" tabindex="-1"></a>                                            <span class="cn">NA</span>),</span>
<span id="cb101-89"><a href="sel-and-pred.html#cb101-89" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.na(weighting) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb101-90"><a href="sel-and-pred.html#cb101-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-91"><a href="sel-and-pred.html#cb101-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res, <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb101-92"><a href="sel-and-pred.html#cb101-92" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-93"><a href="sel-and-pred.html#cb101-93" aria-hidden="true" tabindex="-1"></a>                                            <span class="dv">1</span>),</span>
<span id="cb101-94"><a href="sel-and-pred.html#cb101-94" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb101-95"><a href="sel-and-pred.html#cb101-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-96"><a href="sel-and-pred.html#cb101-96" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getAllClustWeights'>getAllClustWeights</a>(res, <span class="fu">colMeans</span>(res<span class="sc">$</span>clus_sel_mat[,</span>
<span id="cb101-97"><a href="sel-and-pred.html#cb101-97" aria-hidden="true" tabindex="-1"></a>                                                                           <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb101-98"><a href="sel-and-pred.html#cb101-98" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">&quot;spasre&quot;</span>),</span>
<span id="cb101-99"><a href="sel-and-pred.html#cb101-99" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb101-100"><a href="sel-and-pred.html#cb101-100" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb101-101"><a href="sel-and-pred.html#cb101-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-102"><a href="sel-and-pred.html#cb101-102" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p><code><a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>()</code>:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="sel-and-pred.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to check that output of getSelectedClusters is as expected</span></span>
<span id="cb103-2"><a href="sel-and-pred.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb103-3"><a href="sel-and-pred.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected_clusts A named numeric vector containing the selection</span></span>
<span id="cb103-4"><a href="sel-and-pred.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportions for the selected clusters. The name of each entry is the name of</span></span>
<span id="cb103-5"><a href="sel-and-pred.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the corresponding cluster.</span></span>
<span id="cb103-6"><a href="sel-and-pred.html#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param selected_feats A named integer vector; the indices of the features</span></span>
<span id="cb103-7"><a href="sel-and-pred.html#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; with nonzero weights from all of the selected clusters.</span></span>
<span id="cb103-8"><a href="sel-and-pred.html#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weights A named list of the same length as the number of selected</span></span>
<span id="cb103-9"><a href="sel-and-pred.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters. Each list element weights[[j]] is a numeric vector of the weights</span></span>
<span id="cb103-10"><a href="sel-and-pred.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to use for the jth selected cluster, and it has the same name as the cluster</span></span>
<span id="cb103-11"><a href="sel-and-pred.html#cb103-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; it corresponds to.</span></span>
<span id="cb103-12"><a href="sel-and-pred.html#cb103-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param n_clusters Integer; the number of clusters in the data (upper bound</span></span>
<span id="cb103-13"><a href="sel-and-pred.html#cb103-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; for the length of selected_clusts)</span></span>
<span id="cb103-14"><a href="sel-and-pred.html#cb103-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param p Integer; number of features in the data (all selected_feats should</span></span>
<span id="cb103-15"><a href="sel-and-pred.html#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be in 1:p)</span></span>
<span id="cb103-16"><a href="sel-and-pred.html#cb103-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb103-17"><a href="sel-and-pred.html#cb103-17" aria-hidden="true" tabindex="-1"></a><span id='checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(selected_clusts, selected_feats,</span>
<span id="cb103-18"><a href="sel-and-pred.html#cb103-18" aria-hidden="true" tabindex="-1"></a>    weights, n_clusters, p){</span>
<span id="cb103-19"><a href="sel-and-pred.html#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(selected_clusts))</span>
<span id="cb103-20"><a href="sel-and-pred.html#cb103-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(selected_clusts <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb103-21"><a href="sel-and-pred.html#cb103-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(selected_clusts <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb103-22"><a href="sel-and-pred.html#cb103-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb103-23"><a href="sel-and-pred.html#cb103-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&lt;=</span> n_clusters)</span>
<span id="cb103-24"><a href="sel-and-pred.html#cb103-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">names</span>(selected_clusts)) <span class="sc">==</span></span>
<span id="cb103-25"><a href="sel-and-pred.html#cb103-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(selected_clusts))))</span>
<span id="cb103-26"><a href="sel-and-pred.html#cb103-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">names</span>(selected_clusts)))</span>
<span id="cb103-27"><a href="sel-and-pred.html#cb103-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">names</span>(selected_clusts)) <span class="sc">&amp;</span></span>
<span id="cb103-28"><a href="sel-and-pred.html#cb103-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(selected_clusts) <span class="sc">!=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb103-29"><a href="sel-and-pred.html#cb103-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(<span class="fu">names</span>(selected_clusts)) <span class="sc">==</span> <span class="fu">length</span>(selected_clusts))</span>
<span id="cb103-30"><a href="sel-and-pred.html#cb103-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(selected_feats))</span>
<span id="cb103-31"><a href="sel-and-pred.html#cb103-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_feats) <span class="sc">==</span> <span class="fu">length</span>(<span class="fu">unique</span>(selected_feats)))</span>
<span id="cb103-32"><a href="sel-and-pred.html#cb103-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(selected_feats <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p))</span>
<span id="cb103-33"><a href="sel-and-pred.html#cb103-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(selected_clusts) <span class="sc">&lt;=</span> <span class="fu">length</span>(selected_feats))</span>
<span id="cb103-34"><a href="sel-and-pred.html#cb103-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">names</span>(weights), <span class="fu">names</span>(selected_clusts)))</span>
<span id="cb103-35"><a href="sel-and-pred.html#cb103-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(weights) <span class="sc">==</span> <span class="fu">length</span>(selected_clusts)) </span>
<span id="cb103-36"><a href="sel-and-pred.html#cb103-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>()</code>:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="sel-and-pred.html#cb104-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGetSelectedClustersOutput works&quot;</span>, {</span>
<span id="cb104-2"><a href="sel-and-pred.html#cb104-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-3"><a href="sel-and-pred.html#cb104-3" aria-hidden="true" tabindex="-1"></a>  sel_clusts <span class="ot">&lt;-</span> <span class="fl">0.1</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)</span>
<span id="cb104-4"><a href="sel-and-pred.html#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sel_clusts) <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb104-5"><a href="sel-and-pred.html#cb104-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-6"><a href="sel-and-pred.html#cb104-6" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb104-7"><a href="sel-and-pred.html#cb104-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-8"><a href="sel-and-pred.html#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>){</span>
<span id="cb104-9"><a href="sel-and-pred.html#cb104-9" aria-hidden="true" tabindex="-1"></a>    weights[[i]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.3</span>)</span>
<span id="cb104-10"><a href="sel-and-pred.html#cb104-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb104-11"><a href="sel-and-pred.html#cb104-11" aria-hidden="true" tabindex="-1"></a>  weights[[<span class="dv">9</span>]] <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb104-12"><a href="sel-and-pred.html#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(weights) <span class="ot">&lt;-</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb104-13"><a href="sel-and-pred.html#cb104-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-14"><a href="sel-and-pred.html#cb104-14" aria-hidden="true" tabindex="-1"></a>  sel_feats <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">26</span></span>
<span id="cb104-15"><a href="sel-and-pred.html#cb104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sel_feats) <span class="ot">&lt;-</span> LETTERS[<span class="dv">10</span><span class="sc">:</span><span class="dv">26</span>]</span>
<span id="cb104-16"><a href="sel-and-pred.html#cb104-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-17"><a href="sel-and-pred.html#cb104-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-18"><a href="sel-and-pred.html#cb104-18" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-19"><a href="sel-and-pred.html#cb104-19" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-20"><a href="sel-and-pred.html#cb104-20" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>))</span>
<span id="cb104-21"><a href="sel-and-pred.html#cb104-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-22"><a href="sel-and-pred.html#cb104-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb104-23"><a href="sel-and-pred.html#cb104-23" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-24"><a href="sel-and-pred.html#cb104-24" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-25"><a href="sel-and-pred.html#cb104-25" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-26"><a href="sel-and-pred.html#cb104-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(selected_clusts) is not TRUE&quot;</span>,</span>
<span id="cb104-27"><a href="sel-and-pred.html#cb104-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-28"><a href="sel-and-pred.html#cb104-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-29"><a href="sel-and-pred.html#cb104-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span><span class="sc">-</span>sel_clusts,</span>
<span id="cb104-30"><a href="sel-and-pred.html#cb104-30" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-31"><a href="sel-and-pred.html#cb104-31" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-32"><a href="sel-and-pred.html#cb104-32" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-33"><a href="sel-and-pred.html#cb104-33" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(selected_clusts &gt;= 0) is not TRUE&quot;</span>,</span>
<span id="cb104-34"><a href="sel-and-pred.html#cb104-34" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-35"><a href="sel-and-pred.html#cb104-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-36"><a href="sel-and-pred.html#cb104-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span><span class="dv">10</span><span class="sc">*</span>sel_clusts,</span>
<span id="cb104-37"><a href="sel-and-pred.html#cb104-37" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-38"><a href="sel-and-pred.html#cb104-38" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-39"><a href="sel-and-pred.html#cb104-39" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-40"><a href="sel-and-pred.html#cb104-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(selected_clusts &lt;= 1) is not TRUE&quot;</span>,</span>
<span id="cb104-41"><a href="sel-and-pred.html#cb104-41" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-42"><a href="sel-and-pred.html#cb104-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-43"><a href="sel-and-pred.html#cb104-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span><span class="fu">numeric</span>(),</span>
<span id="cb104-44"><a href="sel-and-pred.html#cb104-44" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-45"><a href="sel-and-pred.html#cb104-45" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-46"><a href="sel-and-pred.html#cb104-46" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-47"><a href="sel-and-pred.html#cb104-47" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(selected_clusts) &gt;= 1 is not TRUE&quot;</span>,</span>
<span id="cb104-48"><a href="sel-and-pred.html#cb104-48" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-49"><a href="sel-and-pred.html#cb104-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-50"><a href="sel-and-pred.html#cb104-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-51"><a href="sel-and-pred.html#cb104-51" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-52"><a href="sel-and-pred.html#cb104-52" aria-hidden="true" tabindex="-1"></a>                               <span class="at">weights=</span>weights,</span>
<span id="cb104-53"><a href="sel-and-pred.html#cb104-53" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">8</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-54"><a href="sel-and-pred.html#cb104-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(selected_clusts) &lt;= n_clusters is not TRUE&quot;</span>,</span>
<span id="cb104-55"><a href="sel-and-pred.html#cb104-55" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-56"><a href="sel-and-pred.html#cb104-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-57"><a href="sel-and-pred.html#cb104-57" aria-hidden="true" tabindex="-1"></a>  bad_clusts <span class="ot">&lt;-</span> sel_clusts</span>
<span id="cb104-58"><a href="sel-and-pred.html#cb104-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bad_clusts) <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;a&quot;</span>, <span class="fu">length</span>(bad_clusts))</span>
<span id="cb104-59"><a href="sel-and-pred.html#cb104-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-60"><a href="sel-and-pred.html#cb104-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>bad_clusts,</span>
<span id="cb104-61"><a href="sel-and-pred.html#cb104-61" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-62"><a href="sel-and-pred.html#cb104-62" aria-hidden="true" tabindex="-1"></a>                               <span class="at">weights=</span>weights,</span>
<span id="cb104-63"><a href="sel-and-pred.html#cb104-63" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-64"><a href="sel-and-pred.html#cb104-64" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(names(selected_clusts)) == length(unique(names(selected_clusts))) is not TRUE&quot;</span>,</span>
<span id="cb104-65"><a href="sel-and-pred.html#cb104-65" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-66"><a href="sel-and-pred.html#cb104-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-67"><a href="sel-and-pred.html#cb104-67" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span><span class="fu">unname</span>(sel_clusts),</span>
<span id="cb104-68"><a href="sel-and-pred.html#cb104-68" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span>sel_feats,</span>
<span id="cb104-69"><a href="sel-and-pred.html#cb104-69" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-70"><a href="sel-and-pred.html#cb104-70" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-71"><a href="sel-and-pred.html#cb104-71" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;!is.null(names(selected_clusts)) is not TRUE&quot;</span>,</span>
<span id="cb104-72"><a href="sel-and-pred.html#cb104-72" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-73"><a href="sel-and-pred.html#cb104-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-74"><a href="sel-and-pred.html#cb104-74" aria-hidden="true" tabindex="-1"></a>  bad_clusts <span class="ot">&lt;-</span> sel_clusts</span>
<span id="cb104-75"><a href="sel-and-pred.html#cb104-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bad_clusts)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb104-76"><a href="sel-and-pred.html#cb104-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-77"><a href="sel-and-pred.html#cb104-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>bad_clusts,</span>
<span id="cb104-78"><a href="sel-and-pred.html#cb104-78" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats, <span class="at">weights=</span>weights,</span>
<span id="cb104-79"><a href="sel-and-pred.html#cb104-79" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-80"><a href="sel-and-pred.html#cb104-80" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(names(selected_clusts)) &amp; names(selected_clusts) !=  .... is not TRUE&quot;</span>,</span>
<span id="cb104-81"><a href="sel-and-pred.html#cb104-81" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-82"><a href="sel-and-pred.html#cb104-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-83"><a href="sel-and-pred.html#cb104-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bad_clusts)[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb104-84"><a href="sel-and-pred.html#cb104-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-85"><a href="sel-and-pred.html#cb104-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>bad_clusts,</span>
<span id="cb104-86"><a href="sel-and-pred.html#cb104-86" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats, <span class="at">weights=</span>weights,</span>
<span id="cb104-87"><a href="sel-and-pred.html#cb104-87" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-88"><a href="sel-and-pred.html#cb104-88" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(!is.na(names(selected_clusts)) &amp; names(selected_clusts) !=  .... is not TRUE&quot;</span>,</span>
<span id="cb104-89"><a href="sel-and-pred.html#cb104-89" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-90"><a href="sel-and-pred.html#cb104-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-91"><a href="sel-and-pred.html#cb104-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-92"><a href="sel-and-pred.html#cb104-92" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span><span class="fl">0.1</span>,</span>
<span id="cb104-93"><a href="sel-and-pred.html#cb104-93" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-94"><a href="sel-and-pred.html#cb104-94" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-95"><a href="sel-and-pred.html#cb104-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.integer(selected_feats) is not TRUE&quot;</span>,</span>
<span id="cb104-96"><a href="sel-and-pred.html#cb104-96" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-97"><a href="sel-and-pred.html#cb104-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-98"><a href="sel-and-pred.html#cb104-98" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-99"><a href="sel-and-pred.html#cb104-99" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">selected_feats=</span><span class="fu">c</span>(1L,</span>
<span id="cb104-100"><a href="sel-and-pred.html#cb104-100" aria-hidden="true" tabindex="-1"></a>                                                                        <span class="fu">rep</span>(2L,</span>
<span id="cb104-101"><a href="sel-and-pred.html#cb104-101" aria-hidden="true" tabindex="-1"></a>                                                                            <span class="dv">2</span>)),</span>
<span id="cb104-102"><a href="sel-and-pred.html#cb104-102" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">weights=</span>weights,</span>
<span id="cb104-103"><a href="sel-and-pred.html#cb104-103" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">30</span>),</span>
<span id="cb104-104"><a href="sel-and-pred.html#cb104-104" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(selected_feats) == length(unique(selected_feats)) is not TRUE&quot;</span>,</span>
<span id="cb104-105"><a href="sel-and-pred.html#cb104-105" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-106"><a href="sel-and-pred.html#cb104-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-107"><a href="sel-and-pred.html#cb104-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-108"><a href="sel-and-pred.html#cb104-108" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats, <span class="at">weights=</span>weights,</span>
<span id="cb104-109"><a href="sel-and-pred.html#cb104-109" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">25</span>),</span>
<span id="cb104-110"><a href="sel-and-pred.html#cb104-110" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;all(selected_feats %in% 1:p) is not TRUE&quot;</span>,</span>
<span id="cb104-111"><a href="sel-and-pred.html#cb104-111" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-112"><a href="sel-and-pred.html#cb104-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-113"><a href="sel-and-pred.html#cb104-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetSelectedClustersOutput'>checkGetSelectedClustersOutput</a>(<span class="at">selected_clusts=</span>sel_clusts,</span>
<span id="cb104-114"><a href="sel-and-pred.html#cb104-114" aria-hidden="true" tabindex="-1"></a>                               <span class="at">selected_feats=</span>sel_feats[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="at">weights=</span>weights,</span>
<span id="cb104-115"><a href="sel-and-pred.html#cb104-115" aria-hidden="true" tabindex="-1"></a>                               <span class="at">n_clusters=</span><span class="dv">10</span>, <span class="at">p=</span><span class="dv">25</span>),</span>
<span id="cb104-116"><a href="sel-and-pred.html#cb104-116" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(selected_clusts) &lt;= length(selected_feats) is not TRUE&quot;</span>,</span>
<span id="cb104-117"><a href="sel-and-pred.html#cb104-117" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb104-118"><a href="sel-and-pred.html#cb104-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb104-119"><a href="sel-and-pred.html#cb104-119" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p>Tests for <code><a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>()</code></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="sel-and-pred.html#cb106-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getSelectedClusters works&quot;</span>, {</span>
<span id="cb106-2"><a href="sel-and-pred.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">26717</span>)</span>
<span id="cb106-3"><a href="sel-and-pred.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-4"><a href="sel-and-pred.html#cb106-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb106-5"><a href="sel-and-pred.html#cb106-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb106-6"><a href="sel-and-pred.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-7"><a href="sel-and-pred.html#cb106-7" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;apple&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;banana&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;cantaloupe&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb106-8"><a href="sel-and-pred.html#cb106-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-9"><a href="sel-and-pred.html#cb106-9" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb106-10"><a href="sel-and-pred.html#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="sel-and-pred.html#cb106-11" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>,</span>
<span id="cb106-12"><a href="sel-and-pred.html#cb106-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-13"><a href="sel-and-pred.html#cb106-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-14"><a href="sel-and-pred.html#cb106-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb106-15"><a href="sel-and-pred.html#cb106-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb106-16"><a href="sel-and-pred.html#cb106-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;selected_clusts&quot;</span>, <span class="st">&quot;selected_feats&quot;</span>,</span>
<span id="cb106-17"><a href="sel-and-pred.html#cb106-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;weights&quot;</span>))</span>
<span id="cb106-18"><a href="sel-and-pred.html#cb106-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span></span>
<span id="cb106-19"><a href="sel-and-pred.html#cb106-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb106-20"><a href="sel-and-pred.html#cb106-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-21"><a href="sel-and-pred.html#cb106-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb106-22"><a href="sel-and-pred.html#cb106-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb106-23"><a href="sel-and-pred.html#cb106-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb106-24"><a href="sel-and-pred.html#cb106-24" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb106-25"><a href="sel-and-pred.html#cb106-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb106-26"><a href="sel-and-pred.html#cb106-26" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts))))</span>
<span id="cb106-27"><a href="sel-and-pred.html#cb106-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_clusts <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb106-28"><a href="sel-and-pred.html#cb106-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_clusts <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb106-29"><a href="sel-and-pred.html#cb106-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-30"><a href="sel-and-pred.html#cb106-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb106-31"><a href="sel-and-pred.html#cb106-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb106-32"><a href="sel-and-pred.html#cb106-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb106-33"><a href="sel-and-pred.html#cb106-33" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats))))</span>
<span id="cb106-34"><a href="sel-and-pred.html#cb106-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb106-35"><a href="sel-and-pred.html#cb106-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&lt;=</span> <span class="dv">5</span>))</span>
<span id="cb106-36"><a href="sel-and-pred.html#cb106-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats),</span>
<span id="cb106-37"><a href="sel-and-pred.html#cb106-37" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">length</span>(<span class="fu">unique</span>(res<span class="sc">$</span>selected_feats)))</span>
<span id="cb106-38"><a href="sel-and-pred.html#cb106-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-39"><a href="sel-and-pred.html#cb106-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts), <span class="fu">length</span>(res<span class="sc">$</span>weights))</span>
<span id="cb106-40"><a href="sel-and-pred.html#cb106-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>weights)){</span>
<span id="cb106-41"><a href="sel-and-pred.html#cb106-41" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> res<span class="sc">$</span>weights[[i]]</span>
<span id="cb106-42"><a href="sel-and-pred.html#cb106-42" aria-hidden="true" tabindex="-1"></a>    num_nonzero_weights <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights_i <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb106-43"><a href="sel-and-pred.html#cb106-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For &quot;sparse&quot; weighting, either there should only be one nonzero weight and</span></span>
<span id="cb106-44"><a href="sel-and-pred.html#cb106-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># it should equal 1 (if there were no ties in selection proportions among</span></span>
<span id="cb106-45"><a href="sel-and-pred.html#cb106-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster members) or the nonzero weights should all be</span></span>
<span id="cb106-46"><a href="sel-and-pred.html#cb106-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1/num_nonzero_weights</span></span>
<span id="cb106-47"><a href="sel-and-pred.html#cb106-47" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(weights_i[weights_i <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="sc">==</span> <span class="dv">1</span><span class="sc">/</span>num_nonzero_weights))</span>
<span id="cb106-48"><a href="sel-and-pred.html#cb106-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-49"><a href="sel-and-pred.html#cb106-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-50"><a href="sel-and-pred.html#cb106-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weighted_avg</span></span>
<span id="cb106-51"><a href="sel-and-pred.html#cb106-51" aria-hidden="true" tabindex="-1"></a>  res_weighted <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb106-52"><a href="sel-and-pred.html#cb106-52" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb106-53"><a href="sel-and-pred.html#cb106-53" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-54"><a href="sel-and-pred.html#cb106-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-55"><a href="sel-and-pred.html#cb106-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_weighted<span class="sc">$</span>selected_clusts),</span>
<span id="cb106-56"><a href="sel-and-pred.html#cb106-56" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res_weighted<span class="sc">$</span>weights))</span>
<span id="cb106-57"><a href="sel-and-pred.html#cb106-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_weighted<span class="sc">$</span>weights)){</span>
<span id="cb106-58"><a href="sel-and-pred.html#cb106-58" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> res_weighted<span class="sc">$</span>weights[[i]]</span>
<span id="cb106-59"><a href="sel-and-pred.html#cb106-59" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(weights_i <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb106-60"><a href="sel-and-pred.html#cb106-60" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(weights_i <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb106-61"><a href="sel-and-pred.html#cb106-61" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-62"><a href="sel-and-pred.html#cb106-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-63"><a href="sel-and-pred.html#cb106-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simple_avg</span></span>
<span id="cb106-64"><a href="sel-and-pred.html#cb106-64" aria-hidden="true" tabindex="-1"></a>  res_simple <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb106-65"><a href="sel-and-pred.html#cb106-65" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb106-66"><a href="sel-and-pred.html#cb106-66" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-67"><a href="sel-and-pred.html#cb106-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-68"><a href="sel-and-pred.html#cb106-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_simple<span class="sc">$</span>selected_clusts),</span>
<span id="cb106-69"><a href="sel-and-pred.html#cb106-69" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res_simple<span class="sc">$</span>weights))</span>
<span id="cb106-70"><a href="sel-and-pred.html#cb106-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res_simple<span class="sc">$</span>weights)){</span>
<span id="cb106-71"><a href="sel-and-pred.html#cb106-71" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> res_simple<span class="sc">$</span>weights[[i]]</span>
<span id="cb106-72"><a href="sel-and-pred.html#cb106-72" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">unique</span>(weights_i)), <span class="dv">1</span>)</span>
<span id="cb106-73"><a href="sel-and-pred.html#cb106-73" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(weights_i), <span class="fu">sum</span>(weights_i <span class="sc">&gt;</span> <span class="dv">0</span>))</span>
<span id="cb106-74"><a href="sel-and-pred.html#cb106-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-75"><a href="sel-and-pred.html#cb106-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-76"><a href="sel-and-pred.html#cb106-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test min_num_clusts</span></span>
<span id="cb106-77"><a href="sel-and-pred.html#cb106-77" aria-hidden="true" tabindex="-1"></a>  res2 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">1</span>,</span>
<span id="cb106-78"><a href="sel-and-pred.html#cb106-78" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-79"><a href="sel-and-pred.html#cb106-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res2))</span>
<span id="cb106-80"><a href="sel-and-pred.html#cb106-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res2<span class="sc">$</span>selected_clusts), <span class="dv">3</span>)</span>
<span id="cb106-81"><a href="sel-and-pred.html#cb106-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-82"><a href="sel-and-pred.html#cb106-82" aria-hidden="true" tabindex="-1"></a>  res3 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="dv">1</span>,</span>
<span id="cb106-83"><a href="sel-and-pred.html#cb106-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-84"><a href="sel-and-pred.html#cb106-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res3<span class="sc">$</span>selected_clusts) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb106-85"><a href="sel-and-pred.html#cb106-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-86"><a href="sel-and-pred.html#cb106-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test max_num_clusts</span></span>
<span id="cb106-87"><a href="sel-and-pred.html#cb106-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure there is at least one relevant feature</span></span>
<span id="cb106-88"><a href="sel-and-pred.html#cb106-88" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> x</span>
<span id="cb106-89"><a href="sel-and-pred.html#cb106-89" aria-hidden="true" tabindex="-1"></a>  x2[, <span class="dv">5</span>] <span class="ot">&lt;-</span> y</span>
<span id="cb106-90"><a href="sel-and-pred.html#cb106-90" aria-hidden="true" tabindex="-1"></a>  css_res2 <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x2, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb106-91"><a href="sel-and-pred.html#cb106-91" aria-hidden="true" tabindex="-1"></a>  res4 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res2, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb106-92"><a href="sel-and-pred.html#cb106-92" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">1</span>)</span>
<span id="cb106-93"><a href="sel-and-pred.html#cb106-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res4))</span>
<span id="cb106-94"><a href="sel-and-pred.html#cb106-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res4<span class="sc">$</span>selected_clusts), <span class="dv">1</span>)</span>
<span id="cb106-95"><a href="sel-and-pred.html#cb106-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-96"><a href="sel-and-pred.html#cb106-96" aria-hidden="true" tabindex="-1"></a>  res5 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb106-97"><a href="sel-and-pred.html#cb106-97" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">2</span>)</span>
<span id="cb106-98"><a href="sel-and-pred.html#cb106-98" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res5<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span> <span class="dv">2</span>)</span>
<span id="cb106-99"><a href="sel-and-pred.html#cb106-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-100"><a href="sel-and-pred.html#cb106-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name features</span></span>
<span id="cb106-101"><a href="sel-and-pred.html#cb106-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(x)]</span>
<span id="cb106-102"><a href="sel-and-pred.html#cb106-102" aria-hidden="true" tabindex="-1"></a>  css_res3 <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb106-103"><a href="sel-and-pred.html#cb106-103" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_res3, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>,</span>
<span id="cb106-104"><a href="sel-and-pred.html#cb106-104" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb106-105"><a href="sel-and-pred.html#cb106-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-106"><a href="sel-and-pred.html#cb106-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb106-107"><a href="sel-and-pred.html#cb106-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb106-108"><a href="sel-and-pred.html#cb106-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;selected_clusts&quot;</span>, <span class="st">&quot;selected_feats&quot;</span>,</span>
<span id="cb106-109"><a href="sel-and-pred.html#cb106-109" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;weights&quot;</span>))</span>
<span id="cb106-110"><a href="sel-and-pred.html#cb106-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span></span>
<span id="cb106-111"><a href="sel-and-pred.html#cb106-111" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb106-112"><a href="sel-and-pred.html#cb106-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-113"><a href="sel-and-pred.html#cb106-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb106-114"><a href="sel-and-pred.html#cb106-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb106-115"><a href="sel-and-pred.html#cb106-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb106-116"><a href="sel-and-pred.html#cb106-116" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb106-117"><a href="sel-and-pred.html#cb106-117" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb106-118"><a href="sel-and-pred.html#cb106-118" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts))))</span>
<span id="cb106-119"><a href="sel-and-pred.html#cb106-119" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_clusts <span class="sc">&gt;=</span> <span class="dv">0</span>))</span>
<span id="cb106-120"><a href="sel-and-pred.html#cb106-120" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_clusts <span class="sc">&lt;=</span> <span class="dv">1</span>))</span>
<span id="cb106-121"><a href="sel-and-pred.html#cb106-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-122"><a href="sel-and-pred.html#cb106-122" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb106-123"><a href="sel-and-pred.html#cb106-123" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb106-124"><a href="sel-and-pred.html#cb106-124" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb106-125"><a href="sel-and-pred.html#cb106-125" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats))))</span>
<span id="cb106-126"><a href="sel-and-pred.html#cb106-126" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb106-127"><a href="sel-and-pred.html#cb106-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&lt;=</span> <span class="dv">5</span>))</span>
<span id="cb106-128"><a href="sel-and-pred.html#cb106-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats),</span>
<span id="cb106-129"><a href="sel-and-pred.html#cb106-129" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">length</span>(<span class="fu">unique</span>(res<span class="sc">$</span>selected_feats)))</span>
<span id="cb106-130"><a href="sel-and-pred.html#cb106-130" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb106-131"><a href="sel-and-pred.html#cb106-131" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb106-132"><a href="sel-and-pred.html#cb106-132" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb106-133"><a href="sel-and-pred.html#cb106-133" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats))))</span>
<span id="cb106-134"><a href="sel-and-pred.html#cb106-134" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸŽŠ</code></pre>
<p>Finally, tests for <code><a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>()</code></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="sel-and-pred.html#cb108-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getCssSelections works&quot;</span>, {</span>
<span id="cb108-2"><a href="sel-and-pred.html#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="sel-and-pred.html#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">26717</span>)</span>
<span id="cb108-4"><a href="sel-and-pred.html#cb108-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-5"><a href="sel-and-pred.html#cb108-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">7</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">7</span>)</span>
<span id="cb108-6"><a href="sel-and-pred.html#cb108-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb108-7"><a href="sel-and-pred.html#cb108-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-8"><a href="sel-and-pred.html#cb108-8" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;apple&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;banana&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;cantaloupe&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb108-9"><a href="sel-and-pred.html#cb108-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-10"><a href="sel-and-pred.html#cb108-10" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb108-11"><a href="sel-and-pred.html#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="sel-and-pred.html#cb108-12" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res)</span>
<span id="cb108-13"><a href="sel-and-pred.html#cb108-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-14"><a href="sel-and-pred.html#cb108-14" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb108-15"><a href="sel-and-pred.html#cb108-15" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb108-16"><a href="sel-and-pred.html#cb108-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;selected_clusts&quot;</span>, <span class="st">&quot;selected_feats&quot;</span>,</span>
<span id="cb108-17"><a href="sel-and-pred.html#cb108-17" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;weights&quot;</span>))</span>
<span id="cb108-18"><a href="sel-and-pred.html#cb108-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span></span>
<span id="cb108-19"><a href="sel-and-pred.html#cb108-19" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb108-20"><a href="sel-and-pred.html#cb108-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-21"><a href="sel-and-pred.html#cb108-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb108-22"><a href="sel-and-pred.html#cb108-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb108-23"><a href="sel-and-pred.html#cb108-23" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(res<span class="sc">$</span>selected_clusts))</span>
<span id="cb108-24"><a href="sel-and-pred.html#cb108-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts)),</span>
<span id="cb108-25"><a href="sel-and-pred.html#cb108-25" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_clusts))))</span>
<span id="cb108-26"><a href="sel-and-pred.html#cb108-26" aria-hidden="true" tabindex="-1"></a>  already_used_feats <span class="ot">&lt;-</span> <span class="fu">integer</span>()</span>
<span id="cb108-27"><a href="sel-and-pred.html#cb108-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>selected_clusts)){</span>
<span id="cb108-28"><a href="sel-and-pred.html#cb108-28" aria-hidden="true" tabindex="-1"></a>    sels_i <span class="ot">&lt;-</span> res<span class="sc">$</span>selected_clusts[[i]]</span>
<span id="cb108-29"><a href="sel-and-pred.html#cb108-29" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(sels_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb108-30"><a href="sel-and-pred.html#cb108-30" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(sels_i))</span>
<span id="cb108-31"><a href="sel-and-pred.html#cb108-31" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(sels_i <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>))</span>
<span id="cb108-32"><a href="sel-and-pred.html#cb108-32" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(sels_i), <span class="fu">length</span>(<span class="fu">unique</span>(sels_i)))</span>
<span id="cb108-33"><a href="sel-and-pred.html#cb108-33" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">intersect</span>(already_used_feats, sels_i)), <span class="dv">0</span>)</span>
<span id="cb108-34"><a href="sel-and-pred.html#cb108-34" aria-hidden="true" tabindex="-1"></a>    already_used_feats <span class="ot">&lt;-</span> <span class="fu">c</span>(already_used_feats, sels_i)</span>
<span id="cb108-35"><a href="sel-and-pred.html#cb108-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-36"><a href="sel-and-pred.html#cb108-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(already_used_feats) <span class="sc">&lt;=</span> <span class="dv">11</span>)</span>
<span id="cb108-37"><a href="sel-and-pred.html#cb108-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(already_used_feats),</span>
<span id="cb108-38"><a href="sel-and-pred.html#cb108-38" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(already_used_feats)))</span>
<span id="cb108-39"><a href="sel-and-pred.html#cb108-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(already_used_feats <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>))</span>
<span id="cb108-40"><a href="sel-and-pred.html#cb108-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-41"><a href="sel-and-pred.html#cb108-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.integer</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb108-42"><a href="sel-and-pred.html#cb108-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb108-43"><a href="sel-and-pred.html#cb108-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb108-44"><a href="sel-and-pred.html#cb108-44" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats))))</span>
<span id="cb108-45"><a href="sel-and-pred.html#cb108-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&gt;=</span> <span class="dv">1</span>))</span>
<span id="cb108-46"><a href="sel-and-pred.html#cb108-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(res<span class="sc">$</span>selected_feats <span class="sc">&lt;=</span> <span class="dv">7</span>))</span>
<span id="cb108-47"><a href="sel-and-pred.html#cb108-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_feats),</span>
<span id="cb108-48"><a href="sel-and-pred.html#cb108-48" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">length</span>(<span class="fu">unique</span>(res<span class="sc">$</span>selected_feats)))</span>
<span id="cb108-49"><a href="sel-and-pred.html#cb108-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-50"><a href="sel-and-pred.html#cb108-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts), <span class="fu">length</span>(res<span class="sc">$</span>weights))</span>
<span id="cb108-51"><a href="sel-and-pred.html#cb108-51" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res<span class="sc">$</span>weights)){</span>
<span id="cb108-52"><a href="sel-and-pred.html#cb108-52" aria-hidden="true" tabindex="-1"></a>    weights_i <span class="ot">&lt;-</span> res<span class="sc">$</span>weights[[i]]</span>
<span id="cb108-53"><a href="sel-and-pred.html#cb108-53" aria-hidden="true" tabindex="-1"></a>    num_nonzero_weights <span class="ot">&lt;-</span> <span class="fu">sum</span>(weights_i <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb108-54"><a href="sel-and-pred.html#cb108-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For &quot;sparse&quot; weighting, either there should only be one nonzero weight and</span></span>
<span id="cb108-55"><a href="sel-and-pred.html#cb108-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># it should equal 1 (if there were no ties in selection proportions among</span></span>
<span id="cb108-56"><a href="sel-and-pred.html#cb108-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cluster members) or the nonzero weights should all be</span></span>
<span id="cb108-57"><a href="sel-and-pred.html#cb108-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1/num_nonzero_weights</span></span>
<span id="cb108-58"><a href="sel-and-pred.html#cb108-58" aria-hidden="true" tabindex="-1"></a>    testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(weights_i[weights_i <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="sc">==</span> <span class="dv">1</span><span class="sc">/</span>num_nonzero_weights))</span>
<span id="cb108-59"><a href="sel-and-pred.html#cb108-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb108-60"><a href="sel-and-pred.html#cb108-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-61"><a href="sel-and-pred.html#cb108-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test min_num_clusts (should be 5 clusters--3 named ones, plus last two get</span></span>
<span id="cb108-62"><a href="sel-and-pred.html#cb108-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put in their own unnamed clusters automatically by css)</span></span>
<span id="cb108-63"><a href="sel-and-pred.html#cb108-63" aria-hidden="true" tabindex="-1"></a>  res2 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">1</span>,</span>
<span id="cb108-64"><a href="sel-and-pred.html#cb108-64" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">5</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb108-65"><a href="sel-and-pred.html#cb108-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res2))</span>
<span id="cb108-66"><a href="sel-and-pred.html#cb108-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res2<span class="sc">$</span>selected_clusts), <span class="dv">5</span>)</span>
<span id="cb108-67"><a href="sel-and-pred.html#cb108-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-68"><a href="sel-and-pred.html#cb108-68" aria-hidden="true" tabindex="-1"></a>  res3 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="dv">1</span>,</span>
<span id="cb108-69"><a href="sel-and-pred.html#cb108-69" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb108-70"><a href="sel-and-pred.html#cb108-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res3<span class="sc">$</span>selected_clusts) <span class="sc">&gt;=</span> <span class="dv">3</span>)</span>
<span id="cb108-71"><a href="sel-and-pred.html#cb108-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-72"><a href="sel-and-pred.html#cb108-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test max_num_clusts</span></span>
<span id="cb108-73"><a href="sel-and-pred.html#cb108-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure there is at least one relevant feature</span></span>
<span id="cb108-74"><a href="sel-and-pred.html#cb108-74" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> x</span>
<span id="cb108-75"><a href="sel-and-pred.html#cb108-75" aria-hidden="true" tabindex="-1"></a>  x2[, <span class="dv">5</span>] <span class="ot">&lt;-</span> y</span>
<span id="cb108-76"><a href="sel-and-pred.html#cb108-76" aria-hidden="true" tabindex="-1"></a>  css_res2 <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x2, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb108-77"><a href="sel-and-pred.html#cb108-77" aria-hidden="true" tabindex="-1"></a>  res4 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res2, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb108-78"><a href="sel-and-pred.html#cb108-78" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">1</span>)</span>
<span id="cb108-79"><a href="sel-and-pred.html#cb108-79" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res4))</span>
<span id="cb108-80"><a href="sel-and-pred.html#cb108-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res4<span class="sc">$</span>selected_clusts), <span class="dv">1</span>)</span>
<span id="cb108-81"><a href="sel-and-pred.html#cb108-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-82"><a href="sel-and-pred.html#cb108-82" aria-hidden="true" tabindex="-1"></a>  res5 <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb108-83"><a href="sel-and-pred.html#cb108-83" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">2</span>)</span>
<span id="cb108-84"><a href="sel-and-pred.html#cb108-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res5<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span> <span class="dv">2</span>)</span>
<span id="cb108-85"><a href="sel-and-pred.html#cb108-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-86"><a href="sel-and-pred.html#cb108-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name features</span></span>
<span id="cb108-87"><a href="sel-and-pred.html#cb108-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(x)]</span>
<span id="cb108-88"><a href="sel-and-pred.html#cb108-88" aria-hidden="true" tabindex="-1"></a>  css_res3 <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x, <span class="at">y=</span>y, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb108-89"><a href="sel-and-pred.html#cb108-89" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res3, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.05</span>,</span>
<span id="cb108-90"><a href="sel-and-pred.html#cb108-90" aria-hidden="true" tabindex="-1"></a>                             <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb108-91"><a href="sel-and-pred.html#cb108-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-92"><a href="sel-and-pred.html#cb108-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb108-93"><a href="sel-and-pred.html#cb108-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">3</span>)</span>
<span id="cb108-94"><a href="sel-and-pred.html#cb108-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;selected_clusts&quot;</span>, <span class="st">&quot;selected_feats&quot;</span>,</span>
<span id="cb108-95"><a href="sel-and-pred.html#cb108-95" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;weights&quot;</span>))</span>
<span id="cb108-96"><a href="sel-and-pred.html#cb108-96" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>selected_clusts) <span class="sc">&lt;=</span></span>
<span id="cb108-97"><a href="sel-and-pred.html#cb108-97" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb108-98"><a href="sel-and-pred.html#cb108-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-99"><a href="sel-and-pred.html#cb108-99" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb108-100"><a href="sel-and-pred.html#cb108-100" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(res<span class="sc">$</span>selected_feats))</span>
<span id="cb108-101"><a href="sel-and-pred.html#cb108-101" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats)),</span>
<span id="cb108-102"><a href="sel-and-pred.html#cb108-102" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">names</span>(res<span class="sc">$</span>selected_feats))))</span>
<span id="cb108-103"><a href="sel-and-pred.html#cb108-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-104"><a href="sel-and-pred.html#cb108-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bad inputs</span></span>
<span id="cb108-105"><a href="sel-and-pred.html#cb108-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Error has quotation marks in it</span></span>
<span id="cb108-106"><a href="sel-and-pred.html#cb108-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(<span class="st">&quot;css_results&quot;</span>))</span>
<span id="cb108-107"><a href="sel-and-pred.html#cb108-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>),</span>
<span id="cb108-108"><a href="sel-and-pred.html#cb108-108" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb108-109"><a href="sel-and-pred.html#cb108-109" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-110"><a href="sel-and-pred.html#cb108-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">cutoff=</span><span class="sc">-</span>.<span class="dv">5</span>),</span>
<span id="cb108-111"><a href="sel-and-pred.html#cb108-111" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-112"><a href="sel-and-pred.html#cb108-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">min_num_clusts=</span><span class="dv">0</span>),</span>
<span id="cb108-113"><a href="sel-and-pred.html#cb108-113" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-114"><a href="sel-and-pred.html#cb108-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">min_num_clusts=</span><span class="dv">0</span>),</span>
<span id="cb108-115"><a href="sel-and-pred.html#cb108-115" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-116"><a href="sel-and-pred.html#cb108-116" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">max_num_clusts=</span><span class="dv">50</span>),</span>
<span id="cb108-117"><a href="sel-and-pred.html#cb108-117" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-118"><a href="sel-and-pred.html#cb108-118" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssSelections'>getCssSelections</a>(css_res, <span class="at">max_num_clusts=</span><span class="fl">4.5</span>),</span>
<span id="cb108-119"><a href="sel-and-pred.html#cb108-119" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb108-120"><a href="sel-and-pred.html#cb108-120" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb108-121"><a href="sel-and-pred.html#cb108-121" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥³</code></pre>
<p><code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code></p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="sel-and-pred.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Obtain a design matrix of cluster representatives</span></span>
<span id="cb110-2"><a href="sel-and-pred.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb110-3"><a href="sel-and-pred.html#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Takes a matrix of observations from the original feature space and returns</span></span>
<span id="cb110-4"><a href="sel-and-pred.html#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a matrix of representatives from the selected clusters based on the results</span></span>
<span id="cb110-5"><a href="sel-and-pred.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; of cluster stability selection.</span></span>
<span id="cb110-6"><a href="sel-and-pred.html#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb110-7"><a href="sel-and-pred.html#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb110-8"><a href="sel-and-pred.html#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param newX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb110-9"><a href="sel-and-pred.html#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb110-10"><a href="sel-and-pred.html#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate the design matrix of cluster</span></span>
<span id="cb110-11"><a href="sel-and-pred.html#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representatives. Must contain the same features (in the same</span></span>
<span id="cb110-12"><a href="sel-and-pred.html#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of columns) as the X matrix provided to css, and if the columns of</span></span>
<span id="cb110-13"><a href="sel-and-pred.html#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newX are labeled, the names must match the variable names provided to css.</span></span>
<span id="cb110-14"><a href="sel-and-pred.html#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newX may be omitted if train_inds were provided to css to set aside</span></span>
<span id="cb110-15"><a href="sel-and-pred.html#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations for model estimation. If this is the case, then when newX is</span></span>
<span id="cb110-16"><a href="sel-and-pred.html#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; omitted getCssDesign will return a design matrix of cluster representatives</span></span>
<span id="cb110-17"><a href="sel-and-pred.html#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formed from the train_inds observations from the matrix X provided to css.</span></span>
<span id="cb110-18"><a href="sel-and-pred.html#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (If no train_inds were provided to css, newX must be provided to</span></span>
<span id="cb110-19"><a href="sel-and-pred.html#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; getCssDesign.) Default is NA.</span></span>
<span id="cb110-20"><a href="sel-and-pred.html#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb110-21"><a href="sel-and-pred.html#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb110-22"><a href="sel-and-pred.html#cb110-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb110-23"><a href="sel-and-pred.html#cb110-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is put on the most frequently</span></span>
<span id="cb110-24"><a href="sel-and-pred.html#cb110-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb110-25"><a href="sel-and-pred.html#cb110-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb110-26"><a href="sel-and-pred.html#cb110-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, the weight used for each cluster member is calculated in</span></span>
<span id="cb110-27"><a href="sel-and-pred.html#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportion to the individual selection proportions of each feature. For</span></span>
<span id="cb110-28"><a href="sel-and-pred.html#cb110-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb110-29"><a href="sel-and-pred.html#cb110-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, the cluster representative</span></span>
<span id="cb110-30"><a href="sel-and-pred.html#cb110-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is just a simple average of all the cluster members). See Faletto and Bien</span></span>
<span id="cb110-31"><a href="sel-and-pred.html#cb110-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2022) for details. Default is &quot;weighted_avg&quot;.</span></span>
<span id="cb110-32"><a href="sel-and-pred.html#cb110-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; getCssDesign will only include those clusters with</span></span>
<span id="cb110-33"><a href="sel-and-pred.html#cb110-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportions equal to at least cutoff. Must be between 0 and 1.</span></span>
<span id="cb110-34"><a href="sel-and-pred.html#cb110-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0 (in which case either all clusters are used, or max_num_clusts</span></span>
<span id="cb110-35"><a href="sel-and-pred.html#cb110-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; are used, if max_num_clusts is specified).</span></span>
<span id="cb110-36"><a href="sel-and-pred.html#cb110-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb110-37"><a href="sel-and-pred.html#cb110-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb110-38"><a href="sel-and-pred.html#cb110-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb110-39"><a href="sel-and-pred.html#cb110-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb110-40"><a href="sel-and-pred.html#cb110-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb110-41"><a href="sel-and-pred.html#cb110-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb110-42"><a href="sel-and-pred.html#cb110-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb110-43"><a href="sel-and-pred.html#cb110-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb110-44"><a href="sel-and-pred.html#cb110-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb110-45"><a href="sel-and-pred.html#cb110-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A design matrix with either nrow(newX) (or length(train_inds), if</span></span>
<span id="cb110-46"><a href="sel-and-pred.html#cb110-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; train_inds was provided to css and newX was not provided to getCssDesign)</span></span>
<span id="cb110-47"><a href="sel-and-pred.html#cb110-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations and number of columns equal to the number of selected clusters,</span></span>
<span id="cb110-48"><a href="sel-and-pred.html#cb110-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; containing the cluster representatives for each cluster.</span></span>
<span id="cb110-49"><a href="sel-and-pred.html#cb110-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb110-50"><a href="sel-and-pred.html#cb110-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb110-51"><a href="sel-and-pred.html#cb110-51" aria-hidden="true" tabindex="-1"></a><span id='getCssDesign'>getCssDesign</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">newX=</span><span class="cn">NA</span>, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb110-52"><a href="sel-and-pred.html#cb110-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>){</span>
<span id="cb110-53"><a href="sel-and-pred.html#cb110-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb110-54"><a href="sel-and-pred.html#cb110-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb110-55"><a href="sel-and-pred.html#cb110-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-56"><a href="sel-and-pred.html#cb110-56" aria-hidden="true" tabindex="-1"></a>    check_results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(newX, css_results)</span>
<span id="cb110-57"><a href="sel-and-pred.html#cb110-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-58"><a href="sel-and-pred.html#cb110-58" aria-hidden="true" tabindex="-1"></a>    newX <span class="ot">&lt;-</span> check_results<span class="sc">$</span>newX</span>
<span id="cb110-59"><a href="sel-and-pred.html#cb110-59" aria-hidden="true" tabindex="-1"></a>    newXProvided <span class="ot">&lt;-</span> check_results<span class="sc">$</span>newXProvided</span>
<span id="cb110-60"><a href="sel-and-pred.html#cb110-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-61"><a href="sel-and-pred.html#cb110-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(check_results)</span>
<span id="cb110-62"><a href="sel-and-pred.html#cb110-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-63"><a href="sel-and-pred.html#cb110-63" aria-hidden="true" tabindex="-1"></a>    n_train <span class="ot">&lt;-</span> <span class="fu">nrow</span>(newX)</span>
<span id="cb110-64"><a href="sel-and-pred.html#cb110-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-65"><a href="sel-and-pred.html#cb110-65" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newX, css_results<span class="sc">$</span>X)</span>
<span id="cb110-66"><a href="sel-and-pred.html#cb110-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-67"><a href="sel-and-pred.html#cb110-67" aria-hidden="true" tabindex="-1"></a>    newX <span class="ot">&lt;-</span> results<span class="sc">$</span>newx</span>
<span id="cb110-68"><a href="sel-and-pred.html#cb110-68" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> results<span class="sc">$</span>feat_names</span>
<span id="cb110-69"><a href="sel-and-pred.html#cb110-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-70"><a href="sel-and-pred.html#cb110-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(results)</span>
<span id="cb110-71"><a href="sel-and-pred.html#cb110-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-72"><a href="sel-and-pred.html#cb110-72" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(newX)</span>
<span id="cb110-73"><a href="sel-and-pred.html#cb110-73" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(newX)</span>
<span id="cb110-74"><a href="sel-and-pred.html#cb110-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-75"><a href="sel-and-pred.html#cb110-75" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb110-76"><a href="sel-and-pred.html#cb110-76" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(weighting)</span>
<span id="cb110-77"><a href="sel-and-pred.html#cb110-77" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb110-78"><a href="sel-and-pred.html#cb110-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-79"><a href="sel-and-pred.html#cb110-79" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb110-80"><a href="sel-and-pred.html#cb110-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb110-81"><a href="sel-and-pred.html#cb110-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-82"><a href="sel-and-pred.html#cb110-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Take provided training design matrix and testX and turn them into</span></span>
<span id="cb110-83"><a href="sel-and-pred.html#cb110-83" aria-hidden="true" tabindex="-1"></a>    <span class="co"># matrices of cluster representatives using information from css_results</span></span>
<span id="cb110-84"><a href="sel-and-pred.html#cb110-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(newXProvided){</span>
<span id="cb110-85"><a href="sel-and-pred.html#cb110-85" aria-hidden="true" tabindex="-1"></a>        newX_clusters <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_results, weighting, cutoff,</span>
<span id="cb110-86"><a href="sel-and-pred.html#cb110-86" aria-hidden="true" tabindex="-1"></a>            min_num_clusts, max_num_clusts, <span class="at">newx=</span>newX)</span>
<span id="cb110-87"><a href="sel-and-pred.html#cb110-87" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb110-88"><a href="sel-and-pred.html#cb110-88" aria-hidden="true" tabindex="-1"></a>        newX_clusters <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_results, weighting, cutoff,</span>
<span id="cb110-89"><a href="sel-and-pred.html#cb110-89" aria-hidden="true" tabindex="-1"></a>            min_num_clusts, max_num_clusts)</span>
<span id="cb110-90"><a href="sel-and-pred.html#cb110-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-91"><a href="sel-and-pred.html#cb110-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-92"><a href="sel-and-pred.html#cb110-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(newX_clusters)</span>
<span id="cb110-93"><a href="sel-and-pred.html#cb110-93" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>()</code></p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="sel-and-pred.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that the new X matrix provided to getCssDesign or</span></span>
<span id="cb111-2"><a href="sel-and-pred.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; getCssPreds matches the characteristics of the X that was provided to css.</span></span>
<span id="cb111-3"><a href="sel-and-pred.html#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb111-4"><a href="sel-and-pred.html#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param trainX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb111-5"><a href="sel-and-pred.html#cb111-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix). Must contain</span></span>
<span id="cb111-6"><a href="sel-and-pred.html#cb111-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the same features (in the same number of columns) as the X matrix provided to</span></span>
<span id="cb111-7"><a href="sel-and-pred.html#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css, and if the columns of trainX are labeled, the names must match the</span></span>
<span id="cb111-8"><a href="sel-and-pred.html#cb111-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; variable names provided to css. trainX may be omitted if train_inds were</span></span>
<span id="cb111-9"><a href="sel-and-pred.html#cb111-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to css to set aside observations.</span></span>
<span id="cb111-10"><a href="sel-and-pred.html#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb111-11"><a href="sel-and-pred.html#cb111-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb111-12"><a href="sel-and-pred.html#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{newX}{If trainX was</span></span>
<span id="cb111-13"><a href="sel-and-pred.html#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided, this is the provided trainX matrix, coerced from a data.frame to a</span></span>
<span id="cb111-14"><a href="sel-and-pred.html#cb111-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; matrix if the provided trainX was a data.frame. If trainX was not provided,</span></span>
<span id="cb111-15"><a href="sel-and-pred.html#cb111-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; this is a matrix made up of the training indices provided to css in the</span></span>
<span id="cb111-16"><a href="sel-and-pred.html#cb111-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; train_inds argument.} \item{newXProvided}{Logical; indicates whether a valid</span></span>
<span id="cb111-17"><a href="sel-and-pred.html#cb111-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; trainX input was provided.}</span></span>
<span id="cb111-18"><a href="sel-and-pred.html#cb111-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb111-19"><a href="sel-and-pred.html#cb111-19" aria-hidden="true" tabindex="-1"></a><span id='checkNewXProvided'>checkNewXProvided</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(trainX, css_results){</span>
<span id="cb111-20"><a href="sel-and-pred.html#cb111-20" aria-hidden="true" tabindex="-1"></a>    newXProvided <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb111-21"><a href="sel-and-pred.html#cb111-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-22"><a href="sel-and-pred.html#cb111-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(trainX)) <span class="sc">&amp;</span> <span class="fu">length</span>(trainX) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb111-23"><a href="sel-and-pred.html#cb111-23" aria-hidden="true" tabindex="-1"></a>        newXProvided <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb111-24"><a href="sel-and-pred.html#cb111-24" aria-hidden="true" tabindex="-1"></a>        trainX <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(trainX, css_results<span class="sc">$</span>X)<span class="sc">$</span>newx</span>
<span id="cb111-25"><a href="sel-and-pred.html#cb111-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb111-26"><a href="sel-and-pred.html#cb111-26" aria-hidden="true" tabindex="-1"></a>        n_train <span class="ot">&lt;-</span> <span class="fu">nrow</span>(trainX)</span>
<span id="cb111-27"><a href="sel-and-pred.html#cb111-27" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(n_train <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb111-28"><a href="sel-and-pred.html#cb111-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb111-29"><a href="sel-and-pred.html#cb111-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(css_results<span class="sc">$</span>train_inds) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb111-30"><a href="sel-and-pred.html#cb111-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide new X in order to generate a design matrix&quot;</span>)</span>
<span id="cb111-31"><a href="sel-and-pred.html#cb111-31" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb111-32"><a href="sel-and-pred.html#cb111-32" aria-hidden="true" tabindex="-1"></a>        trainX <span class="ot">&lt;-</span> css_results<span class="sc">$</span>X[css_results<span class="sc">$</span>train_inds, ]</span>
<span id="cb111-33"><a href="sel-and-pred.html#cb111-33" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb111-34"><a href="sel-and-pred.html#cb111-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(trainX))</span>
<span id="cb111-35"><a href="sel-and-pred.html#cb111-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(trainX) <span class="sc">|</span> <span class="fu">is.integer</span>(trainX))</span>
<span id="cb111-36"><a href="sel-and-pred.html#cb111-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(trainX)))</span>
<span id="cb111-37"><a href="sel-and-pred.html#cb111-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(trainX) <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb111-38"><a href="sel-and-pred.html#cb111-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-39"><a href="sel-and-pred.html#cb111-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">newX=</span>trainX, <span class="at">newXProvided=</span>newXProvided))</span>
<span id="cb111-40"><a href="sel-and-pred.html#cb111-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>()</code></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="sel-and-pred.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that inputs to several functions are as expected,</span></span>
<span id="cb112-2"><a href="sel-and-pred.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; and modify inputs if needed</span></span>
<span id="cb112-3"><a href="sel-and-pred.html#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb112-4"><a href="sel-and-pred.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param newx A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb112-5"><a href="sel-and-pred.html#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb112-6"><a href="sel-and-pred.html#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate the design matrix of cluster</span></span>
<span id="cb112-7"><a href="sel-and-pred.html#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representatives. Must contain the same features (in the same</span></span>
<span id="cb112-8"><a href="sel-and-pred.html#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of columns) as the X matrix provided to css, and if the columns of</span></span>
<span id="cb112-9"><a href="sel-and-pred.html#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newX are labeled, the names must match the variable names provided to css.</span></span>
<span id="cb112-10"><a href="sel-and-pred.html#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_X The X matrix provided to css, as in the output of the css</span></span>
<span id="cb112-11"><a href="sel-and-pred.html#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; function (after having been coerced from a data.frame to a matrix by css if</span></span>
<span id="cb112-12"><a href="sel-and-pred.html#cb112-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; needed).</span></span>
<span id="cb112-13"><a href="sel-and-pred.html#cb112-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements. \item{feat_names}{A </span></span>
<span id="cb112-14"><a href="sel-and-pred.html#cb112-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; character vector containing the column names of newx (if the provided newx</span></span>
<span id="cb112-15"><a href="sel-and-pred.html#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; had column names). If the provided newx did not have column names, feat_names</span></span>
<span id="cb112-16"><a href="sel-and-pred.html#cb112-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; will be NA.} \item{newx}{The provided newx matrix, coerced from a data.frame</span></span>
<span id="cb112-17"><a href="sel-and-pred.html#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; to a matrix if the provided newx was a data.frame.}</span></span>
<span id="cb112-18"><a href="sel-and-pred.html#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb112-19"><a href="sel-and-pred.html#cb112-19" aria-hidden="true" tabindex="-1"></a><span id='checkXInputResults'>checkXInputResults</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(newx, css_X){</span>
<span id="cb112-20"><a href="sel-and-pred.html#cb112-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-21"><a href="sel-and-pred.html#cb112-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if x is a matrix; if it&#39;s a data.frame, convert to matrix.</span></span>
<span id="cb112-22"><a href="sel-and-pred.html#cb112-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.data.frame</span>(newx)){</span>
<span id="cb112-23"><a href="sel-and-pred.html#cb112-23" aria-hidden="true" tabindex="-1"></a>        newx <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., newx)</span>
<span id="cb112-24"><a href="sel-and-pred.html#cb112-24" aria-hidden="true" tabindex="-1"></a>        newx <span class="ot">&lt;-</span> newx[, <span class="fu">colnames</span>(newx) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb112-25"><a href="sel-and-pred.html#cb112-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-26"><a href="sel-and-pred.html#cb112-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-27"><a href="sel-and-pred.html#cb112-27" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="cn">NA</span>)</span>
<span id="cb112-28"><a href="sel-and-pred.html#cb112-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(newx))){</span>
<span id="cb112-29"><a href="sel-and-pred.html#cb112-29" aria-hidden="true" tabindex="-1"></a>        feat_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(newx)</span>
<span id="cb112-30"><a href="sel-and-pred.html#cb112-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">identical</span>(feat_names, <span class="fu">colnames</span>(css_X)))</span>
<span id="cb112-31"><a href="sel-and-pred.html#cb112-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb112-32"><a href="sel-and-pred.html#cb112-32" aria-hidden="true" tabindex="-1"></a>        <span class="co"># In this case, newx has no column names, so same better be true of</span></span>
<span id="cb112-33"><a href="sel-and-pred.html#cb112-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># css_X</span></span>
<span id="cb112-34"><a href="sel-and-pred.html#cb112-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(css_X))){</span>
<span id="cb112-35"><a href="sel-and-pred.html#cb112-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(<span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>)</span>
<span id="cb112-36"><a href="sel-and-pred.html#cb112-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb112-37"><a href="sel-and-pred.html#cb112-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-38"><a href="sel-and-pred.html#cb112-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-39"><a href="sel-and-pred.html#cb112-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.matrix</span>(newx))</span>
<span id="cb112-40"><a href="sel-and-pred.html#cb112-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(newx)))</span>
<span id="cb112-41"><a href="sel-and-pred.html#cb112-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-42"><a href="sel-and-pred.html#cb112-42" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(newx)</span>
<span id="cb112-43"><a href="sel-and-pred.html#cb112-43" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(newx)</span>
<span id="cb112-44"><a href="sel-and-pred.html#cb112-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb112-45"><a href="sel-and-pred.html#cb112-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(feat_names) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb112-46"><a href="sel-and-pred.html#cb112-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(feat_names) <span class="sc">==</span> p)</span>
<span id="cb112-47"><a href="sel-and-pred.html#cb112-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;(Intercept)&quot;</span> <span class="sc">%in%</span> feat_names))</span>
<span id="cb112-48"><a href="sel-and-pred.html#cb112-48" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb112-49"><a href="sel-and-pred.html#cb112-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">is.na</span>(feat_names))</span>
<span id="cb112-50"><a href="sel-and-pred.html#cb112-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-51"><a href="sel-and-pred.html#cb112-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-52"><a href="sel-and-pred.html#cb112-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(newx) <span class="ot">&lt;-</span> <span class="fu">character</span>()</span>
<span id="cb112-53"><a href="sel-and-pred.html#cb112-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-54"><a href="sel-and-pred.html#cb112-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Confirm that newx matches css_results$X</span></span>
<span id="cb112-55"><a href="sel-and-pred.html#cb112-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(p <span class="sc">!=</span> <span class="fu">ncol</span>(css_X)){</span>
<span id="cb112-56"><a href="sel-and-pred.html#cb112-56" aria-hidden="true" tabindex="-1"></a>        err <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;Number of columns in newx must match number of columns from matrix provided to css. Number of columns in new provided X: &quot;</span>,</span>
<span id="cb112-57"><a href="sel-and-pred.html#cb112-57" aria-hidden="true" tabindex="-1"></a>            p, <span class="st">&quot;. Number of columns in matrix provided to css: &quot;</span>, <span class="fu">ncol</span>(css_X),</span>
<span id="cb112-58"><a href="sel-and-pred.html#cb112-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;.&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb112-59"><a href="sel-and-pred.html#cb112-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(err)</span>
<span id="cb112-60"><a href="sel-and-pred.html#cb112-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-61"><a href="sel-and-pred.html#cb112-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(feat_names) <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(feat_names))){</span>
<span id="cb112-62"><a href="sel-and-pred.html#cb112-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">identical</span>(feat_names, <span class="fu">colnames</span>(css_X))){</span>
<span id="cb112-63"><a href="sel-and-pred.html#cb112-63" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Provided feature names for newx do not match feature names provided to css&quot;</span>)</span>
<span id="cb112-64"><a href="sel-and-pred.html#cb112-64" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb112-65"><a href="sel-and-pred.html#cb112-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-66"><a href="sel-and-pred.html#cb112-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-67"><a href="sel-and-pred.html#cb112-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">feat_names=</span>feat_names, <span class="at">newx=</span>newx))</span>
<span id="cb112-68"><a href="sel-and-pred.html#cb112-68" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>()</code></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="sel-and-pred.html#cb113-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkXInputResults works&quot;</span>, {</span>
<span id="cb113-2"><a href="sel-and-pred.html#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">72617</span>)</span>
<span id="cb113-3"><a href="sel-and-pred.html#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="sel-and-pred.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb113-5"><a href="sel-and-pred.html#cb113-5" aria-hidden="true" tabindex="-1"></a>  x_new <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb113-6"><a href="sel-and-pred.html#cb113-6" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb113-7"><a href="sel-and-pred.html#cb113-7" aria-hidden="true" tabindex="-1"></a>  y_new <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb113-8"><a href="sel-and-pred.html#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="sel-and-pred.html#cb113-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb113-10"><a href="sel-and-pred.html#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="sel-and-pred.html#cb113-11" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb113-12"><a href="sel-and-pred.html#cb113-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb113-13"><a href="sel-and-pred.html#cb113-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-14"><a href="sel-and-pred.html#cb113-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(x_new, css_res<span class="sc">$</span>X)</span>
<span id="cb113-15"><a href="sel-and-pred.html#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="sel-and-pred.html#cb113-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb113-17"><a href="sel-and-pred.html#cb113-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;newx&quot;</span>))</span>
<span id="cb113-18"><a href="sel-and-pred.html#cb113-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-19"><a href="sel-and-pred.html#cb113-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb113-20"><a href="sel-and-pred.html#cb113-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb113-21"><a href="sel-and-pred.html#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="sel-and-pred.html#cb113-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newx))</span>
<span id="cb113-23"><a href="sel-and-pred.html#cb113-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newx))</span>
<span id="cb113-24"><a href="sel-and-pred.html#cb113-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newx), <span class="dv">8</span>)</span>
<span id="cb113-25"><a href="sel-and-pred.html#cb113-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newx), <span class="dv">5</span>)</span>
<span id="cb113-26"><a href="sel-and-pred.html#cb113-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newx))</span>
<span id="cb113-27"><a href="sel-and-pred.html#cb113-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-28"><a href="sel-and-pred.html#cb113-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb113-29"><a href="sel-and-pred.html#cb113-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-30"><a href="sel-and-pred.html#cb113-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb113-31"><a href="sel-and-pred.html#cb113-31" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb113-32"><a href="sel-and-pred.html#cb113-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb113-33"><a href="sel-and-pred.html#cb113-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-34"><a href="sel-and-pred.html#cb113-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb113-35"><a href="sel-and-pred.html#cb113-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(x_new, css_res_named<span class="sc">$</span>X),</span>
<span id="cb113-36"><a href="sel-and-pred.html#cb113-36" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>,</span>
<span id="cb113-37"><a href="sel-and-pred.html#cb113-37" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb113-38"><a href="sel-and-pred.html#cb113-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-39"><a href="sel-and-pred.html#cb113-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb113-40"><a href="sel-and-pred.html#cb113-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb113-41"><a href="sel-and-pred.html#cb113-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(x_new, css_res_named<span class="sc">$</span>X),</span>
<span id="cb113-42"><a href="sel-and-pred.html#cb113-42" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb113-43"><a href="sel-and-pred.html#cb113-43" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb113-44"><a href="sel-and-pred.html#cb113-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-45"><a href="sel-and-pred.html#cb113-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb113-46"><a href="sel-and-pred.html#cb113-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-47"><a href="sel-and-pred.html#cb113-47" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(x_new, css_res_named<span class="sc">$</span>X)</span>
<span id="cb113-48"><a href="sel-and-pred.html#cb113-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-49"><a href="sel-and-pred.html#cb113-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_named))</span>
<span id="cb113-50"><a href="sel-and-pred.html#cb113-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_named), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;newx&quot;</span>))</span>
<span id="cb113-51"><a href="sel-and-pred.html#cb113-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb113-52"><a href="sel-and-pred.html#cb113-52" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res_named<span class="sc">$</span>feat_names))</span>
<span id="cb113-53"><a href="sel-and-pred.html#cb113-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_named<span class="sc">$</span>feat_names, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb113-54"><a href="sel-and-pred.html#cb113-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-55"><a href="sel-and-pred.html#cb113-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and checkXInputResults</span></span>
<span id="cb113-56"><a href="sel-and-pred.html#cb113-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-57"><a href="sel-and-pred.html#cb113-57" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb113-58"><a href="sel-and-pred.html#cb113-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-59"><a href="sel-and-pred.html#cb113-59" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb113-60"><a href="sel-and-pred.html#cb113-60" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb113-61"><a href="sel-and-pred.html#cb113-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-62"><a href="sel-and-pred.html#cb113-62" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb113-63"><a href="sel-and-pred.html#cb113-63" aria-hidden="true" tabindex="-1"></a>  fit_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, selec_inds)</span>
<span id="cb113-64"><a href="sel-and-pred.html#cb113-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-65"><a href="sel-and-pred.html#cb113-65" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb113-66"><a href="sel-and-pred.html#cb113-66" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(X_df[fit_inds, ], css_res_df<span class="sc">$</span>X)</span>
<span id="cb113-67"><a href="sel-and-pred.html#cb113-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-68"><a href="sel-and-pred.html#cb113-68" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb113-69"><a href="sel-and-pred.html#cb113-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;newx&quot;</span>))</span>
<span id="cb113-70"><a href="sel-and-pred.html#cb113-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-71"><a href="sel-and-pred.html#cb113-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res_df<span class="sc">$</span>feat_names))</span>
<span id="cb113-72"><a href="sel-and-pred.html#cb113-72" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_df<span class="sc">$</span>feat_names, <span class="fu">colnames</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb113-73"><a href="sel-and-pred.html#cb113-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_df<span class="sc">$</span>feat_names, <span class="fu">colnames</span>(X_df))</span>
<span id="cb113-74"><a href="sel-and-pred.html#cb113-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-75"><a href="sel-and-pred.html#cb113-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-76"><a href="sel-and-pred.html#cb113-76" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-77"><a href="sel-and-pred.html#cb113-77" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-78"><a href="sel-and-pred.html#cb113-78" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newx), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb113-79"><a href="sel-and-pred.html#cb113-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-80"><a href="sel-and-pred.html#cb113-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb113-81"><a href="sel-and-pred.html#cb113-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb113-82"><a href="sel-and-pred.html#cb113-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb113-83"><a href="sel-and-pred.html#cb113-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cyl, gear, and carb are factors with more than 2 levels</span></span>
<span id="cb113-84"><a href="sel-and-pred.html#cb113-84" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb113-85"><a href="sel-and-pred.html#cb113-85" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb113-86"><a href="sel-and-pred.html#cb113-86" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb113-87"><a href="sel-and-pred.html#cb113-87" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb113-88"><a href="sel-and-pred.html#cb113-88" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb113-89"><a href="sel-and-pred.html#cb113-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-90"><a href="sel-and-pred.html#cb113-90" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb113-91"><a href="sel-and-pred.html#cb113-91" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(X_df[fit_inds, ], css_res_df<span class="sc">$</span>X)</span>
<span id="cb113-92"><a href="sel-and-pred.html#cb113-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-93"><a href="sel-and-pred.html#cb113-93" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb113-94"><a href="sel-and-pred.html#cb113-94" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;newx&quot;</span>))</span>
<span id="cb113-95"><a href="sel-and-pred.html#cb113-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-96"><a href="sel-and-pred.html#cb113-96" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res_df<span class="sc">$</span>feat_names))</span>
<span id="cb113-97"><a href="sel-and-pred.html#cb113-97" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_df<span class="sc">$</span>feat_names, <span class="fu">colnames</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb113-98"><a href="sel-and-pred.html#cb113-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-99"><a href="sel-and-pred.html#cb113-99" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>( <span class="sc">~</span>., X_df)</span>
<span id="cb113-100"><a href="sel-and-pred.html#cb113-100" aria-hidden="true" tabindex="-1"></a>  mat <span class="ot">&lt;-</span> mat[, <span class="fu">colnames</span>(mat) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb113-101"><a href="sel-and-pred.html#cb113-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-102"><a href="sel-and-pred.html#cb113-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_df<span class="sc">$</span>feat_names, <span class="fu">colnames</span>(mat))</span>
<span id="cb113-103"><a href="sel-and-pred.html#cb113-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-104"><a href="sel-and-pred.html#cb113-104" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-105"><a href="sel-and-pred.html#cb113-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-106"><a href="sel-and-pred.html#cb113-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb113-107"><a href="sel-and-pred.html#cb113-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newx), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb113-108"><a href="sel-and-pred.html#cb113-108" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸŒˆ</code></pre>
<p>Tests for <code><a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>()</code></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="sel-and-pred.html#cb115-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkNewXProvided works&quot;</span>, {</span>
<span id="cb115-2"><a href="sel-and-pred.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">2673</span>)</span>
<span id="cb115-3"><a href="sel-and-pred.html#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="sel-and-pred.html#cb115-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb115-5"><a href="sel-and-pred.html#cb115-5" aria-hidden="true" tabindex="-1"></a>  x_new <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">5</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">5</span>)</span>
<span id="cb115-6"><a href="sel-and-pred.html#cb115-6" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb115-7"><a href="sel-and-pred.html#cb115-7" aria-hidden="true" tabindex="-1"></a>  y_new <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb115-8"><a href="sel-and-pred.html#cb115-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-9"><a href="sel-and-pred.html#cb115-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb115-10"><a href="sel-and-pred.html#cb115-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-11"><a href="sel-and-pred.html#cb115-11" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb115-12"><a href="sel-and-pred.html#cb115-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb115-13"><a href="sel-and-pred.html#cb115-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-14"><a href="sel-and-pred.html#cb115-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(x_new, css_res)</span>
<span id="cb115-15"><a href="sel-and-pred.html#cb115-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-16"><a href="sel-and-pred.html#cb115-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb115-17"><a href="sel-and-pred.html#cb115-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-18"><a href="sel-and-pred.html#cb115-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-19"><a href="sel-and-pred.html#cb115-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-20"><a href="sel-and-pred.html#cb115-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-21"><a href="sel-and-pred.html#cb115-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newX), <span class="dv">8</span>)</span>
<span id="cb115-22"><a href="sel-and-pred.html#cb115-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newX), <span class="dv">5</span>)</span>
<span id="cb115-23"><a href="sel-and-pred.html#cb115-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-24"><a href="sel-and-pred.html#cb115-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-25"><a href="sel-and-pred.html#cb115-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res<span class="sc">$</span>newXProvided))</span>
<span id="cb115-26"><a href="sel-and-pred.html#cb115-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>newXProvided), <span class="dv">1</span>)</span>
<span id="cb115-27"><a href="sel-and-pred.html#cb115-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>newXProvided))</span>
<span id="cb115-28"><a href="sel-and-pred.html#cb115-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>newXProvided)</span>
<span id="cb115-29"><a href="sel-and-pred.html#cb115-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-30"><a href="sel-and-pred.html#cb115-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb115-31"><a href="sel-and-pred.html#cb115-31" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb115-32"><a href="sel-and-pred.html#cb115-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb115-33"><a href="sel-and-pred.html#cb115-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-34"><a href="sel-and-pred.html#cb115-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb115-35"><a href="sel-and-pred.html#cb115-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-36"><a href="sel-and-pred.html#cb115-36" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(x_new, css_res_train)</span>
<span id="cb115-37"><a href="sel-and-pred.html#cb115-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-38"><a href="sel-and-pred.html#cb115-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb115-39"><a href="sel-and-pred.html#cb115-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-40"><a href="sel-and-pred.html#cb115-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-41"><a href="sel-and-pred.html#cb115-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_new <span class="sc">-</span> res<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb115-42"><a href="sel-and-pred.html#cb115-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>newXProvided)</span>
<span id="cb115-43"><a href="sel-and-pred.html#cb115-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-44"><a href="sel-and-pred.html#cb115-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb115-45"><a href="sel-and-pred.html#cb115-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-46"><a href="sel-and-pred.html#cb115-46" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(<span class="cn">NA</span>, css_res_train)</span>
<span id="cb115-47"><a href="sel-and-pred.html#cb115-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-48"><a href="sel-and-pred.html#cb115-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb115-49"><a href="sel-and-pred.html#cb115-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-50"><a href="sel-and-pred.html#cb115-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-51"><a href="sel-and-pred.html#cb115-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-52"><a href="sel-and-pred.html#cb115-52" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-53"><a href="sel-and-pred.html#cb115-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newX), <span class="dv">5</span>)</span>
<span id="cb115-54"><a href="sel-and-pred.html#cb115-54" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newX), <span class="dv">5</span>)</span>
<span id="cb115-55"><a href="sel-and-pred.html#cb115-55" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newX))</span>
<span id="cb115-56"><a href="sel-and-pred.html#cb115-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-57"><a href="sel-and-pred.html#cb115-57" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_false</span>(res<span class="sc">$</span>newXProvided)</span>
<span id="cb115-58"><a href="sel-and-pred.html#cb115-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-59"><a href="sel-and-pred.html#cb115-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newx--should get error</span></span>
<span id="cb115-60"><a href="sel-and-pred.html#cb115-60" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(<span class="cn">NA</span>, css_res),</span>
<span id="cb115-61"><a href="sel-and-pred.html#cb115-61" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide new X in order to generate a design matrix&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-62"><a href="sel-and-pred.html#cb115-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-63"><a href="sel-and-pred.html#cb115-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb115-64"><a href="sel-and-pred.html#cb115-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-65"><a href="sel-and-pred.html#cb115-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb115-66"><a href="sel-and-pred.html#cb115-66" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb115-67"><a href="sel-and-pred.html#cb115-67" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb115-68"><a href="sel-and-pred.html#cb115-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-69"><a href="sel-and-pred.html#cb115-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb115-70"><a href="sel-and-pred.html#cb115-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(x_new, css_res_named),</span>
<span id="cb115-71"><a href="sel-and-pred.html#cb115-71" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-72"><a href="sel-and-pred.html#cb115-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-73"><a href="sel-and-pred.html#cb115-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb115-74"><a href="sel-and-pred.html#cb115-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb115-75"><a href="sel-and-pred.html#cb115-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(x_new, css_res_named),</span>
<span id="cb115-76"><a href="sel-and-pred.html#cb115-76" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb115-77"><a href="sel-and-pred.html#cb115-77" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb115-78"><a href="sel-and-pred.html#cb115-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-79"><a href="sel-and-pred.html#cb115-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb115-80"><a href="sel-and-pred.html#cb115-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-81"><a href="sel-and-pred.html#cb115-81" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(x_new, css_res_named)</span>
<span id="cb115-82"><a href="sel-and-pred.html#cb115-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-83"><a href="sel-and-pred.html#cb115-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_named))</span>
<span id="cb115-84"><a href="sel-and-pred.html#cb115-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_named), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-85"><a href="sel-and-pred.html#cb115-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-86"><a href="sel-and-pred.html#cb115-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_new <span class="sc">-</span> res_named<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb115-87"><a href="sel-and-pred.html#cb115-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res_named<span class="sc">$</span>newXProvided)</span>
<span id="cb115-88"><a href="sel-and-pred.html#cb115-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-89"><a href="sel-and-pred.html#cb115-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and checkNewXProvided</span></span>
<span id="cb115-90"><a href="sel-and-pred.html#cb115-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-91"><a href="sel-and-pred.html#cb115-91" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb115-92"><a href="sel-and-pred.html#cb115-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-93"><a href="sel-and-pred.html#cb115-93" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb115-94"><a href="sel-and-pred.html#cb115-94" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb115-95"><a href="sel-and-pred.html#cb115-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-96"><a href="sel-and-pred.html#cb115-96" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb115-97"><a href="sel-and-pred.html#cb115-97" aria-hidden="true" tabindex="-1"></a>  fit_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, selec_inds)</span>
<span id="cb115-98"><a href="sel-and-pred.html#cb115-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-99"><a href="sel-and-pred.html#cb115-99" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb115-100"><a href="sel-and-pred.html#cb115-100" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(X_df[fit_inds, ], css_res_df)</span>
<span id="cb115-101"><a href="sel-and-pred.html#cb115-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-102"><a href="sel-and-pred.html#cb115-102" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb115-103"><a href="sel-and-pred.html#cb115-103" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-104"><a href="sel-and-pred.html#cb115-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-105"><a href="sel-and-pred.html#cb115-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-106"><a href="sel-and-pred.html#cb115-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-107"><a href="sel-and-pred.html#cb115-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>newX), <span class="fu">length</span>(fit_inds))</span>
<span id="cb115-108"><a href="sel-and-pred.html#cb115-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newX), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb115-109"><a href="sel-and-pred.html#cb115-109" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-110"><a href="sel-and-pred.html#cb115-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-111"><a href="sel-and-pred.html#cb115-111" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res_df<span class="sc">$</span>newXProvided))</span>
<span id="cb115-112"><a href="sel-and-pred.html#cb115-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_df<span class="sc">$</span>newXProvided), <span class="dv">1</span>)</span>
<span id="cb115-113"><a href="sel-and-pred.html#cb115-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>newXProvided))</span>
<span id="cb115-114"><a href="sel-and-pred.html#cb115-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res_df<span class="sc">$</span>newXProvided)</span>
<span id="cb115-115"><a href="sel-and-pred.html#cb115-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-116"><a href="sel-and-pred.html#cb115-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb115-117"><a href="sel-and-pred.html#cb115-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb115-118"><a href="sel-and-pred.html#cb115-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb115-119"><a href="sel-and-pred.html#cb115-119" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb115-120"><a href="sel-and-pred.html#cb115-120" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb115-121"><a href="sel-and-pred.html#cb115-121" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb115-122"><a href="sel-and-pred.html#cb115-122" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb115-123"><a href="sel-and-pred.html#cb115-123" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb115-124"><a href="sel-and-pred.html#cb115-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-125"><a href="sel-and-pred.html#cb115-125" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb115-126"><a href="sel-and-pred.html#cb115-126" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(X_df[fit_inds, ], css_res_df)</span>
<span id="cb115-127"><a href="sel-and-pred.html#cb115-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-128"><a href="sel-and-pred.html#cb115-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb115-129"><a href="sel-and-pred.html#cb115-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;newX&quot;</span>, <span class="st">&quot;newXProvided&quot;</span>))</span>
<span id="cb115-130"><a href="sel-and-pred.html#cb115-130" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-131"><a href="sel-and-pred.html#cb115-131" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-132"><a href="sel-and-pred.html#cb115-132" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-133"><a href="sel-and-pred.html#cb115-133" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>newX), <span class="fu">length</span>(fit_inds))</span>
<span id="cb115-134"><a href="sel-and-pred.html#cb115-134" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newX), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb115-135"><a href="sel-and-pred.html#cb115-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newX))</span>
<span id="cb115-136"><a href="sel-and-pred.html#cb115-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-137"><a href="sel-and-pred.html#cb115-137" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res_df<span class="sc">$</span>newXProvided))</span>
<span id="cb115-138"><a href="sel-and-pred.html#cb115-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_df<span class="sc">$</span>newXProvided), <span class="dv">1</span>)</span>
<span id="cb115-139"><a href="sel-and-pred.html#cb115-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>newXProvided))</span>
<span id="cb115-140"><a href="sel-and-pred.html#cb115-140" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res_df<span class="sc">$</span>newXProvided)</span>
<span id="cb115-141"><a href="sel-and-pred.html#cb115-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb115-142"><a href="sel-and-pred.html#cb115-142" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ˜€</code></pre>
<p><code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code>:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="sel-and-pred.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Create design matrix of cluster representatives from matrix of raw features</span></span>
<span id="cb117-2"><a href="sel-and-pred.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; using results of css function</span></span>
<span id="cb117-3"><a href="sel-and-pred.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb117-4"><a href="sel-and-pred.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb117-5"><a href="sel-and-pred.html#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb117-6"><a href="sel-and-pred.html#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb117-7"><a href="sel-and-pred.html#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb117-8"><a href="sel-and-pred.html#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb117-9"><a href="sel-and-pred.html#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is put on the most frequently</span></span>
<span id="cb117-10"><a href="sel-and-pred.html#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb117-11"><a href="sel-and-pred.html#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb117-12"><a href="sel-and-pred.html#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, the weight used for each cluster member is calculated in</span></span>
<span id="cb117-13"><a href="sel-and-pred.html#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportion to the individual selection proportions of each feature. For</span></span>
<span id="cb117-14"><a href="sel-and-pred.html#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb117-15"><a href="sel-and-pred.html#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, the cluster representative</span></span>
<span id="cb117-16"><a href="sel-and-pred.html#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is just a simple average of all the cluster members). See Faletto and Bien</span></span>
<span id="cb117-17"><a href="sel-and-pred.html#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2022) for details. Default is &quot;weighted_avg&quot;.</span></span>
<span id="cb117-18"><a href="sel-and-pred.html#cb117-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; css will return only those clusters with selection</span></span>
<span id="cb117-19"><a href="sel-and-pred.html#cb117-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportions equal to at least cutoff. Must be between 0 and 1. Default is 0</span></span>
<span id="cb117-20"><a href="sel-and-pred.html#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (in which case all clusters are returned in decreasing order of selection</span></span>
<span id="cb117-21"><a href="sel-and-pred.html#cb117-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportion).</span></span>
<span id="cb117-22"><a href="sel-and-pred.html#cb117-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb117-23"><a href="sel-and-pred.html#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb117-24"><a href="sel-and-pred.html#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb117-25"><a href="sel-and-pred.html#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb117-26"><a href="sel-and-pred.html#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb117-27"><a href="sel-and-pred.html#cb117-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb117-28"><a href="sel-and-pred.html#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb117-29"><a href="sel-and-pred.html#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb117-30"><a href="sel-and-pred.html#cb117-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb117-31"><a href="sel-and-pred.html#cb117-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param newx A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb117-32"><a href="sel-and-pred.html#cb117-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb117-33"><a href="sel-and-pred.html#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate the design matrix of cluster</span></span>
<span id="cb117-34"><a href="sel-and-pred.html#cb117-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representatives. Must contain the same features (in the same</span></span>
<span id="cb117-35"><a href="sel-and-pred.html#cb117-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of columns) as the X matrix provided to css, and if the columns of</span></span>
<span id="cb117-36"><a href="sel-and-pred.html#cb117-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newx are labeled, the names must match the variable names provided to css.</span></span>
<span id="cb117-37"><a href="sel-and-pred.html#cb117-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newx may be omitted if train_inds were provided to css to set aside</span></span>
<span id="cb117-38"><a href="sel-and-pred.html#cb117-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations for model estimation. If this is the case, then when newx is</span></span>
<span id="cb117-39"><a href="sel-and-pred.html#cb117-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; omitted formCssDesign will return a design matrix of cluster representatives</span></span>
<span id="cb117-40"><a href="sel-and-pred.html#cb117-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formed from the train_inds observations from the matrix X provided to css.</span></span>
<span id="cb117-41"><a href="sel-and-pred.html#cb117-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (If no train_inds were provided to css, newX must be provided to</span></span>
<span id="cb117-42"><a href="sel-and-pred.html#cb117-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formCssDesign.) Default is NA.</span></span>
<span id="cb117-43"><a href="sel-and-pred.html#cb117-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A design matrix with the same number of rows as newx (or the </span></span>
<span id="cb117-44"><a href="sel-and-pred.html#cb117-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; train_inds provided to css) where the columns are the constructed cluster</span></span>
<span id="cb117-45"><a href="sel-and-pred.html#cb117-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representatives.</span></span>
<span id="cb117-46"><a href="sel-and-pred.html#cb117-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb117-47"><a href="sel-and-pred.html#cb117-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb117-48"><a href="sel-and-pred.html#cb117-48" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb117-49"><a href="sel-and-pred.html#cb117-49" aria-hidden="true" tabindex="-1"></a><span id='formCssDesign'>formCssDesign</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb117-50"><a href="sel-and-pred.html#cb117-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">newx=</span><span class="cn">NA</span>){</span>
<span id="cb117-51"><a href="sel-and-pred.html#cb117-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-52"><a href="sel-and-pred.html#cb117-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb117-53"><a href="sel-and-pred.html#cb117-53" aria-hidden="true" tabindex="-1"></a>    ret <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(css_results, weighting, cutoff,</span>
<span id="cb117-54"><a href="sel-and-pred.html#cb117-54" aria-hidden="true" tabindex="-1"></a>        min_num_clusts, max_num_clusts, newx)</span>
<span id="cb117-55"><a href="sel-and-pred.html#cb117-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-56"><a href="sel-and-pred.html#cb117-56" aria-hidden="true" tabindex="-1"></a>    newx <span class="ot">&lt;-</span> ret<span class="sc">$</span>newx</span>
<span id="cb117-57"><a href="sel-and-pred.html#cb117-57" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> ret<span class="sc">$</span>max_num_clusts</span>
<span id="cb117-58"><a href="sel-and-pred.html#cb117-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-59"><a href="sel-and-pred.html#cb117-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(ret)</span>
<span id="cb117-60"><a href="sel-and-pred.html#cb117-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-61"><a href="sel-and-pred.html#cb117-61" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(newx)</span>
<span id="cb117-62"><a href="sel-and-pred.html#cb117-62" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(newx)</span>
<span id="cb117-63"><a href="sel-and-pred.html#cb117-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-64"><a href="sel-and-pred.html#cb117-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the names of the selected clusters and the weights for the features</span></span>
<span id="cb117-65"><a href="sel-and-pred.html#cb117-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># within each cluster, according to the provided weighting rule</span></span>
<span id="cb117-66"><a href="sel-and-pred.html#cb117-66" aria-hidden="true" tabindex="-1"></a>    weights <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getSelectedClusters'>getSelectedClusters</a>(css_results, weighting, cutoff,</span>
<span id="cb117-67"><a href="sel-and-pred.html#cb117-67" aria-hidden="true" tabindex="-1"></a>        min_num_clusts, max_num_clusts)<span class="sc">$</span>weights</span>
<span id="cb117-68"><a href="sel-and-pred.html#cb117-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-69"><a href="sel-and-pred.html#cb117-69" aria-hidden="true" tabindex="-1"></a>    n_sel_clusts <span class="ot">&lt;-</span> <span class="fu">length</span>(weights)</span>
<span id="cb117-70"><a href="sel-and-pred.html#cb117-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-71"><a href="sel-and-pred.html#cb117-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Form matrix of cluster representatives of selected clusters</span></span>
<span id="cb117-72"><a href="sel-and-pred.html#cb117-72" aria-hidden="true" tabindex="-1"></a>    X_clus_reps <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fu">as.numeric</span>(<span class="cn">NA</span>), n<span class="sc">*</span>n_sel_clusts), <span class="at">nrow=</span>n,</span>
<span id="cb117-73"><a href="sel-and-pred.html#cb117-73" aria-hidden="true" tabindex="-1"></a>        <span class="at">ncol=</span>n_sel_clusts)</span>
<span id="cb117-74"><a href="sel-and-pred.html#cb117-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(X_clus_reps) <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.character</span>(<span class="cn">NA</span>), n_sel_clusts)</span>
<span id="cb117-75"><a href="sel-and-pred.html#cb117-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-76"><a href="sel-and-pred.html#cb117-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sel_clusts){</span>
<span id="cb117-77"><a href="sel-and-pred.html#cb117-77" aria-hidden="true" tabindex="-1"></a>        clust_i_name <span class="ot">&lt;-</span> <span class="fu">names</span>(weights)[i]</span>
<span id="cb117-78"><a href="sel-and-pred.html#cb117-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-79"><a href="sel-and-pred.html#cb117-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clust_i_name) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb117-80"><a href="sel-and-pred.html#cb117-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(clust_i_name <span class="sc">%in%</span> <span class="fu">names</span>(weights))</span>
<span id="cb117-81"><a href="sel-and-pred.html#cb117-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-82"><a href="sel-and-pred.html#cb117-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(X_clus_reps)[i] <span class="ot">&lt;-</span> clust_i_name</span>
<span id="cb117-83"><a href="sel-and-pred.html#cb117-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-84"><a href="sel-and-pred.html#cb117-84" aria-hidden="true" tabindex="-1"></a>        clust_i <span class="ot">&lt;-</span> css_results<span class="sc">$</span>clusters[[clust_i_name]]</span>
<span id="cb117-85"><a href="sel-and-pred.html#cb117-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-86"><a href="sel-and-pred.html#cb117-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clust_i) <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb117-87"><a href="sel-and-pred.html#cb117-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(clust_i) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb117-88"><a href="sel-and-pred.html#cb117-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-89"><a href="sel-and-pred.html#cb117-89" aria-hidden="true" tabindex="-1"></a>        weights_i <span class="ot">&lt;-</span> weights[[clust_i_name]]</span>
<span id="cb117-90"><a href="sel-and-pred.html#cb117-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-91"><a href="sel-and-pred.html#cb117-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(clust_i) <span class="sc">==</span> <span class="fu">length</span>(weights_i))</span>
<span id="cb117-92"><a href="sel-and-pred.html#cb117-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-93"><a href="sel-and-pred.html#cb117-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(weights_i) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb117-94"><a href="sel-and-pred.html#cb117-94" aria-hidden="true" tabindex="-1"></a>            X_clus_reps[, i] <span class="ot">&lt;-</span> newx[, clust_i] <span class="sc">%*%</span> weights_i</span>
<span id="cb117-95"><a href="sel-and-pred.html#cb117-95" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb117-96"><a href="sel-and-pred.html#cb117-96" aria-hidden="true" tabindex="-1"></a>            X_clus_reps[, i] <span class="ot">&lt;-</span> newx[, clust_i]<span class="sc">*</span>weights_i</span>
<span id="cb117-97"><a href="sel-and-pred.html#cb117-97" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb117-98"><a href="sel-and-pred.html#cb117-98" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb117-99"><a href="sel-and-pred.html#cb117-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-100"><a href="sel-and-pred.html#cb117-100" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb117-101"><a href="sel-and-pred.html#cb117-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(X_clus_reps)))</span>
<span id="cb117-102"><a href="sel-and-pred.html#cb117-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(X_clus_reps) <span class="sc">==</span> n_sel_clusts)</span>
<span id="cb117-103"><a href="sel-and-pred.html#cb117-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(X_clus_reps) <span class="sc">==</span> n)</span>
<span id="cb117-104"><a href="sel-and-pred.html#cb117-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-105"><a href="sel-and-pred.html#cb117-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(X_clus_reps)</span>
<span id="cb117-106"><a href="sel-and-pred.html#cb117-106" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>()</code>:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="sel-and-pred.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to check that the inputs to formCssDesign are as expected</span></span>
<span id="cb118-2"><a href="sel-and-pred.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb118-3"><a href="sel-and-pred.html#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb118-4"><a href="sel-and-pred.html#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb118-5"><a href="sel-and-pred.html#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb118-6"><a href="sel-and-pred.html#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb118-7"><a href="sel-and-pred.html#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb118-8"><a href="sel-and-pred.html#cb118-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;.</span></span>
<span id="cb118-9"><a href="sel-and-pred.html#cb118-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; css will return only those clusters with selection</span></span>
<span id="cb118-10"><a href="sel-and-pred.html#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportions equal to at least cutoff. Must be between 0 and 1.</span></span>
<span id="cb118-11"><a href="sel-and-pred.html#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb118-12"><a href="sel-and-pred.html#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb118-13"><a href="sel-and-pred.html#cb118-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb118-14"><a href="sel-and-pred.html#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.)</span></span>
<span id="cb118-15"><a href="sel-and-pred.html#cb118-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb118-16"><a href="sel-and-pred.html#cb118-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb118-17"><a href="sel-and-pred.html#cb118-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb118-18"><a href="sel-and-pred.html#cb118-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.)</span></span>
<span id="cb118-19"><a href="sel-and-pred.html#cb118-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param newx A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb118-20"><a href="sel-and-pred.html#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb118-21"><a href="sel-and-pred.html#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate the design matrix of cluster</span></span>
<span id="cb118-22"><a href="sel-and-pred.html#cb118-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; representatives. Must contain the same features (in the same</span></span>
<span id="cb118-23"><a href="sel-and-pred.html#cb118-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; number of columns) as the X matrix provided to css, and if the columns of</span></span>
<span id="cb118-24"><a href="sel-and-pred.html#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newx are labeled, the names must match the variable names provided to css.</span></span>
<span id="cb118-25"><a href="sel-and-pred.html#cb118-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; newx may be omitted if train_inds were provided to css to set aside</span></span>
<span id="cb118-26"><a href="sel-and-pred.html#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations for model estimation. If this is the case, then when newx is</span></span>
<span id="cb118-27"><a href="sel-and-pred.html#cb118-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; omitted formCssDesign will return a design matrix of cluster representatives</span></span>
<span id="cb118-28"><a href="sel-and-pred.html#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formed from the train_inds observations from the matrix X provided to css.</span></span>
<span id="cb118-29"><a href="sel-and-pred.html#cb118-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (If no train_inds were provided to css, newX must be provided to</span></span>
<span id="cb118-30"><a href="sel-and-pred.html#cb118-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; formCssDesign.)</span></span>
<span id="cb118-31"><a href="sel-and-pred.html#cb118-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{newx}{If newx was</span></span>
<span id="cb118-32"><a href="sel-and-pred.html#cb118-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided, the provided newx matrix, coerced from a data.frame to a matrix if</span></span>
<span id="cb118-33"><a href="sel-and-pred.html#cb118-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; needed. If newx was not provided, a matrix formed by the train_inds set</span></span>
<span id="cb118-34"><a href="sel-and-pred.html#cb118-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; aside in the original function call to css.} \item{max_num_clusts}{The</span></span>
<span id="cb118-35"><a href="sel-and-pred.html#cb118-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided max_num_clusts, coerced to an integer if needed, and coerced to be</span></span>
<span id="cb118-36"><a href="sel-and-pred.html#cb118-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; less than or equal to the total number of clusters.}</span></span>
<span id="cb118-37"><a href="sel-and-pred.html#cb118-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb118-38"><a href="sel-and-pred.html#cb118-38" aria-hidden="true" tabindex="-1"></a><span id='checkFormCssDesignInputs'>checkFormCssDesignInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, weighting, cutoff,</span>
<span id="cb118-39"><a href="sel-and-pred.html#cb118-39" aria-hidden="true" tabindex="-1"></a>    min_num_clusts, max_num_clusts, newx){    </span>
<span id="cb118-40"><a href="sel-and-pred.html#cb118-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb118-41"><a href="sel-and-pred.html#cb118-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-42"><a href="sel-and-pred.html#cb118-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(newx) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb118-43"><a href="sel-and-pred.html#cb118-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">is.na</span>(newx)){</span>
<span id="cb118-44"><a href="sel-and-pred.html#cb118-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(css_results<span class="sc">$</span>train_inds) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb118-45"><a href="sel-and-pred.html#cb118-45" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stop</span>(<span class="st">&quot;If css was not provided with indices to set aside for model training, then newx must be provided to formCssDesign&quot;</span>)</span>
<span id="cb118-46"><a href="sel-and-pred.html#cb118-46" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb118-47"><a href="sel-and-pred.html#cb118-47" aria-hidden="true" tabindex="-1"></a>            newx <span class="ot">&lt;-</span> css_results<span class="sc">$</span>X[css_results<span class="sc">$</span>train_inds, ]</span>
<span id="cb118-48"><a href="sel-and-pred.html#cb118-48" aria-hidden="true" tabindex="-1"></a>            <span class="co"># feat_names &lt;- colnames(newx)</span></span>
<span id="cb118-49"><a href="sel-and-pred.html#cb118-49" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb118-50"><a href="sel-and-pred.html#cb118-50" aria-hidden="true" tabindex="-1"></a>            results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results<span class="sc">$</span>X)</span>
<span id="cb118-51"><a href="sel-and-pred.html#cb118-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-52"><a href="sel-and-pred.html#cb118-52" aria-hidden="true" tabindex="-1"></a>            newx <span class="ot">&lt;-</span> results<span class="sc">$</span>newx</span>
<span id="cb118-53"><a href="sel-and-pred.html#cb118-53" aria-hidden="true" tabindex="-1"></a>            <span class="co"># feat_names &lt;- results$feat_names</span></span>
<span id="cb118-54"><a href="sel-and-pred.html#cb118-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-55"><a href="sel-and-pred.html#cb118-55" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rm</span>(results)</span>
<span id="cb118-56"><a href="sel-and-pred.html#cb118-56" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb118-57"><a href="sel-and-pred.html#cb118-57" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb118-58"><a href="sel-and-pred.html#cb118-58" aria-hidden="true" tabindex="-1"></a>        results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results<span class="sc">$</span>X)</span>
<span id="cb118-59"><a href="sel-and-pred.html#cb118-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-60"><a href="sel-and-pred.html#cb118-60" aria-hidden="true" tabindex="-1"></a>        newx <span class="ot">&lt;-</span> results<span class="sc">$</span>newx</span>
<span id="cb118-61"><a href="sel-and-pred.html#cb118-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># feat_names &lt;- results$feat_names</span></span>
<span id="cb118-62"><a href="sel-and-pred.html#cb118-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-63"><a href="sel-and-pred.html#cb118-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rm</span>(results)</span>
<span id="cb118-64"><a href="sel-and-pred.html#cb118-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb118-65"><a href="sel-and-pred.html#cb118-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-66"><a href="sel-and-pred.html#cb118-66" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(newx)</span>
<span id="cb118-67"><a href="sel-and-pred.html#cb118-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-68"><a href="sel-and-pred.html#cb118-68" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb118-69"><a href="sel-and-pred.html#cb118-69" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(weighting)</span>
<span id="cb118-70"><a href="sel-and-pred.html#cb118-70" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb118-71"><a href="sel-and-pred.html#cb118-71" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb118-72"><a href="sel-and-pred.html#cb118-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb118-73"><a href="sel-and-pred.html#cb118-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-74"><a href="sel-and-pred.html#cb118-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">newx=</span>newx, <span class="at">max_num_clusts=</span>max_num_clusts))</span>
<span id="cb118-75"><a href="sel-and-pred.html#cb118-75" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>()</code></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="sel-and-pred.html#cb119-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkFormCssDesignInputs works&quot;</span>, {</span>
<span id="cb119-2"><a href="sel-and-pred.html#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">72617</span>)</span>
<span id="cb119-3"><a href="sel-and-pred.html#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="sel-and-pred.html#cb119-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb119-5"><a href="sel-and-pred.html#cb119-5" aria-hidden="true" tabindex="-1"></a>  x_new <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb119-6"><a href="sel-and-pred.html#cb119-6" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb119-7"><a href="sel-and-pred.html#cb119-7" aria-hidden="true" tabindex="-1"></a>  y_new <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb119-8"><a href="sel-and-pred.html#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="sel-and-pred.html#cb119-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb119-10"><a href="sel-and-pred.html#cb119-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-11"><a href="sel-and-pred.html#cb119-11" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb119-12"><a href="sel-and-pred.html#cb119-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb119-13"><a href="sel-and-pred.html#cb119-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-14"><a href="sel-and-pred.html#cb119-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-15"><a href="sel-and-pred.html#cb119-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">cutoff=</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-16"><a href="sel-and-pred.html#cb119-16" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">newx=</span>x_new)</span>
<span id="cb119-17"><a href="sel-and-pred.html#cb119-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-18"><a href="sel-and-pred.html#cb119-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb119-19"><a href="sel-and-pred.html#cb119-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-20"><a href="sel-and-pred.html#cb119-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-21"><a href="sel-and-pred.html#cb119-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-22"><a href="sel-and-pred.html#cb119-22" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-23"><a href="sel-and-pred.html#cb119-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newx), <span class="dv">8</span>)</span>
<span id="cb119-24"><a href="sel-and-pred.html#cb119-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newx), <span class="dv">6</span>)</span>
<span id="cb119-25"><a href="sel-and-pred.html#cb119-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-26"><a href="sel-and-pred.html#cb119-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_new <span class="sc">-</span> res<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb119-27"><a href="sel-and-pred.html#cb119-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-28"><a href="sel-and-pred.html#cb119-28" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>max_num_clusts), <span class="dv">1</span>)</span>
<span id="cb119-29"><a href="sel-and-pred.html#cb119-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>max_num_clusts))</span>
<span id="cb119-30"><a href="sel-and-pred.html#cb119-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-31"><a href="sel-and-pred.html#cb119-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb119-32"><a href="sel-and-pred.html#cb119-32" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb119-33"><a href="sel-and-pred.html#cb119-33" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb119-34"><a href="sel-and-pred.html#cb119-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-35"><a href="sel-and-pred.html#cb119-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb119-36"><a href="sel-and-pred.html#cb119-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-37"><a href="sel-and-pred.html#cb119-37" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_train,</span>
<span id="cb119-38"><a href="sel-and-pred.html#cb119-38" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb119-39"><a href="sel-and-pred.html#cb119-39" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-40"><a href="sel-and-pred.html#cb119-40" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">newx=</span>x_new)</span>
<span id="cb119-41"><a href="sel-and-pred.html#cb119-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-42"><a href="sel-and-pred.html#cb119-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb119-43"><a href="sel-and-pred.html#cb119-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-44"><a href="sel-and-pred.html#cb119-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-45"><a href="sel-and-pred.html#cb119-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-46"><a href="sel-and-pred.html#cb119-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-47"><a href="sel-and-pred.html#cb119-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newx), <span class="dv">8</span>)</span>
<span id="cb119-48"><a href="sel-and-pred.html#cb119-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newx), <span class="dv">6</span>)</span>
<span id="cb119-49"><a href="sel-and-pred.html#cb119-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-50"><a href="sel-and-pred.html#cb119-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_new <span class="sc">-</span> res<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb119-51"><a href="sel-and-pred.html#cb119-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-52"><a href="sel-and-pred.html#cb119-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb119-53"><a href="sel-and-pred.html#cb119-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-54"><a href="sel-and-pred.html#cb119-54" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_train, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-55"><a href="sel-and-pred.html#cb119-55" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">cutoff=</span><span class="dv">1</span>, <span class="at">min_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb119-56"><a href="sel-and-pred.html#cb119-56" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">newx=</span><span class="cn">NA</span>)</span>
<span id="cb119-57"><a href="sel-and-pred.html#cb119-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-58"><a href="sel-and-pred.html#cb119-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb119-59"><a href="sel-and-pred.html#cb119-59" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-60"><a href="sel-and-pred.html#cb119-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-61"><a href="sel-and-pred.html#cb119-61" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-62"><a href="sel-and-pred.html#cb119-62" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-63"><a href="sel-and-pred.html#cb119-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>newx), <span class="fu">length</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb119-64"><a href="sel-and-pred.html#cb119-64" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>newx), <span class="dv">6</span>)</span>
<span id="cb119-65"><a href="sel-and-pred.html#cb119-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res<span class="sc">$</span>newx))</span>
<span id="cb119-66"><a href="sel-and-pred.html#cb119-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_select[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ] <span class="sc">-</span> res<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb119-67"><a href="sel-and-pred.html#cb119-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-68"><a href="sel-and-pred.html#cb119-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newx--should get error</span></span>
<span id="cb119-69"><a href="sel-and-pred.html#cb119-69" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-70"><a href="sel-and-pred.html#cb119-70" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-71"><a href="sel-and-pred.html#cb119-71" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-72"><a href="sel-and-pred.html#cb119-72" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">newx=</span><span class="cn">NA</span>),</span>
<span id="cb119-73"><a href="sel-and-pred.html#cb119-73" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;If css was not provided with indices to set aside for model training, then newx must be provided to formCssDesign&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-74"><a href="sel-and-pred.html#cb119-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-75"><a href="sel-and-pred.html#cb119-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb119-76"><a href="sel-and-pred.html#cb119-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-77"><a href="sel-and-pred.html#cb119-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb119-78"><a href="sel-and-pred.html#cb119-78" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb119-79"><a href="sel-and-pred.html#cb119-79" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb119-80"><a href="sel-and-pred.html#cb119-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-81"><a href="sel-and-pred.html#cb119-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb119-82"><a href="sel-and-pred.html#cb119-82" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb119-83"><a href="sel-and-pred.html#cb119-83" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb119-84"><a href="sel-and-pred.html#cb119-84" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">cutoff=</span><span class="fl">0.9</span>,</span>
<span id="cb119-85"><a href="sel-and-pred.html#cb119-85" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-86"><a href="sel-and-pred.html#cb119-86" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">max_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb119-87"><a href="sel-and-pred.html#cb119-87" aria-hidden="true" tabindex="-1"></a>                                                    <span class="at">newx=</span>x_new),</span>
<span id="cb119-88"><a href="sel-and-pred.html#cb119-88" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-89"><a href="sel-and-pred.html#cb119-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-90"><a href="sel-and-pred.html#cb119-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb119-91"><a href="sel-and-pred.html#cb119-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb119-92"><a href="sel-and-pred.html#cb119-92" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb119-93"><a href="sel-and-pred.html#cb119-93" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-94"><a href="sel-and-pred.html#cb119-94" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-95"><a href="sel-and-pred.html#cb119-95" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-96"><a href="sel-and-pred.html#cb119-96" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-97"><a href="sel-and-pred.html#cb119-97" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb119-98"><a href="sel-and-pred.html#cb119-98" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-99"><a href="sel-and-pred.html#cb119-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-100"><a href="sel-and-pred.html#cb119-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb119-101"><a href="sel-and-pred.html#cb119-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-102"><a href="sel-and-pred.html#cb119-102" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb119-103"><a href="sel-and-pred.html#cb119-103" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.5</span>,</span>
<span id="cb119-104"><a href="sel-and-pred.html#cb119-104" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-105"><a href="sel-and-pred.html#cb119-105" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">newx=</span>x_new)</span>
<span id="cb119-106"><a href="sel-and-pred.html#cb119-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-107"><a href="sel-and-pred.html#cb119-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_named))</span>
<span id="cb119-108"><a href="sel-and-pred.html#cb119-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_named), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-109"><a href="sel-and-pred.html#cb119-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-110"><a href="sel-and-pred.html#cb119-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_named<span class="sc">$</span>newx))</span>
<span id="cb119-111"><a href="sel-and-pred.html#cb119-111" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_named<span class="sc">$</span>newx))</span>
<span id="cb119-112"><a href="sel-and-pred.html#cb119-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_named<span class="sc">$</span>newx), <span class="dv">8</span>)</span>
<span id="cb119-113"><a href="sel-and-pred.html#cb119-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_named<span class="sc">$</span>newx), <span class="dv">6</span>)</span>
<span id="cb119-114"><a href="sel-and-pred.html#cb119-114" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_named<span class="sc">$</span>newx))</span>
<span id="cb119-115"><a href="sel-and-pred.html#cb119-115" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(css_res_named<span class="sc">$</span>X), LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb119-116"><a href="sel-and-pred.html#cb119-116" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_new <span class="sc">-</span> res_named<span class="sc">$</span>newX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb119-117"><a href="sel-and-pred.html#cb119-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-118"><a href="sel-and-pred.html#cb119-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and checkFormCssDesignInputs</span></span>
<span id="cb119-119"><a href="sel-and-pred.html#cb119-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-120"><a href="sel-and-pred.html#cb119-120" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb119-121"><a href="sel-and-pred.html#cb119-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-122"><a href="sel-and-pred.html#cb119-122" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb119-123"><a href="sel-and-pred.html#cb119-123" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb119-124"><a href="sel-and-pred.html#cb119-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-125"><a href="sel-and-pred.html#cb119-125" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb119-126"><a href="sel-and-pred.html#cb119-126" aria-hidden="true" tabindex="-1"></a>  fit_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, selec_inds)</span>
<span id="cb119-127"><a href="sel-and-pred.html#cb119-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-128"><a href="sel-and-pred.html#cb119-128" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb119-129"><a href="sel-and-pred.html#cb119-129" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_df,</span>
<span id="cb119-130"><a href="sel-and-pred.html#cb119-130" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.7</span>,</span>
<span id="cb119-131"><a href="sel-and-pred.html#cb119-131" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-132"><a href="sel-and-pred.html#cb119-132" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">newx=</span>X_df[fit_inds, ])</span>
<span id="cb119-133"><a href="sel-and-pred.html#cb119-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-134"><a href="sel-and-pred.html#cb119-134" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb119-135"><a href="sel-and-pred.html#cb119-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-136"><a href="sel-and-pred.html#cb119-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-137"><a href="sel-and-pred.html#cb119-137" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-138"><a href="sel-and-pred.html#cb119-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-139"><a href="sel-and-pred.html#cb119-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-140"><a href="sel-and-pred.html#cb119-140" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>newx), <span class="fu">length</span>(fit_inds))</span>
<span id="cb119-141"><a href="sel-and-pred.html#cb119-141" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newx), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb119-142"><a href="sel-and-pred.html#cb119-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-143"><a href="sel-and-pred.html#cb119-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb119-144"><a href="sel-and-pred.html#cb119-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb119-145"><a href="sel-and-pred.html#cb119-145" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb119-146"><a href="sel-and-pred.html#cb119-146" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb119-147"><a href="sel-and-pred.html#cb119-147" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb119-148"><a href="sel-and-pred.html#cb119-148" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb119-149"><a href="sel-and-pred.html#cb119-149" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb119-150"><a href="sel-and-pred.html#cb119-150" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb119-151"><a href="sel-and-pred.html#cb119-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-152"><a href="sel-and-pred.html#cb119-152" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb119-153"><a href="sel-and-pred.html#cb119-153" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res_df,</span>
<span id="cb119-154"><a href="sel-and-pred.html#cb119-154" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.3</span>,</span>
<span id="cb119-155"><a href="sel-and-pred.html#cb119-155" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">4</span>,</span>
<span id="cb119-156"><a href="sel-and-pred.html#cb119-156" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">newx=</span>X_df[fit_inds, ])</span>
<span id="cb119-157"><a href="sel-and-pred.html#cb119-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-158"><a href="sel-and-pred.html#cb119-158" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb119-159"><a href="sel-and-pred.html#cb119-159" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;newx&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb119-160"><a href="sel-and-pred.html#cb119-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-161"><a href="sel-and-pred.html#cb119-161" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-162"><a href="sel-and-pred.html#cb119-162" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-163"><a href="sel-and-pred.html#cb119-163" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_null</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>newx))</span>
<span id="cb119-164"><a href="sel-and-pred.html#cb119-164" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>newx), <span class="fu">length</span>(fit_inds))</span>
<span id="cb119-165"><a href="sel-and-pred.html#cb119-165" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>newx), <span class="fu">ncol</span>(css_res_df<span class="sc">$</span>X))</span>
<span id="cb119-166"><a href="sel-and-pred.html#cb119-166" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-167"><a href="sel-and-pred.html#cb119-167" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Try other bad inputs</span></span>
<span id="cb119-168"><a href="sel-and-pred.html#cb119-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-169"><a href="sel-and-pred.html#cb119-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb119-170"><a href="sel-and-pred.html#cb119-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-171"><a href="sel-and-pred.html#cb119-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-172"><a href="sel-and-pred.html#cb119-172" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-173"><a href="sel-and-pred.html#cb119-173" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="sc">-</span><span class="fl">0.3</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-174"><a href="sel-and-pred.html#cb119-174" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="dv">4</span>,</span>
<span id="cb119-175"><a href="sel-and-pred.html#cb119-175" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-176"><a href="sel-and-pred.html#cb119-176" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-177"><a href="sel-and-pred.html#cb119-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-178"><a href="sel-and-pred.html#cb119-178" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-179"><a href="sel-and-pred.html#cb119-179" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-180"><a href="sel-and-pred.html#cb119-180" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="st">&quot;0.5&quot;</span>,</span>
<span id="cb119-181"><a href="sel-and-pred.html#cb119-181" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-182"><a href="sel-and-pred.html#cb119-182" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">newx=</span>x_new),</span>
<span id="cb119-183"><a href="sel-and-pred.html#cb119-183" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb119-184"><a href="sel-and-pred.html#cb119-184" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-185"><a href="sel-and-pred.html#cb119-185" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-186"><a href="sel-and-pred.html#cb119-186" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-187"><a href="sel-and-pred.html#cb119-187" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-188"><a href="sel-and-pred.html#cb119-188" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb119-189"><a href="sel-and-pred.html#cb119-189" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-190"><a href="sel-and-pred.html#cb119-190" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-191"><a href="sel-and-pred.html#cb119-191" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-192"><a href="sel-and-pred.html#cb119-192" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-193"><a href="sel-and-pred.html#cb119-193" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-194"><a href="sel-and-pred.html#cb119-194" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-195"><a href="sel-and-pred.html#cb119-195" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb119-196"><a href="sel-and-pred.html#cb119-196" aria-hidden="true" tabindex="-1"></a>                                                              <span class="st">&quot;simple_avg&quot;</span>),</span>
<span id="cb119-197"><a href="sel-and-pred.html#cb119-197" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-198"><a href="sel-and-pred.html#cb119-198" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-199"><a href="sel-and-pred.html#cb119-199" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-200"><a href="sel-and-pred.html#cb119-200" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-201"><a href="sel-and-pred.html#cb119-201" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-202"><a href="sel-and-pred.html#cb119-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-203"><a href="sel-and-pred.html#cb119-203" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-204"><a href="sel-and-pred.html#cb119-204" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="dv">1</span>,</span>
<span id="cb119-205"><a href="sel-and-pred.html#cb119-205" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-206"><a href="sel-and-pred.html#cb119-206" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-207"><a href="sel-and-pred.html#cb119-207" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-208"><a href="sel-and-pred.html#cb119-208" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-209"><a href="sel-and-pred.html#cb119-209" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-210"><a href="sel-and-pred.html#cb119-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-211"><a href="sel-and-pred.html#cb119-211" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-212"><a href="sel-and-pred.html#cb119-212" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>,</span>
<span id="cb119-213"><a href="sel-and-pred.html#cb119-213" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-214"><a href="sel-and-pred.html#cb119-214" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-215"><a href="sel-and-pred.html#cb119-215" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-216"><a href="sel-and-pred.html#cb119-216" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-217"><a href="sel-and-pred.html#cb119-217" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb119-218"><a href="sel-and-pred.html#cb119-218" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-219"><a href="sel-and-pred.html#cb119-219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-220"><a href="sel-and-pred.html#cb119-220" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-221"><a href="sel-and-pred.html#cb119-221" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-222"><a href="sel-and-pred.html#cb119-222" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-223"><a href="sel-and-pred.html#cb119-223" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb119-224"><a href="sel-and-pred.html#cb119-224" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-225"><a href="sel-and-pred.html#cb119-225" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-226"><a href="sel-and-pred.html#cb119-226" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-227"><a href="sel-and-pred.html#cb119-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-228"><a href="sel-and-pred.html#cb119-228" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-229"><a href="sel-and-pred.html#cb119-229" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-230"><a href="sel-and-pred.html#cb119-230" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-231"><a href="sel-and-pred.html#cb119-231" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb119-232"><a href="sel-and-pred.html#cb119-232" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-233"><a href="sel-and-pred.html#cb119-233" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-234"><a href="sel-and-pred.html#cb119-234" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb119-235"><a href="sel-and-pred.html#cb119-235" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-236"><a href="sel-and-pred.html#cb119-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-237"><a href="sel-and-pred.html#cb119-237" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-238"><a href="sel-and-pred.html#cb119-238" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-239"><a href="sel-and-pred.html#cb119-239" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-240"><a href="sel-and-pred.html#cb119-240" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">0</span>,</span>
<span id="cb119-241"><a href="sel-and-pred.html#cb119-241" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-242"><a href="sel-and-pred.html#cb119-242" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-243"><a href="sel-and-pred.html#cb119-243" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-244"><a href="sel-and-pred.html#cb119-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-245"><a href="sel-and-pred.html#cb119-245" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-246"><a href="sel-and-pred.html#cb119-246" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-247"><a href="sel-and-pred.html#cb119-247" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-248"><a href="sel-and-pred.html#cb119-248" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">6</span>,</span>
<span id="cb119-249"><a href="sel-and-pred.html#cb119-249" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb119-250"><a href="sel-and-pred.html#cb119-250" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-251"><a href="sel-and-pred.html#cb119-251" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-252"><a href="sel-and-pred.html#cb119-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-253"><a href="sel-and-pred.html#cb119-253" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-254"><a href="sel-and-pred.html#cb119-254" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-255"><a href="sel-and-pred.html#cb119-255" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-256"><a href="sel-and-pred.html#cb119-256" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-257"><a href="sel-and-pred.html#cb119-257" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-258"><a href="sel-and-pred.html#cb119-258" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="st">&quot;4&quot;</span>,</span>
<span id="cb119-259"><a href="sel-and-pred.html#cb119-259" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-260"><a href="sel-and-pred.html#cb119-260" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb119-261"><a href="sel-and-pred.html#cb119-261" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-262"><a href="sel-and-pred.html#cb119-262" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-263"><a href="sel-and-pred.html#cb119-263" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-264"><a href="sel-and-pred.html#cb119-264" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-265"><a href="sel-and-pred.html#cb119-265" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-266"><a href="sel-and-pred.html#cb119-266" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-267"><a href="sel-and-pred.html#cb119-267" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="fl">3.5</span>,</span>
<span id="cb119-268"><a href="sel-and-pred.html#cb119-268" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-269"><a href="sel-and-pred.html#cb119-269" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb119-270"><a href="sel-and-pred.html#cb119-270" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-271"><a href="sel-and-pred.html#cb119-271" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-272"><a href="sel-and-pred.html#cb119-272" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-273"><a href="sel-and-pred.html#cb119-273" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-274"><a href="sel-and-pred.html#cb119-274" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-275"><a href="sel-and-pred.html#cb119-275" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb119-276"><a href="sel-and-pred.html#cb119-276" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb119-277"><a href="sel-and-pred.html#cb119-277" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-278"><a href="sel-and-pred.html#cb119-278" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb119-279"><a href="sel-and-pred.html#cb119-279" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-280"><a href="sel-and-pred.html#cb119-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-281"><a href="sel-and-pred.html#cb119-281" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb119-282"><a href="sel-and-pred.html#cb119-282" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb119-283"><a href="sel-and-pred.html#cb119-283" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb119-284"><a href="sel-and-pred.html#cb119-284" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb119-285"><a href="sel-and-pred.html#cb119-285" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">max_num_clusts=</span><span class="dv">8</span>,</span>
<span id="cb119-286"><a href="sel-and-pred.html#cb119-286" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">newx=</span>x_new),</span>
<span id="cb119-287"><a href="sel-and-pred.html#cb119-287" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb119-288"><a href="sel-and-pred.html#cb119-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-289"><a href="sel-and-pred.html#cb119-289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-290"><a href="sel-and-pred.html#cb119-290" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p>Tests for <code><a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>()</code></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="sel-and-pred.html#cb121-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;formCssDesign works&quot;</span>, {</span>
<span id="cb121-2"><a href="sel-and-pred.html#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">17230</span>)</span>
<span id="cb121-3"><a href="sel-and-pred.html#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="sel-and-pred.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb121-5"><a href="sel-and-pred.html#cb121-5" aria-hidden="true" tabindex="-1"></a>  x_new <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb121-6"><a href="sel-and-pred.html#cb121-6" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb121-7"><a href="sel-and-pred.html#cb121-7" aria-hidden="true" tabindex="-1"></a>  y_new <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb121-8"><a href="sel-and-pred.html#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="sel-and-pred.html#cb121-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb121-10"><a href="sel-and-pred.html#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="sel-and-pred.html#cb121-11" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb121-12"><a href="sel-and-pred.html#cb121-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb121-13"><a href="sel-and-pred.html#cb121-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-14"><a href="sel-and-pred.html#cb121-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_res, <span class="at">newx=</span>x_new)</span>
<span id="cb121-15"><a href="sel-and-pred.html#cb121-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-16"><a href="sel-and-pred.html#cb121-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb121-17"><a href="sel-and-pred.html#cb121-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb121-18"><a href="sel-and-pred.html#cb121-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">8</span>)</span>
<span id="cb121-19"><a href="sel-and-pred.html#cb121-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res<span class="sc">$</span>clusters))</span>
<span id="cb121-20"><a href="sel-and-pred.html#cb121-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res<span class="sc">$</span>clusters)))</span>
<span id="cb121-21"><a href="sel-and-pred.html#cb121-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb121-22"><a href="sel-and-pred.html#cb121-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-23"><a href="sel-and-pred.html#cb121-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb121-24"><a href="sel-and-pred.html#cb121-24" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb121-25"><a href="sel-and-pred.html#cb121-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb121-26"><a href="sel-and-pred.html#cb121-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-27"><a href="sel-and-pred.html#cb121-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb121-28"><a href="sel-and-pred.html#cb121-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-29"><a href="sel-and-pred.html#cb121-29" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_train, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb121-30"><a href="sel-and-pred.html#cb121-30" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb121-31"><a href="sel-and-pred.html#cb121-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">newx=</span>x_new)</span>
<span id="cb121-32"><a href="sel-and-pred.html#cb121-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-33"><a href="sel-and-pred.html#cb121-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb121-34"><a href="sel-and-pred.html#cb121-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb121-35"><a href="sel-and-pred.html#cb121-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">8</span>)</span>
<span id="cb121-36"><a href="sel-and-pred.html#cb121-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res_train<span class="sc">$</span>clusters))</span>
<span id="cb121-37"><a href="sel-and-pred.html#cb121-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters)))</span>
<span id="cb121-38"><a href="sel-and-pred.html#cb121-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb121-39"><a href="sel-and-pred.html#cb121-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-40"><a href="sel-and-pred.html#cb121-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb121-41"><a href="sel-and-pred.html#cb121-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-42"><a href="sel-and-pred.html#cb121-42" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_train, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb121-43"><a href="sel-and-pred.html#cb121-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>)</span>
<span id="cb121-44"><a href="sel-and-pred.html#cb121-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-45"><a href="sel-and-pred.html#cb121-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb121-46"><a href="sel-and-pred.html#cb121-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb121-47"><a href="sel-and-pred.html#cb121-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">5</span>)</span>
<span id="cb121-48"><a href="sel-and-pred.html#cb121-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res_train<span class="sc">$</span>clusters))</span>
<span id="cb121-49"><a href="sel-and-pred.html#cb121-49" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters)))</span>
<span id="cb121-50"><a href="sel-and-pred.html#cb121-50" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb121-51"><a href="sel-and-pred.html#cb121-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-52"><a href="sel-and-pred.html#cb121-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newx--should get error</span></span>
<span id="cb121-53"><a href="sel-and-pred.html#cb121-53" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb121-54"><a href="sel-and-pred.html#cb121-54" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cutoff=</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb121-55"><a href="sel-and-pred.html#cb121-55" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">newx=</span><span class="cn">NA</span>),</span>
<span id="cb121-56"><a href="sel-and-pred.html#cb121-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;If css was not provided with indices to set aside for model training, then newx must be provided to formCssDesign&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-57"><a href="sel-and-pred.html#cb121-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-58"><a href="sel-and-pred.html#cb121-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb121-59"><a href="sel-and-pred.html#cb121-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-60"><a href="sel-and-pred.html#cb121-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb121-61"><a href="sel-and-pred.html#cb121-61" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb121-62"><a href="sel-and-pred.html#cb121-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb121-63"><a href="sel-and-pred.html#cb121-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-64"><a href="sel-and-pred.html#cb121-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb121-65"><a href="sel-and-pred.html#cb121-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb121-66"><a href="sel-and-pred.html#cb121-66" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.9</span>,</span>
<span id="cb121-67"><a href="sel-and-pred.html#cb121-67" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb121-68"><a href="sel-and-pred.html#cb121-68" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">newx=</span>x_new),</span>
<span id="cb121-69"><a href="sel-and-pred.html#cb121-69" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-70"><a href="sel-and-pred.html#cb121-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-71"><a href="sel-and-pred.html#cb121-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb121-72"><a href="sel-and-pred.html#cb121-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb121-73"><a href="sel-and-pred.html#cb121-73" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb121-74"><a href="sel-and-pred.html#cb121-74" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb121-75"><a href="sel-and-pred.html#cb121-75" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb121-76"><a href="sel-and-pred.html#cb121-76" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-77"><a href="sel-and-pred.html#cb121-77" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb121-78"><a href="sel-and-pred.html#cb121-78" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-79"><a href="sel-and-pred.html#cb121-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-80"><a href="sel-and-pred.html#cb121-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb121-81"><a href="sel-and-pred.html#cb121-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-82"><a href="sel-and-pred.html#cb121-82" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb121-83"><a href="sel-and-pred.html#cb121-83" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.5</span>,</span>
<span id="cb121-84"><a href="sel-and-pred.html#cb121-84" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb121-85"><a href="sel-and-pred.html#cb121-85" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">newx=</span>x_new)</span>
<span id="cb121-86"><a href="sel-and-pred.html#cb121-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-87"><a href="sel-and-pred.html#cb121-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_named))</span>
<span id="cb121-88"><a href="sel-and-pred.html#cb121-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_named))</span>
<span id="cb121-89"><a href="sel-and-pred.html#cb121-89" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_named), <span class="dv">8</span>)</span>
<span id="cb121-90"><a href="sel-and-pred.html#cb121-90" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_named) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_named<span class="sc">$</span>clusters))</span>
<span id="cb121-91"><a href="sel-and-pred.html#cb121-91" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_named) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_named<span class="sc">$</span>clusters)))</span>
<span id="cb121-92"><a href="sel-and-pred.html#cb121-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-93"><a href="sel-and-pred.html#cb121-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and formCssDesign</span></span>
<span id="cb121-94"><a href="sel-and-pred.html#cb121-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-95"><a href="sel-and-pred.html#cb121-95" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb121-96"><a href="sel-and-pred.html#cb121-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-97"><a href="sel-and-pred.html#cb121-97" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb121-98"><a href="sel-and-pred.html#cb121-98" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb121-99"><a href="sel-and-pred.html#cb121-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-100"><a href="sel-and-pred.html#cb121-100" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb121-101"><a href="sel-and-pred.html#cb121-101" aria-hidden="true" tabindex="-1"></a>  fit_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, selec_inds)</span>
<span id="cb121-102"><a href="sel-and-pred.html#cb121-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-103"><a href="sel-and-pred.html#cb121-103" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb121-104"><a href="sel-and-pred.html#cb121-104" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_df, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb121-105"><a href="sel-and-pred.html#cb121-105" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cutoff=</span><span class="fl">0.7</span>, <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb121-106"><a href="sel-and-pred.html#cb121-106" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newx=</span>X_df[fit_inds, ])</span>
<span id="cb121-107"><a href="sel-and-pred.html#cb121-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-108"><a href="sel-and-pred.html#cb121-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df))</span>
<span id="cb121-109"><a href="sel-and-pred.html#cb121-109" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb121-110"><a href="sel-and-pred.html#cb121-110" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df), <span class="fu">length</span>(fit_inds))</span>
<span id="cb121-111"><a href="sel-and-pred.html#cb121-111" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_df) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_df<span class="sc">$</span>clusters))</span>
<span id="cb121-112"><a href="sel-and-pred.html#cb121-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_df) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_df<span class="sc">$</span>clusters)))</span>
<span id="cb121-113"><a href="sel-and-pred.html#cb121-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-114"><a href="sel-and-pred.html#cb121-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb121-115"><a href="sel-and-pred.html#cb121-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb121-116"><a href="sel-and-pred.html#cb121-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb121-117"><a href="sel-and-pred.html#cb121-117" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb121-118"><a href="sel-and-pred.html#cb121-118" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb121-119"><a href="sel-and-pred.html#cb121-119" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb121-120"><a href="sel-and-pred.html#cb121-120" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb121-121"><a href="sel-and-pred.html#cb121-121" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb121-122"><a href="sel-and-pred.html#cb121-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-123"><a href="sel-and-pred.html#cb121-123" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb121-124"><a href="sel-and-pred.html#cb121-124" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res_df, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb121-125"><a href="sel-and-pred.html#cb121-125" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cutoff=</span><span class="fl">0.3</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">4</span>,</span>
<span id="cb121-126"><a href="sel-and-pred.html#cb121-126" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newx=</span>X_df[fit_inds, ])</span>
<span id="cb121-127"><a href="sel-and-pred.html#cb121-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-128"><a href="sel-and-pred.html#cb121-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df))</span>
<span id="cb121-129"><a href="sel-and-pred.html#cb121-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb121-130"><a href="sel-and-pred.html#cb121-130" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df), <span class="fu">length</span>(fit_inds))</span>
<span id="cb121-131"><a href="sel-and-pred.html#cb121-131" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_df) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_df<span class="sc">$</span>clusters))</span>
<span id="cb121-132"><a href="sel-and-pred.html#cb121-132" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_df) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_df<span class="sc">$</span>clusters)))</span>
<span id="cb121-133"><a href="sel-and-pred.html#cb121-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-134"><a href="sel-and-pred.html#cb121-134" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Try other bad inputs</span></span>
<span id="cb121-135"><a href="sel-and-pred.html#cb121-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-136"><a href="sel-and-pred.html#cb121-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb121-137"><a href="sel-and-pred.html#cb121-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-138"><a href="sel-and-pred.html#cb121-138" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">cutoff=</span><span class="sc">-</span><span class="fl">0.3</span>,</span>
<span id="cb121-139"><a href="sel-and-pred.html#cb121-139" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new), <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>,</span>
<span id="cb121-140"><a href="sel-and-pred.html#cb121-140" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-141"><a href="sel-and-pred.html#cb121-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-142"><a href="sel-and-pred.html#cb121-142" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">cutoff=</span><span class="st">&quot;0.5&quot;</span>,</span>
<span id="cb121-143"><a href="sel-and-pred.html#cb121-143" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-144"><a href="sel-and-pred.html#cb121-144" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb121-145"><a href="sel-and-pred.html#cb121-145" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-146"><a href="sel-and-pred.html#cb121-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-147"><a href="sel-and-pred.html#cb121-147" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb121-148"><a href="sel-and-pred.html#cb121-148" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cutoff=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">newx=</span>x_new),</span>
<span id="cb121-149"><a href="sel-and-pred.html#cb121-149" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-150"><a href="sel-and-pred.html#cb121-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-151"><a href="sel-and-pred.html#cb121-151" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb121-152"><a href="sel-and-pred.html#cb121-152" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weighting=</span><span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>),</span>
<span id="cb121-153"><a href="sel-and-pred.html#cb121-153" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-154"><a href="sel-and-pred.html#cb121-154" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-155"><a href="sel-and-pred.html#cb121-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-156"><a href="sel-and-pred.html#cb121-156" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="dv">1</span>,</span>
<span id="cb121-157"><a href="sel-and-pred.html#cb121-157" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-158"><a href="sel-and-pred.html#cb121-158" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-159"><a href="sel-and-pred.html#cb121-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-160"><a href="sel-and-pred.html#cb121-160" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>,</span>
<span id="cb121-161"><a href="sel-and-pred.html#cb121-161" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-162"><a href="sel-and-pred.html#cb121-162" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb121-163"><a href="sel-and-pred.html#cb121-163" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-164"><a href="sel-and-pred.html#cb121-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-165"><a href="sel-and-pred.html#cb121-165" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb121-166"><a href="sel-and-pred.html#cb121-166" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">min_num_clusts=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">newx=</span>x_new),</span>
<span id="cb121-167"><a href="sel-and-pred.html#cb121-167" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-168"><a href="sel-and-pred.html#cb121-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-169"><a href="sel-and-pred.html#cb121-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb121-170"><a href="sel-and-pred.html#cb121-170" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-171"><a href="sel-and-pred.html#cb121-171" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb121-172"><a href="sel-and-pred.html#cb121-172" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-173"><a href="sel-and-pred.html#cb121-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-174"><a href="sel-and-pred.html#cb121-174" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">0</span>,</span>
<span id="cb121-175"><a href="sel-and-pred.html#cb121-175" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-176"><a href="sel-and-pred.html#cb121-176" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-177"><a href="sel-and-pred.html#cb121-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-178"><a href="sel-and-pred.html#cb121-178" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">6</span>,</span>
<span id="cb121-179"><a href="sel-and-pred.html#cb121-179" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-180"><a href="sel-and-pred.html#cb121-180" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-181"><a href="sel-and-pred.html#cb121-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-182"><a href="sel-and-pred.html#cb121-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-183"><a href="sel-and-pred.html#cb121-183" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="st">&quot;4&quot;</span>,</span>
<span id="cb121-184"><a href="sel-and-pred.html#cb121-184" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-185"><a href="sel-and-pred.html#cb121-185" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb121-186"><a href="sel-and-pred.html#cb121-186" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-187"><a href="sel-and-pred.html#cb121-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-188"><a href="sel-and-pred.html#cb121-188" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="fl">3.5</span>,</span>
<span id="cb121-189"><a href="sel-and-pred.html#cb121-189" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-190"><a href="sel-and-pred.html#cb121-190" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb121-191"><a href="sel-and-pred.html#cb121-191" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-192"><a href="sel-and-pred.html#cb121-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-193"><a href="sel-and-pred.html#cb121-193" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb121-194"><a href="sel-and-pred.html#cb121-194" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">max_num_clusts=</span><span class="dv">1</span>, <span class="at">newx=</span>x_new),</span>
<span id="cb121-195"><a href="sel-and-pred.html#cb121-195" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb121-196"><a href="sel-and-pred.html#cb121-196" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-197"><a href="sel-and-pred.html#cb121-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-198"><a href="sel-and-pred.html#cb121-198" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="dv">8</span>,</span>
<span id="cb121-199"><a href="sel-and-pred.html#cb121-199" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newx=</span>x_new),</span>
<span id="cb121-200"><a href="sel-and-pred.html#cb121-200" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb121-201"><a href="sel-and-pred.html#cb121-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-202"><a href="sel-and-pred.html#cb121-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb121-203"><a href="sel-and-pred.html#cb121-203" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Test passed ðŸ¥‡</code></pre>
<p>Finally, tests for <code><a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>()</code></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="sel-and-pred.html#cb123-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getCssDesign works&quot;</span>, {</span>
<span id="cb123-2"><a href="sel-and-pred.html#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">23170</span>)</span>
<span id="cb123-3"><a href="sel-and-pred.html#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="sel-and-pred.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb123-5"><a href="sel-and-pred.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  x_new <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb123-6"><a href="sel-and-pred.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb123-7"><a href="sel-and-pred.html#cb123-7" aria-hidden="true" tabindex="-1"></a>  y_new <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb123-8"><a href="sel-and-pred.html#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="sel-and-pred.html#cb123-9" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb123-10"><a href="sel-and-pred.html#cb123-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-11"><a href="sel-and-pred.html#cb123-11" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb123-12"><a href="sel-and-pred.html#cb123-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb123-13"><a href="sel-and-pred.html#cb123-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-14"><a href="sel-and-pred.html#cb123-14" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(css_res, <span class="at">newX=</span>x_new)</span>
<span id="cb123-15"><a href="sel-and-pred.html#cb123-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-16"><a href="sel-and-pred.html#cb123-16" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb123-17"><a href="sel-and-pred.html#cb123-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb123-18"><a href="sel-and-pred.html#cb123-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">8</span>)</span>
<span id="cb123-19"><a href="sel-and-pred.html#cb123-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res<span class="sc">$</span>clusters))</span>
<span id="cb123-20"><a href="sel-and-pred.html#cb123-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res<span class="sc">$</span>clusters)))</span>
<span id="cb123-21"><a href="sel-and-pred.html#cb123-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb123-22"><a href="sel-and-pred.html#cb123-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-23"><a href="sel-and-pred.html#cb123-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb123-24"><a href="sel-and-pred.html#cb123-24" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb123-25"><a href="sel-and-pred.html#cb123-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb123-26"><a href="sel-and-pred.html#cb123-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-27"><a href="sel-and-pred.html#cb123-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb123-28"><a href="sel-and-pred.html#cb123-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-29"><a href="sel-and-pred.html#cb123-29" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_train, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb123-30"><a href="sel-and-pred.html#cb123-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">newX=</span>x_new)</span>
<span id="cb123-31"><a href="sel-and-pred.html#cb123-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-32"><a href="sel-and-pred.html#cb123-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb123-33"><a href="sel-and-pred.html#cb123-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb123-34"><a href="sel-and-pred.html#cb123-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">8</span>)</span>
<span id="cb123-35"><a href="sel-and-pred.html#cb123-35" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res_train<span class="sc">$</span>clusters))</span>
<span id="cb123-36"><a href="sel-and-pred.html#cb123-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters)))</span>
<span id="cb123-37"><a href="sel-and-pred.html#cb123-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb123-38"><a href="sel-and-pred.html#cb123-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-39"><a href="sel-and-pred.html#cb123-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb123-40"><a href="sel-and-pred.html#cb123-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-41"><a href="sel-and-pred.html#cb123-41" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_train, <span class="at">min_num_clusts=</span><span class="dv">2</span>)</span>
<span id="cb123-42"><a href="sel-and-pred.html#cb123-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-43"><a href="sel-and-pred.html#cb123-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res))</span>
<span id="cb123-44"><a href="sel-and-pred.html#cb123-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb123-45"><a href="sel-and-pred.html#cb123-45" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res), <span class="dv">5</span>)</span>
<span id="cb123-46"><a href="sel-and-pred.html#cb123-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res), <span class="fu">length</span>(css_res_train<span class="sc">$</span>clusters))</span>
<span id="cb123-47"><a href="sel-and-pred.html#cb123-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters)))</span>
<span id="cb123-48"><a href="sel-and-pred.html#cb123-48" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">names</span>(css_res_train<span class="sc">$</span>clusters) <span class="sc">%in%</span> <span class="fu">colnames</span>(res)))</span>
<span id="cb123-49"><a href="sel-and-pred.html#cb123-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-50"><a href="sel-and-pred.html#cb123-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newX--should get error</span></span>
<span id="cb123-51"><a href="sel-and-pred.html#cb123-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb123-52"><a href="sel-and-pred.html#cb123-52" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cutoff=</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb123-53"><a href="sel-and-pred.html#cb123-53" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">max_num_clusts=</span><span class="dv">5</span>, <span class="at">newX=</span><span class="cn">NA</span>),</span>
<span id="cb123-54"><a href="sel-and-pred.html#cb123-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide new X in order to generate a design matrix&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-55"><a href="sel-and-pred.html#cb123-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-56"><a href="sel-and-pred.html#cb123-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb123-57"><a href="sel-and-pred.html#cb123-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-58"><a href="sel-and-pred.html#cb123-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb123-59"><a href="sel-and-pred.html#cb123-59" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb123-60"><a href="sel-and-pred.html#cb123-60" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb123-61"><a href="sel-and-pred.html#cb123-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-62"><a href="sel-and-pred.html#cb123-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb123-63"><a href="sel-and-pred.html#cb123-63" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb123-64"><a href="sel-and-pred.html#cb123-64" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.9</span>,</span>
<span id="cb123-65"><a href="sel-and-pred.html#cb123-65" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb123-66"><a href="sel-and-pred.html#cb123-66" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">newX=</span>x_new),</span>
<span id="cb123-67"><a href="sel-and-pred.html#cb123-67" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-68"><a href="sel-and-pred.html#cb123-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-69"><a href="sel-and-pred.html#cb123-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb123-70"><a href="sel-and-pred.html#cb123-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb123-71"><a href="sel-and-pred.html#cb123-71" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_named,</span>
<span id="cb123-72"><a href="sel-and-pred.html#cb123-72" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.2</span>,</span>
<span id="cb123-73"><a href="sel-and-pred.html#cb123-73" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb123-74"><a href="sel-and-pred.html#cb123-74" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">newX=</span>x_new),</span>
<span id="cb123-75"><a href="sel-and-pred.html#cb123-75" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb123-76"><a href="sel-and-pred.html#cb123-76" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-77"><a href="sel-and-pred.html#cb123-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-78"><a href="sel-and-pred.html#cb123-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb123-79"><a href="sel-and-pred.html#cb123-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-80"><a href="sel-and-pred.html#cb123-80" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_named, <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb123-81"><a href="sel-and-pred.html#cb123-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cutoff=</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">2</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb123-82"><a href="sel-and-pred.html#cb123-82" aria-hidden="true" tabindex="-1"></a>                            <span class="at">newX=</span>x_new)</span>
<span id="cb123-83"><a href="sel-and-pred.html#cb123-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-84"><a href="sel-and-pred.html#cb123-84" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_named))</span>
<span id="cb123-85"><a href="sel-and-pred.html#cb123-85" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_named))</span>
<span id="cb123-86"><a href="sel-and-pred.html#cb123-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_named), <span class="dv">8</span>)</span>
<span id="cb123-87"><a href="sel-and-pred.html#cb123-87" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_named) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_named<span class="sc">$</span>clusters))</span>
<span id="cb123-88"><a href="sel-and-pred.html#cb123-88" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_named) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_named<span class="sc">$</span>clusters)))</span>
<span id="cb123-89"><a href="sel-and-pred.html#cb123-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-90"><a href="sel-and-pred.html#cb123-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and getCssDesign</span></span>
<span id="cb123-91"><a href="sel-and-pred.html#cb123-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-92"><a href="sel-and-pred.html#cb123-92" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb123-93"><a href="sel-and-pred.html#cb123-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-94"><a href="sel-and-pred.html#cb123-94" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb123-95"><a href="sel-and-pred.html#cb123-95" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb123-96"><a href="sel-and-pred.html#cb123-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-97"><a href="sel-and-pred.html#cb123-97" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb123-98"><a href="sel-and-pred.html#cb123-98" aria-hidden="true" tabindex="-1"></a>  fit_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, selec_inds)</span>
<span id="cb123-99"><a href="sel-and-pred.html#cb123-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-100"><a href="sel-and-pred.html#cb123-100" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb123-101"><a href="sel-and-pred.html#cb123-101" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_df, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb123-102"><a href="sel-and-pred.html#cb123-102" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cutoff=</span><span class="fl">0.7</span>, <span class="at">min_num_clusts=</span><span class="dv">3</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb123-103"><a href="sel-and-pred.html#cb123-103" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newX=</span>X_df[fit_inds, ])</span>
<span id="cb123-104"><a href="sel-and-pred.html#cb123-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-105"><a href="sel-and-pred.html#cb123-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df))</span>
<span id="cb123-106"><a href="sel-and-pred.html#cb123-106" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb123-107"><a href="sel-and-pred.html#cb123-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df), <span class="fu">length</span>(fit_inds))</span>
<span id="cb123-108"><a href="sel-and-pred.html#cb123-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_df) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_df<span class="sc">$</span>clusters))</span>
<span id="cb123-109"><a href="sel-and-pred.html#cb123-109" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_df) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_df<span class="sc">$</span>clusters)))</span>
<span id="cb123-110"><a href="sel-and-pred.html#cb123-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-111"><a href="sel-and-pred.html#cb123-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb123-112"><a href="sel-and-pred.html#cb123-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb123-113"><a href="sel-and-pred.html#cb123-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb123-114"><a href="sel-and-pred.html#cb123-114" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb123-115"><a href="sel-and-pred.html#cb123-115" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb123-116"><a href="sel-and-pred.html#cb123-116" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb123-117"><a href="sel-and-pred.html#cb123-117" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb123-118"><a href="sel-and-pred.html#cb123-118" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb123-119"><a href="sel-and-pred.html#cb123-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-120"><a href="sel-and-pred.html#cb123-120" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb123-121"><a href="sel-and-pred.html#cb123-121" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res_df, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb123-122"><a href="sel-and-pred.html#cb123-122" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cutoff=</span><span class="fl">0.3</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">4</span>,</span>
<span id="cb123-123"><a href="sel-and-pred.html#cb123-123" aria-hidden="true" tabindex="-1"></a>                         <span class="at">newX=</span>X_df[fit_inds, ])</span>
<span id="cb123-124"><a href="sel-and-pred.html#cb123-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-125"><a href="sel-and-pred.html#cb123-125" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df))</span>
<span id="cb123-126"><a href="sel-and-pred.html#cb123-126" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb123-127"><a href="sel-and-pred.html#cb123-127" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df), <span class="fu">length</span>(fit_inds))</span>
<span id="cb123-128"><a href="sel-and-pred.html#cb123-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">ncol</span>(res_df) <span class="sc">&lt;=</span> <span class="fu">length</span>(css_res_df<span class="sc">$</span>clusters))</span>
<span id="cb123-129"><a href="sel-and-pred.html#cb123-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(res_df) <span class="sc">%in%</span> <span class="fu">names</span>(css_res_df<span class="sc">$</span>clusters)))</span>
<span id="cb123-130"><a href="sel-and-pred.html#cb123-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-131"><a href="sel-and-pred.html#cb123-131" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Try other bad inputs</span></span>
<span id="cb123-132"><a href="sel-and-pred.html#cb123-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-133"><a href="sel-and-pred.html#cb123-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_new) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb123-134"><a href="sel-and-pred.html#cb123-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-135"><a href="sel-and-pred.html#cb123-135" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">cutoff=</span><span class="sc">-</span><span class="fl">0.3</span>,</span>
<span id="cb123-136"><a href="sel-and-pred.html#cb123-136" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new), <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>,</span>
<span id="cb123-137"><a href="sel-and-pred.html#cb123-137" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-138"><a href="sel-and-pred.html#cb123-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-139"><a href="sel-and-pred.html#cb123-139" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">cutoff=</span><span class="st">&quot;0.5&quot;</span>,</span>
<span id="cb123-140"><a href="sel-and-pred.html#cb123-140" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-141"><a href="sel-and-pred.html#cb123-141" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb123-142"><a href="sel-and-pred.html#cb123-142" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-143"><a href="sel-and-pred.html#cb123-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-144"><a href="sel-and-pred.html#cb123-144" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb123-145"><a href="sel-and-pred.html#cb123-145" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">cutoff=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">newX=</span>x_new),</span>
<span id="cb123-146"><a href="sel-and-pred.html#cb123-146" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-147"><a href="sel-and-pred.html#cb123-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-148"><a href="sel-and-pred.html#cb123-148" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb123-149"><a href="sel-and-pred.html#cb123-149" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weighting=</span><span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>),</span>
<span id="cb123-150"><a href="sel-and-pred.html#cb123-150" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-151"><a href="sel-and-pred.html#cb123-151" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-152"><a href="sel-and-pred.html#cb123-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-153"><a href="sel-and-pred.html#cb123-153" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="dv">1</span>,</span>
<span id="cb123-154"><a href="sel-and-pred.html#cb123-154" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-155"><a href="sel-and-pred.html#cb123-155" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-156"><a href="sel-and-pred.html#cb123-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-157"><a href="sel-and-pred.html#cb123-157" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>,</span>
<span id="cb123-158"><a href="sel-and-pred.html#cb123-158" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-159"><a href="sel-and-pred.html#cb123-159" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb123-160"><a href="sel-and-pred.html#cb123-160" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-161"><a href="sel-and-pred.html#cb123-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-162"><a href="sel-and-pred.html#cb123-162" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res,</span>
<span id="cb123-163"><a href="sel-and-pred.html#cb123-163" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">min_num_clusts=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">newX=</span>x_new),</span>
<span id="cb123-164"><a href="sel-and-pred.html#cb123-164" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-165"><a href="sel-and-pred.html#cb123-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-166"><a href="sel-and-pred.html#cb123-166" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="st">&quot;3&quot;</span>,</span>
<span id="cb123-167"><a href="sel-and-pred.html#cb123-167" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-168"><a href="sel-and-pred.html#cb123-168" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb123-169"><a href="sel-and-pred.html#cb123-169" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-170"><a href="sel-and-pred.html#cb123-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-171"><a href="sel-and-pred.html#cb123-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">0</span>,</span>
<span id="cb123-172"><a href="sel-and-pred.html#cb123-172" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-173"><a href="sel-and-pred.html#cb123-173" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-174"><a href="sel-and-pred.html#cb123-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-175"><a href="sel-and-pred.html#cb123-175" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">6</span>,</span>
<span id="cb123-176"><a href="sel-and-pred.html#cb123-176" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-177"><a href="sel-and-pred.html#cb123-177" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= n_clusters is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-178"><a href="sel-and-pred.html#cb123-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-179"><a href="sel-and-pred.html#cb123-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-180"><a href="sel-and-pred.html#cb123-180" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="st">&quot;4&quot;</span>,</span>
<span id="cb123-181"><a href="sel-and-pred.html#cb123-181" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-182"><a href="sel-and-pred.html#cb123-182" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb123-183"><a href="sel-and-pred.html#cb123-183" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-184"><a href="sel-and-pred.html#cb123-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-185"><a href="sel-and-pred.html#cb123-185" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="fl">3.5</span>,</span>
<span id="cb123-186"><a href="sel-and-pred.html#cb123-186" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-187"><a href="sel-and-pred.html#cb123-187" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb123-188"><a href="sel-and-pred.html#cb123-188" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-189"><a href="sel-and-pred.html#cb123-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-190"><a href="sel-and-pred.html#cb123-190" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">min_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb123-191"><a href="sel-and-pred.html#cb123-191" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">max_num_clusts=</span><span class="dv">1</span>, <span class="at">newX=</span>x_new),</span>
<span id="cb123-192"><a href="sel-and-pred.html#cb123-192" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb123-193"><a href="sel-and-pred.html#cb123-193" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-194"><a href="sel-and-pred.html#cb123-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-195"><a href="sel-and-pred.html#cb123-195" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(<span class="at">css_results=</span>css_res, <span class="at">max_num_clusts=</span><span class="dv">8</span>,</span>
<span id="cb123-196"><a href="sel-and-pred.html#cb123-196" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newX=</span>x_new),</span>
<span id="cb123-197"><a href="sel-and-pred.html#cb123-197" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb123-198"><a href="sel-and-pred.html#cb123-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-199"><a href="sel-and-pred.html#cb123-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-200"><a href="sel-and-pred.html#cb123-200" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## â”€â”€ Warning (&#39;&lt;text&gt;:63&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. testthat::expect_warning(...)
##  7. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  8. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:63&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##   1. testthat::expect_warning(...)
##   7. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##   8. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##   9. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  10. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:80&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:80&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##  3. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  4. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:101&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:101&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##  3. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  4. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:121&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:121&#39;): getCssDesign works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssDesign'>getCssDesign</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##  3. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  4. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)</code></pre>
<p><code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code></p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="sel-and-pred.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Fit model and generate predictions from new data</span></span>
<span id="cb125-2"><a href="sel-and-pred.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb125-3"><a href="sel-and-pred.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Generate predictions on test data using cluster stability-selected model.</span></span>
<span id="cb125-4"><a href="sel-and-pred.html#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb125-5"><a href="sel-and-pred.html#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb125-6"><a href="sel-and-pred.html#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param testX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb125-7"><a href="sel-and-pred.html#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb125-8"><a href="sel-and-pred.html#cb125-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate predictions. Must contain the same</span></span>
<span id="cb125-9"><a href="sel-and-pred.html#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features (in the same number of columns) as the matrix provided to css, and</span></span>
<span id="cb125-10"><a href="sel-and-pred.html#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; if the columns of testX are labeled, the names must match the variable names</span></span>
<span id="cb125-11"><a href="sel-and-pred.html#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to css.</span></span>
<span id="cb125-12"><a href="sel-and-pred.html#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb125-13"><a href="sel-and-pred.html#cb125-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb125-14"><a href="sel-and-pred.html#cb125-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb125-15"><a href="sel-and-pred.html#cb125-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is put on the most frequently</span></span>
<span id="cb125-16"><a href="sel-and-pred.html#cb125-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb125-17"><a href="sel-and-pred.html#cb125-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb125-18"><a href="sel-and-pred.html#cb125-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, the weight used for each cluster member is calculated in</span></span>
<span id="cb125-19"><a href="sel-and-pred.html#cb125-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportion to the individual selection proportions of each feature. For</span></span>
<span id="cb125-20"><a href="sel-and-pred.html#cb125-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb125-21"><a href="sel-and-pred.html#cb125-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, the cluster representative</span></span>
<span id="cb125-22"><a href="sel-and-pred.html#cb125-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is just a simple average of all the cluster members). See Faletto and Bien</span></span>
<span id="cb125-23"><a href="sel-and-pred.html#cb125-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2022) for details. Default is &quot;weighted_avg&quot;.</span></span>
<span id="cb125-24"><a href="sel-and-pred.html#cb125-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; getCssPreds will make use only of those clusters with</span></span>
<span id="cb125-25"><a href="sel-and-pred.html#cb125-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportions equal to at least cutoff. Must be between 0 and 1.</span></span>
<span id="cb125-26"><a href="sel-and-pred.html#cb125-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0 (in which case either all clusters are used, or max_num_clusts</span></span>
<span id="cb125-27"><a href="sel-and-pred.html#cb125-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; are used, if max_num_clusts is specified).</span></span>
<span id="cb125-28"><a href="sel-and-pred.html#cb125-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb125-29"><a href="sel-and-pred.html#cb125-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb125-30"><a href="sel-and-pred.html#cb125-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb125-31"><a href="sel-and-pred.html#cb125-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb125-32"><a href="sel-and-pred.html#cb125-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb125-33"><a href="sel-and-pred.html#cb125-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb125-34"><a href="sel-and-pred.html#cb125-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb125-35"><a href="sel-and-pred.html#cb125-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb125-36"><a href="sel-and-pred.html#cb125-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb125-37"><a href="sel-and-pred.html#cb125-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param trainX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb125-38"><a href="sel-and-pred.html#cb125-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb125-39"><a href="sel-and-pred.html#cb125-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to estimate the linear model from the selected</span></span>
<span id="cb125-40"><a href="sel-and-pred.html#cb125-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters. trainX is only necessary to provide if no train_inds were</span></span>
<span id="cb125-41"><a href="sel-and-pred.html#cb125-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; designated in the css function call to set aside observations for model</span></span>
<span id="cb125-42"><a href="sel-and-pred.html#cb125-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; estimation (though even if train_inds was provided, trainX and trianY will be</span></span>
<span id="cb125-43"><a href="sel-and-pred.html#cb125-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; used for model estimation if they are both provided to getCssPreds). Must </span></span>
<span id="cb125-44"><a href="sel-and-pred.html#cb125-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; contain the same features (in the same number of columns) as the matrix </span></span>
<span id="cb125-45"><a href="sel-and-pred.html#cb125-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to css, and if the columns of trainX are labeled, the names must</span></span>
<span id="cb125-46"><a href="sel-and-pred.html#cb125-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; match the variable names provided to css. Default is NA (in which case</span></span>
<span id="cb125-47"><a href="sel-and-pred.html#cb125-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; getCssPreds uses the observations from the train_inds that were provided to</span></span>
<span id="cb125-48"><a href="sel-and-pred.html#cb125-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css to estimate a linear model).</span></span>
<span id="cb125-49"><a href="sel-and-pred.html#cb125-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param trainY The response corresponding to trainX. Must be a real-valued</span></span>
<span id="cb125-50"><a href="sel-and-pred.html#cb125-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response (unlike in the general css setup) because predictions will be</span></span>
<span id="cb125-51"><a href="sel-and-pred.html#cb125-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated by an ordinary least squares model. Must have the same length as</span></span>
<span id="cb125-52"><a href="sel-and-pred.html#cb125-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the number of rows of trainX. Like trainX, only needs to be provided if no</span></span>
<span id="cb125-53"><a href="sel-and-pred.html#cb125-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations were set aside for model estimation by the parameter train_inds</span></span>
<span id="cb125-54"><a href="sel-and-pred.html#cb125-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the css function call. Default is NA (in which case getCssPreds uses the</span></span>
<span id="cb125-55"><a href="sel-and-pred.html#cb125-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations from the train_inds that were provided to css).</span></span>
<span id="cb125-56"><a href="sel-and-pred.html#cb125-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A vector of predictions corresponding to the observations from testX.</span></span>
<span id="cb125-57"><a href="sel-and-pred.html#cb125-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb125-58"><a href="sel-and-pred.html#cb125-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references </span></span>
<span id="cb125-59"><a href="sel-and-pred.html#cb125-59" aria-hidden="true" tabindex="-1"></a><a href='index.html#faletto2022'>&lt;&lt;faletto2022&gt;&gt;</a></span>
<span id="cb125-60"><a href="sel-and-pred.html#cb125-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb125-61"><a href="sel-and-pred.html#cb125-61" aria-hidden="true" tabindex="-1"></a><span id='getCssPreds'>getCssPreds</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, testX, <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb125-62"><a href="sel-and-pred.html#cb125-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">trainX=</span><span class="cn">NA</span>, <span class="at">trainY=</span><span class="cn">NA</span>){</span>
<span id="cb125-63"><a href="sel-and-pred.html#cb125-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto) Consider adding an argument for a user-provided prediction</span></span>
<span id="cb125-64"><a href="sel-and-pred.html#cb125-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># function in order to allow for more general kinds of predictions than</span></span>
<span id="cb125-65"><a href="sel-and-pred.html#cb125-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OLS.</span></span>
<span id="cb125-66"><a href="sel-and-pred.html#cb125-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-67"><a href="sel-and-pred.html#cb125-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb125-68"><a href="sel-and-pred.html#cb125-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-69"><a href="sel-and-pred.html#cb125-69" aria-hidden="true" tabindex="-1"></a>    check_list <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_results, testX, weighting, cutoff,</span>
<span id="cb125-70"><a href="sel-and-pred.html#cb125-70" aria-hidden="true" tabindex="-1"></a>        min_num_clusts, max_num_clusts, trainX, trainY)</span>
<span id="cb125-71"><a href="sel-and-pred.html#cb125-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-72"><a href="sel-and-pred.html#cb125-72" aria-hidden="true" tabindex="-1"></a>    trainXProvided <span class="ot">&lt;-</span> check_list<span class="sc">$</span>trainXProvided</span>
<span id="cb125-73"><a href="sel-and-pred.html#cb125-73" aria-hidden="true" tabindex="-1"></a>    trainX <span class="ot">&lt;-</span> check_list<span class="sc">$</span>trainX</span>
<span id="cb125-74"><a href="sel-and-pred.html#cb125-74" aria-hidden="true" tabindex="-1"></a>    testX <span class="ot">&lt;-</span> check_list<span class="sc">$</span>testX</span>
<span id="cb125-75"><a href="sel-and-pred.html#cb125-75" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> check_list<span class="sc">$</span>feat_names</span>
<span id="cb125-76"><a href="sel-and-pred.html#cb125-76" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> check_list<span class="sc">$</span>max_num_clusts</span>
<span id="cb125-77"><a href="sel-and-pred.html#cb125-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-78"><a href="sel-and-pred.html#cb125-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(check_list)</span>
<span id="cb125-79"><a href="sel-and-pred.html#cb125-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-80"><a href="sel-and-pred.html#cb125-80" aria-hidden="true" tabindex="-1"></a>    n_train <span class="ot">&lt;-</span> <span class="fu">nrow</span>(trainX)</span>
<span id="cb125-81"><a href="sel-and-pred.html#cb125-81" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(testX)</span>
<span id="cb125-82"><a href="sel-and-pred.html#cb125-82" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(testX)</span>
<span id="cb125-83"><a href="sel-and-pred.html#cb125-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-84"><a href="sel-and-pred.html#cb125-84" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Take provided training design matrix and testX and turn them into</span></span>
<span id="cb125-85"><a href="sel-and-pred.html#cb125-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># matrices of cluster representatives using information from css_results</span></span>
<span id="cb125-86"><a href="sel-and-pred.html#cb125-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(trainXProvided){</span>
<span id="cb125-87"><a href="sel-and-pred.html#cb125-87" aria-hidden="true" tabindex="-1"></a>        train_X_clusters <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_results, weighting, cutoff,</span>
<span id="cb125-88"><a href="sel-and-pred.html#cb125-88" aria-hidden="true" tabindex="-1"></a>            min_num_clusts, max_num_clusts, <span class="at">newx=</span>trainX)</span>
<span id="cb125-89"><a href="sel-and-pred.html#cb125-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(trainY) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(trainY)){</span>
<span id="cb125-90"><a href="sel-and-pred.html#cb125-90" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;The provided trainY must be real-valued, because predictions will be generated by ordinary least squares regression.&quot;</span>)</span>
<span id="cb125-91"><a href="sel-and-pred.html#cb125-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb125-92"><a href="sel-and-pred.html#cb125-92" aria-hidden="true" tabindex="-1"></a>        y_train <span class="ot">&lt;-</span> trainY</span>
<span id="cb125-93"><a href="sel-and-pred.html#cb125-93" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb125-94"><a href="sel-and-pred.html#cb125-94" aria-hidden="true" tabindex="-1"></a>        train_X_clusters <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_results, weighting, cutoff,</span>
<span id="cb125-95"><a href="sel-and-pred.html#cb125-95" aria-hidden="true" tabindex="-1"></a>            min_num_clusts, max_num_clusts)</span>
<span id="cb125-96"><a href="sel-and-pred.html#cb125-96" aria-hidden="true" tabindex="-1"></a>        y_train <span class="ot">&lt;-</span> css_results<span class="sc">$</span>y[css_results<span class="sc">$</span>train_inds]</span>
<span id="cb125-97"><a href="sel-and-pred.html#cb125-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(y_train) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.integer</span>(y_train)){</span>
<span id="cb125-98"><a href="sel-and-pred.html#cb125-98" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;Can&#39;t generated predictions from the data that was provided to css because the provided y was not real-valued (getCssPreds generated predictions using ordinary least squares regression).&quot;</span>)</span>
<span id="cb125-99"><a href="sel-and-pred.html#cb125-99" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb125-100"><a href="sel-and-pred.html#cb125-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-101"><a href="sel-and-pred.html#cb125-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-102"><a href="sel-and-pred.html#cb125-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(y_train) <span class="sc">==</span> <span class="fu">nrow</span>(train_X_clusters))</span>
<span id="cb125-103"><a href="sel-and-pred.html#cb125-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-104"><a href="sel-and-pred.html#cb125-104" aria-hidden="true" tabindex="-1"></a>    testX_clusters <span class="ot">&lt;-</span> <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(css_results, weighting, cutoff,</span>
<span id="cb125-105"><a href="sel-and-pred.html#cb125-105" aria-hidden="true" tabindex="-1"></a>        min_num_clusts, max_num_clusts, <span class="at">newx=</span>testX)</span>
<span id="cb125-106"><a href="sel-and-pred.html#cb125-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-107"><a href="sel-and-pred.html#cb125-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">ncol</span>(testX_clusters) <span class="sc">==</span> <span class="fu">ncol</span>(train_X_clusters))</span>
<span id="cb125-108"><a href="sel-and-pred.html#cb125-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-109"><a href="sel-and-pred.html#cb125-109" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get names for clusters</span></span>
<span id="cb125-110"><a href="sel-and-pred.html#cb125-110" aria-hidden="true" tabindex="-1"></a>    clust_X_names <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;c_fit_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(testX_clusters), <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb125-111"><a href="sel-and-pred.html#cb125-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(train_X_clusters))){</span>
<span id="cb125-112"><a href="sel-and-pred.html#cb125-112" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">identical</span>(<span class="fu">colnames</span>(train_X_clusters), <span class="fu">colnames</span>(testX_clusters)))</span>
<span id="cb125-113"><a href="sel-and-pred.html#cb125-113" aria-hidden="true" tabindex="-1"></a>        clust_X_names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(train_X_clusters)</span>
<span id="cb125-114"><a href="sel-and-pred.html#cb125-114" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-115"><a href="sel-and-pred.html#cb125-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-116"><a href="sel-and-pred.html#cb125-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit linear model on training data via OLS</span></span>
<span id="cb125-117"><a href="sel-and-pred.html#cb125-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(train_X_clusters) <span class="sc">&lt;</span> <span class="fu">ncol</span>(train_X_clusters)){</span>
<span id="cb125-118"><a href="sel-and-pred.html#cb125-118" aria-hidden="true" tabindex="-1"></a>        err_mess <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;css not provided with enough indices to fit OLS model for predictions (number of training indices: &quot;</span>,</span>
<span id="cb125-119"><a href="sel-and-pred.html#cb125-119" aria-hidden="true" tabindex="-1"></a>            <span class="fu">nrow</span>(train_X_clusters), <span class="st">&quot;, number of clusters: &quot;</span>,</span>
<span id="cb125-120"><a href="sel-and-pred.html#cb125-120" aria-hidden="true" tabindex="-1"></a>            <span class="fu">ncol</span>(train_X_clusters),</span>
<span id="cb125-121"><a href="sel-and-pred.html#cb125-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;). Try reducing number of clusters by increasing cutoff, or re-run css with a larger number of training indices.&quot;</span>,</span>
<span id="cb125-122"><a href="sel-and-pred.html#cb125-122" aria-hidden="true" tabindex="-1"></a>            <span class="at">sep=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb125-123"><a href="sel-and-pred.html#cb125-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(err_mess)</span>
<span id="cb125-124"><a href="sel-and-pred.html#cb125-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-125"><a href="sel-and-pred.html#cb125-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-126"><a href="sel-and-pred.html#cb125-126" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span>y_train, train_X_clusters)</span>
<span id="cb125-127"><a href="sel-and-pred.html#cb125-127" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df)[<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(df)] <span class="ot">&lt;-</span> clust_X_names</span>
<span id="cb125-128"><a href="sel-and-pred.html#cb125-128" aria-hidden="true" tabindex="-1"></a>    model <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lm</span>(y <span class="sc">~</span>., <span class="at">data=</span>df)</span>
<span id="cb125-129"><a href="sel-and-pred.html#cb125-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-130"><a href="sel-and-pred.html#cb125-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use fitted model to generate predictions on testX</span></span>
<span id="cb125-131"><a href="sel-and-pred.html#cb125-131" aria-hidden="true" tabindex="-1"></a>    df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(testX_clusters)</span>
<span id="cb125-132"><a href="sel-and-pred.html#cb125-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(df_test) <span class="ot">&lt;-</span> clust_X_names</span>
<span id="cb125-133"><a href="sel-and-pred.html#cb125-133" aria-hidden="true" tabindex="-1"></a>    predictions <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">predict.lm</span>(model, <span class="at">newdata=</span>df_test)</span>
<span id="cb125-134"><a href="sel-and-pred.html#cb125-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(predictions) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb125-135"><a href="sel-and-pred.html#cb125-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-136"><a href="sel-and-pred.html#cb125-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check output</span></span>
<span id="cb125-137"><a href="sel-and-pred.html#cb125-137" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(predictions) <span class="sc">|</span> <span class="fu">is.integer</span>(predictions))</span>
<span id="cb125-138"><a href="sel-and-pred.html#cb125-138" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">length</span>(predictions) <span class="sc">==</span> n)</span>
<span id="cb125-139"><a href="sel-and-pred.html#cb125-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(predictions)))</span>
<span id="cb125-140"><a href="sel-and-pred.html#cb125-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-141"><a href="sel-and-pred.html#cb125-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(predictions)</span>
<span id="cb125-142"><a href="sel-and-pred.html#cb125-142" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code><a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>()</code>:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="sel-and-pred.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Helper function to confirm that inputs to the function getCssPreds are as</span></span>
<span id="cb126-2"><a href="sel-and-pred.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; expected, and modify inputs if needed.</span></span>
<span id="cb126-3"><a href="sel-and-pred.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb126-4"><a href="sel-and-pred.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param css_results An object of class &quot;cssr&quot; (the output of the function</span></span>
<span id="cb126-5"><a href="sel-and-pred.html#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css).</span></span>
<span id="cb126-6"><a href="sel-and-pred.html#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param testX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb126-7"><a href="sel-and-pred.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb126-8"><a href="sel-and-pred.html#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to generate predictions. Must contain the same</span></span>
<span id="cb126-9"><a href="sel-and-pred.html#cb126-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; features (in the same number of columns) as the matrix provided to css.</span></span>
<span id="cb126-10"><a href="sel-and-pred.html#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param weighting Character; determines how to calculate the weights to</span></span>
<span id="cb126-11"><a href="sel-and-pred.html#cb126-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; combine features from the selected clusters into weighted averages, called</span></span>
<span id="cb126-12"><a href="sel-and-pred.html#cb126-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; cluster representatives. Must be one of &quot;sparse&quot;, &quot;weighted_avg&quot;, or</span></span>
<span id="cb126-13"><a href="sel-and-pred.html#cb126-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&#39;. For &quot;sparse&quot;, all the weight is put on the most frequently</span></span>
<span id="cb126-14"><a href="sel-and-pred.html#cb126-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selected individual cluster member (or divided equally among all the clusters</span></span>
<span id="cb126-15"><a href="sel-and-pred.html#cb126-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; that are tied for the top selection proportion if there is a tie). For</span></span>
<span id="cb126-16"><a href="sel-and-pred.html#cb126-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;weighted_avg&quot;, the weight used for each cluster member is calculated in</span></span>
<span id="cb126-17"><a href="sel-and-pred.html#cb126-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; proportion to the individual selection proportions of each feature. For</span></span>
<span id="cb126-18"><a href="sel-and-pred.html#cb126-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; &quot;simple_avg&quot;, each cluster member gets equal weight regardless of the</span></span>
<span id="cb126-19"><a href="sel-and-pred.html#cb126-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; individual feature selection proportions (that is, the cluster representative</span></span>
<span id="cb126-20"><a href="sel-and-pred.html#cb126-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; is just a simple average of all the cluster members). See Faletto and Bien</span></span>
<span id="cb126-21"><a href="sel-and-pred.html#cb126-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; (2022) for details. Default is &quot;weighted_avg&quot;.</span></span>
<span id="cb126-22"><a href="sel-and-pred.html#cb126-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param cutoff Numeric; getCssPreds will make use only of those clusters with</span></span>
<span id="cb126-23"><a href="sel-and-pred.html#cb126-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; selection proportions equal to at least cutoff. Must be between 0 and 1.</span></span>
<span id="cb126-24"><a href="sel-and-pred.html#cb126-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Default is 0 (in which case either all clusters are used, or max_num_clusts</span></span>
<span id="cb126-25"><a href="sel-and-pred.html#cb126-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; are used, if max_num_clusts is specified).</span></span>
<span id="cb126-26"><a href="sel-and-pred.html#cb126-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param min_num_clusts Integer or numeric; the minimum number of clusters to</span></span>
<span id="cb126-27"><a href="sel-and-pred.html#cb126-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns fewer than</span></span>
<span id="cb126-28"><a href="sel-and-pred.html#cb126-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters, the cutoff will be increased until at least</span></span>
<span id="cb126-29"><a href="sel-and-pred.html#cb126-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; min_num_clusts clusters are selected.) Default is 1.</span></span>
<span id="cb126-30"><a href="sel-and-pred.html#cb126-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_num_clusts Integer or numeric; the maximum number of clusters to</span></span>
<span id="cb126-31"><a href="sel-and-pred.html#cb126-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; use regardless of cutoff. (That is, if the chosen cutoff returns more than</span></span>
<span id="cb126-32"><a href="sel-and-pred.html#cb126-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters, the cutoff will be decreased until at most</span></span>
<span id="cb126-33"><a href="sel-and-pred.html#cb126-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts clusters are selected.) Default is NA (in which case</span></span>
<span id="cb126-34"><a href="sel-and-pred.html#cb126-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; max_num_clusts is ignored).</span></span>
<span id="cb126-35"><a href="sel-and-pred.html#cb126-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param trainX A numeric matrix (preferably) or a data.frame (which will</span></span>
<span id="cb126-36"><a href="sel-and-pred.html#cb126-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; be coerced internally to a matrix by the function model.matrix) containing</span></span>
<span id="cb126-37"><a href="sel-and-pred.html#cb126-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the data that will be used to estimate the linear model from the selected</span></span>
<span id="cb126-38"><a href="sel-and-pred.html#cb126-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; clusters. trainX is only necessary to provide if no train_inds were</span></span>
<span id="cb126-39"><a href="sel-and-pred.html#cb126-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; designated in the css function call to set aside observations for model</span></span>
<span id="cb126-40"><a href="sel-and-pred.html#cb126-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; estimation (though even if train_inds was provided, trainX and trianY will be</span></span>
<span id="cb126-41"><a href="sel-and-pred.html#cb126-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; used for model estimation if they are both provided to getCssPreds). Must </span></span>
<span id="cb126-42"><a href="sel-and-pred.html#cb126-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; contain the same features (in the same number of columns) as the matrix </span></span>
<span id="cb126-43"><a href="sel-and-pred.html#cb126-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided to css, and if the columns of trainX are labeled, the names must</span></span>
<span id="cb126-44"><a href="sel-and-pred.html#cb126-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; match the variable names provided to css. Default is NA (in which case</span></span>
<span id="cb126-45"><a href="sel-and-pred.html#cb126-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; getCssPreds uses the observations from the train_inds that were provided to</span></span>
<span id="cb126-46"><a href="sel-and-pred.html#cb126-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; css to estimate a linear model).</span></span>
<span id="cb126-47"><a href="sel-and-pred.html#cb126-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param trainY The response corresponding to trainX. Must be a real-valued</span></span>
<span id="cb126-48"><a href="sel-and-pred.html#cb126-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; response (unlike in the general css setup) because predictions will be</span></span>
<span id="cb126-49"><a href="sel-and-pred.html#cb126-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; generated by an ordinary least squares model. Must have the same length as</span></span>
<span id="cb126-50"><a href="sel-and-pred.html#cb126-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the number of rows of trainX. Like trainX, only needs to be provided if no</span></span>
<span id="cb126-51"><a href="sel-and-pred.html#cb126-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations were set aside for model estimation by the parameter train_inds</span></span>
<span id="cb126-52"><a href="sel-and-pred.html#cb126-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; in the css function call. Default is NA (in which case getCssPreds uses the</span></span>
<span id="cb126-53"><a href="sel-and-pred.html#cb126-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; observations from the train_inds that were provided to css).</span></span>
<span id="cb126-54"><a href="sel-and-pred.html#cb126-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return A named list with the following elements: \item{trainXProvided}{</span></span>
<span id="cb126-55"><a href="sel-and-pred.html#cb126-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Logical; indicates whether a valid trainX input was provided.} \item{trainX}{</span></span>
<span id="cb126-56"><a href="sel-and-pred.html#cb126-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The provided trainX matrix, coerced from a data.frame to a matrix if the</span></span>
<span id="cb126-57"><a href="sel-and-pred.html#cb126-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided trainX was a data.frame. (If a valid trainX was not provided, this</span></span>
<span id="cb126-58"><a href="sel-and-pred.html#cb126-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; output simply passes whatever was provided as trainX.)} \item{testX}{The</span></span>
<span id="cb126-59"><a href="sel-and-pred.html#cb126-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided testX matrix, coerced from a data.frame to a matrix if the provided</span></span>
<span id="cb126-60"><a href="sel-and-pred.html#cb126-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; testX was a data.frame.} \item{feat_names}{A character vector containing the</span></span>
<span id="cb126-61"><a href="sel-and-pred.html#cb126-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; column names of testX (if the provided testX had column names). If the</span></span>
<span id="cb126-62"><a href="sel-and-pred.html#cb126-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; provided testX did not have column names, feat_names will be NA.}</span></span>
<span id="cb126-63"><a href="sel-and-pred.html#cb126-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \item{max_num_clusts}{The provided max_num_clusts, coerced to an integer if</span></span>
<span id="cb126-64"><a href="sel-and-pred.html#cb126-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; needed, and coerced to be less than or equal to the total number of clusters</span></span>
<span id="cb126-65"><a href="sel-and-pred.html#cb126-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from the output of css_results.}</span></span>
<span id="cb126-66"><a href="sel-and-pred.html#cb126-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Gregory Faletto, Jacob Bien</span></span>
<span id="cb126-67"><a href="sel-and-pred.html#cb126-67" aria-hidden="true" tabindex="-1"></a><span id='checkGetCssPredsInputs'>checkGetCssPredsInputs</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(css_results, testX, weighting, cutoff,</span>
<span id="cb126-68"><a href="sel-and-pred.html#cb126-68" aria-hidden="true" tabindex="-1"></a>    min_num_clusts, max_num_clusts, trainX, trainY){</span>
<span id="cb126-69"><a href="sel-and-pred.html#cb126-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check inputs</span></span>
<span id="cb126-70"><a href="sel-and-pred.html#cb126-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(<span class="fu">class</span>(css_results) <span class="sc">==</span> <span class="st">&quot;cssr&quot;</span>)</span>
<span id="cb126-71"><a href="sel-and-pred.html#cb126-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-72"><a href="sel-and-pred.html#cb126-72" aria-hidden="true" tabindex="-1"></a>    check_results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkNewXProvided'>checkNewXProvided</a>(trainX, css_results)</span>
<span id="cb126-73"><a href="sel-and-pred.html#cb126-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-74"><a href="sel-and-pred.html#cb126-74" aria-hidden="true" tabindex="-1"></a>    trainX <span class="ot">&lt;-</span> check_results<span class="sc">$</span>newX</span>
<span id="cb126-75"><a href="sel-and-pred.html#cb126-75" aria-hidden="true" tabindex="-1"></a>    trainXProvided <span class="ot">&lt;-</span> check_results<span class="sc">$</span>newXProvided</span>
<span id="cb126-76"><a href="sel-and-pred.html#cb126-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-77"><a href="sel-and-pred.html#cb126-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(check_results)</span>
<span id="cb126-78"><a href="sel-and-pred.html#cb126-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-79"><a href="sel-and-pred.html#cb126-79" aria-hidden="true" tabindex="-1"></a>    n_train <span class="ot">&lt;-</span> <span class="fu">nrow</span>(trainX)</span>
<span id="cb126-80"><a href="sel-and-pred.html#cb126-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-81"><a href="sel-and-pred.html#cb126-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(trainXProvided){</span>
<span id="cb126-82"><a href="sel-and-pred.html#cb126-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(trainY)) <span class="sc">&amp;</span> <span class="fu">length</span>(trainY) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb126-83"><a href="sel-and-pred.html#cb126-83" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(<span class="fu">is.numeric</span>(trainY))</span>
<span id="cb126-84"><a href="sel-and-pred.html#cb126-84" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stopifnot</span>(n_train <span class="sc">==</span> <span class="fu">length</span>(trainY))</span>
<span id="cb126-85"><a href="sel-and-pred.html#cb126-85" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span>{</span>
<span id="cb126-86"><a href="sel-and-pred.html#cb126-86" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span>(<span class="fu">length</span>(css_results<span class="sc">$</span>train_inds) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb126-87"><a href="sel-and-pred.html#cb126-87" aria-hidden="true" tabindex="-1"></a>                <span class="fu">stop</span>(<span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide both trainX and trainY in order to generate predictions&quot;</span>)</span>
<span id="cb126-88"><a href="sel-and-pred.html#cb126-88" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb126-89"><a href="sel-and-pred.html#cb126-89" aria-hidden="true" tabindex="-1"></a>            trainXProvided <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb126-90"><a href="sel-and-pred.html#cb126-90" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(<span class="st">&quot;trainX provided but no trainY provided; instead, training model using the train_inds observations provided to css to set aside for model training.&quot;</span>)</span>
<span id="cb126-91"><a href="sel-and-pred.html#cb126-91" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-92"><a href="sel-and-pred.html#cb126-92" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span>{</span>
<span id="cb126-93"><a href="sel-and-pred.html#cb126-93" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(css_results<span class="sc">$</span>train_inds) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb126-94"><a href="sel-and-pred.html#cb126-94" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stop</span>(<span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide both trainX and trainY in order to generate predictions&quot;</span>)</span>
<span id="cb126-95"><a href="sel-and-pred.html#cb126-95" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-96"><a href="sel-and-pred.html#cb126-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(trainY)) <span class="sc">&amp;</span> <span class="fu">length</span>(trainY) <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb126-97"><a href="sel-and-pred.html#cb126-97" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(<span class="st">&quot;trainY provided but no trainX provided; instead, training model using the train_inds observations provided to css to set aside for model training.&quot;</span>)</span>
<span id="cb126-98"><a href="sel-and-pred.html#cb126-98" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-99"><a href="sel-and-pred.html#cb126-99" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-100"><a href="sel-and-pred.html#cb126-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-101"><a href="sel-and-pred.html#cb126-101" aria-hidden="true" tabindex="-1"></a>    results <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(testX, css_results<span class="sc">$</span>X)</span>
<span id="cb126-102"><a href="sel-and-pred.html#cb126-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-103"><a href="sel-and-pred.html#cb126-103" aria-hidden="true" tabindex="-1"></a>    testX <span class="ot">&lt;-</span> results<span class="sc">$</span>newx</span>
<span id="cb126-104"><a href="sel-and-pred.html#cb126-104" aria-hidden="true" tabindex="-1"></a>    feat_names <span class="ot">&lt;-</span> results<span class="sc">$</span>feat_names</span>
<span id="cb126-105"><a href="sel-and-pred.html#cb126-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-106"><a href="sel-and-pred.html#cb126-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(feat_names))){</span>
<span id="cb126-107"><a href="sel-and-pred.html#cb126-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">length</span>(feat_names) <span class="sc">==</span> <span class="fu">ncol</span>(testX))</span>
<span id="cb126-108"><a href="sel-and-pred.html#cb126-108" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="sc">!</span>(<span class="st">&quot;(Intercept)&quot;</span> <span class="sc">%in%</span> feat_names))</span>
<span id="cb126-109"><a href="sel-and-pred.html#cb126-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(testX) <span class="ot">&lt;-</span> feat_names</span>
<span id="cb126-110"><a href="sel-and-pred.html#cb126-110" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-111"><a href="sel-and-pred.html#cb126-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-112"><a href="sel-and-pred.html#cb126-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(results)</span>
<span id="cb126-113"><a href="sel-and-pred.html#cb126-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-114"><a href="sel-and-pred.html#cb126-114" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(testX)</span>
<span id="cb126-115"><a href="sel-and-pred.html#cb126-115" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ncol</span>(testX)</span>
<span id="cb126-116"><a href="sel-and-pred.html#cb126-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-117"><a href="sel-and-pred.html#cb126-117" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(n <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb126-118"><a href="sel-and-pred.html#cb126-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stopifnot</span>(p <span class="sc">==</span> <span class="fu">ncol</span>(trainX))</span>
<span id="cb126-119"><a href="sel-and-pred.html#cb126-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(trainX)) <span class="sc">&amp;</span> <span class="fu">is.null</span>(<span class="fu">colnames</span>(testX))){</span>
<span id="cb126-120"><a href="sel-and-pred.html#cb126-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Column names were provided for trainX but not for testX (are you sure they both contain identical features in the same order?)&quot;</span>)</span>
<span id="cb126-121"><a href="sel-and-pred.html#cb126-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-122"><a href="sel-and-pred.html#cb126-122" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(<span class="fu">colnames</span>(trainX)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(testX))){</span>
<span id="cb126-123"><a href="sel-and-pred.html#cb126-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="st">&quot;Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)&quot;</span>)</span>
<span id="cb126-124"><a href="sel-and-pred.html#cb126-124" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-125"><a href="sel-and-pred.html#cb126-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(trainX)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">colnames</span>(testX))){</span>
<span id="cb126-126"><a href="sel-and-pred.html#cb126-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">colnames</span>(trainX) <span class="sc">==</span> <span class="fu">colnames</span>(testX)))</span>
<span id="cb126-127"><a href="sel-and-pred.html#cb126-127" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-128"><a href="sel-and-pred.html#cb126-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-129"><a href="sel-and-pred.html#cb126-129" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkCutoff'>checkCutoff</a>(cutoff)</span>
<span id="cb126-130"><a href="sel-and-pred.html#cb126-130" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkWeighting'>checkWeighting</a>(weighting)</span>
<span id="cb126-131"><a href="sel-and-pred.html#cb126-131" aria-hidden="true" tabindex="-1"></a>    <a href='sel-and-pred.html#checkMinNumClusts'>checkMinNumClusts</a>(min_num_clusts, p, <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb126-132"><a href="sel-and-pred.html#cb126-132" aria-hidden="true" tabindex="-1"></a>    max_num_clusts <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkMaxNumClusts'>checkMaxNumClusts</a>(max_num_clusts, min_num_clusts, p,</span>
<span id="cb126-133"><a href="sel-and-pred.html#cb126-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(css_results<span class="sc">$</span>clusters))</span>
<span id="cb126-134"><a href="sel-and-pred.html#cb126-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-135"><a href="sel-and-pred.html#cb126-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">trainXProvided=</span>trainXProvided, <span class="at">trainX=</span>trainX, <span class="at">testX=</span>testX,</span>
<span id="cb126-136"><a href="sel-and-pred.html#cb126-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">feat_names=</span>feat_names, <span class="at">max_num_clusts=</span>max_num_clusts))</span>
<span id="cb126-137"><a href="sel-and-pred.html#cb126-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-138"><a href="sel-and-pred.html#cb126-138" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Tests for <code><a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>()</code></p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="sel-and-pred.html#cb127-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;checkGetCssPredsInputs works&quot;</span>, {</span>
<span id="cb127-2"><a href="sel-and-pred.html#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">17081</span>)</span>
<span id="cb127-3"><a href="sel-and-pred.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="sel-and-pred.html#cb127-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb127-5"><a href="sel-and-pred.html#cb127-5" aria-hidden="true" tabindex="-1"></a>  x_train <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb127-6"><a href="sel-and-pred.html#cb127-6" aria-hidden="true" tabindex="-1"></a>  x_pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">7</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">7</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb127-7"><a href="sel-and-pred.html#cb127-7" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb127-8"><a href="sel-and-pred.html#cb127-8" aria-hidden="true" tabindex="-1"></a>  y_train <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb127-9"><a href="sel-and-pred.html#cb127-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-10"><a href="sel-and-pred.html#cb127-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb127-11"><a href="sel-and-pred.html#cb127-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-12"><a href="sel-and-pred.html#cb127-12" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb127-13"><a href="sel-and-pred.html#cb127-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb127-14"><a href="sel-and-pred.html#cb127-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-15"><a href="sel-and-pred.html#cb127-15" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb127-16"><a href="sel-and-pred.html#cb127-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cutoff=</span><span class="fl">0.05</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-17"><a href="sel-and-pred.html#cb127-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">trainX=</span>x_train,</span>
<span id="cb127-18"><a href="sel-and-pred.html#cb127-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trainY=</span>y_train)</span>
<span id="cb127-19"><a href="sel-and-pred.html#cb127-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-20"><a href="sel-and-pred.html#cb127-20" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb127-21"><a href="sel-and-pred.html#cb127-21" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>, <span class="st">&quot;testX&quot;</span>,</span>
<span id="cb127-22"><a href="sel-and-pred.html#cb127-22" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-23"><a href="sel-and-pred.html#cb127-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-24"><a href="sel-and-pred.html#cb127-24" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-25"><a href="sel-and-pred.html#cb127-25" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>trainXProvided), <span class="dv">1</span>)</span>
<span id="cb127-26"><a href="sel-and-pred.html#cb127-26" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-27"><a href="sel-and-pred.html#cb127-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>trainXProvided)</span>
<span id="cb127-28"><a href="sel-and-pred.html#cb127-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-29"><a href="sel-and-pred.html#cb127-29" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainX)))</span>
<span id="cb127-30"><a href="sel-and-pred.html#cb127-30" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-31"><a href="sel-and-pred.html#cb127-31" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-32"><a href="sel-and-pred.html#cb127-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>trainX), <span class="dv">8</span>)</span>
<span id="cb127-33"><a href="sel-and-pred.html#cb127-33" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>trainX), <span class="dv">6</span>)</span>
<span id="cb127-34"><a href="sel-and-pred.html#cb127-34" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_train <span class="sc">-</span> res<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-35"><a href="sel-and-pred.html#cb127-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-36"><a href="sel-and-pred.html#cb127-36" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>testX)))</span>
<span id="cb127-37"><a href="sel-and-pred.html#cb127-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-38"><a href="sel-and-pred.html#cb127-38" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-39"><a href="sel-and-pred.html#cb127-39" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>testX), <span class="dv">7</span>)</span>
<span id="cb127-40"><a href="sel-and-pred.html#cb127-40" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>testX), <span class="dv">6</span>)</span>
<span id="cb127-41"><a href="sel-and-pred.html#cb127-41" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_pred <span class="sc">-</span> res<span class="sc">$</span>testX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-42"><a href="sel-and-pred.html#cb127-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-43"><a href="sel-and-pred.html#cb127-43" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-44"><a href="sel-and-pred.html#cb127-44" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-45"><a href="sel-and-pred.html#cb127-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-46"><a href="sel-and-pred.html#cb127-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>max_num_clusts))</span>
<span id="cb127-47"><a href="sel-and-pred.html#cb127-47" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>max_num_clusts) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb127-48"><a href="sel-and-pred.html#cb127-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-49"><a href="sel-and-pred.html#cb127-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Try other bad inputs</span></span>
<span id="cb127-50"><a href="sel-and-pred.html#cb127-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-51"><a href="sel-and-pred.html#cb127-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-52"><a href="sel-and-pred.html#cb127-52" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb127-53"><a href="sel-and-pred.html#cb127-53" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="sc">-</span><span class="fl">0.5</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-54"><a href="sel-and-pred.html#cb127-54" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-55"><a href="sel-and-pred.html#cb127-55" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-56"><a href="sel-and-pred.html#cb127-56" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-57"><a href="sel-and-pred.html#cb127-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-58"><a href="sel-and-pred.html#cb127-58" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-59"><a href="sel-and-pred.html#cb127-59" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-60"><a href="sel-and-pred.html#cb127-60" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="st">&quot;0.3&quot;</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-61"><a href="sel-and-pred.html#cb127-61" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-62"><a href="sel-and-pred.html#cb127-62" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-63"><a href="sel-and-pred.html#cb127-63" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb127-64"><a href="sel-and-pred.html#cb127-64" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-65"><a href="sel-and-pred.html#cb127-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-66"><a href="sel-and-pred.html#cb127-66" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-67"><a href="sel-and-pred.html#cb127-67" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-68"><a href="sel-and-pred.html#cb127-68" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>),</span>
<span id="cb127-69"><a href="sel-and-pred.html#cb127-69" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-70"><a href="sel-and-pred.html#cb127-70" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-71"><a href="sel-and-pred.html#cb127-71" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-72"><a href="sel-and-pred.html#cb127-72" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-73"><a href="sel-and-pred.html#cb127-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-74"><a href="sel-and-pred.html#cb127-74" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-75"><a href="sel-and-pred.html#cb127-75" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-76"><a href="sel-and-pred.html#cb127-76" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&quot;simple_avg&quot;</span>),</span>
<span id="cb127-77"><a href="sel-and-pred.html#cb127-77" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>,</span>
<span id="cb127-78"><a href="sel-and-pred.html#cb127-78" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-79"><a href="sel-and-pred.html#cb127-79" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-80"><a href="sel-and-pred.html#cb127-80" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-81"><a href="sel-and-pred.html#cb127-81" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-82"><a href="sel-and-pred.html#cb127-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-83"><a href="sel-and-pred.html#cb127-83" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-84"><a href="sel-and-pred.html#cb127-84" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="dv">2</span>, <span class="at">cutoff=</span><span class="fl">0.1</span>,</span>
<span id="cb127-85"><a href="sel-and-pred.html#cb127-85" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-86"><a href="sel-and-pred.html#cb127-86" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-87"><a href="sel-and-pred.html#cb127-87" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-88"><a href="sel-and-pred.html#cb127-88" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-89"><a href="sel-and-pred.html#cb127-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-90"><a href="sel-and-pred.html#cb127-90" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-91"><a href="sel-and-pred.html#cb127-91" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.1</span>,</span>
<span id="cb127-92"><a href="sel-and-pred.html#cb127-92" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-93"><a href="sel-and-pred.html#cb127-93" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-94"><a href="sel-and-pred.html#cb127-94" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-95"><a href="sel-and-pred.html#cb127-95" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb127-96"><a href="sel-and-pred.html#cb127-96" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-97"><a href="sel-and-pred.html#cb127-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-98"><a href="sel-and-pred.html#cb127-98" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-99"><a href="sel-and-pred.html#cb127-99" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.1</span>,</span>
<span id="cb127-100"><a href="sel-and-pred.html#cb127-100" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">min_num_clusts=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb127-101"><a href="sel-and-pred.html#cb127-101" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-102"><a href="sel-and-pred.html#cb127-102" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-103"><a href="sel-and-pred.html#cb127-103" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-104"><a href="sel-and-pred.html#cb127-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-105"><a href="sel-and-pred.html#cb127-105" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-106"><a href="sel-and-pred.html#cb127-106" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb127-107"><a href="sel-and-pred.html#cb127-107" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb127-108"><a href="sel-and-pred.html#cb127-108" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-109"><a href="sel-and-pred.html#cb127-109" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-110"><a href="sel-and-pred.html#cb127-110" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb127-111"><a href="sel-and-pred.html#cb127-111" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-112"><a href="sel-and-pred.html#cb127-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-113"><a href="sel-and-pred.html#cb127-113" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-114"><a href="sel-and-pred.html#cb127-114" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb127-115"><a href="sel-and-pred.html#cb127-115" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">0</span>,</span>
<span id="cb127-116"><a href="sel-and-pred.html#cb127-116" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-117"><a href="sel-and-pred.html#cb127-117" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-118"><a href="sel-and-pred.html#cb127-118" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-119"><a href="sel-and-pred.html#cb127-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-120"><a href="sel-and-pred.html#cb127-120" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-121"><a href="sel-and-pred.html#cb127-121" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb127-122"><a href="sel-and-pred.html#cb127-122" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">10</span>,</span>
<span id="cb127-123"><a href="sel-and-pred.html#cb127-123" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-124"><a href="sel-and-pred.html#cb127-124" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-125"><a href="sel-and-pred.html#cb127-125" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-126"><a href="sel-and-pred.html#cb127-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-127"><a href="sel-and-pred.html#cb127-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-128"><a href="sel-and-pred.html#cb127-128" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-129"><a href="sel-and-pred.html#cb127-129" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>,</span>
<span id="cb127-130"><a href="sel-and-pred.html#cb127-130" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-131"><a href="sel-and-pred.html#cb127-131" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="st">&quot;5&quot;</span>,</span>
<span id="cb127-132"><a href="sel-and-pred.html#cb127-132" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-133"><a href="sel-and-pred.html#cb127-133" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb127-134"><a href="sel-and-pred.html#cb127-134" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-135"><a href="sel-and-pred.html#cb127-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-136"><a href="sel-and-pred.html#cb127-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-137"><a href="sel-and-pred.html#cb127-137" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-138"><a href="sel-and-pred.html#cb127-138" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-139"><a href="sel-and-pred.html#cb127-139" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="fl">4.5</span>,</span>
<span id="cb127-140"><a href="sel-and-pred.html#cb127-140" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-141"><a href="sel-and-pred.html#cb127-141" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb127-142"><a href="sel-and-pred.html#cb127-142" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-143"><a href="sel-and-pred.html#cb127-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-144"><a href="sel-and-pred.html#cb127-144" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-145"><a href="sel-and-pred.html#cb127-145" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-146"><a href="sel-and-pred.html#cb127-146" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb127-147"><a href="sel-and-pred.html#cb127-147" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="dv">2</span>,</span>
<span id="cb127-148"><a href="sel-and-pred.html#cb127-148" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-149"><a href="sel-and-pred.html#cb127-149" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb127-150"><a href="sel-and-pred.html#cb127-150" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-151"><a href="sel-and-pred.html#cb127-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-152"><a href="sel-and-pred.html#cb127-152" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-153"><a href="sel-and-pred.html#cb127-153" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-154"><a href="sel-and-pred.html#cb127-154" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">cutoff=</span><span class="fl">0.1</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-155"><a href="sel-and-pred.html#cb127-155" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">max_num_clusts=</span><span class="dv">10</span>,</span>
<span id="cb127-156"><a href="sel-and-pred.html#cb127-156" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-157"><a href="sel-and-pred.html#cb127-157" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-158"><a href="sel-and-pred.html#cb127-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-159"><a href="sel-and-pred.html#cb127-159" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb127-160"><a href="sel-and-pred.html#cb127-160" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb127-161"><a href="sel-and-pred.html#cb127-161" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb127-162"><a href="sel-and-pred.html#cb127-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-163"><a href="sel-and-pred.html#cb127-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb127-164"><a href="sel-and-pred.html#cb127-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-165"><a href="sel-and-pred.html#cb127-165" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_train, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-166"><a href="sel-and-pred.html#cb127-166" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb127-167"><a href="sel-and-pred.html#cb127-167" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-168"><a href="sel-and-pred.html#cb127-168" aria-hidden="true" tabindex="-1"></a>                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">trainX=</span>x_train,</span>
<span id="cb127-169"><a href="sel-and-pred.html#cb127-169" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trainY=</span>y_train)</span>
<span id="cb127-170"><a href="sel-and-pred.html#cb127-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-171"><a href="sel-and-pred.html#cb127-171" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb127-172"><a href="sel-and-pred.html#cb127-172" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>, <span class="st">&quot;testX&quot;</span>,</span>
<span id="cb127-173"><a href="sel-and-pred.html#cb127-173" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-174"><a href="sel-and-pred.html#cb127-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-175"><a href="sel-and-pred.html#cb127-175" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-176"><a href="sel-and-pred.html#cb127-176" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>trainXProvided), <span class="dv">1</span>)</span>
<span id="cb127-177"><a href="sel-and-pred.html#cb127-177" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-178"><a href="sel-and-pred.html#cb127-178" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(res<span class="sc">$</span>trainXProvided)</span>
<span id="cb127-179"><a href="sel-and-pred.html#cb127-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-180"><a href="sel-and-pred.html#cb127-180" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainX)))</span>
<span id="cb127-181"><a href="sel-and-pred.html#cb127-181" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-182"><a href="sel-and-pred.html#cb127-182" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-183"><a href="sel-and-pred.html#cb127-183" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>trainX), <span class="dv">8</span>)</span>
<span id="cb127-184"><a href="sel-and-pred.html#cb127-184" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>trainX), <span class="dv">6</span>)</span>
<span id="cb127-185"><a href="sel-and-pred.html#cb127-185" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_train <span class="sc">-</span> res<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-186"><a href="sel-and-pred.html#cb127-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-187"><a href="sel-and-pred.html#cb127-187" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>testX)))</span>
<span id="cb127-188"><a href="sel-and-pred.html#cb127-188" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-189"><a href="sel-and-pred.html#cb127-189" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-190"><a href="sel-and-pred.html#cb127-190" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>testX), <span class="dv">7</span>)</span>
<span id="cb127-191"><a href="sel-and-pred.html#cb127-191" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>testX), <span class="dv">6</span>)</span>
<span id="cb127-192"><a href="sel-and-pred.html#cb127-192" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_pred <span class="sc">-</span> res<span class="sc">$</span>testX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-193"><a href="sel-and-pred.html#cb127-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-194"><a href="sel-and-pred.html#cb127-194" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-195"><a href="sel-and-pred.html#cb127-195" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-196"><a href="sel-and-pred.html#cb127-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-197"><a href="sel-and-pred.html#cb127-197" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>max_num_clusts))</span>
<span id="cb127-198"><a href="sel-and-pred.html#cb127-198" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>max_num_clusts) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb127-199"><a href="sel-and-pred.html#cb127-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-200"><a href="sel-and-pred.html#cb127-200" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb127-201"><a href="sel-and-pred.html#cb127-201" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-202"><a href="sel-and-pred.html#cb127-202" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_train, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-203"><a href="sel-and-pred.html#cb127-203" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>,</span>
<span id="cb127-204"><a href="sel-and-pred.html#cb127-204" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-205"><a href="sel-and-pred.html#cb127-205" aria-hidden="true" tabindex="-1"></a>                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">trainX=</span><span class="cn">NA</span>, <span class="at">trainY=</span><span class="cn">NA</span>)</span>
<span id="cb127-206"><a href="sel-and-pred.html#cb127-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-207"><a href="sel-and-pred.html#cb127-207" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res))</span>
<span id="cb127-208"><a href="sel-and-pred.html#cb127-208" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>, <span class="st">&quot;testX&quot;</span>,</span>
<span id="cb127-209"><a href="sel-and-pred.html#cb127-209" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-210"><a href="sel-and-pred.html#cb127-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-211"><a href="sel-and-pred.html#cb127-211" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-212"><a href="sel-and-pred.html#cb127-212" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res<span class="sc">$</span>trainXProvided), <span class="dv">1</span>)</span>
<span id="cb127-213"><a href="sel-and-pred.html#cb127-213" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.logical</span>(res<span class="sc">$</span>trainXProvided))</span>
<span id="cb127-214"><a href="sel-and-pred.html#cb127-214" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="sc">!</span>res<span class="sc">$</span>trainXProvided)</span>
<span id="cb127-215"><a href="sel-and-pred.html#cb127-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-216"><a href="sel-and-pred.html#cb127-216" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>trainX)))</span>
<span id="cb127-217"><a href="sel-and-pred.html#cb127-217" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-218"><a href="sel-and-pred.html#cb127-218" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>trainX))</span>
<span id="cb127-219"><a href="sel-and-pred.html#cb127-219" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>trainX), <span class="dv">5</span>)</span>
<span id="cb127-220"><a href="sel-and-pred.html#cb127-220" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>trainX), <span class="dv">6</span>)</span>
<span id="cb127-221"><a href="sel-and-pred.html#cb127-221" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_select[<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>, ] <span class="sc">-</span> res<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-222"><a href="sel-and-pred.html#cb127-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-223"><a href="sel-and-pred.html#cb127-223" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res<span class="sc">$</span>testX)))</span>
<span id="cb127-224"><a href="sel-and-pred.html#cb127-224" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-225"><a href="sel-and-pred.html#cb127-225" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res<span class="sc">$</span>testX))</span>
<span id="cb127-226"><a href="sel-and-pred.html#cb127-226" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res<span class="sc">$</span>testX), <span class="dv">7</span>)</span>
<span id="cb127-227"><a href="sel-and-pred.html#cb127-227" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res<span class="sc">$</span>testX), <span class="dv">6</span>)</span>
<span id="cb127-228"><a href="sel-and-pred.html#cb127-228" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_pred <span class="sc">-</span> res<span class="sc">$</span>testX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-229"><a href="sel-and-pred.html#cb127-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-230"><a href="sel-and-pred.html#cb127-230" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-231"><a href="sel-and-pred.html#cb127-231" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>feat_names))</span>
<span id="cb127-232"><a href="sel-and-pred.html#cb127-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-233"><a href="sel-and-pred.html#cb127-233" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.na</span>(res<span class="sc">$</span>max_num_clusts))</span>
<span id="cb127-234"><a href="sel-and-pred.html#cb127-234" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">length</span>(res<span class="sc">$</span>max_num_clusts) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb127-235"><a href="sel-and-pred.html#cb127-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-236"><a href="sel-and-pred.html#cb127-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-237"><a href="sel-and-pred.html#cb127-237" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newX--should get error</span></span>
<span id="cb127-238"><a href="sel-and-pred.html#cb127-238" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-239"><a href="sel-and-pred.html#cb127-239" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>,</span>
<span id="cb127-240"><a href="sel-and-pred.html#cb127-240" aria-hidden="true" tabindex="-1"></a>                                <span class="at">cutoff=</span><span class="dv">0</span>, <span class="at">min_num_clusts=</span><span class="dv">1</span>,</span>
<span id="cb127-241"><a href="sel-and-pred.html#cb127-241" aria-hidden="true" tabindex="-1"></a>                                <span class="at">max_num_clusts=</span><span class="cn">NA</span>, <span class="at">trainX=</span><span class="cn">NA</span>, <span class="at">trainY=</span><span class="cn">NA</span>),</span>
<span id="cb127-242"><a href="sel-and-pred.html#cb127-242" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide new X in order to generate a design matrix&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-243"><a href="sel-and-pred.html#cb127-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-244"><a href="sel-and-pred.html#cb127-244" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb127-245"><a href="sel-and-pred.html#cb127-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-246"><a href="sel-and-pred.html#cb127-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb127-247"><a href="sel-and-pred.html#cb127-247" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb127-248"><a href="sel-and-pred.html#cb127-248" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb127-249"><a href="sel-and-pred.html#cb127-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-250"><a href="sel-and-pred.html#cb127-250" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb127-251"><a href="sel-and-pred.html#cb127-251" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-252"><a href="sel-and-pred.html#cb127-252" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb127-253"><a href="sel-and-pred.html#cb127-253" aria-hidden="true" tabindex="-1"></a>                                <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-254"><a href="sel-and-pred.html#cb127-254" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-255"><a href="sel-and-pred.html#cb127-255" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-256"><a href="sel-and-pred.html#cb127-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-257"><a href="sel-and-pred.html#cb127-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb127-258"><a href="sel-and-pred.html#cb127-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_train) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb127-259"><a href="sel-and-pred.html#cb127-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb127-260"><a href="sel-and-pred.html#cb127-260" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-261"><a href="sel-and-pred.html#cb127-261" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;weighted_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb127-262"><a href="sel-and-pred.html#cb127-262" aria-hidden="true" tabindex="-1"></a>                                <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-263"><a href="sel-and-pred.html#cb127-263" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-264"><a href="sel-and-pred.html#cb127-264" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb127-265"><a href="sel-and-pred.html#cb127-265" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-266"><a href="sel-and-pred.html#cb127-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-267"><a href="sel-and-pred.html#cb127-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_train) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb127-268"><a href="sel-and-pred.html#cb127-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb127-269"><a href="sel-and-pred.html#cb127-269" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-270"><a href="sel-and-pred.html#cb127-270" aria-hidden="true" tabindex="-1"></a>                                <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb127-271"><a href="sel-and-pred.html#cb127-271" aria-hidden="true" tabindex="-1"></a>                                <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-272"><a href="sel-and-pred.html#cb127-272" aria-hidden="true" tabindex="-1"></a>                                <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb127-273"><a href="sel-and-pred.html#cb127-273" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb127-274"><a href="sel-and-pred.html#cb127-274" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb127-275"><a href="sel-and-pred.html#cb127-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-276"><a href="sel-and-pred.html#cb127-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb127-277"><a href="sel-and-pred.html#cb127-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-278"><a href="sel-and-pred.html#cb127-278" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb127-279"><a href="sel-and-pred.html#cb127-279" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb127-280"><a href="sel-and-pred.html#cb127-280" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-281"><a href="sel-and-pred.html#cb127-281" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train)</span>
<span id="cb127-282"><a href="sel-and-pred.html#cb127-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-283"><a href="sel-and-pred.html#cb127-283" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_named))</span>
<span id="cb127-284"><a href="sel-and-pred.html#cb127-284" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_named), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>, <span class="st">&quot;testX&quot;</span>,</span>
<span id="cb127-285"><a href="sel-and-pred.html#cb127-285" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">&quot;feat_names&quot;</span>, <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-286"><a href="sel-and-pred.html#cb127-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-287"><a href="sel-and-pred.html#cb127-287" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_named<span class="sc">$</span>trainX)))</span>
<span id="cb127-288"><a href="sel-and-pred.html#cb127-288" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_named<span class="sc">$</span>trainX))</span>
<span id="cb127-289"><a href="sel-and-pred.html#cb127-289" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_named<span class="sc">$</span>trainX))</span>
<span id="cb127-290"><a href="sel-and-pred.html#cb127-290" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_named<span class="sc">$</span>trainX), <span class="dv">8</span>)</span>
<span id="cb127-291"><a href="sel-and-pred.html#cb127-291" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_named<span class="sc">$</span>trainX), <span class="dv">6</span>)</span>
<span id="cb127-292"><a href="sel-and-pred.html#cb127-292" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(x_train <span class="sc">-</span> res_named<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-293"><a href="sel-and-pred.html#cb127-293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-294"><a href="sel-and-pred.html#cb127-294" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.character</span>(res_named<span class="sc">$</span>feat_names))</span>
<span id="cb127-295"><a href="sel-and-pred.html#cb127-295" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(res_named<span class="sc">$</span>feat_names, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb127-296"><a href="sel-and-pred.html#cb127-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-297"><a href="sel-and-pred.html#cb127-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and checkGetCssPredsInputs</span></span>
<span id="cb127-298"><a href="sel-and-pred.html#cb127-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-299"><a href="sel-and-pred.html#cb127-299" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb127-300"><a href="sel-and-pred.html#cb127-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-301"><a href="sel-and-pred.html#cb127-301" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb127-302"><a href="sel-and-pred.html#cb127-302" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb127-303"><a href="sel-and-pred.html#cb127-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-304"><a href="sel-and-pred.html#cb127-304" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb127-305"><a href="sel-and-pred.html#cb127-305" aria-hidden="true" tabindex="-1"></a>  train_inds <span class="ot">&lt;-</span> (<span class="fu">max</span>(selec_inds) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb127-306"><a href="sel-and-pred.html#cb127-306" aria-hidden="true" tabindex="-1"></a>  test_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">c</span>(selec_inds, train_inds))</span>
<span id="cb127-307"><a href="sel-and-pred.html#cb127-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-308"><a href="sel-and-pred.html#cb127-308" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[<span class="fu">c</span>(selec_inds, train_inds), ],</span>
<span id="cb127-309"><a href="sel-and-pred.html#cb127-309" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y=</span>y[<span class="fu">c</span>(selec_inds, train_inds)], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>,</span>
<span id="cb127-310"><a href="sel-and-pred.html#cb127-310" aria-hidden="true" tabindex="-1"></a>                    <span class="at">train_inds=</span>train_inds)</span>
<span id="cb127-311"><a href="sel-and-pred.html#cb127-311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-312"><a href="sel-and-pred.html#cb127-312" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_df, <span class="at">testX=</span>X_df[test_inds, ],</span>
<span id="cb127-313"><a href="sel-and-pred.html#cb127-313" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">weighting=</span><span class="st">&quot;sparse&quot;</span>, <span class="at">cutoff=</span><span class="dv">0</span>,</span>
<span id="cb127-314"><a href="sel-and-pred.html#cb127-314" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="cn">NA</span>,</span>
<span id="cb127-315"><a href="sel-and-pred.html#cb127-315" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">trainX=</span><span class="cn">NA</span>, <span class="at">trainY=</span><span class="cn">NA</span>)</span>
<span id="cb127-316"><a href="sel-and-pred.html#cb127-316" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-317"><a href="sel-and-pred.html#cb127-317" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb127-318"><a href="sel-and-pred.html#cb127-318" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>,</span>
<span id="cb127-319"><a href="sel-and-pred.html#cb127-319" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;testX&quot;</span>,<span class="st">&quot;feat_names&quot;</span>,</span>
<span id="cb127-320"><a href="sel-and-pred.html#cb127-320" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-321"><a href="sel-and-pred.html#cb127-321" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-322"><a href="sel-and-pred.html#cb127-322" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>trainX)))</span>
<span id="cb127-323"><a href="sel-and-pred.html#cb127-323" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>trainX))</span>
<span id="cb127-324"><a href="sel-and-pred.html#cb127-324" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>trainX))</span>
<span id="cb127-325"><a href="sel-and-pred.html#cb127-325" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>trainX), <span class="fu">length</span>(train_inds))</span>
<span id="cb127-326"><a href="sel-and-pred.html#cb127-326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-327"><a href="sel-and-pred.html#cb127-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">nrow</span>(css_res_df<span class="sc">$</span>X) <span class="sc">&gt;=</span> <span class="fu">max</span>(train_inds))</span>
<span id="cb127-328"><a href="sel-and-pred.html#cb127-328" aria-hidden="true" tabindex="-1"></a>  train_mat <span class="ot">&lt;-</span> css_res_df<span class="sc">$</span>X[train_inds, ]</span>
<span id="cb127-329"><a href="sel-and-pred.html#cb127-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-330"><a href="sel-and-pred.html#cb127-330" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>trainX), <span class="fu">ncol</span>(train_mat))</span>
<span id="cb127-331"><a href="sel-and-pred.html#cb127-331" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(train_mat <span class="sc">-</span> res_df<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-332"><a href="sel-and-pred.html#cb127-332" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>trainX), <span class="fu">colnames</span>(train_mat))</span>
<span id="cb127-333"><a href="sel-and-pred.html#cb127-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-334"><a href="sel-and-pred.html#cb127-334" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>testX)))</span>
<span id="cb127-335"><a href="sel-and-pred.html#cb127-335" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>testX))</span>
<span id="cb127-336"><a href="sel-and-pred.html#cb127-336" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>testX))</span>
<span id="cb127-337"><a href="sel-and-pred.html#cb127-337" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>testX), <span class="fu">length</span>(test_inds))</span>
<span id="cb127-338"><a href="sel-and-pred.html#cb127-338" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-339"><a href="sel-and-pred.html#cb127-339" aria-hidden="true" tabindex="-1"></a>  test_mat <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X_df[test_inds, ])</span>
<span id="cb127-340"><a href="sel-and-pred.html#cb127-340" aria-hidden="true" tabindex="-1"></a>  test_mat <span class="ot">&lt;-</span> test_mat[, <span class="fu">colnames</span>(test_mat) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb127-341"><a href="sel-and-pred.html#cb127-341" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-342"><a href="sel-and-pred.html#cb127-342" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>testX), <span class="fu">ncol</span>(test_mat))</span>
<span id="cb127-343"><a href="sel-and-pred.html#cb127-343" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(test_mat <span class="sc">-</span> res_df<span class="sc">$</span>testX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-344"><a href="sel-and-pred.html#cb127-344" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>testX), <span class="fu">colnames</span>(test_mat))</span>
<span id="cb127-345"><a href="sel-and-pred.html#cb127-345" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">colnames</span>(res_df<span class="sc">$</span>testX), <span class="fu">colnames</span>(res_df<span class="sc">$</span>trainX))</span>
<span id="cb127-346"><a href="sel-and-pred.html#cb127-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-347"><a href="sel-and-pred.html#cb127-347" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb127-348"><a href="sel-and-pred.html#cb127-348" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb127-349"><a href="sel-and-pred.html#cb127-349" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb127-350"><a href="sel-and-pred.html#cb127-350" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb127-351"><a href="sel-and-pred.html#cb127-351" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb127-352"><a href="sel-and-pred.html#cb127-352" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb127-353"><a href="sel-and-pred.html#cb127-353" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb127-354"><a href="sel-and-pred.html#cb127-354" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb127-355"><a href="sel-and-pred.html#cb127-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-356"><a href="sel-and-pred.html#cb127-356" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb127-357"><a href="sel-and-pred.html#cb127-357" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_res_df, <span class="at">testX=</span>X_df[test_inds, ],</span>
<span id="cb127-358"><a href="sel-and-pred.html#cb127-358" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">weighting=</span><span class="st">&quot;simple_avg&quot;</span>, <span class="at">cutoff=</span><span class="fl">0.3</span>,</span>
<span id="cb127-359"><a href="sel-and-pred.html#cb127-359" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">min_num_clusts=</span><span class="dv">1</span>, <span class="at">max_num_clusts=</span><span class="dv">4</span>,</span>
<span id="cb127-360"><a href="sel-and-pred.html#cb127-360" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">trainX=</span>X_df[train_inds, ],</span>
<span id="cb127-361"><a href="sel-and-pred.html#cb127-361" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">trainY=</span>y[train_inds])</span>
<span id="cb127-362"><a href="sel-and-pred.html#cb127-362" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-363"><a href="sel-and-pred.html#cb127-363" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.list</span>(res_df))</span>
<span id="cb127-364"><a href="sel-and-pred.html#cb127-364" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_identical</span>(<span class="fu">names</span>(res_df), <span class="fu">c</span>(<span class="st">&quot;trainXProvided&quot;</span>, <span class="st">&quot;trainX&quot;</span>,</span>
<span id="cb127-365"><a href="sel-and-pred.html#cb127-365" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;testX&quot;</span>,<span class="st">&quot;feat_names&quot;</span>,</span>
<span id="cb127-366"><a href="sel-and-pred.html#cb127-366" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;max_num_clusts&quot;</span>))</span>
<span id="cb127-367"><a href="sel-and-pred.html#cb127-367" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-368"><a href="sel-and-pred.html#cb127-368" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>trainX)))</span>
<span id="cb127-369"><a href="sel-and-pred.html#cb127-369" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>trainX))</span>
<span id="cb127-370"><a href="sel-and-pred.html#cb127-370" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>trainX))</span>
<span id="cb127-371"><a href="sel-and-pred.html#cb127-371" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>trainX), <span class="fu">length</span>(train_inds))</span>
<span id="cb127-372"><a href="sel-and-pred.html#cb127-372" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-373"><a href="sel-and-pred.html#cb127-373" aria-hidden="true" tabindex="-1"></a>  train_mat <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X_df[train_inds, ])</span>
<span id="cb127-374"><a href="sel-and-pred.html#cb127-374" aria-hidden="true" tabindex="-1"></a>  train_mat <span class="ot">&lt;-</span> train_mat[, <span class="fu">colnames</span>(train_mat) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb127-375"><a href="sel-and-pred.html#cb127-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-376"><a href="sel-and-pred.html#cb127-376" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>trainX), <span class="fu">ncol</span>(train_mat))</span>
<span id="cb127-377"><a href="sel-and-pred.html#cb127-377" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(train_mat <span class="sc">-</span> res_df<span class="sc">$</span>trainX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-378"><a href="sel-and-pred.html#cb127-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-379"><a href="sel-and-pred.html#cb127-379" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df<span class="sc">$</span>testX)))</span>
<span id="cb127-380"><a href="sel-and-pred.html#cb127-380" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.matrix</span>(res_df<span class="sc">$</span>testX))</span>
<span id="cb127-381"><a href="sel-and-pred.html#cb127-381" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df<span class="sc">$</span>testX))</span>
<span id="cb127-382"><a href="sel-and-pred.html#cb127-382" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">nrow</span>(res_df<span class="sc">$</span>testX), <span class="fu">length</span>(test_inds))</span>
<span id="cb127-383"><a href="sel-and-pred.html#cb127-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-384"><a href="sel-and-pred.html#cb127-384" aria-hidden="true" tabindex="-1"></a>  test_mat <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">model.matrix</span>(<span class="sc">~</span> ., X_df[test_inds, ])</span>
<span id="cb127-385"><a href="sel-and-pred.html#cb127-385" aria-hidden="true" tabindex="-1"></a>  test_mat <span class="ot">&lt;-</span> test_mat[, <span class="fu">colnames</span>(test_mat) <span class="sc">!=</span> <span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb127-386"><a href="sel-and-pred.html#cb127-386" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-387"><a href="sel-and-pred.html#cb127-387" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(res_df<span class="sc">$</span>testX), <span class="fu">ncol</span>(test_mat))</span>
<span id="cb127-388"><a href="sel-and-pred.html#cb127-388" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="fu">abs</span>(test_mat <span class="sc">-</span> res_df<span class="sc">$</span>testX) <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^</span>(<span class="sc">-</span><span class="dv">9</span>)))</span>
<span id="cb127-389"><a href="sel-and-pred.html#cb127-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-390"><a href="sel-and-pred.html#cb127-390" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-391"><a href="sel-and-pred.html#cb127-391" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## â”€â”€ Warning (&#39;&lt;text&gt;:251&#39;): checkGetCssPredsInputs works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. testthat::expect_warning(...)
##  7. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)
##  8. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(testX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:278&#39;): checkGetCssPredsInputs works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:357&#39;): checkGetCssPredsInputs works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)</code></pre>
<p>Finally, tests for <code><a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>()</code></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="sel-and-pred.html#cb129-1" aria-hidden="true" tabindex="-1"></a>testthat<span class="sc">::</span><span class="fu">test_that</span>(<span class="st">&quot;getCssPreds works&quot;</span>, {</span>
<span id="cb129-2"><a href="sel-and-pred.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">70811</span>)</span>
<span id="cb129-3"><a href="sel-and-pred.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="sel-and-pred.html#cb129-4" aria-hidden="true" tabindex="-1"></a>  x_select <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">10</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb129-5"><a href="sel-and-pred.html#cb129-5" aria-hidden="true" tabindex="-1"></a>  x_train <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">8</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb129-6"><a href="sel-and-pred.html#cb129-6" aria-hidden="true" tabindex="-1"></a>  x_pred <span class="ot">&lt;-</span> <span class="fu">matrix</span>(stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">7</span><span class="sc">*</span><span class="dv">6</span>), <span class="at">nrow=</span><span class="dv">7</span>, <span class="at">ncol=</span><span class="dv">6</span>)</span>
<span id="cb129-7"><a href="sel-and-pred.html#cb129-7" aria-hidden="true" tabindex="-1"></a>  y_select <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb129-8"><a href="sel-and-pred.html#cb129-8" aria-hidden="true" tabindex="-1"></a>  y_train <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="dv">8</span>)</span>
<span id="cb129-9"><a href="sel-and-pred.html#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="sel-and-pred.html#cb129-10" aria-hidden="true" tabindex="-1"></a>  good_clusters <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;red&quot;</span><span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="st">&quot;blue&quot;</span><span class="ot">=</span><span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;green&quot;</span><span class="ot">=</span><span class="dv">5</span>)</span>
<span id="cb129-11"><a href="sel-and-pred.html#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="sel-and-pred.html#cb129-12" aria-hidden="true" tabindex="-1"></a>  css_res <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">clusters=</span>good_clusters,</span>
<span id="cb129-13"><a href="sel-and-pred.html#cb129-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb129-14"><a href="sel-and-pred.html#cb129-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-15"><a href="sel-and-pred.html#cb129-15" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train)</span>
<span id="cb129-16"><a href="sel-and-pred.html#cb129-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-17"><a href="sel-and-pred.html#cb129-17" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res)))</span>
<span id="cb129-18"><a href="sel-and-pred.html#cb129-18" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb129-19"><a href="sel-and-pred.html#cb129-19" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">7</span>)</span>
<span id="cb129-20"><a href="sel-and-pred.html#cb129-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-21"><a href="sel-and-pred.html#cb129-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">##### Try other bad inputs</span></span>
<span id="cb129-22"><a href="sel-and-pred.html#cb129-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-23"><a href="sel-and-pred.html#cb129-23" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">cutoff=</span><span class="sc">-</span><span class="fl">0.5</span>,</span>
<span id="cb129-24"><a href="sel-and-pred.html#cb129-24" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-25"><a href="sel-and-pred.html#cb129-25" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;cutoff &gt;= 0 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-26"><a href="sel-and-pred.html#cb129-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-27"><a href="sel-and-pred.html#cb129-27" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">cutoff=</span><span class="st">&quot;0.3&quot;</span>,</span>
<span id="cb129-28"><a href="sel-and-pred.html#cb129-28" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-29"><a href="sel-and-pred.html#cb129-29" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(cutoff) | is.integer(cutoff) is not TRUE&quot;</span>,</span>
<span id="cb129-30"><a href="sel-and-pred.html#cb129-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-31"><a href="sel-and-pred.html#cb129-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-32"><a href="sel-and-pred.html#cb129-32" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-33"><a href="sel-and-pred.html#cb129-33" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">cutoff=</span><span class="fu">as.numeric</span>(<span class="cn">NA</span>), <span class="at">trainX=</span>x_train,</span>
<span id="cb129-34"><a href="sel-and-pred.html#cb129-34" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainY=</span>y_train),</span>
<span id="cb129-35"><a href="sel-and-pred.html#cb129-35" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;!is.na(cutoff) is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-36"><a href="sel-and-pred.html#cb129-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-37"><a href="sel-and-pred.html#cb129-37" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-38"><a href="sel-and-pred.html#cb129-38" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">weighting=</span><span class="fu">c</span>(<span class="st">&quot;sparse&quot;</span>, <span class="st">&quot;simple_avg&quot;</span>),</span>
<span id="cb129-39"><a href="sel-and-pred.html#cb129-39" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-40"><a href="sel-and-pred.html#cb129-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(weighting) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-41"><a href="sel-and-pred.html#cb129-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-42"><a href="sel-and-pred.html#cb129-42" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">weighting=</span><span class="dv">2</span>,</span>
<span id="cb129-43"><a href="sel-and-pred.html#cb129-43" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-44"><a href="sel-and-pred.html#cb129-44" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-45"><a href="sel-and-pred.html#cb129-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-46"><a href="sel-and-pred.html#cb129-46" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">weighting=</span><span class="st">&quot;spasre&quot;</span>,</span>
<span id="cb129-47"><a href="sel-and-pred.html#cb129-47" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-48"><a href="sel-and-pred.html#cb129-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;Weighting must be a character and one of sparse, simple_avg, or weighted_avg&quot;</span>,</span>
<span id="cb129-49"><a href="sel-and-pred.html#cb129-49" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-50"><a href="sel-and-pred.html#cb129-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-51"><a href="sel-and-pred.html#cb129-51" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-52"><a href="sel-and-pred.html#cb129-52" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">min_num_clusts=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">trainX=</span>x_train,</span>
<span id="cb129-53"><a href="sel-and-pred.html#cb129-53" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainY=</span>y_train),</span>
<span id="cb129-54"><a href="sel-and-pred.html#cb129-54" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;length(min_num_clusts) == 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-55"><a href="sel-and-pred.html#cb129-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-56"><a href="sel-and-pred.html#cb129-56" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">min_num_clusts=</span><span class="st">&quot;2&quot;</span>,</span>
<span id="cb129-57"><a href="sel-and-pred.html#cb129-57" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-58"><a href="sel-and-pred.html#cb129-58" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(min_num_clusts) | is.integer(min_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb129-59"><a href="sel-and-pred.html#cb129-59" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-60"><a href="sel-and-pred.html#cb129-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-61"><a href="sel-and-pred.html#cb129-61" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">min_num_clusts=</span><span class="dv">0</span>,</span>
<span id="cb129-62"><a href="sel-and-pred.html#cb129-62" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-63"><a href="sel-and-pred.html#cb129-63" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &gt;= 1 is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-64"><a href="sel-and-pred.html#cb129-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-65"><a href="sel-and-pred.html#cb129-65" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">min_num_clusts=</span><span class="dv">10</span>,</span>
<span id="cb129-66"><a href="sel-and-pred.html#cb129-66" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-67"><a href="sel-and-pred.html#cb129-67" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;min_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-68"><a href="sel-and-pred.html#cb129-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-69"><a href="sel-and-pred.html#cb129-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-70"><a href="sel-and-pred.html#cb129-70" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">max_num_clusts=</span><span class="st">&quot;5&quot;</span>,</span>
<span id="cb129-71"><a href="sel-and-pred.html#cb129-71" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-72"><a href="sel-and-pred.html#cb129-72" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;is.numeric(max_num_clusts) | is.integer(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb129-73"><a href="sel-and-pred.html#cb129-73" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-74"><a href="sel-and-pred.html#cb129-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-75"><a href="sel-and-pred.html#cb129-75" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">max_num_clusts=</span><span class="fl">4.5</span>,</span>
<span id="cb129-76"><a href="sel-and-pred.html#cb129-76" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-77"><a href="sel-and-pred.html#cb129-77" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts == round(max_num_clusts) is not TRUE&quot;</span>,</span>
<span id="cb129-78"><a href="sel-and-pred.html#cb129-78" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-79"><a href="sel-and-pred.html#cb129-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-80"><a href="sel-and-pred.html#cb129-80" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">min_num_clusts=</span><span class="dv">3</span>,</span>
<span id="cb129-81"><a href="sel-and-pred.html#cb129-81" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">max_num_clusts=</span><span class="dv">2</span>, <span class="at">trainX=</span>x_train,</span>
<span id="cb129-82"><a href="sel-and-pred.html#cb129-82" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainY=</span>y_train),</span>
<span id="cb129-83"><a href="sel-and-pred.html#cb129-83" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &gt;= min_num_clusts is not TRUE&quot;</span>,</span>
<span id="cb129-84"><a href="sel-and-pred.html#cb129-84" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-85"><a href="sel-and-pred.html#cb129-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-86"><a href="sel-and-pred.html#cb129-86" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred, <span class="at">max_num_clusts=</span><span class="dv">10</span>,</span>
<span id="cb129-87"><a href="sel-and-pred.html#cb129-87" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-88"><a href="sel-and-pred.html#cb129-88" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;max_num_clusts &lt;= p is not TRUE&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-89"><a href="sel-and-pred.html#cb129-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-90"><a href="sel-and-pred.html#cb129-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add training indices</span></span>
<span id="cb129-91"><a href="sel-and-pred.html#cb129-91" aria-hidden="true" tabindex="-1"></a>  css_res_train <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb129-92"><a href="sel-and-pred.html#cb129-92" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B=</span><span class="dv">10</span>, <span class="at">train_inds=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb129-93"><a href="sel-and-pred.html#cb129-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-94"><a href="sel-and-pred.html#cb129-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Training indices should be ignored if new x is provided</span></span>
<span id="cb129-95"><a href="sel-and-pred.html#cb129-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-96"><a href="sel-and-pred.html#cb129-96" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_train, <span class="at">testX=</span>x_pred, <span class="at">trainX=</span>x_train,</span>
<span id="cb129-97"><a href="sel-and-pred.html#cb129-97" aria-hidden="true" tabindex="-1"></a>                     <span class="at">trainY=</span>y_train)</span>
<span id="cb129-98"><a href="sel-and-pred.html#cb129-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-99"><a href="sel-and-pred.html#cb129-99" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res)))</span>
<span id="cb129-100"><a href="sel-and-pred.html#cb129-100" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb129-101"><a href="sel-and-pred.html#cb129-101" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">7</span>)</span>
<span id="cb129-102"><a href="sel-and-pred.html#cb129-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-103"><a href="sel-and-pred.html#cb129-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Things should still work if new x is not provided</span></span>
<span id="cb129-104"><a href="sel-and-pred.html#cb129-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-105"><a href="sel-and-pred.html#cb129-105" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_train, <span class="at">testX=</span>x_pred)</span>
<span id="cb129-106"><a href="sel-and-pred.html#cb129-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-107"><a href="sel-and-pred.html#cb129-107" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res)))</span>
<span id="cb129-108"><a href="sel-and-pred.html#cb129-108" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb129-109"><a href="sel-and-pred.html#cb129-109" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">7</span>)</span>
<span id="cb129-110"><a href="sel-and-pred.html#cb129-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-111"><a href="sel-and-pred.html#cb129-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try not providing training indices and omitting newX--should get error</span></span>
<span id="cb129-112"><a href="sel-and-pred.html#cb129-112" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res, <span class="at">testX=</span>x_pred),</span>
<span id="cb129-113"><a href="sel-and-pred.html#cb129-113" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;css was not provided with indices to set aside for model training (train_inds), so must provide new X in order to generate a design matrix&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-114"><a href="sel-and-pred.html#cb129-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-115"><a href="sel-and-pred.html#cb129-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try naming variables</span></span>
<span id="cb129-116"><a href="sel-and-pred.html#cb129-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-117"><a href="sel-and-pred.html#cb129-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_select) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb129-118"><a href="sel-and-pred.html#cb129-118" aria-hidden="true" tabindex="-1"></a>  css_res_named <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>x_select, <span class="at">y=</span>y_select, <span class="at">lambda=</span><span class="fl">0.01</span>,</span>
<span id="cb129-119"><a href="sel-and-pred.html#cb129-119" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clusters=</span>good_clusters, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb129-120"><a href="sel-and-pred.html#cb129-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-121"><a href="sel-and-pred.html#cb129-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Named variables for css matrix but not new one--should get a warning</span></span>
<span id="cb129-122"><a href="sel-and-pred.html#cb129-122" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_warning</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-123"><a href="sel-and-pred.html#cb129-123" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-124"><a href="sel-and-pred.html#cb129-124" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;New X provided had no variable names (column names) even though the X provided to css did.&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-125"><a href="sel-and-pred.html#cb129-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-126"><a href="sel-and-pred.html#cb129-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try mismatching variable names</span></span>
<span id="cb129-127"><a href="sel-and-pred.html#cb129-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_train) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb129-128"><a href="sel-and-pred.html#cb129-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb129-129"><a href="sel-and-pred.html#cb129-129" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-130"><a href="sel-and-pred.html#cb129-130" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-131"><a href="sel-and-pred.html#cb129-131" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb129-132"><a href="sel-and-pred.html#cb129-132" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-133"><a href="sel-and-pred.html#cb129-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-134"><a href="sel-and-pred.html#cb129-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_train) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb129-135"><a href="sel-and-pred.html#cb129-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb129-136"><a href="sel-and-pred.html#cb129-136" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_error</span>(<a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_named, <span class="at">testX=</span>x_pred,</span>
<span id="cb129-137"><a href="sel-and-pred.html#cb129-137" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">trainX=</span>x_train, <span class="at">trainY=</span>y_train),</span>
<span id="cb129-138"><a href="sel-and-pred.html#cb129-138" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;identical(feat_names, colnames(css_X)) is not TRUE&quot;</span>,</span>
<span id="cb129-139"><a href="sel-and-pred.html#cb129-139" aria-hidden="true" tabindex="-1"></a>                         <span class="at">fixed=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-140"><a href="sel-and-pred.html#cb129-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-141"><a href="sel-and-pred.html#cb129-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_pred) <span class="ot">&lt;-</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb129-142"><a href="sel-and-pred.html#cb129-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-143"><a href="sel-and-pred.html#cb129-143" aria-hidden="true" tabindex="-1"></a>  res_named <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_named, <span class="at">testX=</span>x_pred, <span class="at">trainX=</span>x_train,</span>
<span id="cb129-144"><a href="sel-and-pred.html#cb129-144" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trainY=</span>y_train)</span>
<span id="cb129-145"><a href="sel-and-pred.html#cb129-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-146"><a href="sel-and-pred.html#cb129-146" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res)))</span>
<span id="cb129-147"><a href="sel-and-pred.html#cb129-147" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res))</span>
<span id="cb129-148"><a href="sel-and-pred.html#cb129-148" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res), <span class="dv">7</span>)</span>
<span id="cb129-149"><a href="sel-and-pred.html#cb129-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-150"><a href="sel-and-pred.html#cb129-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try data.frame input to css and getCssPreds</span></span>
<span id="cb129-151"><a href="sel-and-pred.html#cb129-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-152"><a href="sel-and-pred.html#cb129-152" aria-hidden="true" tabindex="-1"></a>  X_df <span class="ot">&lt;-</span> datasets<span class="sc">::</span>mtcars</span>
<span id="cb129-153"><a href="sel-and-pred.html#cb129-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-154"><a href="sel-and-pred.html#cb129-154" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X_df)</span>
<span id="cb129-155"><a href="sel-and-pred.html#cb129-155" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(n)</span>
<span id="cb129-156"><a href="sel-and-pred.html#cb129-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-157"><a href="sel-and-pred.html#cb129-157" aria-hidden="true" tabindex="-1"></a>  selec_inds <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">round</span>(n<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb129-158"><a href="sel-and-pred.html#cb129-158" aria-hidden="true" tabindex="-1"></a>  train_inds <span class="ot">&lt;-</span> (<span class="fu">max</span>(selec_inds) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">max</span>(selec_inds) <span class="sc">+</span> <span class="dv">17</span>)</span>
<span id="cb129-159"><a href="sel-and-pred.html#cb129-159" aria-hidden="true" tabindex="-1"></a>  test_inds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="fu">c</span>(selec_inds, train_inds))</span>
<span id="cb129-160"><a href="sel-and-pred.html#cb129-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-161"><a href="sel-and-pred.html#cb129-161" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[<span class="fu">c</span>(selec_inds, train_inds), ],</span>
<span id="cb129-162"><a href="sel-and-pred.html#cb129-162" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y=</span>y[<span class="fu">c</span>(selec_inds, train_inds)], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>,</span>
<span id="cb129-163"><a href="sel-and-pred.html#cb129-163" aria-hidden="true" tabindex="-1"></a>                    <span class="at">train_inds=</span>train_inds)</span>
<span id="cb129-164"><a href="sel-and-pred.html#cb129-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-165"><a href="sel-and-pred.html#cb129-165" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_df, <span class="at">testX=</span>X_df[test_inds, ])</span>
<span id="cb129-166"><a href="sel-and-pred.html#cb129-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-167"><a href="sel-and-pred.html#cb129-167" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df)))</span>
<span id="cb129-168"><a href="sel-and-pred.html#cb129-168" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb129-169"><a href="sel-and-pred.html#cb129-169" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_df), <span class="fu">length</span>(test_inds))</span>
<span id="cb129-170"><a href="sel-and-pred.html#cb129-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-171"><a href="sel-and-pred.html#cb129-171" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Try again with X as a dataframe with factors (number of columns of final</span></span>
<span id="cb129-172"><a href="sel-and-pred.html#cb129-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># design matrix after one-hot encoding factors won&#39;t match number of columns</span></span>
<span id="cb129-173"><a href="sel-and-pred.html#cb129-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of X_df)</span></span>
<span id="cb129-174"><a href="sel-and-pred.html#cb129-174" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>cyl <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>cyl)</span>
<span id="cb129-175"><a href="sel-and-pred.html#cb129-175" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>vs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>vs)</span>
<span id="cb129-176"><a href="sel-and-pred.html#cb129-176" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>am <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>am)</span>
<span id="cb129-177"><a href="sel-and-pred.html#cb129-177" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>gear)</span>
<span id="cb129-178"><a href="sel-and-pred.html#cb129-178" aria-hidden="true" tabindex="-1"></a>  X_df<span class="sc">$</span>carb <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(X_df<span class="sc">$</span>carb)</span>
<span id="cb129-179"><a href="sel-and-pred.html#cb129-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-180"><a href="sel-and-pred.html#cb129-180" aria-hidden="true" tabindex="-1"></a>  css_res_df <span class="ot">&lt;-</span> <a href='css.html#css'>css</a>(<span class="at">X=</span>X_df[selec_inds, ], <span class="at">y=</span>y[selec_inds], <span class="at">lambda=</span><span class="fl">0.01</span>, <span class="at">B =</span> <span class="dv">10</span>)</span>
<span id="cb129-181"><a href="sel-and-pred.html#cb129-181" aria-hidden="true" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(css_res_df, <span class="at">testX=</span>X_df[test_inds, ],</span>
<span id="cb129-182"><a href="sel-and-pred.html#cb129-182" aria-hidden="true" tabindex="-1"></a>                        <span class="at">trainX=</span>X_df[train_inds, ], <span class="at">trainY=</span>y[train_inds])</span>
<span id="cb129-183"><a href="sel-and-pred.html#cb129-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb129-184"><a href="sel-and-pred.html#cb129-184" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">(gregfaletto): known issue--the above code produces the following</span></span>
<span id="cb129-185"><a href="sel-and-pred.html#cb129-185" aria-hidden="true" tabindex="-1"></a>  <span class="co"># undesired warnings:</span></span>
<span id="cb129-186"><a href="sel-and-pred.html#cb129-186" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1: In <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(css_results, testX, weighting, cutoff,  :</span></span>
<span id="cb129-187"><a href="sel-and-pred.html#cb129-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)</span></span>
<span id="cb129-188"><a href="sel-and-pred.html#cb129-188" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2: In <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X) :</span></span>
<span id="cb129-189"><a href="sel-and-pred.html#cb129-189" aria-hidden="true" tabindex="-1"></a>  <span class="co"># New X provided had no variable names (column names) even though the X provided to css did.</span></span>
<span id="cb129-190"><a href="sel-and-pred.html#cb129-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-191"><a href="sel-and-pred.html#cb129-191" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(res_df)))</span>
<span id="cb129-192"><a href="sel-and-pred.html#cb129-192" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_true</span>(<span class="fu">is.numeric</span>(res_df))</span>
<span id="cb129-193"><a href="sel-and-pred.html#cb129-193" aria-hidden="true" tabindex="-1"></a>  testthat<span class="sc">::</span><span class="fu">expect_equal</span>(<span class="fu">length</span>(res_df), <span class="fu">length</span>(test_inds))</span>
<span id="cb129-194"><a href="sel-and-pred.html#cb129-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-195"><a href="sel-and-pred.html#cb129-195" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## â”€â”€ Warning (&#39;&lt;text&gt;:122&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. testthat::expect_warning(...)
##  7. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  8. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)
##  9. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(testX, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:122&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##   1. testthat::expect_warning(...)
##   7. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##   8. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##   9. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  10. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:122&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##   1. testthat::expect_warning(...)
##   7. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##   8. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##   9. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  10. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:143&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:143&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##  3. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  4. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:181&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## Column names were provided for testX but not for trainX (are you sure they both contain identical features in the same order?)
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#checkGetCssPredsInputs'>checkGetCssPredsInputs</a>(...)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:181&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## New X provided had no variable names (column names) even though the X provided to css did.
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  2. litr (local) <a href='sel-and-pred.html#formCssDesign'>formCssDesign</a>(...)
##  3. litr (local) <a href='sel-and-pred.html#checkFormCssDesignInputs'>checkFormCssDesignInputs</a>(...)
##  4. litr (local) <a href='sel-and-pred.html#checkXInputResults'>checkXInputResults</a>(newx, css_results$X)
## 
## â”€â”€ Warning (&#39;&lt;text&gt;:181&#39;): getCssPreds works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
## prediction from a rank-deficient fit may be misleading
## Backtrace:
##  1. litr (local) <a href='sel-and-pred.html#getCssPreds'>getCssPreds</a>(...)
##  2. stats::predict.lm(model, newdata = df_test)</code></pre>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tests-for-main-functions-in-cssr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="other-useful.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
